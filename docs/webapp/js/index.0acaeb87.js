(function(){var e={739:function(e,t,i){"use strict";i(1703);var n=i(9963),o=i(6252),a=i(3577);function s(e,t,i,n,s,r){const l=(0,o.up)("StandardLayout"),c=(0,o.up)("GameDialog"),d=(0,o.up)("ResearchDialog"),h=(0,o.up)("AnalysisDialog"),u=(0,o.up)("USIEngineManagementDialog"),p=(0,o.up)("AppSettingDialog"),g=(0,o.up)("PasteDialog"),m=(0,o.up)("BussyMessage"),_=(0,o.up)("ConfirmDialog"),v=(0,o.up)("InfoMessage"),S=(0,o.up)("ErrorMessage");return(0,o.wg)(),(0,o.iD)("div",{class:(0,a.C_)(["root",e.thema])},[(0,o.Wm)(l,{class:"main"}),e.dialogVisibilities.game?((0,o.wg)(),(0,o.j4)(c,{key:0})):(0,o.kq)("",!0),e.dialogVisibilities.research?((0,o.wg)(),(0,o.j4)(d,{key:1})):(0,o.kq)("",!0),e.dialogVisibilities.analysis?((0,o.wg)(),(0,o.j4)(h,{key:2})):(0,o.kq)("",!0),e.dialogVisibilities.usiEngineSetting?((0,o.wg)(),(0,o.j4)(u,{key:3})):(0,o.kq)("",!0),e.dialogVisibilities.appSetting?((0,o.wg)(),(0,o.j4)(p,{key:4})):(0,o.kq)("",!0),e.dialogVisibilities.paste?((0,o.wg)(),(0,o.j4)(g,{key:5})):(0,o.kq)("",!0),e.dialogVisibilities.bussy?((0,o.wg)(),(0,o.j4)(m,{key:6})):(0,o.kq)("",!0),e.dialogVisibilities.confirm?((0,o.wg)(),(0,o.j4)(_,{key:7})):(0,o.kq)("",!0),e.hasMessage?((0,o.wg)(),(0,o.j4)(v,{key:8})):(0,o.kq)("",!0),e.hasErrors?((0,o.wg)(),(0,o.j4)(S,{key:9})):(0,o.kq)("",!0)],2)}const r={class:"main"},l={class:"top-pane"};function c(e,t,i,n,s,c){const d=(0,o.up)("BoardPane"),h=(0,o.up)("RecordPane"),u=(0,o.up)("TabPane");return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("div",r,[(0,o._)("div",l,[(0,o.Wm)(d,{class:"top-left-pane","max-size":e.boardPaneMaxSize,onResize:e.onBoardPaneResize},null,8,["max-size","onResize"]),(0,o.Wm)(h,{class:"top-right-pane",style:(0,a.j5)(e.recordPaneStyle)},null,8,["style"])]),(0,o.Wm)(u,{class:"bottom-pane",size:e.bottomPaneSize},null,8,["size"])])])}var d=i(2262);const h={class:"control top"},u=(0,o.Uk)(" 対局 "),p=(0,o.Uk)(" 対局中断 "),g=(0,o.Uk)(" 投了 "),m=(0,o.Uk)(" 検討 "),_=(0,o.Uk)(" 検討終了 "),v=(0,o.Uk)(" 解析 "),S=(0,o.Uk)(" 解析中断 "),E=(0,o.Uk)(" 局面編集 "),w=(0,o.Uk)(" 局面編集終了 "),I=(0,o.Uk)(" 手番変更 "),f={class:"control bottom"},y=(0,o.Uk)(" アプリ設定 "),b=["disabled"],T=(0,o.Uk)(" エンジン設定 "),A=(0,o.Uk)(" 盤面反転 "),N=(0,o.Uk)(" ファイル "),P=["disabled"],R=(0,o.Uk)(" 指し手削除 ");function k(e,t,i,n,a,s){const r=(0,o.up)("ButtonIcon"),l=(0,o.up)("BoardView"),c=(0,o.up)("FileMenu"),d=(0,o.up)("InitialPositionMenu");return(0,o.wg)(),(0,o.iD)("div",null,[(0,o.Wm)(l,{"piece-image-type":e.appSetting.pieceImage,"board-image-type":e.appSetting.boardImage,"board-label-type":e.appSetting.boardLabelType,"max-size":e.maxSize,position:e.position,"last-move":e.lastMove,flip:e.appSetting.boardFlipping,"allow-move":e.allowMove,"allow-edit":e.allowEdit,"black-player-name":e.blackPlayerName,"white-player-name":e.whitePlayerName,"black-player-time-ms":e.blackPlayerTimeMs,"black-player-byoyomi":e.blackPlayerByoyomi,"white-player-time-ms":e.whitePlayerTimeMs,"white-player-byoyomi":e.whitePlayerByoyomi,onResize:e.onResize,onMove:e.onMove,onEdit:e.onEdit},{"right-control":(0,o.w5)((()=>[(0,o._)("div",h,[e.controlStates.game?((0,o.wg)(),(0,o.iD)("button",{key:0,class:"control-item",onClick:t[0]||(t[0]=(...t)=>e.onGame&&e.onGame(...t))},[(0,o.Wm)(r,{class:"icon",icon:e.Icon.GAME},null,8,["icon"]),u])):(0,o.kq)("",!0),e.controlStates.stop?((0,o.wg)(),(0,o.iD)("button",{key:1,class:"control-item",onClick:t[1]||(t[1]=(...t)=>e.onStop&&e.onStop(...t))},[(0,o.Wm)(r,{class:"icon",icon:e.Icon.STOP},null,8,["icon"]),p])):(0,o.kq)("",!0),e.controlStates.resign?((0,o.wg)(),(0,o.iD)("button",{key:2,class:"control-item",onClick:t[2]||(t[2]=(...t)=>e.onResign&&e.onResign(...t))},[(0,o.Wm)(r,{class:"icon",icon:e.Icon.RESIGN},null,8,["icon"]),g])):(0,o.kq)("",!0),e.controlStates.research?((0,o.wg)(),(0,o.iD)("button",{key:3,class:"control-item",onClick:t[3]||(t[3]=(...t)=>e.onResearch&&e.onResearch(...t))},[(0,o.Wm)(r,{class:"icon",icon:e.Icon.RESEARCH},null,8,["icon"]),m])):(0,o.kq)("",!0),e.controlStates.endResearch?((0,o.wg)(),(0,o.iD)("button",{key:4,class:"control-item",onClick:t[4]||(t[4]=(...t)=>e.onEndResearch&&e.onEndResearch(...t))},[(0,o.Wm)(r,{class:"icon",icon:e.Icon.END},null,8,["icon"]),_])):(0,o.kq)("",!0),e.controlStates.analysis?((0,o.wg)(),(0,o.iD)("button",{key:5,class:"control-item",onClick:t[5]||(t[5]=(...t)=>e.onAnalysis&&e.onAnalysis(...t))},[(0,o.Wm)(r,{class:"icon",icon:e.Icon.ANALYSIS},null,8,["icon"]),v])):(0,o.kq)("",!0),e.controlStates.endAnalysis?((0,o.wg)(),(0,o.iD)("button",{key:6,class:"control-item",onClick:t[6]||(t[6]=(...t)=>e.onEndAnalysis&&e.onEndAnalysis(...t))},[(0,o.Wm)(r,{class:"icon",icon:e.Icon.STOP},null,8,["icon"]),S])):(0,o.kq)("",!0),e.controlStates.startEditPosition?((0,o.wg)(),(0,o.iD)("button",{key:7,class:"control-item",onClick:t[7]||(t[7]=(...t)=>e.onStartEditPosition&&e.onStartEditPosition(...t))},[(0,o.Wm)(r,{class:"icon",icon:e.Icon.EDIT},null,8,["icon"]),E])):(0,o.kq)("",!0),e.controlStates.endEditPosition?((0,o.wg)(),(0,o.iD)("button",{key:8,class:"control-item",onClick:t[8]||(t[8]=(...t)=>e.onEndEditPosition&&e.onEndEditPosition(...t))},[(0,o.Wm)(r,{class:"icon",icon:e.Icon.CHECK},null,8,["icon"]),w])):(0,o.kq)("",!0),e.controlStates.initPosition?((0,o.wg)(),(0,o.iD)("button",{key:9,class:"control-item",onClick:t[9]||(t[9]=(...t)=>e.onChangeTurn&&e.onChangeTurn(...t))},[(0,o.Wm)(r,{class:"icon",icon:e.Icon.SWAP},null,8,["icon"]),I])):(0,o.kq)("",!0),e.controlStates.initPosition?((0,o.wg)(),(0,o.iD)("button",{key:10,class:"control-item",onClick:t[10]||(t[10]=(...t)=>e.onInitPosition&&e.onInitPosition(...t))}," 局面の初期化 ")):(0,o.kq)("",!0)])])),"left-control":(0,o.w5)((()=>[(0,o._)("div",f,[(0,o._)("button",{class:"control-item",onClick:t[11]||(t[11]=(...t)=>e.onOpenAppSettings&&e.onOpenAppSettings(...t))},[(0,o.Wm)(r,{class:"icon",icon:e.Icon.SETTINGS},null,8,["icon"]),y]),(0,o._)("button",{class:"control-item",disabled:!e.controlStates.engineSettings,onClick:t[12]||(t[12]=(...t)=>e.onOpenEngineSettings&&e.onOpenEngineSettings(...t))},[(0,o.Wm)(r,{class:"icon",icon:e.Icon.ENGINE_SETTINGS},null,8,["icon"]),T],8,b),(0,o._)("button",{class:"control-item",onClick:t[13]||(t[13]=(...t)=>e.onFlip&&e.onFlip(...t))},[(0,o.Wm)(r,{class:"icon",icon:e.Icon.FLIP},null,8,["icon"]),A]),(0,o._)("button",{class:"control-item",onClick:t[14]||(t[14]=(...t)=>e.onFileAction&&e.onFileAction(...t))},[(0,o.Wm)(r,{class:"icon",icon:e.Icon.FILE},null,8,["icon"]),N]),(0,o._)("button",{class:"control-item",disabled:!e.controlStates.removeAfter,onClick:t[15]||(t[15]=(...t)=>e.onRemoveAfter&&e.onRemoveAfter(...t))},[(0,o.Wm)(r,{class:"icon",icon:e.Icon.DELETE},null,8,["icon"]),R],8,P)])])),_:1},8,["piece-image-type","board-image-type","board-label-type","max-size","position","last-move","flip","allow-move","allow-edit","black-player-name","white-player-name","black-player-time-ms","black-player-byoyomi","white-player-time-ms","white-player-byoyomi","onResize","onMove","onEdit"]),e.isFileMenuVisible?((0,o.wg)(),(0,o.j4)(c,{key:0,onClose:t[16]||(t[16]=t=>e.isFileMenuVisible=!1)})):(0,o.kq)("",!0),e.isInitialPositionMenuVisible?((0,o.wg)(),(0,o.j4)(d,{key:1,onClose:t[17]||(t[17]=t=>e.isInitialPositionMenuVisible=!1)})):(0,o.kq)("",!0)])}const O=["src"],C={class:"player-name-text"},H={class:"clock-text"},M={class:"player-name-text"},L={class:"clock-text"},D=["src"],B=["onClick","onContextmenu"],G=["src"],x=["onClick"],W=["src"],U=["onClick"],K=["src"],F=["src"];function q(e,t,i,n,s,r){return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("div",{class:"frame",style:(0,a.j5)(e.layout.frame.style),onClick:t[2]||(t[2]=t=>e.clickFrame())},[(0,o._)("div",{class:"board",style:(0,a.j5)(e.layout.board.style)},[(0,o._)("img",{class:"board-image",src:e.layout.board.imagePath},null,8,O)],4),(0,o._)("div",{class:(0,a.C_)(["player-name",{active:"black"==e.position.color}]),style:(0,a.j5)(e.layout.blackPlayerName.style)},[(0,o._)("span",C,"▲"+(0,a.zw)(e.blackPlayerName),1)],6),(0,o._)("div",{class:(0,a.C_)(["clock",e.blackPlayerTimeSeverity]),style:(0,a.j5)(e.layout.blackClock.style)},[(0,o._)("span",H,(0,a.zw)(e.blackPlayerTimeText),1)],6),(0,o._)("div",{class:(0,a.C_)(["player-name",{active:"white"==e.position.color}]),style:(0,a.j5)(e.layout.whitePlayerName.style)},[(0,o._)("span",M,"△"+(0,a.zw)(e.whitePlayerName),1)],6),(0,o._)("div",{class:(0,a.C_)(["clock",e.whitePlayerTimeSeverity]),style:(0,a.j5)(e.layout.whiteClock.style)},[(0,o._)("span",L,(0,a.zw)(e.whitePlayerTimeText),1)],6),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.layout.square,(e=>((0,o.wg)(),(0,o.iD)("div",{key:e.id,class:"square",style:(0,a.j5)(e.backgroundStyle)},null,4)))),128)),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.layout.piece,(e=>((0,o.wg)(),(0,o.iD)("div",{key:e.id,class:"piece",style:(0,a.j5)(e.style)},[(0,o._)("img",{class:"piece-image",src:e.imagePath},null,8,D)],4)))),128)),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.layout.labels,(e=>((0,o.wg)(),(0,o.iD)("div",{key:e.id,class:"label",style:(0,a.j5)(e.style)},(0,a.zw)(e.character),5)))),128)),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.layout.square,(t=>((0,o.wg)(),(0,o.iD)("div",{key:t.id,class:"square",style:(0,a.j5)(t.style),onClick:i=>e.clickSquare(i,t.file,t.rank),onContextmenu:i=>e.clickSquareR(i,t.file,t.rank)},null,44,B)))),128)),(0,o._)("div",{class:"hand",style:(0,a.j5)(e.layout.blackHand.style)},[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.layout.blackHand.pointers,(e=>((0,o.wg)(),(0,o.iD)("div",{key:e.id,class:"hand-pointer",style:(0,a.j5)(e.backgroundStyle)},null,4)))),128)),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.layout.blackHand.pieces,(e=>((0,o.wg)(),(0,o.iD)("div",{key:e.id,class:"piece",style:(0,a.j5)(e.style)},[(0,o._)("img",{class:"piece-image",src:e.imagePath},null,8,G)],4)))),128)),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.layout.blackHand.pointers,(t=>((0,o.wg)(),(0,o.iD)("div",{key:t.id,class:"hand-pointer",style:(0,a.j5)(t.style),onClick:i=>e.clickHand(i,e.Color.BLACK,t.type)},null,12,x)))),128))],4),(0,o._)("div",{class:"hand",style:(0,a.j5)(e.layout.whiteHand.style)},[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.layout.whiteHand.pointers,(e=>((0,o.wg)(),(0,o.iD)("div",{key:e.id,class:"hand-pointer",style:(0,a.j5)(e.backgroundStyle)},null,4)))),128)),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.layout.whiteHand.pieces,(e=>((0,o.wg)(),(0,o.iD)("div",{key:e.id,class:"piece",style:(0,a.j5)(e.style)},[(0,o._)("img",{class:"piece-image",src:e.imagePath},null,8,W)],4)))),128)),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.layout.whiteHand.pointers,(t=>((0,o.wg)(),(0,o.iD)("div",{key:t.id,class:"hand-pointer",style:(0,a.j5)(t.style),onClick:i=>e.clickHand(i,e.Color.WHITE,t.type)},null,12,U)))),128))],4),e.layout.promotion?((0,o.wg)(),(0,o.iD)("div",{key:0,class:"promotion-selector",style:(0,a.j5)(e.layout.promotion.style)},[(0,o._)("div",{class:"select-button promote",onClick:t[0]||(t[0]=t=>e.clickPromote(t))},[(0,o._)("img",{class:"piece-image",src:e.layout.promotion.promoteImagePath},null,8,K)]),(0,o._)("div",{class:"select-button not-promote",onClick:t[1]||(t[1]=t=>e.clickNotPromote(t))},[(0,o._)("img",{class:"piece-image",src:e.layout.promotion.notPromoteImagePath},null,8,F)])],4)):(0,o.kq)("",!0),(0,o._)("div",{class:"turn",style:(0,a.j5)(e.layout.turn.style)},"手番",4),(0,o._)("div",{style:(0,a.j5)(e.layout.control.left.style)},[(0,o.WI)(e.$slots,"left-control",{},void 0,!0)],4),(0,o._)("div",{style:(0,a.j5)(e.layout.control.right.style)},[(0,o.WI)(e.$slots,"right-control",{},void 0,!0)],4)],4)])}i(7686),i(4506);var j,V,z=i(2482);function Z(e){return e===j.BLACK?j.WHITE:j.BLACK}function Y(e){return e===j.BLACK?"b":"w"}function $(e){return"b"===e||"w"===e}function J(e){return"b"===e?j.BLACK:j.WHITE}(function(e){e["BLACK"]="black",e["WHITE"]="white"})(j||(j={})),function(e){e["PAWN"]="pawn",e["LANCE"]="lance",e["KNIGHT"]="knight",e["SILVER"]="silver",e["GOLD"]="gold",e["BISHOP"]="bishop",e["ROOK"]="rook",e["KING"]="king",e["PROM_PAWN"]="promPawn",e["PROM_LANCE"]="promLance",e["PROM_KNIGHT"]="promKnight",e["PROM_SILVER"]="promSilver",e["HORSE"]="horse",e["DRAGON"]="dragon"}(V||(V={}));const Q={pawn:"歩",lance:"香",knight:"桂",silver:"銀",gold:"金",bishop:"角",rook:"飛",king:"玉",promPawn:"と",promLance:"成香",promKnight:"成桂",promSilver:"成銀",horse:"馬",dragon:"竜"};function X(e){const t=Q[e];return t||""}V.PAWN,V.LANCE,V.KNIGHT,V.SILVER,V.GOLD,V.BISHOP,V.ROOK,V.KING,V.PROM_PAWN,V.PROM_LANCE,V.PROM_KNIGHT,V.PROM_SILVER,V.HORSE,V.DRAGON;const ee=[V.PAWN,V.LANCE,V.KNIGHT,V.SILVER,V.GOLD,V.BISHOP,V.ROOK],te={pawn:!0,lance:!0,knight:!0,silver:!0,gold:!1,bishop:!0,rook:!0,king:!1,promPawn:!1,promLance:!1,promKnight:!1,promSilver:!1,horse:!1,dragon:!1},ie={pawn:V.PROM_PAWN,lance:V.PROM_LANCE,knight:V.PROM_KNIGHT,silver:V.PROM_SILVER,bishop:V.HORSE,rook:V.DRAGON};function ne(e){return ie[e]||e}const oe={promPawn:V.PAWN,promLance:V.LANCE,promKnight:V.KNIGHT,promSilver:V.SILVER,horse:V.BISHOP,dragon:V.ROOK};const ae={pawn:"P",lance:"L",knight:"N",silver:"S",gold:"G",bishop:"B",rook:"R",king:"K",promPawn:"+P",promLance:"+L",promKnight:"+N",promSilver:"+S",horse:"+B",dragon:"+R"};function se(e){return ae[e]}const re={pawn:"p",lance:"l",knight:"n",silver:"s",gold:"g",bishop:"b",rook:"r",king:"k",promPawn:"+p",promLance:"+l",promKnight:"+n",promSilver:"+s",horse:"+b",dragon:"+r"},le={P:V.PAWN,L:V.LANCE,N:V.KNIGHT,S:V.SILVER,G:V.GOLD,B:V.BISHOP,R:V.ROOK,K:V.KING,"+P":V.PROM_PAWN,"+L":V.PROM_LANCE,"+N":V.PROM_KNIGHT,"+S":V.PROM_SILVER,"+B":V.HORSE,"+R":V.DRAGON,p:V.PAWN,l:V.LANCE,n:V.KNIGHT,s:V.SILVER,g:V.GOLD,b:V.BISHOP,r:V.ROOK,k:V.KING,"+p":V.PROM_PAWN,"+l":V.PROM_LANCE,"+n":V.PROM_KNIGHT,"+s":V.PROM_SILVER,"+b":V.HORSE,"+r":V.DRAGON},ce={P:j.BLACK,L:j.BLACK,N:j.BLACK,S:j.BLACK,G:j.BLACK,B:j.BLACK,R:j.BLACK,K:j.BLACK,"+P":j.BLACK,"+L":j.BLACK,"+N":j.BLACK,"+S":j.BLACK,"+B":j.BLACK,"+R":j.BLACK,p:j.WHITE,l:j.WHITE,n:j.WHITE,s:j.WHITE,g:j.WHITE,b:j.WHITE,r:j.WHITE,k:j.WHITE,"+p":j.WHITE,"+l":j.WHITE,"+n":j.WHITE,"+s":j.WHITE,"+b":j.WHITE,"+r":j.WHITE},de=new Map;de.set(V.PAWN,{type:V.PROM_PAWN,reverseColor:!1}),de.set(V.LANCE,{type:V.PROM_LANCE,reverseColor:!1}),de.set(V.KNIGHT,{type:V.PROM_KNIGHT,reverseColor:!1}),de.set(V.SILVER,{type:V.PROM_SILVER,reverseColor:!1}),de.set(V.GOLD,{type:V.GOLD,reverseColor:!0}),de.set(V.BISHOP,{type:V.HORSE,reverseColor:!1}),de.set(V.ROOK,{type:V.DRAGON,reverseColor:!1}),de.set(V.KING,{type:V.KING,reverseColor:!0}),de.set(V.PROM_PAWN,{type:V.PAWN,reverseColor:!0}),de.set(V.PROM_LANCE,{type:V.LANCE,reverseColor:!0}),de.set(V.PROM_KNIGHT,{type:V.KNIGHT,reverseColor:!0}),de.set(V.PROM_SILVER,{type:V.SILVER,reverseColor:!0}),de.set(V.HORSE,{type:V.BISHOP,reverseColor:!0}),de.set(V.DRAGON,{type:V.ROOK,reverseColor:!0});class he{constructor(e,t){(0,z.Z)(this,"color",void 0),(0,z.Z)(this,"type",void 0),this.type=t,this.color=e}black(){return this.withColor(j.BLACK)}white(){return this.withColor(j.WHITE)}withColor(e){return new he(e,this.type)}equals(e){return this.type===e.type&&this.color===e.color}promoted(){const e=ie[this.type];return new he(this.color,e||this.type)}unpromoted(){const e=oe[this.type];return new he(this.color,e||this.type)}isPromotable(){return!!te[this.type]}rotate(){const e=de.get(this.type),t=new he(this.color,e?e.type:this.type);return e&&e.reverseColor&&(t.color=Z(this.color)),t}get id(){return this.color+"_"+this.type}get sfen(){switch(this.color){default:case j.BLACK:return ae[this.type];case j.WHITE:return re[this.type]}}static isValidSFEN(e){return!!le[e]}static newBySFEN(e){const t=le[e];if(!t)return null;const i=ce[e];return i?new he(i,t):null}}var ue;(function(e){e["UP"]="up",e["DOWN"]="down",e["LEFT"]="left",e["RIGHT"]="right",e["LEFT_UP"]="left_up",e["RIGHT_UP"]="right_up",e["LEFT_DOWN"]="left_down",e["RIGHT_DOWN"]="right_down",e["LEFT_UP_KNIGHT"]="left_up_knight",e["RIGHT_UP_KNIGHT"]="right_up_knight",e["LEFT_DOWN_KNIGHT"]="left_down_knight",e["RIGHT_DOWN_KNIGHT"]="right_down_knight"})(ue||(ue={}));const pe={up:ue.DOWN,down:ue.UP,left:ue.RIGHT,right:ue.LEFT,left_up:ue.RIGHT_DOWN,right_up:ue.LEFT_DOWN,left_down:ue.RIGHT_UP,right_down:ue.LEFT_UP,left_up_knight:ue.RIGHT_DOWN_KNIGHT,right_up_knight:ue.LEFT_DOWN_KNIGHT,left_down_knight:ue.RIGHT_UP_KNIGHT,right_down_knight:ue.LEFT_UP_KNIGHT};function ge(e){return pe[e]}const me=[ue.UP,ue.DOWN,ue.LEFT,ue.RIGHT,ue.LEFT_UP,ue.RIGHT_UP,ue.LEFT_DOWN,ue.RIGHT_DOWN,ue.LEFT_UP_KNIGHT,ue.RIGHT_UP_KNIGHT,ue.LEFT_DOWN_KNIGHT,ue.RIGHT_DOWN_KNIGHT];var _e;(function(e){e["SHORT"]="short",e["LONG"]="long"})(_e||(_e={}));const ve={black:{pawn:{up:_e.SHORT},lance:{up:_e.LONG},knight:{left_up_knight:_e.SHORT,right_up_knight:_e.SHORT},silver:{left_up:_e.SHORT,up:_e.SHORT,right_up:_e.SHORT,left_down:_e.SHORT,right_down:_e.SHORT},gold:{left_up:_e.SHORT,up:_e.SHORT,right_up:_e.SHORT,left:_e.SHORT,right:_e.SHORT,down:_e.SHORT},bishop:{left_up:_e.LONG,right_up:_e.LONG,left_down:_e.LONG,right_down:_e.LONG},rook:{up:_e.LONG,left:_e.LONG,right:_e.LONG,down:_e.LONG},king:{left_down:_e.SHORT,right_down:_e.SHORT,left_up:_e.SHORT,right_up:_e.SHORT,down:_e.SHORT,left:_e.SHORT,right:_e.SHORT,up:_e.SHORT},promPawn:{left_up:_e.SHORT,up:_e.SHORT,right_up:_e.SHORT,left:_e.SHORT,right:_e.SHORT,down:_e.SHORT},promLance:{left_up:_e.SHORT,up:_e.SHORT,right_up:_e.SHORT,left:_e.SHORT,right:_e.SHORT,down:_e.SHORT},promKnight:{left_up:_e.SHORT,up:_e.SHORT,right_up:_e.SHORT,left:_e.SHORT,right:_e.SHORT,down:_e.SHORT},promSilver:{left_up:_e.SHORT,up:_e.SHORT,right_up:_e.SHORT,left:_e.SHORT,right:_e.SHORT,down:_e.SHORT},horse:{left_up:_e.LONG,right_up:_e.LONG,left_down:_e.LONG,right_down:_e.LONG,up:_e.SHORT,left:_e.SHORT,right:_e.SHORT,down:_e.SHORT},dragon:{up:_e.LONG,left:_e.LONG,right:_e.LONG,down:_e.LONG,left_up:_e.SHORT,right_up:_e.SHORT,left_down:_e.SHORT,right_down:_e.SHORT}},white:{pawn:{down:_e.SHORT},lance:{down:_e.LONG},knight:{left_down_knight:_e.SHORT,right_down_knight:_e.SHORT},silver:{left_down:_e.SHORT,down:_e.SHORT,right_down:_e.SHORT,left_up:_e.SHORT,right_up:_e.SHORT},gold:{left_down:_e.SHORT,down:_e.SHORT,right_down:_e.SHORT,left:_e.SHORT,right:_e.SHORT,up:_e.SHORT},bishop:{left_down:_e.LONG,right_down:_e.LONG,left_up:_e.LONG,right_up:_e.LONG},rook:{down:_e.LONG,left:_e.LONG,right:_e.LONG,up:_e.LONG},king:{left_down:_e.SHORT,right_down:_e.SHORT,left_up:_e.SHORT,right_up:_e.SHORT,down:_e.SHORT,left:_e.SHORT,right:_e.SHORT,up:_e.SHORT},promPawn:{left_down:_e.SHORT,down:_e.SHORT,right_down:_e.SHORT,left:_e.SHORT,right:_e.SHORT,up:_e.SHORT},promLance:{left_down:_e.SHORT,down:_e.SHORT,right_down:_e.SHORT,left:_e.SHORT,right:_e.SHORT,up:_e.SHORT},promKnight:{left_down:_e.SHORT,down:_e.SHORT,right_down:_e.SHORT,left:_e.SHORT,right:_e.SHORT,up:_e.SHORT},promSilver:{left_down:_e.SHORT,down:_e.SHORT,right_down:_e.SHORT,left:_e.SHORT,right:_e.SHORT,up:_e.SHORT},horse:{left_down:_e.LONG,right_down:_e.LONG,left_up:_e.LONG,right_up:_e.LONG,down:_e.SHORT,left:_e.SHORT,right:_e.SHORT,up:_e.SHORT},dragon:{down:_e.LONG,left:_e.LONG,right:_e.LONG,up:_e.LONG,left_down:_e.SHORT,right_down:_e.SHORT,left_up:_e.SHORT,right_up:_e.SHORT}}};function Se(e){return Object.keys(ve[e.color][e.type])}function Ee(e,t){return ve[e.color][e.type][t]}const we={up:{x:0,y:-1},down:{x:0,y:1},left:{x:-1,y:0},right:{x:1,y:0},left_up:{x:-1,y:-1},right_up:{x:1,y:-1},left_down:{x:-1,y:1},right_down:{x:1,y:1},left_up_knight:{x:-1,y:-2},right_up_knight:{x:1,y:-2},left_down_knight:{x:-1,y:2},right_down_knight:{x:1,y:2}};function Ie(e,t){if(1===e&&-2===t)return{direction:ue.RIGHT_UP_KNIGHT,distance:1,ok:!0};if(-1===e&&-2===t)return{direction:ue.LEFT_UP_KNIGHT,distance:1,ok:!0};if(1===e&&2===t)return{direction:ue.RIGHT_DOWN_KNIGHT,distance:1,ok:!0};if(-1===e&&2===t)return{direction:ue.LEFT_DOWN_KNIGHT,distance:1,ok:!0};if(0!==e&&0!==t&&Math.abs(e)!==Math.abs(t))return{direction:"",distance:0,ok:!1};let i=e,n=t,o=0;return 0!==i&&(o=Math.abs(i),i/=o),0!==n&&(o=Math.abs(n),n/=o),-1===i&&-1===n?{direction:ue.LEFT_UP,distance:o,ok:!0}:0===i&&-1===n?{direction:ue.UP,distance:o,ok:!0}:1===i&&-1===n?{direction:ue.RIGHT_UP,distance:o,ok:!0}:-1===i&&0===n?{direction:ue.LEFT,distance:o,ok:!0}:1===i&&0===n?{direction:ue.RIGHT,distance:o,ok:!0}:-1===i&&1===n?{direction:ue.LEFT_DOWN,distance:o,ok:!0}:0===i&&1===n?{direction:ue.DOWN,distance:o,ok:!0}:1===i&&1===n?{direction:ue.RIGHT_DOWN,distance:o,ok:!0}:{direction:"",distance:0,ok:!1}}function fe(e){switch(e){case"1":return 1;case"2":return 2;case"3":return 3;case"4":return 4;case"5":return 5;case"6":return 6;case"7":return 7;case"8":return 8;case"9":return 9;default:return null}}function ye(e){switch(e){case"a":return 1;case"b":return 2;case"c":return 3;case"d":return 4;case"e":return 5;case"f":return 6;case"g":return 7;case"h":return 8;case"i":return 9;default:return null}}const be=["a","b","c","d","e","f","g","h","i"];class Te{constructor(e,t){(0,z.Z)(this,"file",void 0),(0,z.Z)(this,"rank",void 0),this.file=e,this.rank=t}get x(){return 9-this.file}get y(){return this.rank-1}get index(){return 9*this.y+this.x}get opposite(){return new Te(10-this.file,10-this.rank)}neighbor(e,t){switch(e){case ue.UP:return new Te(this.file,this.rank-1);case ue.DOWN:return new Te(this.file,this.rank+1);case ue.LEFT:return new Te(this.file+1,this.rank);case ue.RIGHT:return new Te(this.file-1,this.rank);case ue.LEFT_UP:return new Te(this.file+1,this.rank-1);case ue.RIGHT_UP:return new Te(this.file-1,this.rank-1);case ue.LEFT_DOWN:return new Te(this.file+1,this.rank+1);case ue.RIGHT_DOWN:return new Te(this.file-1,this.rank+1);case ue.LEFT_UP_KNIGHT:return new Te(this.file+1,this.rank-2);case ue.RIGHT_UP_KNIGHT:return new Te(this.file-1,this.rank-2);case ue.LEFT_DOWN_KNIGHT:return new Te(this.file+1,this.rank+2);case ue.RIGHT_DOWN_KNIGHT:return new Te(this.file-1,this.rank+2)}const i=e,n=t;return new Te(this.file-i,this.rank+n)}get valid(){return this.file>=1&&this.file<=9&&this.rank>=1&&this.rank<=9}equals(e){return!!e&&this.file===e.file&&this.rank===e.rank}static newByXY(e,t){return new Te(9-e,t+1)}static newByIndex(e){return new Te(9-e%9,Math.trunc(e/9)+1)}get sfen(){return this.file+be[this.rank-1]}static parseSFENSquare(e){const t=fe(e[0]),i=ye(e[1]);return t&&i?new Te(t,i):null}}(0,z.Z)(Te,"all",[]);for(let sp=0;sp<81;sp+=1)Te.all.push(Te.newByIndex(sp));const Ae=["１","２","３","４","５","６","７","８","９"],Ne=["一","二","三","四","五","六","七","八","九"];class Pe{constructor(e,t,i,n,o,a){(0,z.Z)(this,"from",void 0),(0,z.Z)(this,"to",void 0),(0,z.Z)(this,"promote",void 0),(0,z.Z)(this,"color",void 0),(0,z.Z)(this,"pieceType",void 0),(0,z.Z)(this,"capturedPieceType",void 0),this.from=e,this.to=t,this.promote=i,this.color=n,this.pieceType=o,this.capturedPieceType=a}equals(e){return!!e&&((this.from instanceof Te&&e.from instanceof Te&&this.from.equals(e.from)||!(this.from instanceof Te)&&!(e.from instanceof Te)&&this.from===e.from)&&this.to.equals(e.to)&&this.promote===e.promote&&this.color===e.color&&this.pieceType===e.pieceType&&this.capturedPieceType===e.capturedPieceType)}withPromote(){return new Pe(this.from,this.to,!0,this.color,this.pieceType,this.capturedPieceType)}getDisplayText(e){let t="";if(t+=this.color===j.BLACK?"▲":"△",e&&e.to.equals(this.to)?t+="同　":(t+=Ae[this.to.file-1],t+=Ne[this.to.rank-1]),t+=X(this.pieceType),this.promote&&(t+="成"),this.from instanceof Te){const e=this.from;t+=`(${e.file}${e.rank})`}else t+="打";return t}get sfen(){let e="";return this.from instanceof Te?e+=this.from.sfen:e+=se(this.from)+"*",e+=this.to.sfen,this.promote&&(e+="+"),e}}function Re(e){let t;if("*"===e[1]){const i=he.newBySFEN(e[0]);if(!i)return null;t=i.type}else{const i=Te.parseSFENSquare(e);if(!i)return null;t=i}const i=Te.parseSFENSquare(e.substring(2));if(!i)return null;const n=e.length>=5&&"+"===e[4];return{from:t,to:i,promote:n}}var ke;function Oe(e){switch(e){case"1":return 1;case"2":return 2;case"3":return 3;case"4":return 4;case"5":return 5;case"6":return 6;case"7":return 7;case"8":return 8;case"9":return 9;default:return null}}(function(e){e["STANDARD"]="standard",e["EMPTY"]="empty",e["HANDICAP_LANCE"]="handicapLance",e["HANDICAP_RIGHT_LANCE"]="handicapRightLance",e["HANDICAP_BISHOP"]="handicapBishop",e["HANDICAP_ROOK"]="handicapRook",e["HANDICAP_ROOK_LANCE"]="handicapRookLance",e["HANDICAP_2PIECES"]="handicap2Pieces",e["HANDICAP_4PIECES"]="handicap4Pieces",e["HANDICAP_6PIECES"]="handicap6Pieces",e["HANDICAP_8PIECES"]="handicap8Pieces",e["TSUME_SHOGI"]="tsumeShogi",e["TSUME_SHOGI_2KINGS"]="tsumeShogi2Kings"})(ke||(ke={}));class Ce{constructor(){(0,z.Z)(this,"squares",void 0),this.squares=new Array;for(let e=0;e<81;e+=1)this.squares.push(null);this.reset(ke.STANDARD)}at(e){return this.squares[e.index]}set(e,t){this.squares[e.index]=t}swap(e,t){const i=this.squares[e.index];this.squares[e.index]=this.squares[t.index],this.squares[t.index]=i}remove(e){const t=this.squares[e.index];return this.squares[e.index]=null,t}listNonEmptySquares(){const e=new Array;return Te.all.forEach((t=>{this.squares[t.index]&&e.push(t)})),e}listSquaresByColor(e){const t=new Array;return Te.all.forEach((i=>{const n=this.squares[i.index];n&&n.color===e&&t.push(i)})),t}clear(){Te.all.forEach((e=>{this.squares[e.index]=null}))}reset(e){if(this.clear(),e!==ke.EMPTY&&(this.squares[new Te(5,1).index]=new he(j.WHITE,V.KING),e!==ke.TSUME_SHOGI&&(this.squares[new Te(5,9).index]=new he(j.BLACK,V.KING),e!==ke.TSUME_SHOGI_2KINGS)))switch(this.squares[new Te(2,8).index]=new he(j.BLACK,V.ROOK),this.squares[new Te(8,2).index]=new he(j.WHITE,V.ROOK),this.squares[new Te(8,8).index]=new he(j.BLACK,V.BISHOP),this.squares[new Te(2,2).index]=new he(j.WHITE,V.BISHOP),this.squares[new Te(4,9).index]=new he(j.BLACK,V.GOLD),this.squares[new Te(6,9).index]=new he(j.BLACK,V.GOLD),this.squares[new Te(6,1).index]=new he(j.WHITE,V.GOLD),this.squares[new Te(4,1).index]=new he(j.WHITE,V.GOLD),this.squares[new Te(3,9).index]=new he(j.BLACK,V.SILVER),this.squares[new Te(7,9).index]=new he(j.BLACK,V.SILVER),this.squares[new Te(7,1).index]=new he(j.WHITE,V.SILVER),this.squares[new Te(3,1).index]=new he(j.WHITE,V.SILVER),this.squares[new Te(2,9).index]=new he(j.BLACK,V.KNIGHT),this.squares[new Te(8,9).index]=new he(j.BLACK,V.KNIGHT),this.squares[new Te(8,1).index]=new he(j.WHITE,V.KNIGHT),this.squares[new Te(2,1).index]=new he(j.WHITE,V.KNIGHT),this.squares[new Te(1,9).index]=new he(j.BLACK,V.LANCE),this.squares[new Te(9,9).index]=new he(j.BLACK,V.LANCE),this.squares[new Te(9,1).index]=new he(j.WHITE,V.LANCE),this.squares[new Te(1,1).index]=new he(j.WHITE,V.LANCE),this.squares[new Te(1,7).index]=new he(j.BLACK,V.PAWN),this.squares[new Te(2,7).index]=new he(j.BLACK,V.PAWN),this.squares[new Te(3,7).index]=new he(j.BLACK,V.PAWN),this.squares[new Te(4,7).index]=new he(j.BLACK,V.PAWN),this.squares[new Te(5,7).index]=new he(j.BLACK,V.PAWN),this.squares[new Te(6,7).index]=new he(j.BLACK,V.PAWN),this.squares[new Te(7,7).index]=new he(j.BLACK,V.PAWN),this.squares[new Te(8,7).index]=new he(j.BLACK,V.PAWN),this.squares[new Te(9,7).index]=new he(j.BLACK,V.PAWN),this.squares[new Te(1,3).index]=new he(j.WHITE,V.PAWN),this.squares[new Te(2,3).index]=new he(j.WHITE,V.PAWN),this.squares[new Te(3,3).index]=new he(j.WHITE,V.PAWN),this.squares[new Te(4,3).index]=new he(j.WHITE,V.PAWN),this.squares[new Te(5,3).index]=new he(j.WHITE,V.PAWN),this.squares[new Te(6,3).index]=new he(j.WHITE,V.PAWN),this.squares[new Te(7,3).index]=new he(j.WHITE,V.PAWN),this.squares[new Te(8,3).index]=new he(j.WHITE,V.PAWN),this.squares[new Te(9,3).index]=new he(j.WHITE,V.PAWN),e){default:case ke.STANDARD:return;case ke.HANDICAP_LANCE:return void(this.squares[new Te(1,1).index]=null);case ke.HANDICAP_RIGHT_LANCE:return void(this.squares[new Te(9,1).index]=null);case ke.HANDICAP_BISHOP:return void(this.squares[new Te(2,2).index]=null);case ke.HANDICAP_ROOK:return void(this.squares[new Te(8,2).index]=null);case ke.HANDICAP_ROOK_LANCE:return this.squares[new Te(8,2).index]=null,void(this.squares[new Te(1,1).index]=null);case ke.HANDICAP_2PIECES:return this.squares[new Te(8,2).index]=null,void(this.squares[new Te(2,2).index]=null);case ke.HANDICAP_4PIECES:return this.squares[new Te(8,2).index]=null,this.squares[new Te(2,2).index]=null,this.squares[new Te(1,1).index]=null,void(this.squares[new Te(9,1).index]=null);case ke.HANDICAP_6PIECES:return this.squares[new Te(8,2).index]=null,this.squares[new Te(2,2).index]=null,this.squares[new Te(1,1).index]=null,this.squares[new Te(2,1).index]=null,this.squares[new Te(8,1).index]=null,void(this.squares[new Te(9,1).index]=null);case ke.HANDICAP_8PIECES:return this.squares[new Te(8,2).index]=null,this.squares[new Te(2,2).index]=null,this.squares[new Te(1,1).index]=null,this.squares[new Te(2,1).index]=null,this.squares[new Te(3,1).index]=null,this.squares[new Te(7,1).index]=null,this.squares[new Te(8,1).index]=null,void(this.squares[new Te(9,1).index]=null)}}get sfen(){let e="",t=0;for(let i=0;i<9;i+=1){for(let n=0;n<9;n+=1){const o=this.at(Te.newByXY(n,i));o?(t&&(e+=t,t=0),e+=o.sfen):t+=1}t&&(e+=t,t=0),8!==i&&(e+="/")}return e}resetBySFEN(e){if(!Ce.isValidSFEN(e))return!1;this.clear();const t=e.split("/");for(let i=0;i<9;i+=1){let e=0;for(let n=0;n<t[i].length;n+=1){let o=t[i][n];"+"===o&&(n+=1,o+=t[i][n]);const a=Oe(o);a?e+=a:(this.set(Te.newByXY(e,i),he.newBySFEN(o)),e+=1)}}return!0}findKing(e){const t=new he(e,V.KING);return Te.all.find((e=>{const i=this.at(e);if(i&&t.equals(i))return!0}))}hasPower(e,t,i){return!!me.find((n=>{let o=0;for(let a=e.neighbor(n);a.valid;a=a.neighbor(n)){if(o+=1,i&&i.filled&&a.equals(i.filled))break;if(i&&i.ignore&&a.equals(i.ignore))continue;const e=this.at(a);if(e){if(e.color!==t)return!1;const i=ge(n),a=Ee(e,i);return a===_e.LONG||a===_e.SHORT&&1===o}}return!1}))}isChecked(e,t){const i=this.findKing(e);return!!i&&this.hasPower(i,Z(e),{filled:t&&t.filled,ignore:t&&t.ignore})}static isValidSFEN(e){const t=e.split("/");if(9!==t.length)return!1;for(let i=0;i<9;i+=1){let e=0;for(let n=0;n<t[i].length;n+=1){let o=t[i][n];"+"===o&&(n+=1,o+=t[i][n]);const a=Oe(o);if(a)e+=a;else{if(!he.isValidSFEN(o))return!1;e+=1}}if(9!==e)return!1}return!0}copyFrom(e){Te.all.forEach((t=>{this.squares[t.index]=e.at(t)}))}}function He(e,t){return 0===e?"":(1!==e?e:"")+t.sfen}class Me{constructor(){(0,z.Z)(this,"pieces",void 0),this.pieces=new Map,this.pieces.set(V.PAWN,0),this.pieces.set(V.LANCE,0),this.pieces.set(V.KNIGHT,0),this.pieces.set(V.SILVER,0),this.pieces.set(V.GOLD,0),this.pieces.set(V.BISHOP,0),this.pieces.set(V.ROOK,0)}count(e){return this.pieces.get(e)}set(e,t){this.pieces.set(e,t)}add(e,t){let i=this.pieces.get(e);return i+=t,this.pieces.set(e,i),i}reduce(e,t){let i=this.pieces.get(e);return i-=t,this.pieces.set(e,i),i}forEach(e){e(V.PAWN,this.pieces.get(V.PAWN)),e(V.LANCE,this.pieces.get(V.LANCE)),e(V.KNIGHT,this.pieces.get(V.KNIGHT)),e(V.SILVER,this.pieces.get(V.SILVER)),e(V.GOLD,this.pieces.get(V.GOLD)),e(V.BISHOP,this.pieces.get(V.BISHOP)),e(V.ROOK,this.pieces.get(V.ROOK))}get sfenBlack(){return this.formatSFEN(j.BLACK)}get sfenWhite(){return this.formatSFEN(j.WHITE)}formatSFEN(e){let t="";return t+=He(this.count(V.ROOK),new he(e,V.ROOK)),t+=He(this.count(V.BISHOP),new he(e,V.BISHOP)),t+=He(this.count(V.GOLD),new he(e,V.GOLD)),t+=He(this.count(V.SILVER),new he(e,V.SILVER)),t+=He(this.count(V.KNIGHT),new he(e,V.KNIGHT)),t+=He(this.count(V.LANCE),new he(e,V.LANCE)),t+=He(this.count(V.PAWN),new he(e,V.PAWN)),""===t?"-":t}static formatSFEN(e,t){const i=e.sfenBlack,n=t.sfenWhite;return"-"===i&&"-"===n?"-":"-"===n?i:"-"===i?n:i+n}static isValidSFEN(e){return"-"===e||!!e.match(/^(?:[0-9]*[PLNSGBRplnsgbr])*$/)}static parseSFEN(e){if("-"===e)return{black:new Me,white:new Me};if(!e.match(/^(?:[0-9]*[PLNSGBRplnsgbr])*$/))return null;const t=e.match(/([0-9]*[PLNSGBRplnsgbr])/g),i=new Me,n=new Me;for(let o=0;o<t.length;o+=1){const e=t[o];let a=1;e.length>=2&&(a=Number(e.substring(0,e.length-1)));const s=he.newBySFEN(e[e.length-1]);s.color===j.BLACK?i.add(s.type,a):n.add(s.type,a)}return{black:i,white:n}}copyFrom(e){e.pieces.forEach(((e,t)=>{this.pieces.set(t,e)}))}}const Le={black:{pawn:{1:!0},lance:{1:!0},knight:{1:!0,2:!0}},white:{pawn:{9:!0},lance:{9:!0},knight:{9:!0,8:!0}}};function De(e,t,i){const n=Le[e][t];return!!n&&n[i]}function Be(e,t){return e===j.BLACK?t<=3:t>=7}function Ge(e,t,i){for(let n=1;n<=9;n+=1){const o=t.at(new Te(i,n));if(o&&o.type===V.PAWN&&o.color===e)return!0}return!1}class xe{constructor(){(0,z.Z)(this,"_board",void 0),(0,z.Z)(this,"_color",void 0),(0,z.Z)(this,"_blackHand",void 0),(0,z.Z)(this,"_whiteHand",void 0),this._board=new Ce,this._color=j.BLACK,this._blackHand=new Me,this._whiteHand=new Me}get board(){return this._board}get color(){return this._color}get blackHand(){return this._blackHand}get whiteHand(){return this._whiteHand}reset(e){switch(this._board.reset(e),this._blackHand=new Me,this._whiteHand=new Me,e){case ke.STANDARD:case ke.EMPTY:case ke.TSUME_SHOGI:case ke.TSUME_SHOGI_2KINGS:this._color=j.BLACK;break;case ke.HANDICAP_LANCE:case ke.HANDICAP_RIGHT_LANCE:case ke.HANDICAP_BISHOP:case ke.HANDICAP_ROOK:case ke.HANDICAP_ROOK_LANCE:case ke.HANDICAP_2PIECES:case ke.HANDICAP_4PIECES:case ke.HANDICAP_6PIECES:case ke.HANDICAP_8PIECES:this._color=j.WHITE;break}e!==ke.TSUME_SHOGI&&e!==ke.TSUME_SHOGI_2KINGS||(this._whiteHand.set(V.PAWN,18),this._whiteHand.set(V.LANCE,4),this._whiteHand.set(V.KNIGHT,4),this._whiteHand.set(V.SILVER,4),this._whiteHand.set(V.GOLD,4),this._whiteHand.set(V.BISHOP,2),this._whiteHand.set(V.ROOK,2))}hand(e){return this._hand(e)}_hand(e){return e===j.BLACK?this._blackHand:this._whiteHand}get checked(){return this._board.isChecked(this.color)}createMove(e,t){let i;if(e instanceof Te){const t=this._board.at(e);if(!t)return null;i=t.type}else i=e;const n=this._board.at(t);return new Pe(e,t,!1,this.color,i,n?n.type:null)}createMoveBySFEN(e){const t=Re(e);if(!t)return null;let i=this.createMove(t.from,t.to);return i?(t.promote&&(i=i.withPromote()),i):null}isPawnDropMate(e){if(e.from instanceof Te)return!1;if(e.pieceType!==V.PAWN)return!1;const t=e.to.neighbor(e.color===j.BLACK?ue.UP:ue.DOWN),i=this.board.at(t);if(!i||i.type!==V.KING||i.color===e.color)return!1;const n=Se(i).find((n=>{const o=t.neighbor(n);if(!o.valid)return!1;const a=this.board.at(o);return(!a||a.color!=i.color)&&!this.board.hasPower(o,e.color,{filled:e.to})}));return!n&&!this.board.listSquaresByColor(i.color).find((n=>!n.equals(t)&&this.isMovable(n,e.to)&&!this.board.isChecked(i.color,{filled:e.to,ignore:n})))}isValidMove(e){if(e.from instanceof Te){const t=this._board.at(e.from);if(!t||t.color!==this.color)return!1;if(!this.isMovable(e.from,e.to))return!1;const i=this._board.at(e.to);if(i&&i.color===this.color)return!1;if(e.promote){if(!t.isPromotable())return!1;if(!Be(this.color,e.from.rank)&&!Be(this.color,e.to.rank))return!1}else if(De(this.color,t.type,e.to.rank))return!1;if(e.pieceType!==V.KING?this._board.isChecked(this.color,{filled:e.to,ignore:e.from}):this._board.hasPower(e.to,Z(this.color),{ignore:e.from}))return!1}else{if(e.promote)return!1;if(e.color!==this.color)return!1;if(0===this.hand(this.color).count(e.from))return!1;if(this._board.at(e.to))return!1;if(De(this.color,e.from,e.to.rank))return!1;if(e.from===V.PAWN&&Ge(this.color,this._board,e.to.file))return!1;if(this._board.isChecked(this.color,{filled:e.to}))return!1;if(this.isPawnDropMate(e))return!1}return!0}doMove(e,t){if((!t||!t.ignoreValidation)&&!this.isValidMove(e))return!1;if(e.from instanceof Te){const t=this._board.at(e.from),i=this._board.at(e.to);this._board.remove(e.from),this._board.set(e.to,e.promote?t.promoted():t),i&&i.type!==V.KING&&this._hand(this.color).add(i.unpromoted().type,1)}else this._hand(this.color).reduce(e.from,1),this._board.set(e.to,new he(this.color,e.from));return this._color=Z(this.color),!0}undoMove(e){if(this._color=Z(this.color),e.from instanceof Te)if(this._board.set(e.from,new he(this.color,e.pieceType)),e.capturedPieceType){const t=new he(Z(this.color),e.capturedPieceType);this._board.set(e.to,t),t.type!==V.KING&&this._hand(this.color).reduce(t.unpromoted().type,1)}else this._board.remove(e.to);else this._hand(this.color).add(e.from,1),this._board.remove(e.to)}isValidEditing(e,t){if(e instanceof Te){const i=this._board.at(e);if(!i)return!1;if(t instanceof Te){if(e.equals(t))return!1}else if(i.type===V.KING)return!1}else{if(!e.color)return!1;if(0===this.hand(e.color).count(e.type))return!1;if(t instanceof Te){if(this._board.at(t))return!1}else if(e.color===t)return!1}return!0}edit(e){if(e.move){if(!this.isValidEditing(e.move.from,e.move.to))return!1;if(e.move.from instanceof Te)if(e.move.to instanceof Te)this._board.swap(e.move.from,e.move.to);else{const t=this._board.remove(e.move.from);this._hand(e.move.to).add(t.unpromoted().type,1)}else this._hand(e.move.from.color).reduce(e.move.from.type,1),e.move.to instanceof Te?this._board.set(e.move.to,e.move.from):this._hand(e.move.to).add(e.move.from.type,1)}if(e.rotate){const t=this._board.at(e.rotate);t&&this._board.set(e.rotate,t.rotate())}return!0}get sfen(){return this.getSFEN(1)}getSFEN(e){let t=`${this._board.sfen} ${Y(this.color)} `;return t+=Me.formatSFEN(this._blackHand,this._whiteHand),t+=" "+e,t}resetBySFEN(e){if(!xe.isValidSFEN(e))return!1;const t=e.split(" ");"sfen"===t[0]&&t.shift(),this._board.resetBySFEN(t[0]),this._color=J(t[1]);const i=Me.parseSFEN(t[2]);return this._blackHand=i.black,this._whiteHand=i.white,!0}setColor(e){this._color=e}static isValidSFEN(e){const t=e.split(" ");return 5===t.length&&"sfen"===t[0]&&t.shift(),4===t.length&&(!!Ce.isValidSFEN(t[0])&&(!!$(t[1])&&(!!Me.isValidSFEN(t[2])&&!!t[3].match(/[0-9]+/))))}static newBySFEN(e){const t=new xe;return t.resetBySFEN(e)?t:null}isMovable(e,t){const i=t.x-e.x,n=t.y-e.y,{direction:o,distance:a,ok:s}=Ie(i,n);if(!s)return!1;const r=this._board.at(e);if(!r)return!1;switch(Ee(r,o)){default:return!1;case _e.SHORT:return 1===a;case _e.LONG:{const i=we[o];for(let n=e.neighbor(i.x,i.y);n.valid;n=n.neighbor(i.x,i.y)){if(n.equals(t))return!0;if(this._board.at(n))return!1}return!1}}}copyFrom(e){this._board.copyFrom(e._board),this._color=e.color,this._blackHand.copyFrom(e._blackHand),this._whiteHand.copyFrom(e._whiteHand)}clone(){const e=new xe;return e.copyFrom(this),e}}function We(e){const t={pawn:0,lance:0,knight:0,silver:0,gold:0,bishop:0,rook:0,king:0,promPawn:0,promLance:0,promKnight:0,promSilver:0,horse:0,dragon:0};return Te.all.forEach((i=>{const n=e.board.at(i);n&&(t[n.type]+=1)})),e.blackHand.forEach(((e,i)=>{t[e]+=i})),e.whiteHand.forEach(((e,i)=>{t[e]+=i})),t}function Ue(e){const t=We(e);return{pawn:18-t.pawn-t.promPawn,lance:4-t.lance-t.promLance,knight:4-t.knight-t.promKnight,silver:4-t.silver-t.promSilver,gold:4-t.gold,bishop:2-t.bishop-t.horse,rook:2-t.rook-t.dragon,king:2-t.king,promPawn:0,promLance:0,promKnight:0,promSilver:0,horse:0,dragon:0}}function Ke(e){return qe(Math.floor(e/1e3))}function Fe(e){return je(Math.floor(e/1e3))}function qe(e){const t=Math.floor(e/3600),i=Math.floor((e-3600*t)/60),n=e%60;return t+":"+String(i).padStart(2,"0")+":"+String(n).padStart(2,"0")}function je(e){const t=Math.floor(e/60),i=e%60;return String(t).padStart(2," ")+":"+String(i).padStart(2,"0")}var Ve,ze;function Ze(e){switch(e){case Ve.BLACK_NAME:return"先手";case Ve.WHITE_NAME:return"後手";case Ve.START_DATETIME:return"開始日時";case Ve.END_DATETIME:return"終了日時";case Ve.DATE:return"対局日";case Ve.TOURNAMENT:return"棋戦";case Ve.STRATEGY:return"戦型";case Ve.TITLE:return"表題";case Ve.TIME_LIMIT:return"持ち時間";case Ve.TIME_SPENT:return"消費時間";case Ve.PLACE:return"場所";case Ve.POSTED_ON:return"掲載";case Ve.NOTE:return"備考";case Ve.BLACK_SHORT_NAME:return"先手省略名";case Ve.WHITE_SHORT_NAME:return"後手省略名";case Ve.OPUS_NO:return"作品番号";case Ve.OPUS_NAME:return"作品名";case Ve.AUTHOR:return"作者";case Ve.PUBLISHED_ON:return"発表誌";case Ve.PUBLISHED_AT:return"発表年月";case Ve.SOURCE:return"出典";case Ve.LENGTH:return"手数";case Ve.INTEGRITY:return"完全性";case Ve.CATEGORY:return"分類";case Ve.AWARD:return"受賞"}}(function(e){e["BLACK_NAME"]="blackName",e["WHITE_NAME"]="whiteName",e["START_DATETIME"]="startDatetime",e["END_DATETIME"]="endDatetime",e["DATE"]="date",e["TOURNAMENT"]="tournament",e["STRATEGY"]="strategy",e["TITLE"]="title",e["TIME_LIMIT"]="timeLimit",e["TIME_SPENT"]="timeSpent",e["PLACE"]="place",e["POSTED_ON"]="postedOn",e["NOTE"]="note",e["BLACK_SHORT_NAME"]="blackShortName",e["WHITE_SHORT_NAME"]="whiteShortName",e["OPUS_NO"]="opusNo",e["OPUS_NAME"]="opusName",e["AUTHOR"]="author",e["PUBLISHED_ON"]="publishedOn",e["PUBLISHED_AT"]="publishedAt",e["SOURCE"]="source",e["LENGTH"]="length",e["INTEGRITY"]="integrity",e["CATEGORY"]="category",e["AWARD"]="award"})(Ve||(Ve={}));class Ye{constructor(){(0,z.Z)(this,"standard",void 0),(0,z.Z)(this,"custom",void 0),this.standard=new Map,this.custom=new Map}get standardMetadataKeys(){return this.standard.keys()}getStandardMetadata(e){return this.standard.get(e)}setStandardMetadata(e,t){t?this.standard.set(e,t):this.standard.delete(e)}get customMetadataKeys(){return this.custom.keys()}getCustomMetadata(e){return this.custom.get(e)}setCustomMetadata(e,t){t?this.custom.set(e,t):this.custom.delete(e)}}(function(e){e["START"]="start",e["INTERRUPT"]="interrupt",e["RESIGN"]="resign",e["DRAW"]="draw",e["REPETITION_DRAW"]="repetitionDraw",e["MATE"]="mate",e["TIMEOUT"]="timeout",e["FOUL_WIN"]="foulWin",e["FOUL_LOSE"]="foulLose",e["ENTERING_OF_KING"]="enteringOfKing",e["WIN_BY_DEFAULT"]="winByDefault",e["LOSS_BY_DEFAULT"]="lossByDefault"})(ze||(ze={}));const $e={start:"開始局面",resign:"投了",interrupt:"中断",draw:"持将棋",repetitionDraw:"千日手",mate:"詰み",timeout:"切れ負け",foulWin:"反則勝ち",foulLose:"反則負け",enteringOfKing:"入玉",winByDefault:"不戦勝",lossByDefault:"不戦敗"};function Je(e){return $e[e]}class Qe{constructor(e,t,i,n,o,a){(0,z.Z)(this,"number",void 0),(0,z.Z)(this,"prev",void 0),(0,z.Z)(this,"branchIndex",void 0),(0,z.Z)(this,"activeBranch",void 0),(0,z.Z)(this,"move",void 0),(0,z.Z)(this,"isCheck",void 0),(0,z.Z)(this,"next",void 0),(0,z.Z)(this,"branch",void 0),(0,z.Z)(this,"comment",void 0),(0,z.Z)(this,"customData",void 0),(0,z.Z)(this,"elapsedMs",void 0),(0,z.Z)(this,"totalElapsedMs",void 0),this.number=e,this.prev=t,this.branchIndex=i,this.activeBranch=n,this.move=o,this.isCheck=a,this.next=null,this.branch=null,this.comment="",this.elapsedMs=0,this.totalElapsedMs=0}get displayText(){const e=this.prev&&this.prev.move instanceof Pe?this.prev.move:null;return this.move instanceof Pe?this.move.getDisplayText(e):Je(this.move)}get timeText(){const e=Fe(this.elapsedMs),t=Ke(this.totalElapsedMs);return`${e} / ${t}`}get hasBranch(){return!!this.prev&&!!this.prev.next&&!!this.prev.next.branch}get isFirstBranch(){return!this.prev||this.prev.next===this}get isLastMove(){if(!this.next)return!0;for(let e=this.next;e;e=e.branch)if(e.move instanceof Pe)return!1;return!0}updateTotalElapsedMs(){this.totalElapsedMs=this.elapsedMs,this.prev&&this.prev.prev&&(this.totalElapsedMs+=this.prev.prev.totalElapsedMs)}setElapsedMs(e){this.elapsedMs=e,this.updateTotalElapsedMs();let t=this.next;const i=[];while(t)t.updateTotalElapsedMs(),t.branch&&i.push(t.branch),t=t.next?t.next:i.pop()||null}static newRootEntry(){return new Qe(0,null,0,!0,ze.START,!1)}}class Xe{constructor(e){(0,z.Z)(this,"metadata",void 0),(0,z.Z)(this,"_initialPosition",void 0),(0,z.Z)(this,"_position",void 0),(0,z.Z)(this,"_first",void 0),(0,z.Z)(this,"_current",void 0),(0,z.Z)(this,"repetitionCounts",void 0),(0,z.Z)(this,"repetitionStart",void 0),this.metadata=new Ye,this._initialPosition=e?e.clone():new xe,this._position=this.initialPosition.clone(),this._first=Qe.newRootEntry(),this._current=this._first,this.repetitionCounts={},this.repetitionStart={},this.incrementRepetition()}get initialPosition(){return this._initialPosition}get position(){return this._position}get first(){return this._first}get current(){return this._current}get moves(){const e=this.movesBefore;for(let t=this._current.next;t;t=t.next){while(!t.activeBranch)t=t.branch;e.push(t)}return e}get movesBefore(){return this._movesBefore}get _movesBefore(){const e=new Array;e.unshift(this._current);for(let t=this._current.prev;t;t=t.prev)e.unshift(t);return e}get length(){let e=this._current.number;for(let t=this._current.next;t;t=t.next){while(!t.activeBranch)t=t.branch;e=t.number}return e}get branchBegin(){return this._current.prev?this._current.prev.next:this._current}clear(e){this.metadata=new Ye,e&&(this._initialPosition=e.clone()),this._position=this.initialPosition.clone(),this._first=Qe.newRootEntry(),this._current=this._first,this.repetitionCounts={},this.repetitionStart={},this.incrementRepetition()}goBack(){return!!this._current.prev&&(this._current.move instanceof Pe&&(this.decrementRepetition(),this._position.undoMove(this._current.move)),this._current=this._current.prev,!0)}goForward(){if(this._current.next){this._current=this._current.next;while(!this._current.activeBranch)this._current=this._current.branch;return this._current.move instanceof Pe&&(this._position.doMove(this._current.move,{ignoreValidation:!0}),this.incrementRepetition()),!0}return!1}goto(e){while(e<this._current.number)if(!this.goBack())break;while(e>this._current.number)if(!this.goForward())break}resetAllBranchSelection(){this._forEach((e=>{e.activeBranch=e.isFirstBranch}))}switchBranchByIndex(e){if(!this._current.prev)return!1;let t=!1;for(let i=this._current.prev.next;i;i=i.branch)i.branchIndex===e?(i.activeBranch=!0,this._current.move instanceof Pe&&(this.decrementRepetition(),this._position.undoMove(this._current.move)),this._current=i,this._current.move instanceof Pe&&(this._position.doMove(this._current.move,{ignoreValidation:!0}),this.incrementRepetition()),t=!0):i.activeBranch=!1;return t}append(e,t){let i,n=!1;if(e instanceof Pe){if(!this._position.doMove(e,t))return!1;this.incrementRepetition(),n=this.position.checked}if(this._current===this.first||this._current.move instanceof Pe||this.goBack(),!this._current.next)return this._current.next=new Qe(this._current.number+1,this._current,0,!0,e,n),this._current=this._current.next,this._current.setElapsedMs(0),!0;for(i=this._current.next;i;i=i.branch)i.activeBranch=!1;let o=this._current.next;for(i=this._current.next;i;i=i.branch){if(i.move instanceof Pe&&e instanceof Pe&&e.equals(i.move)||e===i.move)return this._current=i,this._current.activeBranch=!0,!0;o=i}return this._current=new Qe(this._current.number+1,this._current,o.branchIndex+1,!0,e,n),this._current.setElapsedMs(0),o.branch=this._current,!0}removeAfter(){const e=this._current;if(!this.goBack())return void(this._current.next=null);if(this._current.next===e)this._current.next=e.branch;else for(let i=this._current.next;i;i=i.branch)if(i.branch===e){i.branch=e.branch;break}let t=0;for(let i=this._current.next;i;i=i.branch)i.branchIndex=t,t+=1;this._current.next&&(this._current.next.activeBranch=!0)}incrementRepetition(){const e=this.position.sfen;this.repetitionCounts[e]?this.repetitionCounts[e]+=1:(this.repetitionCounts[e]=1,this.repetitionStart[e]=this.current.number)}decrementRepetition(){const e=this.position.sfen;this.repetitionCounts[e]-=1,0===this.repetitionCounts[e]&&(delete this.repetitionCounts[e],delete this.repetitionStart[e])}get repetition(){return this.repetitionCounts[this.position.sfen]>=4}get perpetualCheck(){if(!this.repetition)return null;const e=this.position.sfen,t=this.repetitionStart[e];let i=!0,n=!0,o=this.position.color;for(let a=this.current;a.number>=t;a=a.prev)o=Z(o),a.isCheck||(o===j.BLACK?i=!1:n=!1);return i?j.BLACK:n?j.WHITE:null}get usi(){let e="position sfen "+this.initialPosition.sfen+" moves";return this.movesBefore.forEach((t=>{t.move instanceof Pe&&(e+=" "+t.move.sfen)})),e}get usiAll(){let e=this.usi;for(let t=this._current.next;t;t=t.next){while(!t.activeBranch)t=t.branch;t.move instanceof Pe&&(e+=" "+t.move.sfen)}return e}get sfen(){return this.position.getSFEN(this._current.number+1)}forEach(e){this._forEach(e)}_forEach(e){let t=this._first;const i=[];while(t)e(t),t.branch&&i.push(t.branch),t=t.next?t.next:i.pop()||null}static newByUSI(e){const t="position startpos ",i="position sfen ",n="startpos ",o="sfen ",a="moves ";return e.startsWith(t)?Xe.newByUSIFromMoves(new xe,e.slice(t.length)):e.startsWith(i)?Xe.newByUSIFromSFENPosition(e.slice(i.length)):e.startsWith(n)?Xe.newByUSIFromMoves(new xe,e.slice(n.length)):e.startsWith(o)?Xe.newByUSIFromSFENPosition(e.slice(o.length)):e.startsWith(a)?Xe.newByUSIFromMoves(new xe,e):new Error("不正なUSI(1): "+e)}static newByUSIFromSFENPosition(e){const t=e.split(" ");if(t.length<4)return new Error("不正なUSI(2): "+e);const i=xe.newBySFEN(t.slice(0,4).join(" "));return i?Xe.newByUSIFromMoves(i,t.slice(4).join(" ")):new Error("不正なUSI(3): "+e)}static newByUSIFromMoves(e,t){const i=new Xe(e);if(0===t.length)return i;const n=t.split(" ");if("moves"!==n[0])return new Error("不正なUSI(4): "+t);for(let o=1;o<n.length;o++){const e=Re(n[o]);if(!e)break;let t=i.position.createMove(e.from,e.to);if(!t)return new Error("不正な指し手: "+n[o]);e.promote&&(t=t.withPromote()),i.append(t,{ignoreValidation:!0})}return i}}function et(e,t){return e+(!e||e.endsWith("\n")?"":"\n")+t}function tt(e){return e instanceof Object?JSON.stringify(e):String(e)}const it={"先手":Ve.BLACK_NAME,"後手":Ve.WHITE_NAME,"開始日時":Ve.START_DATETIME,"終了日時":Ve.END_DATETIME,"対局日":Ve.DATE,"棋戦":Ve.TOURNAMENT,"戦型":Ve.STRATEGY,"表題":Ve.TITLE,"持ち時間":Ve.TIME_LIMIT,"消費時間":Ve.TIME_SPENT,"場所":Ve.PLACE,"掲載":Ve.POSTED_ON,"備考":Ve.NOTE,"先手省略名":Ve.BLACK_SHORT_NAME,"後手省略名":Ve.WHITE_SHORT_NAME,"作品番号":Ve.OPUS_NO,"作品名":Ve.OPUS_NAME,"作者":Ve.AUTHOR,"発表誌":Ve.PUBLISHED_ON,"発表年月":Ve.PUBLISHED_AT,"出典":Ve.SOURCE,"手数":Ve.LENGTH,"完全性":Ve.INTEGRITY,"分類":Ve.CATEGORY,"受賞":Ve.AWARD},nt={blackName:"先手",whiteName:"後手",startDatetime:"開始日時",endDatetime:"終了日時",date:"対局日",tournament:"棋戦",strategy:"戦型",title:"表題",timeLimit:"持ち時間",timeSpent:"消費時間",place:"場所",postedOn:"掲載",note:"備考",blackShortName:"先手省略名",whiteShortName:"後手省略名",opusNo:"作品番号",opusName:"作品名",author:"作者",publishedOn:"発表誌",publishedAt:"発表年月",source:"出典",length:"手数",integrity:"完全性",category:"分類",award:"受賞"};var ot;(function(e){e[e["PROGRAM_COMMENT"]=0]="PROGRAM_COMMENT",e[e["METADATA"]=1]="METADATA",e[e["HANDICAP"]=2]="HANDICAP",e[e["BLACK_HAND"]=3]="BLACK_HAND",e[e["WHITE_HAND"]=4]="WHITE_HAND",e[e["BOARD"]=5]="BOARD",e[e["BLACK_TURN"]=6]="BLACK_TURN",e[e["WHITE_TURN"]=7]="WHITE_TURN",e[e["MOVE"]=8]="MOVE",e[e["COMMENT"]=9]="COMMENT",e[e["UNKNOWN"]=10]="UNKNOWN"})(ot||(ot={}));const at=[{prefix:/^#/,type:ot.PROGRAM_COMMENT,removePrefix:!1,isPosition:!1},{prefix:/^手合割：/,type:ot.HANDICAP,removePrefix:!0,isPosition:!0},{prefix:/^先手の持駒：/,type:ot.BLACK_HAND,removePrefix:!0,isPosition:!0},{prefix:/^後手の持駒：/,type:ot.WHITE_HAND,removePrefix:!0,isPosition:!0},{prefix:/^\|/,type:ot.BOARD,removePrefix:!1,isPosition:!0},{prefix:/^先手番/,type:ot.BLACK_TURN,removePrefix:!1,isPosition:!0},{prefix:/^後手番/,type:ot.WHITE_TURN,removePrefix:!1,isPosition:!0},{prefix:/^ *[0-9]+ +/,type:ot.MOVE,removePrefix:!1,isPosition:!1},{prefix:/^\*/,type:ot.COMMENT,removePrefix:!0,isPosition:!1}];function st(e){for(let i=0;i<at.length;i++){const t=at[i],n=e.match(t.prefix);if(n){const i=t.removePrefix?n[0].length:0;return{type:t.type,data:e.substring(i),isPosition:t.isPosition,metadataKey:""}}}const t=e.match(/^[^ ]+：/);if(t){const i=t[0];return{type:ot.METADATA,data:e.substring(i.length),isPosition:!1,metadataKey:i.substring(0,i.length-1)}}return{type:ot.UNKNOWN,data:e,isPosition:!1,metadataKey:""}}function rt(e,t){switch(t.trim()){case"平手":return void e.reset(ke.STANDARD);case"香落ち":return void e.reset(ke.HANDICAP_LANCE);case"右香落ち":return void e.reset(ke.HANDICAP_RIGHT_LANCE);case"角落ち":return void e.reset(ke.HANDICAP_BISHOP);case"飛車落ち":return void e.reset(ke.HANDICAP_ROOK);case"飛香落ち":return void e.reset(ke.HANDICAP_ROOK_LANCE);case"二枚落ち":return void e.reset(ke.HANDICAP_2PIECES);case"四枚落ち":return void e.reset(ke.HANDICAP_4PIECES);case"六枚落ち":return void e.reset(ke.HANDICAP_6PIECES);case"八枚落ち":return void e.reset(ke.HANDICAP_8PIECES);case"その他":return void e.reset(ke.EMPTY)}return new Error("不正なデータ:"+t)}const lt={"１":1,"２":2,"３":3,"４":4,"５":5,"６":6,"７":7,"８":8,"９":9},ct={"一":1,"二":2,"三":3,"四":4,"五":5,"六":6,"七":7,"八":8,"九":9},dt={"一":1,"二":2,"三":3,"四":4,"五":5,"六":6,"七":7,"八":8,"九":9,"十":10,"十一":11,"十二":12,"十三":13,"十四":14,"十五":15,"十六":16,"十七":17,"十八":18},ht={1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9},ut={"王":V.KING,"玉":V.KING,"飛":V.ROOK,"龍":V.DRAGON,"竜":V.DRAGON,"角":V.BISHOP,"馬":V.HORSE,"金":V.GOLD,"銀":V.SILVER,"成銀":V.PROM_SILVER,"全":V.PROM_SILVER,"桂":V.KNIGHT,"成桂":V.PROM_KNIGHT,"圭":V.PROM_KNIGHT,"香":V.LANCE,"成香":V.PROM_LANCE,"杏":V.PROM_LANCE,"歩":V.PAWN,"と":V.PROM_PAWN},pt={"中断":ze.INTERRUPT,"投了":ze.RESIGN,"持将棋":ze.DRAW,"千日手":ze.REPETITION_DRAW,"詰み":ze.MATE,"切れ負け":ze.TIMEOUT,"反則勝ち":ze.FOUL_WIN,"反則負け":ze.FOUL_LOSE,"入玉勝ち":ze.ENTERING_OF_KING,"不戦勝":ze.WIN_BY_DEFAULT,"不戦敗":ze.LOSS_BY_DEFAULT},gt=/^ *([0-9]+) +[▲△]?([１２３４５６７８９][一二三四五六七八九]|同\u3000)(王|玉|飛|龍|竜|角|馬|金|銀|成銀|全|桂|成桂|圭|香|成香|杏|歩|と)(成?)(打|\([1-9][1-9]\)) *(.*)$/,mt=/\( *([0-9]+):([0-9]+)\/[0-9: ]*\)/,_t=/^ *([0-9]+) +(中断|投了|持将棋|千日手|詰み|切れ負け|反則勝ち|反則負け|入玉勝ち|不戦勝|不戦敗) *(.*)$/;function vt(e,t){if(t.length<21)return new Error("不正な盤面:"+t);const i=t[20],n=ct[i];if(!n)return new Error("不正な盤面:"+t);for(let o=0;o<9;o+=1){const i=9-o,a=new Te(i,n),s=2*o+1,r=t[s+1],l=ut[r];if(!l){e.remove(a);continue}const c="v"!==t[s]?j.BLACK:j.WHITE;e.set(a,new he(c,l))}}function St(e,t){const i=t.split(/[ 　]/);for(const n of i){if(!n||"なし"===n)continue;const t=n[0],i=n.substring(1),o=ut[t],a=dt[i]||1;if(!o)return new Error("不正な持ち駒: "+n);e.add(o,a)}}function Et(e,t){const i=mt.exec(t);if(i){const t=i[1],n=i[2],o=60*Number.parseInt(t)+Number.parseInt(n);e.current.setElapsedMs(1e3*o)}}function wt(e,t){let i=_t.exec(t);if(i){const t=Number(i[1]),n=pt[i[2]],o=i[3];return e.goto(t-1),e.append(n,{ignoreValidation:!0}),void Et(e,o)}if(i=gt.exec(t),!i)return new Error("不正な指し手形式:"+t);const n=Number(i[1]),o=i[2],a=i[3],s=i[4],r=i[5],l=i[6];if(0===n)return new Error("不正な手数:"+t);let c,d;if(e.goto(n-1),"同　"===o){if(!(e.current.move instanceof Pe))return new Error("不明な移動先: "+t);c=e.current.move.to}else{const e=lt[o[0]],t=ct[o[1]];c=new Te(e,t)}if("打"===r)d=ut[a];else{const e=ht[r[1]],t=ht[r[2]];d=new Te(e,t)}let h=e.position.createMove(d,c);if(!h)return new Error("不正な指し手: "+t);"成"===s&&(h=h.withPromote()),e.append(h,{ignoreValidation:!0}),Et(e,l)}function It(e){const t=new Ye,i=new Xe,n=e.split(/\r?\n/),o=new xe;let a="",s=!1;for(const r of n){if(""===r)continue;const e=st(r);if(s&&e.isPosition)return new Error("不正なデータ: "+r);let n;switch(e.type){case ot.METADATA:{const i=it[e.metadataKey];i?t.setStandardMetadata(i,e.data):t.setCustomMetadata(e.metadataKey,e.data);break}case ot.HANDICAP:n=rt(o,e.data);break;case ot.BLACK_HAND:n=St(o.blackHand,e.data);break;case ot.WHITE_HAND:n=St(o.whiteHand,e.data);break;case ot.BOARD:n=vt(o.board,e.data);break;case ot.BLACK_TURN:o.setColor(j.BLACK);break;case ot.WHITE_TURN:o.setColor(j.WHITE);break;case ot.MOVE:s||(i.clear(o),i.first.comment=a,s=!0),n=wt(i,e.data);break;case ot.COMMENT:s?i.current.comment=et(i.current.comment,e.data):a=et(a,e.data);break;case ot.PROGRAM_COMMENT:break;case ot.UNKNOWN:break}if(n)return n}return s||(i.clear(o),i.first.comment=a),i.goto(0),i.resetAllBranchSelection(),i.metadata=t,i}const ft=["一","二","三","四","五","六","七","八","九","十","十一","十二","十三","十四","十五","十六","十七","十八"],yt=["１","２","３","４","５","６","７","８","９"],bt=ft,Tt={king:"玉",rook:"飛",dragon:"龍",bishop:"角",horse:"馬",gold:"金",silver:"銀",promSilver:"成銀",knight:"桂",promKnight:"成桂",lance:"香",promLance:"成香",pawn:"歩",promPawn:"と"},At={king:"玉",rook:"飛",dragon:"龍",bishop:"角",horse:"馬",gold:"金",silver:"銀",promSilver:"全",knight:"桂",promKnight:"圭",lance:"香",promLance:"杏",pawn:"歩",promPawn:"と"},Nt={start:"",resign:"投了",interrupt:"中断",draw:"持将棋",repetitionDraw:"千日手",mate:"詰み",timeout:"切れ負け",foulWin:"反則勝ち",foulLose:"反則負け",enteringOfKing:"入玉勝ち",winByDefault:"不戦勝",lossByDefault:"不戦敗"};function Pt(e,t){let i="";const n=t.returnCode?t.returnCode:"\n";for(const o of e.standardMetadataKeys)i+=nt[o]+"："+e.getStandardMetadata(o)+n;for(const o of e.customMetadataKeys)i+=o+"："+e.getCustomMetadata(o)+n;return i}function Rt(e,t){let i="";const n=t.returnCode?t.returnCode:"\n";i+="後手の持駒："+Ot(e.whiteHand)+n,i+="  ９ ８ ７ ６ ５ ４ ３ ２ １"+n,i+="+---------------------------+"+n;for(let o=0;o<9;o++){i+="|";for(let t=0;t<9;t++){const n=Te.newByXY(t,o),a=e.board.at(n);a?a.color===j.BLACK?i+=" "+At[a.type]:i+="v"+At[a.type]:i+=" ・"}i+="|"+bt[o]+n}return i+="+---------------------------+"+n,i+="先手の持駒："+Ot(e.blackHand)+n,e.color===j.BLACK?i+="先手番"+n:i+="後手番"+n,i}function kt(e){let t="";return t+=yt[e.to.file-1],t+=bt[e.to.rank-1],t+=Tt[e.pieceType],e.promote&&(t+="成"),e.from instanceof Te?t+="("+e.from.file+e.from.rank+")":t+="打",t}function Ot(e){let t="";return e.forEach(((e,i)=>{i>=1&&(t+=At[e],i>=2&&(t+=ft[i-1]),t+="　")})),t}function Ct(e,t){let i="";const n=t.returnCode?t.returnCode:"\n";return i+="# KIF形式棋譜ファイル Generated by Electron Shogi"+n,i+=Pt(e.metadata,t),i+=Rt(e.initialPosition,t),i+="手数----指手---------消費時間--"+n,e.forEach((e=>{if(0!==e.number){e.isFirstBranch||(i+=n,i+="変化："+e.number+"手"+n),i+=e.number+" ",e.move instanceof Pe?i+=kt(e.move):i+=Nt[e.move];const t=Fe(e.elapsedMs),o=Ke(e.totalElapsedMs);i+=` (${t}/${o})`,e.isFirstBranch&&e.hasBranch&&(i+="+"),i+=n}0!==e.comment.length&&(i+="*"+e.comment.replaceAll("\n",n+"*")+n)})),i}var Ht,Mt;(function(e){e[e["VERSION"]=0]="VERSION",e[e["COMMENT"]=1]="COMMENT",e[e["BLACK_NAME"]=2]="BLACK_NAME",e[e["WHITE_NAME"]=3]="WHITE_NAME",e[e["METADATA"]=4]="METADATA",e[e["POSITION"]=5]="POSITION",e[e["RANK"]=6]="RANK",e[e["PIECES"]=7]="PIECES",e[e["FIRST_TURN"]=8]="FIRST_TURN",e[e["MOVE"]=9]="MOVE",e[e["SPECIAL_MOVE"]=10]="SPECIAL_MOVE",e[e["ELAPSED"]=11]="ELAPSED"})(Ht||(Ht={})),function(e){e[e["HEADER"]=0]="HEADER",e[e["MOVE"]=1]="MOVE",e[e["NEUTRAL"]=2]="NEUTRAL"}(Mt||(Mt={}));const Lt=[{pattern:/^V/,type:Ht.VERSION,sectionType:Mt.HEADER},{pattern:/^'/,type:Ht.COMMENT,sectionType:Mt.NEUTRAL},{pattern:/^N\+(.+)$/,type:Ht.BLACK_NAME,sectionType:Mt.HEADER},{pattern:/^N-(.+)$/,type:Ht.WHITE_NAME,sectionType:Mt.HEADER},{pattern:/^\$([^:]+):(.+)$/,type:Ht.METADATA,sectionType:Mt.HEADER},{pattern:/^PI([1-9]{2}[A-Z]{2})*$/,type:Ht.POSITION,sectionType:Mt.HEADER},{pattern:/^P[1-9]( \* |[-+][A-Z][A-Z]){9}$/,type:Ht.RANK,sectionType:Mt.HEADER},{pattern:/^P[-+]([0-9]{2}[A-Z]{2})*/,type:Ht.PIECES,sectionType:Mt.HEADER},{pattern:/^[-+]$/,type:Ht.FIRST_TURN,sectionType:Mt.HEADER},{pattern:/^[-+][0-9]{4}[A-Z]{2}/,type:Ht.MOVE,sectionType:Mt.MOVE},{pattern:/^%[-+A-Z_]+/,type:Ht.SPECIAL_MOVE,sectionType:Mt.MOVE},{pattern:/^T([0-9]+)/,type:Ht.ELAPSED,sectionType:Mt.MOVE}];function Dt(e){const t=[],i=e.match(/^['N$]/)?[e]:e.split(",");for(const n of i)for(let e=0;e<Lt.length;e++){const i=Lt[e].pattern.exec(n);i&&t.push({type:Lt[e].type,line:n,args:i.slice(1),sectionType:Lt[e].sectionType})}return t}const Bt={EVENT:Ve.TITLE,SITE:Ve.PLACE,START_TIME:Ve.START_DATETIME,END_TIME:Ve.END_DATETIME,TIME_LIMIT:Ve.TIME_LIMIT,OPENING:Ve.STRATEGY},Gt={FU:V.PAWN,KY:V.LANCE,KE:V.KNIGHT,GI:V.SILVER,KI:V.GOLD,KA:V.BISHOP,HI:V.ROOK,OU:V.KING,TO:V.PROM_PAWN,NY:V.PROM_LANCE,NK:V.PROM_KNIGHT,NG:V.PROM_SILVER,UM:V.HORSE,RY:V.DRAGON};function xt(e,t){t.reset(ke.STANDARD);for(let i=2;i+4<=e.length;i+=4){const n=Number(e[i]),o=Number(e[i+1]);t.board.remove(new Te(n,o))}}function Wt(e,t){const i=Number(e[1]);for(let n=0;n<9;n+=1){const o=9-n,a=3*n+2,s=e.slice(a,a+3);if(" "===s[0])continue;const r="+"===s[0]?j.BLACK:j.WHITE,l=Gt[s.slice(1)];if(!l)return new Error("不正な駒: "+s);t.board.set(new Te(o,i),new he(r,l))}}function Ut(e,t){const i="+"===e[1]?j.BLACK:j.WHITE;for(let n=2;n+4<=e.length;n+=4){const o=e.slice(n,n+4);if("00AL"===o){const e=Ue(t);return void(i===j.BLACK?t.blackHand.forEach((i=>{t.blackHand.add(i,e[i])})):t.whiteHand.forEach((i=>{t.whiteHand.add(i,e[i])})))}const a=Number(o[0]),s=Number(o[1]),r=Gt[o.slice(2)];if(!r)return new Error("不正な駒: "+o);0!==a&&0!==s?t.board.set(new Te(a,s),new he(i,r)):i===j.BLACK?t.blackHand.add(r,1):t.whiteHand.add(r,1)}}function Kt(e,t){const i="+"===e[0]?j.BLACK:j.WHITE;if(i!=t.color)return new Error("不正な手番: "+e);const n=Number(e[1]),o=Number(e[2]),a=Number(e[3]),s=Number(e[4]),r=Gt[e.slice(5,7)];if(!r)return new Error("不正な駒の種類: "+e);const l=0===n&&0===o?r:new Te(n,o),c=new Te(a,s);let d=t.createMove(l,c);if(!d)return new Error("不正な指し手: "+e);if(l instanceof Te){const i=t.board.at(l);if(!i)return new Error("存在しない駒: "+e);if(i.type!==r){if(i.promoted().type!==r)return new Error("存在しない駒: "+e);d=d.withPromote()}}return d}function Ft(e){switch(e){case"%TORYO":return ze.RESIGN;case"%CHUDAN":return ze.INTERRUPT;case"%SENNICHITE":return ze.REPETITION_DRAW;case"%TIME_UP":return ze.TIMEOUT;case"%ILLEGAL_MOVE":return ze.FOUL_LOSE;case"%JISHOGI":return ze.DRAW;case"%KACHI":return ze.ENTERING_OF_KING;case"%HIKIWAKE":return ze.DRAW;case"%TSUMI":return ze.MATE}}function qt(e){const t=new Ye,i=new Xe,n=new xe;n.reset(ke.EMPTY);let o=!1;const a=e.replace(/\r?\n\//,"").split(/\r?\n/);for(const s of a)for(const e of Dt(s)){if(e.sectionType===Mt.HEADER&&o||e.sectionType===Mt.MOVE&&!o)return new Error("不正な行が検出されました: "+e.line);switch(e.type){case Ht.VERSION:break;case Ht.COMMENT:break;case Ht.BLACK_NAME:t.setStandardMetadata(Ve.BLACK_NAME,e.args[0]);break;case Ht.WHITE_NAME:t.setStandardMetadata(Ve.WHITE_NAME,e.args[0]);break;case Ht.METADATA:{const i=Bt[e.args[0]];i?t.setStandardMetadata(i,e.args[1]):t.setCustomMetadata(e.args[0],e.args[1]);break}case Ht.POSITION:xt(e.line,n);break;case Ht.RANK:{const t=Wt(e.line,n);if(t)return t;break}case Ht.PIECES:{const t=Ut(e.line,n);if(t)return t;break}case Ht.FIRST_TURN:"+"===e.line[0]?n.setColor(j.BLACK):n.setColor(j.WHITE),i.clear(n),o=!0;break;case Ht.MOVE:{const t=Kt(e.line,i.position);if(t instanceof Error)return t;i.append(t,{ignoreValidation:!0});break}case Ht.SPECIAL_MOVE:{const t=Ft(e.line);t&&i.append(t,{ignoreValidation:!0});break}case Ht.ELAPSED:i.current.setElapsedMs(1e3*Number(e.args[0]));break}}return o||i.clear(n),i.goto(0),i.resetAllBranchSelection(),i.metadata=t,i}function jt(e,t){let i="";const n=t.returnCode?t.returnCode:"\n",o=e.getStandardMetadata(Ve.BLACK_NAME)||e.getStandardMetadata(Ve.BLACK_SHORT_NAME);o&&(i+="N+"+o+n);const a=e.getStandardMetadata(Ve.WHITE_NAME)||e.getStandardMetadata(Ve.WHITE_SHORT_NAME);a&&(i+="N-"+a+n);const s=e.getStandardMetadata(Ve.TOURNAMENT)||e.getStandardMetadata(Ve.TITLE)||e.getStandardMetadata(Ve.OPUS_NAME)||e.getStandardMetadata(Ve.PUBLISHED_ON);s&&(i+="$EVENT:"+s+n);const r=e.getStandardMetadata(Ve.PLACE);r&&(i+="$SITE:"+r+n);const l=e.getStandardMetadata(Ve.START_DATETIME)||e.getStandardMetadata(Ve.DATE);l&&(i+="$START_TIME:"+l.slice(10)+n);const c=e.getStandardMetadata(Ve.DATE);c&&(i+="$END_TIME:"+c.slice(10)+n);const d=e.getStandardMetadata(Ve.STRATEGY);return d&&(i+="$OPENING:"+d+n),i}const Vt={king:"OU",rook:"HI",dragon:"RY",bishop:"KA",horse:"UM",gold:"KI",silver:"GI",promSilver:"NG",knight:"KE",promKnight:"NK",lance:"KY",promLance:"NY",pawn:"FU",promPawn:"TO"};function zt(e){let t="";return e.forEach(((e,i)=>{for(let n=0;n<i;n++)t+="00"+Vt[e]})),t}function Zt(e,t){let i="";const n=t.returnCode?t.returnCode:"\n";for(let o=1;o<=9;o+=1){i+="P"+o;for(let t=9;t>=1;t-=1){const n=e.board.at(new Te(t,o));n?n.color===j.BLACK?i+="+"+Vt[n.type]:i+="-"+Vt[n.type]:i+=" * "}i+=n}return i+="P+"+zt(e.blackHand)+n,i+="P-"+zt(e.whiteHand)+n,i+=(e.color===j.BLACK?"+":"-")+n,i}function Yt(e){return e instanceof Te?`${e.file}${e.rank}`:"00"}function $t(e){return(e.color===j.BLACK?"+":"-")+Yt(e.from)+Yt(e.to)+Vt[e.promote?ne(e.pieceType):e.pieceType]}function Jt(e){switch(e){case ze.RESIGN:return"%TORYO";case ze.INTERRUPT:return"%CHUDAN";case ze.REPETITION_DRAW:return"%SENNICHITE";case ze.TIMEOUT:return"%TIME_UP";case ze.FOUL_LOSE:return"%ILLEGAL_MOVE";case ze.DRAW:return"%JISHOGI";case ze.ENTERING_OF_KING:return"%KACHI";case ze.MATE:return"%TSUMI"}}function Qt(e,t){let i="";const n=t.returnCode?t.returnCode:"\n";return i+="' CSA形式棋譜ファイル Generated by Electron Shogi"+n,i+="V2.2"+n,i+=jt(e.metadata,t),i+=Zt(e.initialPosition,t),e.moves.forEach((e=>{if(0===e.number)return;let t;t=e.move instanceof Pe?$t(e.move):Jt(e.move),t&&(i+=t+n,i+="T"+Math.floor(e.elapsedMs/1e3)+n)})),i}var Xt;function ei(e){if(e.startsWith("position sfen ")||e.startsWith("position startpos ")||e.startsWith("sfen ")||e.startsWith("startpos ")||e.startsWith("moves "))return Xt.USI;if(xe.isValidSFEN(e))return Xt.SFEN;const t=/(^|\n)[#0-9開終棋手戦表持秒記消場掲備先後作発出完分受]/g,i=/(^|,|\n)[-+$%'VNPT]/g,n=e.match(t),o=e.match(i),a=n?n.length:0,s=o?o.length:0;return a>=s?Xt.KIF:Xt.CSA}(function(e){e[e["USI"]=0]="USI",e[e["SFEN"]=1]="SFEN",e[e["KIF"]=2]="KIF",e[e["CSA"]=3]="CSA"})(Xt||(Xt={}));const ti={};function ii(e){if(ti[e])return;const t=document.createElement("img");t.src=e,ti[e]=t}class ni{constructor(e,t){(0,z.Z)(this,"width",void 0),(0,z.Z)(this,"height",void 0),this.width=e,this.height=t}add(e){return new ni(this.width+e.width,this.height+e.height)}reduce(e){return new ni(this.width-e.width,this.height-e.height)}}var oi,ai,si;(function(e){e["HITOMOJI"]="hitomoji",e["HITOMOJI_DARK"]="hitomojiDark",e["HITOMOJI_GOTHIC"]="hitomojiGothic",e["HITOMOJI_GOTHIC_DARK"]="hitomojiGothicDark"})(oi||(oi={})),function(e){e["LIGHT"]="light",e["WARM"]="warm",e["RESIN"]="resin",e["DARK"]="dark"}(ai||(ai={})),function(e){e["NONE"]="none",e["STANDARD"]="standard"}(si||(si={}));const ri={frame:{width:1471,height:959},board:{x:296.5,y:0,width:878,height:960,squreWidth:94.8,squreHeight:104,leftSquarePadding:12,topSquarePadding:12.2,leftPiecePadding:17.5,topPiecePadding:18.5,highlight:{selected:{"background-color":"#0088ff",opacity:"0.8"},lastMoveTo:{"background-color":"#44cc44",opacity:"0.8"},lastMoveFrom:{"background-color":"#44cc44",opacity:"0.4"}}},label:{fontSize:24},piece:{width:88,height:93},hand:{black:{x:1184,y:600},white:{x:0,y:0},width:288,height:360,highlight:{selected:{"background-color":"#ff4800",opacity:"0.7"}}},turn:{black:{x:1184,y:425},white:{x:0,y:492},width:288,height:45,fontSize:32},playerName:{black:{x:1184,y:480},white:{x:0,y:370},width:288,height:45,fontSize:25},clock:{black:{x:1184,y:535},white:{x:0,y:425},width:288,height:55,fontSize:40},control:{left:{x:0,y:547,width:288,height:412,fontSize:26},right:{x:1184,y:0,width:288,height:412,fontSize:26}}},li={[oi.HITOMOJI]:{black:{pawn:"./piece/hitomoji/black_pawn.png",lance:"./piece/hitomoji/black_lance.png",knight:"./piece/hitomoji/black_knight.png",silver:"./piece/hitomoji/black_silver.png",gold:"./piece/hitomoji/black_gold.png",bishop:"./piece/hitomoji/black_bishop.png",rook:"./piece/hitomoji/black_rook.png",king:"./piece/hitomoji/black_king.png",king2:"./piece/hitomoji/black_king2.png",promPawn:"./piece/hitomoji/black_prom_pawn.png",promLance:"./piece/hitomoji/black_prom_lance.png",promKnight:"./piece/hitomoji/black_prom_knight.png",promSilver:"./piece/hitomoji/black_prom_silver.png",horse:"./piece/hitomoji/black_horse.png",dragon:"./piece/hitomoji/black_dragon.png"},white:{pawn:"./piece/hitomoji/white_pawn.png",lance:"./piece/hitomoji/white_lance.png",knight:"./piece/hitomoji/white_knight.png",silver:"./piece/hitomoji/white_silver.png",gold:"./piece/hitomoji/white_gold.png",bishop:"./piece/hitomoji/white_bishop.png",rook:"./piece/hitomoji/white_rook.png",king:"./piece/hitomoji/white_king.png",king2:"./piece/hitomoji/white_king2.png",promPawn:"./piece/hitomoji/white_prom_pawn.png",promLance:"./piece/hitomoji/white_prom_lance.png",promKnight:"./piece/hitomoji/white_prom_knight.png",promSilver:"./piece/hitomoji/white_prom_silver.png",horse:"./piece/hitomoji/white_horse.png",dragon:"./piece/hitomoji/white_dragon.png"}},[oi.HITOMOJI_DARK]:{black:{pawn:"./piece/hitomoji_dark/black_pawn.png",lance:"./piece/hitomoji_dark/black_lance.png",knight:"./piece/hitomoji_dark/black_knight.png",silver:"./piece/hitomoji_dark/black_silver.png",gold:"./piece/hitomoji_dark/black_gold.png",bishop:"./piece/hitomoji_dark/black_bishop.png",rook:"./piece/hitomoji_dark/black_rook.png",king:"./piece/hitomoji_dark/black_king.png",king2:"./piece/hitomoji_dark/black_king2.png",promPawn:"./piece/hitomoji_dark/black_prom_pawn.png",promLance:"./piece/hitomoji_dark/black_prom_lance.png",promKnight:"./piece/hitomoji_dark/black_prom_knight.png",promSilver:"./piece/hitomoji_dark/black_prom_silver.png",horse:"./piece/hitomoji_dark/black_horse.png",dragon:"./piece/hitomoji_dark/black_dragon.png"},white:{pawn:"./piece/hitomoji_dark/white_pawn.png",lance:"./piece/hitomoji_dark/white_lance.png",knight:"./piece/hitomoji_dark/white_knight.png",silver:"./piece/hitomoji_dark/white_silver.png",gold:"./piece/hitomoji_dark/white_gold.png",bishop:"./piece/hitomoji_dark/white_bishop.png",rook:"./piece/hitomoji_dark/white_rook.png",king:"./piece/hitomoji_dark/white_king.png",king2:"./piece/hitomoji_dark/white_king2.png",promPawn:"./piece/hitomoji_dark/white_prom_pawn.png",promLance:"./piece/hitomoji_dark/white_prom_lance.png",promKnight:"./piece/hitomoji_dark/white_prom_knight.png",promSilver:"./piece/hitomoji_dark/white_prom_silver.png",horse:"./piece/hitomoji_dark/white_horse.png",dragon:"./piece/hitomoji_dark/white_dragon.png"}},[oi.HITOMOJI_GOTHIC]:{black:{pawn:"./piece/hitomoji_gothic/black_pawn.png",lance:"./piece/hitomoji_gothic/black_lance.png",knight:"./piece/hitomoji_gothic/black_knight.png",silver:"./piece/hitomoji_gothic/black_silver.png",gold:"./piece/hitomoji_gothic/black_gold.png",bishop:"./piece/hitomoji_gothic/black_bishop.png",rook:"./piece/hitomoji_gothic/black_rook.png",king:"./piece/hitomoji_gothic/black_king.png",king2:"./piece/hitomoji_gothic/black_king2.png",promPawn:"./piece/hitomoji_gothic/black_prom_pawn.png",promLance:"./piece/hitomoji_gothic/black_prom_lance.png",promKnight:"./piece/hitomoji_gothic/black_prom_knight.png",promSilver:"./piece/hitomoji_gothic/black_prom_silver.png",horse:"./piece/hitomoji_gothic/black_horse.png",dragon:"./piece/hitomoji_gothic/black_dragon.png"},white:{pawn:"./piece/hitomoji_gothic/white_pawn.png",lance:"./piece/hitomoji_gothic/white_lance.png",knight:"./piece/hitomoji_gothic/white_knight.png",silver:"./piece/hitomoji_gothic/white_silver.png",gold:"./piece/hitomoji_gothic/white_gold.png",bishop:"./piece/hitomoji_gothic/white_bishop.png",rook:"./piece/hitomoji_gothic/white_rook.png",king:"./piece/hitomoji_gothic/white_king.png",king2:"./piece/hitomoji_gothic/white_king2.png",promPawn:"./piece/hitomoji_gothic/white_prom_pawn.png",promLance:"./piece/hitomoji_gothic/white_prom_lance.png",promKnight:"./piece/hitomoji_gothic/white_prom_knight.png",promSilver:"./piece/hitomoji_gothic/white_prom_silver.png",horse:"./piece/hitomoji_gothic/white_horse.png",dragon:"./piece/hitomoji_gothic/white_dragon.png"}},[oi.HITOMOJI_GOTHIC_DARK]:{black:{pawn:"./piece/hitomoji_gothic_dark/black_pawn.png",lance:"./piece/hitomoji_gothic_dark/black_lance.png",knight:"./piece/hitomoji_gothic_dark/black_knight.png",silver:"./piece/hitomoji_gothic_dark/black_silver.png",gold:"./piece/hitomoji_gothic_dark/black_gold.png",bishop:"./piece/hitomoji_gothic_dark/black_bishop.png",rook:"./piece/hitomoji_gothic_dark/black_rook.png",king:"./piece/hitomoji_gothic_dark/black_king.png",king2:"./piece/hitomoji_gothic_dark/black_king2.png",promPawn:"./piece/hitomoji_gothic_dark/black_prom_pawn.png",promLance:"./piece/hitomoji_gothic_dark/black_prom_lance.png",promKnight:"./piece/hitomoji_gothic_dark/black_prom_knight.png",promSilver:"./piece/hitomoji_gothic_dark/black_prom_silver.png",horse:"./piece/hitomoji_gothic_dark/black_horse.png",dragon:"./piece/hitomoji_gothic_dark/black_dragon.png"},white:{pawn:"./piece/hitomoji_gothic_dark/white_pawn.png",lance:"./piece/hitomoji_gothic_dark/white_lance.png",knight:"./piece/hitomoji_gothic_dark/white_knight.png",silver:"./piece/hitomoji_gothic_dark/white_silver.png",gold:"./piece/hitomoji_gothic_dark/white_gold.png",bishop:"./piece/hitomoji_gothic_dark/white_bishop.png",rook:"./piece/hitomoji_gothic_dark/white_rook.png",king:"./piece/hitomoji_gothic_dark/white_king.png",king2:"./piece/hitomoji_gothic_dark/white_king2.png",promPawn:"./piece/hitomoji_gothic_dark/white_prom_pawn.png",promLance:"./piece/hitomoji_gothic_dark/white_prom_lance.png",promKnight:"./piece/hitomoji_gothic_dark/white_prom_knight.png",promSilver:"./piece/hitomoji_gothic_dark/white_prom_silver.png",horse:"./piece/hitomoji_gothic_dark/white_horse.png",dragon:"./piece/hitomoji_gothic_dark/white_dragon.png"}}},ci={[ai.LIGHT]:"./board/light.png",[ai.WARM]:"./board/warm.png",[ai.RESIN]:"./board/resin.png",[ai.DARK]:"./board/dark.png"},di={[ai.LIGHT]:"#8b4513",[ai.WARM]:"#8b4513",[ai.RESIN]:"#8b4513",[ai.DARK]:"#333333"},hi={black:{pawn:{row:3,column:0,width:2},lance:{row:2,column:0,width:1},knight:{row:2,column:1,width:1},silver:{row:1,column:0,width:1},gold:{row:1,column:1,width:1},bishop:{row:0,column:0,width:1},rook:{row:0,column:1,width:1},king:{row:0,column:0,width:0},promPawn:{row:0,column:0,width:0},promLance:{row:0,column:0,width:0},promKnight:{row:0,column:0,width:0},promSilver:{row:0,column:0,width:0},horse:{row:0,column:0,width:0},dragon:{row:0,column:0,width:0}},white:{pawn:{row:0,column:0,width:2},lance:{row:1,column:1,width:1},knight:{row:1,column:0,width:1},silver:{row:2,column:1,width:1},gold:{row:2,column:0,width:1},bishop:{row:3,column:1,width:1},rook:{row:3,column:0,width:1},king:{row:0,column:0,width:0},promPawn:{row:0,column:0,width:0},promLance:{row:0,column:0,width:0},promKnight:{row:0,column:0,width:0},promSilver:{row:0,column:0,width:0},horse:{row:0,column:0,width:0},dragon:{row:0,column:0,width:0}}},ui={1:"一",2:"二",3:"三",4:"四",5:"五",6:"六",7:"七",8:"八",9:"九"};class pi{constructor(e,t,i){(0,z.Z)(this,"pieceImages",void 0),(0,z.Z)(this,"boardImage",void 0),(0,z.Z)(this,"handColor",void 0),(0,z.Z)(this,"boardLabelType",void 0),this.pieceImages=li[e]||li[oi.HITOMOJI],this.boardImage=ci[t],this.handColor=di[t],this.boardLabelType=i}preload(){ii(this.boardImage),Object.values(this.pieceImages.black).forEach(ii),Object.values(this.pieceImages.white).forEach(ii)}build(e,t,i,n,o,a){let s=e.width/ri.frame.width;ri.frame.height*s>e.height&&(s=e.height/ri.frame.height);const r=()=>{const e=ri.frame.height*s,t=ri.frame.width*s;return{style:{height:e+"px",width:t+"px"},size:new ni(t,e)}},l=()=>{const e=this.boardImage,t=ri.board.x*s,i=ri.board.y*s,n=ri.board.width*s,o=ri.board.height*s,a={left:t+"px",top:i+"px",height:o+"px",width:n+"px"};return{imagePath:e,x:t,y:i,style:a}},c=e=>{const t=[];if(this.boardLabelType==si.NONE)return t;const i=ri.label.fontSize*s,n=.1*i,o={color:"black","font-size":i+"px","font-weight":"bold","text-shadow":`${n}px ${n}px  ${n}px white`};for(let r=1;r<=9;r++){const n=e.x-.5*i+(a?0:ri.board.width)*s+.5*ri.board.leftPiecePadding*s*(a?1:-1),l=e.y-.5*i+(ri.board.topSquarePadding+((a?10-r:r)-.5)*ri.board.squreHeight)*s;t.push({id:"rank"+r,character:ui[r],style:{left:n+"px",top:l+"px",...o}})}for(let r=1;r<=9;r++){const n=e.x-.5*i+(ri.board.leftPiecePadding+(9.5-(a?10-r:r))*ri.board.squreWidth)*s,l=e.y-.5*i+(a?ri.board.height:0)*s+.5*ri.board.topSquarePadding*s*(a?-1:1);t.push({id:"file"+r,character:String(r),style:{left:n+"px",top:l+"px",...o}})}return t},d=e=>{const i=[];return t.board.listNonEmptySquares().forEach((n=>{const o=t.board.at(n),r=o.id+n.index,l=a?Z(o.color):o.color,c=o.type==V.KING&&o.color==j.BLACK?"king2":o.type,d=this.pieceImages[l][c],h=e.x+(ri.board.leftPiecePadding+ri.board.squreWidth*(a?n.opposite:n).x)*s,u=e.y+(ri.board.topPiecePadding+ri.board.squreHeight*(a?n.opposite:n).y)*s,p=ri.piece.width*s,g=ri.piece.height*s;i.push({id:r,imagePath:d,style:{left:h+"px",top:u+"px",width:p+"px",height:g+"px"}})})),i},h=e=>{const t=[];return Te.all.forEach((o=>{const r=o.index,{file:l}=o,{rank:c}=o,d=e.x+(ri.board.leftSquarePadding+ri.board.squreWidth*(a?o.opposite:o).x)*s,h=e.y+(ri.board.topSquarePadding+ri.board.squreHeight*(a?o.opposite:o).y)*s,u=ri.board.squreWidth*s,p=ri.board.squreHeight*s,g={left:d+"px",top:h+"px",width:u+"px",height:p+"px"};let m=g;i&&o.equals(i.to)&&(m={...m,...ri.board.highlight.lastMoveTo}),i&&i.from instanceof Te&&o.equals(i.from)&&(m={...m,...ri.board.highlight.lastMoveFrom}),n instanceof Te&&n.equals(o)&&(m={...m,...ri.board.highlight.selected}),t.push({id:r,file:l,rank:c,style:g,backgroundStyle:m})})),t},u=(e,t)=>{const i=a?Z(e):e,o=ri.hand[i].x*s,r=ri.hand[i].y*s,l=ri.hand.width*s,c=ri.hand.height*s,d={"background-color":this.handColor,left:o+"px",top:r+"px",width:l+"px",height:c+"px"},h=[],u=[];return ee.forEach((o=>{const a=t.count(o),r=hi[i][o],l=ri.hand.width/2*r.width*s,c=ri.hand.height/4*s,d=l*r.column,p=c*r.row,g=ri.piece.width*s,m=ri.piece.height*s,_=Math.max(l-g*a,0)/(2*a),v=(l-g-2*_)/Math.max(a-1,1);for(let e=a-1;e>=0;e-=1){const t=o+e,n=this.pieceImages[i][o],a=d+_+v*e,s=p;h.push({id:t,imagePath:n,style:{left:a+"px",top:s+"px",width:g+"px",height:m+"px"}})}const S=o,E={left:d+"px",top:p+"px",width:l+"px",height:c+"px"};let w=E;n&&n instanceof he&&n.color===e&&n.type===o&&(w={...w,...ri.hand.highlight.selected}),u.push({id:S,type:o,style:E,backgroundStyle:w})})),{style:d,pieces:h,pointers:u}},p=(e,t)=>{if(!t)return null;const i=a?Z(t.color):t.color,n=a?t.to.opposite:t.to,o=new he(i,t.pieceType),r=o.promoted(),l=o.unpromoted(),c=this.pieceImages[i][r.type],d=this.pieceImages[i][l.type],h=e.x+(ri.board.leftSquarePadding+ri.board.squreWidth*(0===n.x?0:8===n.x?7:n.x-.5))*s,u=e.y+(ri.board.topSquarePadding+ri.board.squreHeight*n.y)*s,p=2*ri.board.squreWidth*s,g=ri.board.squreHeight*s,m={left:h+"px",top:u+"px",width:p+"px",height:g+"px","font-size":g/4+"px"};return{promoteImagePath:c,notPromoteImagePath:d,style:m}},g=()=>{const e=t.color,i=a?Z(e):e,n=2;return{style:{left:ri.turn[i].x*s-n+"px",top:ri.turn[i].y*s-n+"px",width:ri.turn.width*s-n+"px",height:ri.turn.height*s-n+"px","font-size":ri.turn.fontSize*s+"px","border-radius":ri.turn.height*s*.4+"px","border-width":n+"px","border-style":"solid"}}},m=e=>{const t=a?Z(e):e;return{style:{left:ri.playerName[t].x*s+"px",top:ri.playerName[t].y*s+"px",width:ri.playerName.width*s+"px",height:ri.playerName.height*s+"px","font-size":ri.playerName.fontSize*s+"px"}}},_=e=>{const t=a?Z(e):e;return{style:{left:ri.clock[t].x*s+"px",top:ri.clock[t].y*s+"px",width:ri.clock.width*s+"px",height:ri.clock.height*s+"px","font-size":ri.clock.fontSize*s+"px"}}},v=()=>({left:{style:{left:ri.control.left.x*s+"px",top:ri.control.left.y*s+"px",width:ri.control.left.width*s+"px",height:ri.control.left.height*s+"px","font-size":ri.control.left.fontSize*s+"px"}},right:{style:{left:ri.control.right.x*s+"px",top:ri.control.right.y*s+"px",width:ri.control.right.width*s+"px",height:ri.control.right.height*s+"px","font-size":ri.control.right.fontSize*s+"px"}}}),S=r(),E=l(),w=c(E),I=d(E),f=h(E),y=u(j.BLACK,t.hand(j.BLACK)),b=u(j.WHITE,t.hand(j.WHITE)),T=p(E,o),A=g(),N=m(j.BLACK),P=m(j.WHITE),R=_(j.BLACK),k=_(j.WHITE),O=v();return{frame:S,board:E,labels:w,piece:I,square:f,blackHand:y,whiteHand:b,promotion:T,turn:A,blackPlayerName:N,whitePlayerName:P,blackClock:R,whiteClock:k,control:O}}}var gi=(0,o.aZ)({name:"BoardView",props:{pieceImageType:{type:String,required:!0},boardImageType:{type:String,required:!0},boardLabelType:{type:String,required:!0},maxSize:{type:ni,required:!0},position:{type:Object,required:!0},lastMove:{type:Object,required:!1,default:null},flip:{type:Boolean,required:!1},allowEdit:{type:Boolean,required:!1},allowMove:{type:Boolean,required:!1},blackPlayerName:{type:String,required:!1,default:"先手"},whitePlayerName:{type:String,required:!1,default:"後手"},blackPlayerTimeMs:{type:Number,required:!1,default:void 0},blackPlayerByoyomi:{type:Number,required:!1,default:void 0},whitePlayerTimeMs:{type:Number,required:!1,default:void 0},whitePlayerByoyomi:{type:Number,required:!1,default:void 0}},emits:["resize","move","edit"],setup(e,t){const i=(0,d.qj)({pointer:null,reservedMove:null}),n=()=>{i.pointer=null,i.reservedMove=null};(0,o.YP)([()=>e.position,()=>e.allowEdit,()=>e.allowMove],(()=>{n()}));const a=()=>{n()},s=(o,a,s)=>{const r=i.pointer;if(n(),!(o instanceof Te&&r instanceof Te&&o.equals(r))&&!(o instanceof he&&r instanceof he&&o.equals(r))){if(r){const n=r,a=o instanceof Te?o:o.color;if(e.allowEdit&&e.position.isValidEditing(n,a))return void t.emit("edit",{move:{from:r,to:a}});if(e.allowMove&&o instanceof Te){const n=r instanceof Te?r:r.type,a=o,s=e.position.createMove(n,a);if(!s)return;const l=e.position.isValidMove(s),c=e.position.isValidMove(s.withPromote());if(l&&c)return void(i.reservedMove=s);if(l)return void t.emit("move",s);if(c)return void t.emit("move",s.withPromote())}}!e.allowMove&&!e.allowEdit||a||(e.allowEdit||s===e.position.color)&&(i.pointer=o)}},r=(t,i,n)=>{t.stopPropagation(),t.preventDefault();const o=new Te(i,n),a=e.position.board.at(o),r=!a;s(o,r,a?.color)},l=(t,i,n)=>{t.stopPropagation(),t.preventDefault();const o=0===e.position.hand(i).count(n);s(new he(i,n),o,i)},c=(i,o,a)=>{i.stopPropagation(),i.preventDefault(),n();const s=new Te(o,a);e.allowEdit&&e.position.board.at(s)&&t.emit("edit",{rotate:s})},h=o=>{o.stopPropagation(),o.preventDefault();const a=i.reservedMove;n(),a&&e.position.isValidMove(a.withPromote())&&t.emit("move",a.withPromote())},u=o=>{o.stopPropagation(),o.preventDefault();const a=i.reservedMove;n(),a&&e.position.isValidMove(a)&&t.emit("move",a)},p=(0,o.Fl)((()=>{const t=new pi(e.pieceImageType,e.boardImageType,e.boardLabelType);return t.preload(),t})),g=(0,o.Fl)((()=>{const n=new ni(20,20),o=p.value.build(e.maxSize.reduce(n),e.position,e.lastMove,i.pointer,i.reservedMove,e.flip);return t.emit("resize",o.frame.size.add(n)),o})),m=(e,t)=>e?qe(Math.ceil(e/1e3)):void 0!==t?""+t:"0:00:00",_=(e,t)=>{if(!e&&!t)return"normal";const i=(e||0)/1e3+(t||0);return i<=5?"danger":i<=10?"warning":"normal"},v=(0,o.Fl)((()=>m(e.blackPlayerTimeMs,e.blackPlayerByoyomi))),S=(0,o.Fl)((()=>_(e.blackPlayerTimeMs,e.blackPlayerByoyomi))),E=(0,o.Fl)((()=>m(e.whitePlayerTimeMs,e.whitePlayerByoyomi))),w=(0,o.Fl)((()=>_(e.whitePlayerTimeMs,e.whitePlayerByoyomi)));return{clickFrame:a,clickSquare:r,clickHand:l,clickSquareR:c,clickPromote:h,clickNotPromote:u,layout:g,blackPlayerTimeText:v,blackPlayerTimeSeverity:S,whitePlayerTimeText:E,whitePlayerTimeSeverity:w,Color:j}}}),mi=i(3744);const _i=(0,mi.Z)(gi,[["render",q],["__scopeId","data-v-7b1939f2"]]);var vi=_i;const Si="es://human",Ei="es://usi-engine/";function wi(e){return e.startsWith(Ei)}function Ii(){const e=Date.now(),t=Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16);return Ei+`${e}/${t}`}const fi="USI_Ponder",yi="USI_MultiPV",bi="Threads",Ti="NumberOfThreads",Ai="MultiPV";function Ni(e){if(e)return void 0!==e.value?e.value:void 0!==e.default?"string"===e.type&&"<empty>"===e.default?"":e.default:void 0}function Pi(e){const t=JSON.parse(JSON.stringify(e));return t.uri=Ii(),t.name+=" のコピー",t}function Ri(e,t){e.uri=t.uri,e.name=t.name,Object.keys(t.options).forEach((i=>{e.options[i]&&(e.options[i].value=t.options[i].value)}))}class ki{constructor(e){if((0,z.Z)(this,"engines",void 0),this.engines={},e){const t=JSON.parse(e);t.engines instanceof Object&&(this.engines=t.engines)}}hasEngine(e){return!!this.engines[e]}addEngine(e){this.engines[e.uri]=e}updateEngine(e){return!!this.engines[e.uri]&&(this.engines[e.uri]=e,!0)}removeEngine(e){return!!this.engines[e]&&(delete this.engines[e],!0)}getEngine(e){return this.engines[e]}get engineList(){return Object.values(this.engines).sort(((e,t)=>e.name!==t.name?e.name>t.name?1:-1:e.defaultName!==t.defaultName?e.defaultName>t.defaultName?1:-1:e.uri>t.uri?1:-1))}get json(){return JSON.stringify(this)}get jsonWithIndent(){return JSON.stringify(this,void 0,2)}}var Oi,Ci,Hi,Mi,Li,Di;function Bi(){return{startCriteria:{enableNumber:!1,number:20},endCriteria:{enableNumber:!1,number:100},perMoveCriteria:{maxSeconds:5},commentBehavior:Oi.INSERT}}function Gi(e){return{thema:Ci.STANDARD,pieceImage:oi.HITOMOJI,boardImage:ai.LIGHT,boardLabelType:si.STANDARD,pieceVolume:30,clockVolume:30,clockPitch:500,clockSoundTarget:Mi.ONLY_USER,boardFlipping:!1,tab:Hi.RECORD_INFO,returnCode:e||"\r\n",coefficientInSigmoid:600,badMoveLevelThreshold1:5,badMoveLevelThreshold2:10,badMoveLevelThreshold3:20,badMoveLevelThreshold4:50,showElapsedTimeInRecordView:!0,showCommentInRecordView:!0,enableAppLog:!1,enableUSILog:!1}}function xi(e){return e.pieceVolume<0||e.pieceVolume>100?new Error("駒音の大きさには0%～100%の値を指定してください。"):e.clockVolume<0||e.clockVolume>100?new Error("時計音の大きさには0%～100%の値を指定してください。"):e.clockPitch<220||e.clockPitch>880?new Error("時計音の高さには220Hz～880Hzの値を指定してください。"):e.coefficientInSigmoid<=0?new Error("勝率換算係数には0より大きい値を指定してください。"):e.badMoveLevelThreshold1<1||e.badMoveLevelThreshold1>100?new Error("緩手には1%～100%の値を指定してください。"):e.badMoveLevelThreshold2<1||e.badMoveLevelThreshold2>100?new Error("疑問手には1%～100%の値を指定してください。"):e.badMoveLevelThreshold3<1||e.badMoveLevelThreshold3>100?new Error("悪手には1%～100%の閾値を指定してください。"):e.badMoveLevelThreshold4<1||e.badMoveLevelThreshold4>100?new Error("大悪手には1%～100%の値を指定してください。"):e.badMoveLevelThreshold1>=e.badMoveLevelThreshold2?new Error("緩手には疑問手より小さい値を指定してください。"):e.badMoveLevelThreshold2>=e.badMoveLevelThreshold3?new Error("疑問手には悪手より小さい値を指定してください。"):e.badMoveLevelThreshold3>=e.badMoveLevelThreshold4?new Error("悪手には大悪手より小さい値を指定してください。"):void 0}function Wi(){return{black:{name:"人",uri:Si},white:{name:"人",uri:Si},timeLimit:{timeSeconds:0,byoyomi:30,increment:0},enableEngineTimeout:!1,humanIsFront:!0}}function Ui(e){return 0===e.timeLimit.timeSeconds&&0===e.timeLimit.byoyomi?new Error("持ち時間と秒読みが両方とも0です。"):0!==e.timeLimit.byoyomi&&0!==e.timeLimit.increment?new Error("秒読みとフィッシャールールは併用できません。"):void 0}function Ki(){return{}}(function(e){e["NONE"]="none",e["INSERT"]="insert",e["APPEND"]="append",e["OVERWRITE"]="overwrite"})(Oi||(Oi={})),function(e){e["STANDARD"]="standard",e["CHERRY_BLOSSOM"]="cherry-blossom",e["DARK"]="dark"}(Ci||(Ci={})),function(e){e["RECORD_INFO"]="recordInfo",e["COMMENT"]="comment",e["SEARCH"]="search",e["PV"]="pv",e["CHART"]="chart",e["PERCENTAGE_CHART"]="percentageChart",e["INVISIBLE"]="invisible"}(Hi||(Hi={})),function(e){e["ALL"]="all",e["ONLY_USER"]="onlyUser"}(Mi||(Mi={})),function(e){e["INFO"]="info",e["WARN"]="warn",e["ERROR"]="error"}(Li||(Li={})),function(e){e["APP_SETTING"]="appSetting",e["RESEARCH_SETTING"]="researchSetting",e["ANALYSIS_SETTING"]="analysisSetting",e["GAME_SETTING"]="gameSetting"}(Di||(Di={}));const Fi={async getRecordPathFromProcArg(){return""},updateMenuState(){},async showOpenRecordDialog(){throw"Web版では利用できない機能です。"},async openRecord(){throw"Web版では利用できない機能です。"},async showSaveRecordDialog(){throw"Web版では利用できない機能です。"},async saveRecord(){throw"Web版では利用できない機能です。"},async showSelectFileDialog(){throw"Web版では利用できない機能です。"},async loadAppSetting(){const e=localStorage.getItem(Di.APP_SETTING);return e?JSON.stringify({...Gi(),...JSON.parse(e)}):JSON.stringify(Gi())},async saveAppSetting(e){localStorage.setItem(Di.APP_SETTING,e)},async loadResearchSetting(){const e=localStorage.getItem(Di.RESEARCH_SETTING);return e?JSON.stringify({...Ki(),...JSON.parse(e)}):JSON.stringify(Ki())},async saveResearchSetting(e){localStorage.setItem(Di.RESEARCH_SETTING,e)},async loadAnalysisSetting(){const e=localStorage.getItem(Di.ANALYSIS_SETTING);return e?JSON.stringify({...Bi(),...JSON.parse(e)}):JSON.stringify(Bi())},async saveAnalysisSetting(e){localStorage.setItem(Di.ANALYSIS_SETTING,e)},async loadGameSetting(){const e=localStorage.getItem(Di.GAME_SETTING);return e?JSON.stringify({...Wi(),...JSON.parse(e)}):JSON.stringify(Wi())},async saveGameSetting(e){localStorage.setItem(Di.GAME_SETTING,e)},async loadUSIEngineSetting(){return(new ki).json},async saveUSIEngineSetting(){},async showSelectUSIEngineDialog(){throw"Web版では利用できない機能です。"},async getUSIEngineInfo(){throw"Web版では利用できない機能です。"},async sendUSISetOption(){},async usiLaunch(){throw"Web版では利用できない機能です。"},async usiGo(){},async usiGoPonder(){},async usiPonderHit(){},async usiGoInfinite(){},async usiStop(){},async usiGameover(){},async usiQuit(){},log(e,t){switch(e){case Li.INFO:console.log(t);break;case Li.WARN:console.warn(t);break;case Li.ERROR:console.error(t);break}},onSendError(){},onMenuEvent(){},onUSIBestMove(){},onUSIInfo(){},onUSIPonderInfo(){}};function qi(){return window}const ji=qi().electronShogiAPI||Fi,Vi={...ji,async loadAppSetting(){return JSON.parse(await ji.loadAppSetting())},saveAppSetting(e){return ji.saveAppSetting(JSON.stringify(e))},async loadResearchSetting(){return JSON.parse(await ji.loadResearchSetting())},saveResearchSetting(e){return ji.saveResearchSetting(JSON.stringify(e))},async loadAnalysisSetting(){return JSON.parse(await ji.loadAnalysisSetting())},saveAnalysisSetting(e){return ji.saveAnalysisSetting(JSON.stringify(e))},async loadGameSetting(){return JSON.parse(await ji.loadGameSetting())},saveGameSetting(e){return ji.saveGameSetting(JSON.stringify(e))},async loadUSIEngineSetting(){return new ki(await ji.loadUSIEngineSetting())},saveUSIEngineSetting(e){return ji.saveUSIEngineSetting(e.json)},async getUSIEngineInfo(e){return JSON.parse(await ji.getUSIEngineInfo(e))},usiLaunch(e){return ji.usiLaunch(JSON.stringify(e))},usiGo(e,t,i,n,o){return ji.usiGo(e,t,JSON.stringify(i),n,o)},usiGoPonder(e,t,i,n,o){return ji.usiGoPonder(e,t,JSON.stringify(i),n,o)}};var zi=Vi;function Zi(){return!!qi().electronShogiAPI}var Yi=i(4914),$i=i.n(Yi);function Ji(e){const t=e?.type||"sine",i=e?.frequency||440,n=e?.volume||2,o=new AudioContext,a=o.createOscillator(),s=o.createGain();return a.connect(s),s.connect(o.destination),a.type=t,a.frequency.value=i,s.gain.value=.005*n,a.onended=()=>{s.disconnect(o.destination),a.disconnect(s)},a.start(o.currentTime),e?.time&&a.stop(o.currentTime+e.time),{stop:()=>{e?.time||a.stop()}}}function Qi(e){Ji({type:"sine",frequency:e.frequency,time:.1,volume:e.volume})}function Xi(e){return Ji({type:"sine",frequency:e.frequency,volume:e.volume})}let en;function tn(e){const t=Date.now();if(en&&t<en+200)return;const i=new Audio("sound/piece.mp3");i.volume=.01*e,i.play(),en=t}var nn;function on(e){switch(e){case nn.BLACK_PLAYER:return"先手";case nn.WHITE_PLAYER:return"後手";case nn.RESEARCHER:return"検討"}}function an(e,t){const i=e.clone();let n,o="";for(const a of t){const e=i.createMoveBySFEN(a);if(!e)break;i.doMove(e,{ignoreValidation:!0}),o+=e.getDisplayText(n),n=e}return o}(function(e){e["BLACK_PLAYER"]="blackPlayer",e["WHITE_PLAYER"]="whitePlayer",e["RESEARCHER"]="researcher"})(nn||(nn={}));class sn{constructor(e,t,i){(0,z.Z)(this,"sessionID",void 0),(0,z.Z)(this,"name",void 0),(0,z.Z)(this,"sfen",void 0),(0,z.Z)(this,"nodes",void 0),(0,z.Z)(this,"nps",void 0),(0,z.Z)(this,"iterates",void 0),(0,z.Z)(this,"hashfull",void 0),(0,z.Z)(this,"currentMove",void 0),(0,z.Z)(this,"currentMoveText",void 0),(0,z.Z)(this,"ponderMove",void 0),this.sessionID=e,this.name=t,this.sfen=i,this.iterates=[]}get latestIteration(){const e=[],t=new Set,i=new Set;for(const n of this.iterates){const o=n.pv?n.pv[0]:void 0;t.has(n.multiPV)||i.has(o)||(e.push(n),t.add(n.multiPV),i.add(o))}return e.sort(((e,t)=>(e.multiPV||1)-(t.multiPV||1)))}update(e,t,i){const n=xe.newBySFEN(e),o={position:e};if(void 0!==t.depth&&(o.depth=t.depth),void 0!==t.seldepth&&(o.selectiveDepth=t.seldepth),void 0!==t.timeMs&&(o.timeMs=t.timeMs),void 0!==t.nodes&&(this.nodes=t.nodes),t.pv&&(o.pv=t.pv,o.text=n?an(n,t.pv):""),void 0!==t.multipv&&(o.multiPV=t.multipv),void 0!==t.scoreCP&&(o.score=t.scoreCP),void 0!==t.scoreMate&&(o.scoreMate=t.scoreMate),void 0!==t.lowerbound&&(o.lowerBound=t.lowerbound),void 0!==t.upperbound&&(o.upperBound=t.upperbound),void 0!==t.currmove){this.currentMove=t.currmove;const e=n&&n.createMoveBySFEN(t.currmove);e&&(this.currentMoveText=e.getDisplayText())}void 0!==t.hashfullPerMill&&(this.hashfull=t.hashfullPerMill/1e3),void 0!==t.nps&&(this.nps=t.nps),t.string&&(o.text=t.string),0!==Object.keys(o).length&&(void 0!==t.nodes&&(o.nodes=t.nodes),this.iterates.unshift(o)),this.ponderMove=i?.getDisplayText()}}class rn{constructor(){(0,z.Z)(this,"_blackPlayer",void 0),(0,z.Z)(this,"_whitePlayer",void 0),(0,z.Z)(this,"_researcher",void 0),(0,z.Z)(this,"updateQueue",void 0),(0,z.Z)(this,"timeoutHandle",void 0),this.updateQueue=[]}get blackPlayer(){return this._blackPlayer}get whitePlayer(){return this._whitePlayer}get researcher(){return this._researcher}update(e,t,i,n,o,a){this.updateQueue.push({sessionID:e,sfen:t.sfen,sender:i,name:n,info:o,ponderMove:a}),this.timeoutHandle||(this.timeoutHandle=window.setTimeout((()=>{this.dequeue()}),100))}dequeue(){for(const e of this.updateQueue)this._update(e);this.updateQueue=[],this.timeoutHandle=void 0}_update(e){switch(e.sender){case nn.BLACK_PLAYER:this._blackPlayer&&this._blackPlayer.sessionID===e.sessionID&&this._blackPlayer.sfen===e.sfen||(this._blackPlayer=new sn(e.sessionID,e.name,e.sfen)),this._blackPlayer.update(e.sfen,e.info,e.ponderMove),this._researcher=void 0;break;case nn.WHITE_PLAYER:this._whitePlayer&&this._whitePlayer.sessionID===e.sessionID&&this._whitePlayer.sfen===e.sfen||(this._whitePlayer=new sn(e.sessionID,e.name,e.sfen)),this._whitePlayer.update(e.sfen,e.info,e.ponderMove),this._researcher=void 0;break;case nn.RESEARCHER:this._researcher&&this._researcher.sessionID===e.sessionID&&this._researcher.sfen===e.sfen||(this._researcher=new sn(e.sessionID,e.name,e.sfen)),this._researcher.update(e.sfen,e.info),this._blackPlayer=void 0,this._whitePlayer=void 0;break}}}const ln=3e4;class cn{constructor(e){if((0,z.Z)(this,"evaluation",void 0),e){const t=JSON.parse(e);this.evaluation=t.evaluation}}updateScore(e,t,i){switch(this.evaluation||(this.evaluation={}),t){case nn.BLACK_PLAYER:this.evaluation[nn.BLACK_PLAYER]=i;break;case nn.WHITE_PLAYER:this.evaluation[nn.WHITE_PLAYER]=-i;break;case nn.RESEARCHER:this.evaluation[nn.RESEARCHER]=e===j.BLACK?i:-i;break}}updateUSIInfo(e,t,i){void 0!==i.multipv&&1!==i.multipv||(i.scoreCP?this.updateScore(e,t,i.scoreCP):i.scoreMate&&this.updateScore(e,t,i.scoreMate>=0?ln:-ln))}stringify(){return JSON.stringify(this)}}function dn(e){return je(e.timeSeconds)+"+"+String(e.byoyomi).padStart(2,"0")}var hn;(function(e){e["WIN"]="win",e["LOSE"]="lose",e["DRAW"]="draw"})(hn||(hn={}));class un{constructor(){(0,z.Z)(this,"searchHandler",void 0)}isEngine(){return!1}async startSearch(e,t,i,n,o){this.searchHandler=o}async startPonder(){}async stop(){}async gameover(){}async close(){this.searchHandler=void 0}doMove(e){const t=this.searchHandler;this.searchHandler=void 0,t&&t.onMove(e)}resign(){const e=this.searchHandler;this.searchHandler=void 0,e&&e.onResign()}}const pn=new un;class gn{constructor(e){(0,z.Z)(this,"setting",void 0),(0,z.Z)(this,"sessionID",void 0),(0,z.Z)(this,"usi",void 0),(0,z.Z)(this,"position",void 0),(0,z.Z)(this,"searchHandler",void 0),(0,z.Z)(this,"ponder",void 0),(0,z.Z)(this,"inPonder",void 0),this.setting=e,this.sessionID=0,this.inPonder=!1}async launch(){this.sessionID=await zi.usiLaunch(this.setting),mn[this.sessionID]=this}isEngine(){return!0}async startSearch(e,t,i,n,o){this.searchHandler=o,this.usi=e.usi,this.position=e.position.clone(),this.inPonder&&this.ponder===this.usi?zi.usiPonderHit(this.sessionID):await zi.usiGo(this.sessionID,this.usi,t,i,n),this.inPonder=!1,this.ponder=void 0}async startPonder(e,t,i,n){if(!this.ponder||!this.ponder.startsWith(e.usi))return;const o=Ni(this.setting.options[fi]);"true"===o&&(this.inPonder=!0,await zi.usiGoPonder(this.sessionID,this.ponder,t,i,n))}async startResearch(e){this.searchHandler=void 0,this.usi=e.usi,await zi.usiGoInfinite(this.sessionID,e.usi)}async stop(){await zi.usiStop(this.sessionID)}async gameover(e){await zi.usiGameover(this.sessionID,e)}async close(){this.searchHandler=void 0,await zi.usiQuit(this.sessionID),delete mn[this.sessionID]}onBestMove(e,t,i){const n=this.searchHandler;if(this.searchHandler=void 0,!n||!this.position)return;if(e!==this.usi)return;if("resign"===t)return void n.onResign();if("win"===t)return void n.onWin();const o=this.position.createMoveBySFEN(t);if(!o)return n.onError("エンジンから不明な指し手を受信しました:"+t),void n.onResign();this.ponder=i&&`${e} ${t} ${i}`,n.onMove(o)}}const mn={};function _n(e,t,i,n){const o=mn[e];o&&o.onBestMove(t,i,n)}const vn={async build(e){if(e.uri===Si)return pn;if(wi(e.uri)&&e.usi){const t=new gn(e.usi);return await t.launch(),t}throw new Error("予期せぬプレイヤーURIです: "+e.uri)}};var Sn,En;(function(e){e["IDLE"]="idle",e["ACTIVE"]="active",e["PENDING"]="pending",e["BUSSY"]="bussy"})(Sn||(Sn={}));class wn{constructor(e,t){(0,z.Z)(this,"state",void 0),(0,z.Z)(this,"handlers",void 0),(0,z.Z)(this,"playerBuilder",void 0),(0,z.Z)(this,"blackState",void 0),(0,z.Z)(this,"whiteState",void 0),(0,z.Z)(this,"timerHandle",void 0),(0,z.Z)(this,"timerStart",void 0),(0,z.Z)(this,"lastTimeMs",void 0),(0,z.Z)(this,"_elapsedMs",void 0),(0,z.Z)(this,"_setting",void 0),(0,z.Z)(this,"blackPlayer",void 0),(0,z.Z)(this,"whitePlayer",void 0),(0,z.Z)(this,"lastEventID",void 0),(0,z.Z)(this,"record",void 0),this.state=Sn.IDLE,this.handlers=t,this.playerBuilder=e,this.blackState={timeMs:0,byoyomi:0},this.whiteState={timeMs:0,byoyomi:0},this.timerHandle=0,this.timerStart=new Date,this.lastTimeMs=0,this._elapsedMs=0,this._setting=Wi(),this.lastEventID=0,this.record=new Xe}get blackTimeMs(){return this.blackState.timeMs}get blackByoyomi(){return this.blackState.byoyomi}get whiteTimeMs(){return this.whiteState.timeMs}get whiteByoyomi(){return this.whiteState.byoyomi}get elapsedMs(){return this._elapsedMs}get setting(){return this._setting}async startGame(e,t){if(this.state!==Sn.IDLE)throw Error("前回の対局が正常に終了できていません。アプリを再起動してください。");this.blackState.timeMs=1e3*e.timeLimit.timeSeconds,this.blackState.byoyomi=e.timeLimit.byoyomi,this.whiteState.timeMs=1e3*e.timeLimit.timeSeconds,this.whiteState.byoyomi=e.timeLimit.byoyomi,this._setting=e,this.record=t;try{this.blackPlayer=await this.playerBuilder.build(e.black),this.whitePlayer=await this.playerBuilder.build(e.white)}catch(i){try{await this.closePlayers()}catch(n){this.handlers.onError(n)}throw i}this.state=Sn.ACTIVE,setTimeout((()=>this.next()))}next(){if(this.state!==Sn.ACTIVE)return void this.handlers.onError("予期せぬステータスです: GameManager.next(): "+this.state);const e=this.record.position.color;this.startTimer(e);const t=this.getPlayer(e),i=this.getPlayer(Z(e));if(!t||!i)return void this.handlers.onError("致命的なエラーが発生しました: GameManager.next(): player is undefined");const n=this.issueEventID();t.startSearch(this.record,this.setting,this.blackTimeMs,this.whiteTimeMs,{onMove:e=>this.onMove(n,e),onResign:()=>this.onResign(n),onWin:()=>this.onWin(n),onError:e=>this.handlers.onError(e)}).catch((e=>{this.handlers.onError(new Error("プレイヤーにコマンドを送信できませんでした: "+e))})),i.startPonder(this.record,this.setting,this.blackTimeMs,this.whiteTimeMs).catch((e=>{this.handlers.onError(new Error("プレイヤーにPonderコマンドを送信できませんでした: "+e))}))}onMove(e,t){if(e!==this.lastEventID)return void zi.log(Li.WARN,"指し手を受信しましたが既にイベントは無効です。");if(this.state!==Sn.ACTIVE)return void zi.log(Li.WARN,"指し手を受信しましたが既に対局中ではありません。");if(!this.record.position.isValidMove(t))return this.handlers.onError("反則手: "+t.getDisplayText()),void this.endGame(ze.FOUL_LOSE);this.incrementTime(this.record.position.color),this.record=this.handlers.onMove(t);const i=this.record.perpetualCheck;if(i)return i===this.record.position.color?void this.endGame(ze.FOUL_LOSE):void this.endGame(ze.FOUL_WIN);this.record.repetition?this.endGame(ze.REPETITION_DRAW):this.next()}onResign(e){e===this.lastEventID?this.state===Sn.ACTIVE?this.endGame(ze.RESIGN):zi.log(Li.WARN,"投了を受信しましたが既に対局中ではありません。"):zi.log(Li.WARN,"投了を受信しましたが既にイベントは無効です。")}onWin(e){e===this.lastEventID?this.state===Sn.ACTIVE?this.endGame(ze.ENTERING_OF_KING):zi.log(Li.WARN,"勝ち宣言を受信しましたが既に対局中ではありません。"):zi.log(Li.WARN,"勝ち宣言を受信しましたが既にイベントは無効です。")}onTimeout(){this.state===Sn.ACTIVE?this.endGame(ze.TIMEOUT):this.handlers.onError("予期せぬステータスです: GameManager.onTimeout(): "+this.state)}startTimer(e){this.stopTimer();const t=this.getPlayerState(e);this.timerStart=new Date,this.lastTimeMs=t.timeMs,t.byoyomi=this.setting.timeLimit.byoyomi,this._elapsedMs=0,this.timerHandle=window.setInterval((()=>{const i=t.timeMs,n=t.byoyomi,o=new Date;this._elapsedMs=o.getTime()-this.timerStart.getTime();const a=this.lastTimeMs-this._elapsedMs;if(a>=0?t.timeMs=a:(t.timeMs=0,t.byoyomi=Math.max(Math.ceil(this.setting.timeLimit.byoyomi+a/1e3),0)),0===t.timeMs&&0===t.byoyomi)return void this.timeout(e);const s=Math.ceil(i/1e3),r=Math.ceil(t.timeMs/1e3),l=t.byoyomi;0===r&&(i>0||l!==n)?l<=5?this.handlers.onBeepUnlimited():(l<=10||l%10===0)&&this.handlers.onBeepShort():this.setting.timeLimit.byoyomi||r===s||(r<=5?this.handlers.onBeepUnlimited():(r<=10||20===r||30===r||60===r)&&this.handlers.onBeepShort())}),100)}timeout(e){this.stopTimer();const t=this.getPlayer(e);t&&t.isEngine()&&!this.setting.enableEngineTimeout?t.stop().catch((e=>{this.handlers.onError(new Error("プレイヤーにコマンドを送信できませんでした: "+e))})):this.onTimeout()}endGame(e){this.state!==Sn.ACTIVE&&this.state!==Sn.PENDING||(this.state=Sn.BUSSY,this.stopTimer(),this.endGameAsync(e).then((()=>{this.state=Sn.IDLE})).catch((e=>{this.handlers.onError(e),this.state=Sn.PENDING})))}async endGameAsync(e){if(e){const t=this.record.position.color;await this.sendGameResults(t,e)}await this.closePlayers(),this.handlers.onEndGame(e)}async sendGameResults(e,t){if(this.blackPlayer){const i=this.getGameResult(e,j.BLACK,t);i&&await this.blackPlayer.gameover(i)}if(this.whitePlayer){const i=this.getGameResult(e,j.WHITE,t);i&&await this.whitePlayer.gameover(i)}}getGameResult(e,t,i){switch(i){case ze.FOUL_WIN:case ze.ENTERING_OF_KING:return e==t?hn.WIN:hn.LOSE;case ze.RESIGN:case ze.MATE:case ze.TIMEOUT:case ze.FOUL_LOSE:return e==t?hn.LOSE:hn.WIN;case ze.DRAW:case ze.REPETITION_DRAW:return hn.DRAW}return null}stopTimer(){this.handlers.onStopBeep(),this.timerHandle&&(window.clearInterval(this.timerHandle),this.timerHandle=0)}incrementTime(e){this.getPlayerState(e).timeMs+=1e3*this.setting.timeLimit.increment}async closePlayers(){this.blackPlayer&&(await this.blackPlayer.close(),this.blackPlayer=void 0),this.whitePlayer&&(await this.whitePlayer.close(),this.whitePlayer=void 0)}getPlayer(e){switch(e){case j.BLACK:return this.blackPlayer;case j.WHITE:return this.whitePlayer}}getPlayerState(e){switch(e){case j.BLACK:return this.blackState;case j.WHITE:return this.whiteState}}issueEventID(){return this.lastEventID+=1,this.lastEventID}}function In(e){let t=fn(e);const i=e.getStandardMetadata(Ve.TITLE)||e.getStandardMetadata(Ve.TOURNAMENT)||e.getStandardMetadata(Ve.OPUS_NAME)||e.getStandardMetadata(Ve.OPUS_NO)||e.getStandardMetadata(Ve.PLACE)||e.getStandardMetadata(Ve.POSTED_ON)||e.getStandardMetadata(Ve.AUTHOR);i&&(t+="_"+i);const n=e.getStandardMetadata(Ve.BLACK_NAME)||e.getStandardMetadata(Ve.BLACK_SHORT_NAME);n&&(t+="_"+n);const o=e.getStandardMetadata(Ve.WHITE_NAME)||e.getStandardMetadata(Ve.WHITE_SHORT_NAME);return o&&(t+="_"+o),t+".kif"}function fn(e){const t=e.getStandardMetadata(Ve.DATE);return t?t.trim().replaceAll(" ","_").replaceAll("/","").replaceAll(":",""):(new Date).toLocaleDateString(void 0,{year:"numeric",month:"2-digit",day:"2-digit"}).replaceAll("/","")}class yn{constructor(){(0,z.Z)(this,"count",void 0),this.count=0}get isBussy(){return 0!==this.count}retain(){this.count+=1}release(){this.count-=1}}(function(e){e["NORMAL"]="normal",e["PASTE_DIALOG"]="pasteDialog",e["POSITION_EDITING"]="positionEditing",e["GAME"]="game",e["GAME_DIALOG"]="gameDialog",e["RESEARCH"]="research",e["RESEARCH_DIALOG"]="researchDialog",e["ANALYSIS"]="analysis",e["ANALYSIS_DIALOG"]="analysisDialog",e["USI_ENGINE_SETTING_DIALOG"]="usiEngineSettingDialog",e["TEMPORARY"]="temporary"})(En||(En={}));class bn{constructor(){(0,z.Z)(this,"_queue",void 0),this._queue=[]}get message(){return this._queue[0]}get hasMessage(){return 0!==this._queue.length}enqueue(e){this._queue.push(e)}dequeue(){this._queue.shift()}}class Tn{constructor(){(0,z.Z)(this,"_queue",void 0),this._queue=[]}get errors(){return this._queue}get hasError(){return 0!==this._queue.length}push(e){e instanceof Error?this._queue.push(e):this._queue.push(new Error(""+e))}clear(){this._queue=[]}}function An(e){return(e||new Date).toLocaleDateString(void 0,{year:"numeric",month:"2-digit",day:"2-digit"})}function Nn(e){return(e||new Date).toLocaleTimeString(void 0,{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1})}function Pn(e){return e>=1500?"先手勝勢":e>=600?"先手優勢":e>=400?"先手有利":e>=200?"先手有望":e>=-200?"互角":e>=-400?"後手有望":e>=-600?"後手有利":e>=-1500?"後手優勢":"後手勝勢"}function Rn(e,t){return 100/(1+Math.exp(-e/t.coefficientInSigmoid))}function kn(e,t,i){const n=Rn(e,i)-Rn(t,i);return n>=i.badMoveLevelThreshold4?"大悪手":n>=i.badMoveLevelThreshold3?"悪手":n>=i.badMoveLevelThreshold2?"疑問手":n>=i.badMoveLevelThreshold1?"緩手":null}class On{constructor(e,t){if((0,z.Z)(this,"handler",void 0),(0,z.Z)(this,"researcher",void 0),(0,z.Z)(this,"_setting",void 0),(0,z.Z)(this,"number",void 0),(0,z.Z)(this,"actualMove",void 0),(0,z.Z)(this,"color",void 0),(0,z.Z)(this,"lastScore",void 0),(0,z.Z)(this,"score",void 0),(0,z.Z)(this,"mate",void 0),(0,z.Z)(this,"lastPV",void 0),(0,z.Z)(this,"pv",void 0),(0,z.Z)(this,"timerHandle",void 0),!e.usi)throw new Error("エンジンが設定されていません。");this._setting=e,this.handler=t,this.color=j.BLACK}get setting(){return this._setting}async start(){await this.setupEngine(this.setting.usi),setTimeout((()=>this.next()))}async setupEngine(e){await this.closeEngine();const t=new gn(e);await t.launch(),this.researcher=t}finish(){this.handler.onFinish(),this.close()}close(){this.clearTimer(),this.closeEngine().catch((e=>{this.handler.onError(e)}))}next(){if(this.clearTimer(),this.onResult(),this.actualMove=void 0,this.lastScore=this.score,this.score=void 0,this.mate=void 0,this.lastPV=this.pv,this.pv=void 0,this.number=void 0!==this.number?this.number+1:this.setting.startCriteria.enableNumber?this.setting.startCriteria.number-1:0,this.setting.endCriteria.enableNumber&&this.number>=this.setting.endCriteria.number)return void this.finish();const e=this.handler.onNext(this.number);e&&(e.current.next||e.current.move instanceof Pe)?(this.actualMove=e.current.move instanceof Pe?e.current.move:void 0,this.color=Z(e.position.color),this.timerHandle=window.setTimeout((()=>this.next()),1e3*this.setting.perMoveCriteria.maxSeconds),this.goAsync(e).catch((e=>{this.handler.onError(e)}))):this.finish()}clearTimer(){this.timerHandle&&(clearTimeout(this.timerHandle),this.timerHandle=void 0)}onResult(){void 0!==this.number&&this.handler.onResult({number:this.number,score:this.score,negaScore:this.score?this.color===j.BLACK?this.score:-this.score:void 0,scoreDelta:void 0!==this.score&&void 0!==this.lastScore?this.color===j.BLACK?this.score-this.lastScore:-(this.score-this.lastScore):void 0,mate:this.mate,pv:this.pv,isBestMove:this.actualMove&&this.lastPV?this.actualMove.equals(this.lastPV[0]):void 0})}async goAsync(e){this.researcher&&await this.researcher.startResearch(e)}async closeEngine(){this.researcher&&(this.researcher.close(),this.researcher=void 0)}updateUSIInfo(e,t){if(void 0===t.multipv||1===t.multipv)if(void 0!==t.scoreCP&&(this.score=e.color===j.BLACK?t.scoreCP:-t.scoreCP),t.scoreMate&&(this.mate=Math.abs(t.scoreMate)),t.pv&&0!==t.pv.length){this.pv=[];const i=e.clone();for(const e of t.pv){const t=i.createMoveBySFEN(e);if(!t||!i.doMove(t))break;this.pv.push(t)}}else if(t.currmove){const i=e.createMoveBySFEN(t.currmove);i&&(this.pv=[i])}}}function Cn(e,t){let i="";if(e.mate&&(i+=`${e.mate}手詰\n`),void 0!==e.scoreDelta&&void 0!==e.negaScore&&!e.isBestMove){const n=kn(e.negaScore-e.scoreDelta,e.negaScore,t);n&&(i+=`【${n}】\n`)}if(void 0!==e.score&&(i+=`#評価値=${e.score}\n`,i+=Pn(e.score)+"\n"),e.pv&&0!==e.pv.length){for(const t of e.pv)i+=`${t.getDisplayText()}`;i+="\n"}return i}function Hn(e){const t=e.split("\n");for(const i of t){const e=/^#評価値=([+-.0-9]+)/.exec(i);if(e)return Number(e[1])}}function Mn(e,t,i){const n=e?"\n":"";switch(i){case Oi.NONE:return e;case Oi.INSERT:return t+n+e;case Oi.APPEND:return e+n+t;case Oi.OVERWRITE:return t}}class Ln{constructor(){(0,z.Z)(this,"_bussy",void 0),(0,z.Z)(this,"_message",void 0),(0,z.Z)(this,"_error",void 0),(0,z.Z)(this,"_appSetting",void 0),(0,z.Z)(this,"_appState",void 0),(0,z.Z)(this,"lastAppState",void 0),(0,z.Z)(this,"_isAppSettingDialogVisible",void 0),(0,z.Z)(this,"_confirmation",void 0),(0,z.Z)(this,"_usi",void 0),(0,z.Z)(this,"game",void 0),(0,z.Z)(this,"researcher",void 0),(0,z.Z)(this,"analysis",void 0),(0,z.Z)(this,"unlimitedBeepHandler",void 0),(0,z.Z)(this,"_recordFilePath",void 0),(0,z.Z)(this,"_record",void 0),this._bussy=new yn,this._message=new bn,this._error=new Tn,this._appSetting=Gi(),this._appState=En.NORMAL,this._isAppSettingDialogVisible=!1,this._usi=new rn,this.game=new wn(vn,this),this._record=new Xe}get isBussy(){return this._bussy.isBussy}retainBussyState(){return this._bussy.retain()}releaseBussyState(){return this._bussy.release()}get message(){return this._message.message}get hasMessage(){return this._message.hasMessage}enqueueMessage(e){this._message.enqueue(e)}dequeueMessage(){this._message.dequeue()}get errors(){return this._error.errors}get hasError(){return this._error.hasError}pushError(e){zi.log(Li.ERROR,tt(e)),this._error.push(e)}clearErrors(){this._error.clear()}get appSetting(){return this._appSetting}async updateAppSetting(e){const t={...this.appSetting,...e},i=xi(t);if(i)throw i;await zi.saveAppSetting(t),this._appSetting=t}flipBoard(){this._appSetting.boardFlipping=!this.appSetting.boardFlipping,zi.saveAppSetting(this.appSetting)}get appState(){return this._appState}get confirmation(){return this._confirmation?.message}showConfirmation(e){this.appState!=En.TEMPORARY?(this._confirmation=e,this.lastAppState=this.appState,this._appState=En.TEMPORARY):zi.log(Li.ERROR,`確認ダイアログを多重に表示しようとしました。 lastAppState=${this.lastAppState}`+(this._confirmation?` currentMessage=${this._confirmation.message}`:"")+` newMessage=${e.message}`)}confirmationOk(){const e=this._confirmation?.onOk;this._confirmation=void 0,this.lastAppState&&(this._appState=this.lastAppState,this.lastAppState=void 0),e&&e()}confirmationCancel(){const e=this._confirmation?.onCancel;this._confirmation=void 0,this.lastAppState&&(this._appState=this.lastAppState,this.lastAppState=void 0),e&&e()}showPasteDialog(){this.appState===En.NORMAL&&(this._appState=En.PASTE_DIALOG)}showGameDialog(){this.appState===En.NORMAL&&(this._appState=En.GAME_DIALOG)}showResearchDialog(){this.appState===En.NORMAL&&(this._appState=En.RESEARCH_DIALOG)}showAnalysisDialog(){this.appState===En.NORMAL&&(this._appState=En.ANALYSIS_DIALOG)}showUsiEngineManagementDialog(){this.appState===En.NORMAL&&(this._appState=En.USI_ENGINE_SETTING_DIALOG)}closeModalDialog(){this.appState!==En.PASTE_DIALOG&&this.appState!==En.GAME_DIALOG&&this.appState!==En.RESEARCH_DIALOG&&this.appState!==En.ANALYSIS_DIALOG&&this.appState!==En.USI_ENGINE_SETTING_DIALOG||(this._appState=En.NORMAL)}get isAppSettingDialogVisible(){return this._isAppSettingDialogVisible}showAppSettingDialog(){this._isAppSettingDialogVisible=!0}closeAppSettingDialog(){this._isAppSettingDialogVisible=!1}get usiBlackPlayerMonitor(){return this._usi.blackPlayer}get usiWhitePlayerMonitor(){return this._usi.whitePlayer}get usiResearcherMonitor(){return this._usi.researcher}updateUSIInfo(e,t,i,n,o){if(this.record.usi!==t)return;this._usi.update(e,this.record.position,i,n,o);const a=new cn(this.record.current.customData);a.updateUSIInfo(this.record.position.color,i,o),this.record.current.customData=a.stringify(),this.analysis&&this.analysis.updateUSIInfo(this.record.position,o)}updateUSIPonderInfo(e,t,i,n,o){const a=Xe.newByUSI(t);if(a instanceof Error)return void zi.log(Li.ERROR,`invalid USI: ${t} (updateUSIPonderInfo)`);const s=a.current.move;s instanceof Pe&&this._usi.update(e,a.position,i,n,o,s)}get gameSetting(){return this.game.setting}get blackTimeMs(){return this.game.blackTimeMs}get blackByoyomi(){return this.game.blackByoyomi}get whiteTimeMs(){return this.game.whiteTimeMs}get whiteByoyomi(){return this.game.whiteByoyomi}get elapsedMs(){return this.game.elapsedMs}startGame(e){this.startGameAsync(e).catch((e=>{this.pushError("対局の初期化中にエラーが出ました: "+e)}))}async startGameAsync(e){if(this.appState===En.GAME_DIALOG){this.retainBussyState();try{await zi.saveGameSetting(e),this.initializeRecordForGame(e),this.initializeDisplaySettingForGame(e),await this.game.startGame(e,this.record),this._appState=En.GAME}finally{this.releaseBussyState()}}}initializeRecordForGame(e){if(e.startPosition){const t=new xe;t.reset(e.startPosition),this._record.clear(t),this.onUpdatePosition(),this.clearRecordFilePath()}this._record.metadata.setStandardMetadata(Ve.BLACK_NAME,e.black.name),this._record.metadata.setStandardMetadata(Ve.WHITE_NAME,e.white.name),this._record.metadata.setStandardMetadata(Ve.DATE,An()),this._record.metadata.setStandardMetadata(Ve.START_DATETIME,Nn()),this._record.metadata.setStandardMetadata(Ve.TIME_LIMIT,dn(e.timeLimit))}initializeDisplaySettingForGame(e){if(e.humanIsFront){let t=this.appSetting.boardFlipping;e.black.uri===Si&&e.white.uri!==Si?t=!1:e.black.uri!==Si&&e.white.uri===Si&&(t=!0),t!==this.appSetting.boardFlipping&&this.flipBoard()}}stopGame(){this.appState===En.GAME&&this.game.endGame(ze.INTERRUPT)}onMove(e){return this.appState===En.GAME&&(this._record.append(e,{ignoreValidation:!0}),this.onUpdatePosition(),this.record.current.setElapsedMs(this.elapsedMs),tn(this.appSetting.pieceVolume)),this.record}onEndGame(e){this.appState===En.GAME&&(e&&this.enqueueMessage(`対局終了（${Je(e)})`),this._record.append(e||ze.INTERRUPT),this.onUpdatePosition(),this._record.current.setElapsedMs(this.elapsedMs),this._record.metadata.setStandardMetadata(Ve.END_DATETIME,Nn()),this._appState=En.NORMAL)}onBeepShort(){(this.appSetting.clockSoundTarget!==Mi.ONLY_USER||this.isMovableByUser)&&(this.unlimitedBeepHandler||Qi({frequency:this.appSetting.clockPitch,volume:this.appSetting.clockVolume}))}onBeepUnlimited(){(this.appSetting.clockSoundTarget!==Mi.ONLY_USER||this.isMovableByUser)&&(this.unlimitedBeepHandler||(this.unlimitedBeepHandler=Xi({frequency:this.appSetting.clockPitch,volume:this.appSetting.clockVolume})))}onStopBeep(){this.unlimitedBeepHandler&&(this.unlimitedBeepHandler.stop(),this.unlimitedBeepHandler=void 0)}doMove(e){this.appState!==En.NORMAL&&this.appState!==En.RESEARCH||(this._record.append(e),this.onUpdatePosition(),tn(this.appSetting.pieceVolume))}onNext(e){return this.appState===En.ANALYSIS?(this._record.goto(e),this.record.current.number===e?this.record:null):null}onResult(e){if(this.appState===En.ANALYSIS&&this.analysis){const t=Cn(e,this.appSetting);t&&(this._record.current.comment=Mn(this._record.current.comment,t,this.analysis.setting.commentBehavior))}}onFinish(){this.appState===En.ANALYSIS&&(this._message.enqueue("棋譜解析が終了しました。"),this._appState=En.NORMAL)}onError(e){this.pushError(e)}startResearch(e){this.startResearchAsync(e).then((()=>{this.onUpdatePosition()})).catch((e=>{this.pushError("検討の初期化中にエラーが出ました: "+e)}))}async startResearchAsync(e){if(this.appState===En.RESEARCH_DIALOG){this.retainBussyState();try{if(await zi.saveResearchSetting(e),!e.usi)throw new Error("エンジンが設定されていません。");const t=new gn(e.usi);await t.launch(),this.researcher=t,this._appState=En.RESEARCH}finally{this.releaseBussyState()}}}stopResearch(){this.appState===En.RESEARCH&&(this.researcher&&(this.researcher.close(),this.researcher=void 0),this._appState=En.NORMAL)}startAnalysis(e){this.startAnalysisAsync(e).catch((e=>{this.pushError("検討の初期化中にエラーが出ました: "+e)}))}async startAnalysisAsync(e){if(this.appState===En.ANALYSIS_DIALOG){this.retainBussyState();try{await zi.saveAnalysisSetting(e);const t=new On(e,this);await t.start(),this.analysis=t,this._appState=En.ANALYSIS}finally{this.releaseBussyState()}}}stopAnalysis(){this.appState===En.ANALYSIS&&(this.analysis&&(this.analysis.close(),this.analysis=void 0),this._appState=En.NORMAL)}onUpdatePosition(){this.researcher&&this.researcher.startResearch(this.record)}get recordFilePath(){return this._recordFilePath}updateRecordFilePath(e){this._recordFilePath=e}clearRecordFilePath(){this._recordFilePath=void 0}get record(){return this._record}newRecord(){this.appState==En.NORMAL&&this.showConfirmation({message:"現在の棋譜は削除されます。よろしいですか？",onOk:()=>{this._record.clear(),this.onUpdatePosition(),this.clearRecordFilePath()}})}updateRecordComment(e){this.record.current.comment=e}updateStandardRecordMetadata(e){this._record.metadata.setStandardMetadata(e.key,e.value)}insertSpecialMove(e){this.appState!==En.NORMAL&&this.appState!==En.RESEARCH||(this._record.append(e),this.onUpdatePosition())}startPositionEditing(){this.appState===En.NORMAL&&this.showConfirmation({message:"現在の棋譜は削除されます。よろしいですか？",onOk:()=>{this._appState=En.POSITION_EDITING,this._record.clear(this.record.position),this.onUpdatePosition(),this.clearRecordFilePath()}})}endPositionEditing(){this.appState===En.POSITION_EDITING&&(this._appState=En.NORMAL)}initializePosition(e){this.appState==En.POSITION_EDITING&&this.showConfirmation({message:"現在の局面は破棄されます。よろしいですか？",onOk:()=>{const t=new xe;t.reset(e),this._record.clear(t),this.onUpdatePosition(),this.clearRecordFilePath()}})}changeTurn(){if(this.appState!=En.POSITION_EDITING)return;const e=this.record.position.clone();e.setColor(Z(e.color)),this._record.clear(e),this.onUpdatePosition(),this.clearRecordFilePath()}editPosition(e){if(this.appState===En.POSITION_EDITING){const t=this.record.position.clone();t.edit(e),this._record.clear(t),this.onUpdatePosition(),this.clearRecordFilePath()}}changeMoveNumber(e){this.appState!==En.NORMAL&&this.appState!==En.RESEARCH||(this._record.goto(e),this.onUpdatePosition())}changeBranch(e){this.appState!==En.NORMAL&&this.appState!==En.RESEARCH||this.record.current.branchIndex!==e&&(this._record.switchBranchByIndex(e),this.onUpdatePosition())}removeRecordAfter(){if(this.appState===En.NORMAL||this.appState===En.RESEARCH)return this.record.current.isLastMove?(this._record.removeAfter(),void this.onUpdatePosition()):void this.showConfirmation({message:`${this.record.current.number}手目以降を削除します。よろしいですか？`,onOk:()=>{this._record.removeAfter(),this.onUpdatePosition()}})}copyRecordKIF(){const e=Ct(this._record,{returnCode:this.appSetting.returnCode});navigator.clipboard.writeText(e)}copyRecordCSA(){const e=Qt(this._record,{returnCode:this.appSetting.returnCode});navigator.clipboard.writeText(e)}copyRecordUSIBefore(){const e=this._record.usi;navigator.clipboard.writeText(e)}copyRecordUSIAll(){const e=this._record.usiAll;navigator.clipboard.writeText(e)}copyBoardSFEN(){const e=this._record.sfen;navigator.clipboard.writeText(e)}pasteRecord(e){if(this.appState!==En.NORMAL)return;let t;switch(ei(e)){case Xt.SFEN:{const i=xe.newBySFEN(e);t=i?new Xe(i):new Error("局面を読み込めませんでした。");break}case Xt.USI:t=Xe.newByUSI(e)||new Error("棋譜を読み込めませんでした。");break;case Xt.KIF:t=It(e);break;case Xt.CSA:t=qt(e);break;default:t=new Error("棋譜フォーマットの検出ができませんでした。");break}t instanceof Error?this.pushError(t):(this.clearRecordFilePath(),this._record=t,this.restoreCustomData(),this.onUpdatePosition())}openRecord(e){this.openRecordAsync(e).catch((e=>{this.pushError("棋譜の読み込み中にエラーが出ました: "+e)}))}async openRecordAsync(e){if(this.appState===En.NORMAL){this.retainBussyState();try{if(!e&&(e=await zi.showOpenRecordDialog(),!e))return;const t=await zi.openRecord(e);let i;if(e.match(/\.kif$/)||e.match(/\.kifu$/)){const n=e.match(/\.kif$/)?$i().decode(t,"Shift_JIS"):(new TextDecoder).decode(t);i=It(n)}else i=e.match(/\.csa$/)?qt((new TextDecoder).decode(t)):new Error("不明なファイル形式: "+e);if(i instanceof Error)throw i;this.updateRecordFilePath(e),this._record=i,this.restoreCustomData(),this.onUpdatePosition()}finally{this.releaseBussyState()}}}restoreCustomData(){this._record.forEach((e=>{const t=Hn(e.comment);if(void 0!==t){const i=new cn(e.customData);i.updateScore(j.BLACK,nn.RESEARCHER,t),e.customData=i.stringify()}}))}saveRecord(e){this.saveRecordAsync(e).catch((e=>{this.pushError("棋譜の保存中にエラーが出ました: "+e)}))}async saveRecordAsync(e){if(this.appState===En.NORMAL){this.retainBussyState();try{let t,i=this.recordFilePath;if(!e?.overwrite||!i){const e=In(this._record.metadata);if(i=await zi.showSaveRecordDialog(e),!i)return}if(i.match(/\.kif$/)||i.match(/\.kifu$/)){const e=Ct(this.record,{returnCode:this.appSetting.returnCode});t=i.match(/\.kif$/)?$i().encode(e,"Shift_JIS"):(new TextEncoder).encode(e)}else{if(!i.match(/\.csa$/))throw new Error("不明なファイル形式: "+i);t=(new TextEncoder).encode(Qt(this.record,{returnCode:this.appSetting.returnCode}))}await zi.saveRecord(i,t),this.updateRecordFilePath(i)}finally{this.releaseBussyState()}}}get isMovableByUser(){switch(this.appState){case En.NORMAL:case En.RESEARCH:return!0;case En.GAME:return(this.record.position.color===j.BLACK?this.gameSetting.black.uri:this.gameSetting.white.uri)===Si}return!1}}const Dn=(0,d.qj)(new Ln);function Bn(){return Dn}const Gn=["src"];function xn(e,t,i,n,a,s){return(0,o.wg)(),(0,o.iD)("img",{class:"icon",src:e.source,draggable:"false"},null,8,Gn)}var Wn;(function(e){e["BUSSY"]="bussy",e["ERROR"]="error",e["INFO"]="info",e["GAME"]="game",e["STOP"]="stop",e["RESIGN"]="resign",e["RESEARCH"]="research",e["END"]="end",e["QUIZ"]="quiz",e["EDIT"]="edit",e["CHECK"]="check",e["SWAP"]="swap",e["SWAP_H"]="swap_h",e["SETTINGS"]="settings",e["ENGINE_SETTINGS"]="engineSettings",e["FLIP"]="flip",e["FILE"]="file",e["OPEN"]="open",e["SAVE"]="save",e["SAVE_AS"]="saveAs",e["PASTE"]="paste",e["COPY"]="copy",e["DELETE"]="delete",e["COMMENT"]="comment",e["BRAIN"]="brain",e["PV"]="pv",e["CHART"]="chart",e["PERCENT"]="percent",e["ARROW_DROP"]="arrowDrop",e["FIRST"]="first",e["BACK"]="back",e["NEXT"]="next",e["LAST"]="last",e["QUESTION"]="question",e["ANALYSIS"]="analysis",e["DESCRIPTION"]="description",e["PLAY"]="play",e["CLOSE"]="close"})(Wn||(Wn={}));const Un={[Wn.BUSSY]:"icon/hourglass_empty_white_24dp.svg",[Wn.ERROR]:"icon/error_outline_white_24dp.svg",[Wn.INFO]:"icon/info_white_24dp.svg",[Wn.GAME]:"icon/sports_esports_white_24dp.svg",[Wn.STOP]:"icon/block_white_24dp.svg",[Wn.RESIGN]:"icon/flag_white_24dp.svg",[Wn.RESEARCH]:"icon/science_white_24dp.svg",[Wn.END]:"icon/do_disturb_on_white_24dp.svg",[Wn.QUIZ]:"icon/quiz_FILL0_wght400_GRAD0_opsz48.svg",[Wn.EDIT]:"icon/app_registration_white_24dp.svg",[Wn.CHECK]:"icon/check_circle_white_24dp.svg",[Wn.SWAP]:"icon/swap_vert_white_24dp.svg",[Wn.SWAP_H]:"icon/swap_horiz_white_24dp.svg",[Wn.SETTINGS]:"icon/settings_white_24dp.svg",[Wn.ENGINE_SETTINGS]:"icon/settings_input_component_white_24dp.svg",[Wn.FLIP]:"icon/flip_camera_android_white_24dp.svg",[Wn.FILE]:"icon/draft_FILL0_wght400_GRAD0_opsz48.svg",[Wn.OPEN]:"icon/file_open_FILL0_wght400_GRAD0_opsz48.svg",[Wn.SAVE]:"icon/save_FILL0_wght400_GRAD0_opsz48.svg",[Wn.SAVE_AS]:"icon/save_as_FILL0_wght400_GRAD0_opsz48.svg",[Wn.PASTE]:"icon/content_paste_white_24dp.svg",[Wn.COPY]:"icon/content_copy_white_24dp.svg",[Wn.DELETE]:"icon/backspace_white_24dp.svg",[Wn.COMMENT]:"icon/edit_note_white_24dp.svg",[Wn.BRAIN]:"icon/psychology_white_24dp.svg",[Wn.PV]:"icon/manage_search_FILL0_wght400_GRAD0_opsz48.svg",[Wn.CHART]:"icon/show_chart_white_24dp.svg",[Wn.PERCENT]:"icon/percent_white_24dp.svg",[Wn.ARROW_DROP]:"icon/arrow_drop_down_white_24dp.svg",[Wn.FIRST]:"icon/first_page_white_24dp.svg",[Wn.BACK]:"icon/chevron_left_white_24dp.svg",[Wn.NEXT]:"icon/chevron_right_white_24dp.svg",[Wn.LAST]:"icon/last_page_white_24dp.svg",[Wn.QUESTION]:"icon/help_white_24dp.svg",[Wn.ANALYSIS]:"icon/query_stats_white_24dp.svg",[Wn.DESCRIPTION]:"icon/description_white_24dp.svg",[Wn.PLAY]:"icon/play_arrow_FILL1_wght400_GRAD0_opsz48.svg",[Wn.CLOSE]:"icon/close_FILL0_wght400_GRAD0_opsz48.svg"};Object.values(Un).forEach((e=>{ii(e)}));var Kn=(0,o.aZ)({name:"ButtonIcon",props:{icon:{type:String,required:!0}},setup(e){return{source:Un[e.icon]}}});const Fn=(0,mi.Z)(Kn,[["render",xn]]);var qn=Fn;const jn=e=>((0,o.dD)("data-v-15a0289b"),e=e(),(0,o.Cn)(),e),Vn={ref:"dialog",class:"background"},zn={class:"groups"},Zn={class:"group"},Yn=jn((()=>(0,o._)("div",{class:"label"},"戻る",-1))),$n={class:"group"},Jn=["disabled"],Qn=jn((()=>(0,o._)("div",{class:"label"},"初期化",-1))),Xn=["disabled"],eo=jn((()=>(0,o._)("div",{class:"label"},"開く",-1))),to=["disabled"],io=jn((()=>(0,o._)("div",{class:"label"},"上書き保存",-1))),no=["disabled"],oo=jn((()=>(0,o._)("div",{class:"label"},"保存",-1))),ao={class:"group"},so=jn((()=>(0,o._)("div",{class:"label"},"コピー・KIF",-1))),ro=jn((()=>(0,o._)("div",{class:"label"},"コピー・CSA",-1))),lo=jn((()=>(0,o._)("div",{class:"label"},"コピー・USI",-1))),co=jn((()=>(0,o._)("div",{class:"label"},"コピー・SFEN",-1))),ho=["disabled"],uo=jn((()=>(0,o._)("div",{class:"label"},"貼り付け",-1)));function po(e,t,i,n,a,s){const r=(0,o.up)("ButtonIcon");return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("dialog",Vn,[(0,o._)("div",zn,[(0,o._)("div",Zn,[(0,o._)("button",{class:"button",onClick:t[0]||(t[0]=(...t)=>e.onClose&&e.onClose(...t))},[(0,o.Wm)(r,{class:"icon",icon:e.Icon.CLOSE},null,8,["icon"]),Yn])]),(0,o._)("div",$n,[(0,o._)("button",{class:"button",disabled:!e.states.newFile,onClick:t[1]||(t[1]=(...t)=>e.onNewFile&&e.onNewFile(...t))},[(0,o.Wm)(r,{class:"icon",icon:e.Icon.FILE},null,8,["icon"]),Qn],8,Jn),(0,o._)("button",{class:"button",disabled:!e.states.open,onClick:t[2]||(t[2]=(...t)=>e.onOpen&&e.onOpen(...t))},[(0,o.Wm)(r,{class:"icon",icon:e.Icon.OPEN},null,8,["icon"]),eo],8,Xn),(0,o._)("button",{class:"button",disabled:!e.states.saveAs,onClick:t[3]||(t[3]=(...t)=>e.onSave&&e.onSave(...t))},[(0,o.Wm)(r,{class:"icon",icon:e.Icon.SAVE},null,8,["icon"]),io],8,to),(0,o._)("button",{class:"button",disabled:!e.states.save,onClick:t[4]||(t[4]=(...t)=>e.onSaveAs&&e.onSaveAs(...t))},[(0,o.Wm)(r,{class:"icon",icon:e.Icon.SAVE_AS},null,8,["icon"]),oo],8,no)]),(0,o._)("div",ao,[(0,o._)("button",{class:"button",onClick:t[5]||(t[5]=(...t)=>e.onCopyKIF&&e.onCopyKIF(...t))},[(0,o.Wm)(r,{class:"icon",icon:e.Icon.COPY},null,8,["icon"]),so]),(0,o._)("button",{class:"button",onClick:t[6]||(t[6]=(...t)=>e.onCopyCSA&&e.onCopyCSA(...t))},[(0,o.Wm)(r,{class:"icon",icon:e.Icon.COPY},null,8,["icon"]),ro]),(0,o._)("button",{class:"button",onClick:t[7]||(t[7]=(...t)=>e.onCopyUSI&&e.onCopyUSI(...t))},[(0,o.Wm)(r,{class:"icon",icon:e.Icon.COPY},null,8,["icon"]),lo]),(0,o._)("button",{class:"button",onClick:t[8]||(t[8]=(...t)=>e.onCopySFEN&&e.onCopySFEN(...t))},[(0,o.Wm)(r,{class:"icon",icon:e.Icon.COPY},null,8,["icon"]),co]),(0,o._)("button",{class:"button",disabled:!e.states.paste,onClick:t[9]||(t[9]=(...t)=>e.onPaste&&e.onPaste(...t))},[(0,o.Wm)(r,{class:"icon",icon:e.Icon.PASTE},null,8,["icon"]),uo],8,ho)])])],512)])}function go(e){e.addEventListener("cancel",(e=>{e.preventDefault(),e.stopPropagation()})),e.addEventListener("copy",(e=>{e.stopPropagation()})),e.addEventListener("paste",(e=>{e.stopPropagation()})),e.showModal()}function mo(e){return document.getElementById(e)}var _o=(0,o.aZ)({name:"FileMenu",components:{ButtonIcon:qn},emits:["close"],setup(e,t){const i=Bn(),n=(0,d.iH)(null);(0,o.bv)((()=>{go(n.value)}));const a=()=>{t.emit("close")},s=()=>{i.newRecord(),t.emit("close")},r=()=>{i.openRecord(),t.emit("close")},l=()=>{i.saveRecord({overwrite:!0}),t.emit("close")},c=()=>{i.saveRecord(),t.emit("close")},h=()=>{i.copyRecordKIF(),t.emit("close")},u=()=>{i.copyRecordCSA(),t.emit("close")},p=()=>{i.copyRecordUSIAll(),t.emit("close")},g=()=>{i.copyBoardSFEN(),t.emit("close")},m=()=>{i.showPasteDialog(),t.emit("close")},_=(0,o.Fl)((()=>({newFile:i.appState===En.NORMAL,open:i.appState===En.NORMAL,save:i.appState===En.NORMAL,saveAs:i.appState===En.NORMAL,paste:i.appState===En.NORMAL})));return{dialog:n,Icon:Wn,onClose:a,onNewFile:s,onOpen:r,onSave:l,onSaveAs:c,onCopyKIF:h,onCopyCSA:u,onCopyUSI:p,onCopySFEN:g,onPaste:m,states:_}}});const vo=(0,mi.Z)(_o,[["render",po],["__scopeId","data-v-15a0289b"]]);var So=vo;const Eo=e=>((0,o.dD)("data-v-d7f89dd8"),e=e(),(0,o.Cn)(),e),wo={ref:"dialog",class:"background"},Io={class:"groups"},fo={class:"group"},yo=Eo((()=>(0,o._)("div",{class:"label"},"戻る",-1))),bo={class:"group"},To=Eo((()=>(0,o._)("div",{class:"label"},"平手",-1))),Ao=Eo((()=>(0,o._)("div",{class:"label"},"香落ち",-1))),No=Eo((()=>(0,o._)("div",{class:"label"},"右香落ち",-1))),Po=Eo((()=>(0,o._)("div",{class:"label"},"角落ち",-1))),Ro=Eo((()=>(0,o._)("div",{class:"label"},"飛車落ち",-1))),ko=Eo((()=>(0,o._)("div",{class:"label"},"飛車香落ち",-1))),Oo=Eo((()=>(0,o._)("div",{class:"label"},"2枚落ち",-1))),Co=Eo((()=>(0,o._)("div",{class:"label"},"4枚落ち",-1))),Ho=Eo((()=>(0,o._)("div",{class:"label"},"6枚落ち",-1))),Mo=Eo((()=>(0,o._)("div",{class:"label"},"8枚落ち",-1))),Lo=Eo((()=>(0,o._)("div",{class:"label"},"詰め将棋",-1))),Do=Eo((()=>(0,o._)("div",{class:"label"},"双玉詰め将棋",-1)));function Bo(e,t,i,n,a,s){const r=(0,o.up)("ButtonIcon");return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("dialog",wo,[(0,o._)("div",Io,[(0,o._)("div",fo,[(0,o._)("button",{class:"button",onClick:t[0]||(t[0]=(...t)=>e.onClose&&e.onClose(...t))},[(0,o.Wm)(r,{class:"icon",icon:e.Icon.CLOSE},null,8,["icon"]),yo])]),(0,o._)("div",bo,[(0,o._)("button",{class:"button",onClick:t[1]||(t[1]=(...t)=>e.onStandard&&e.onStandard(...t))},[(0,o.Wm)(r,{class:"icon",icon:e.Icon.GAME},null,8,["icon"]),To]),(0,o._)("button",{class:"button",onClick:t[2]||(t[2]=(...t)=>e.onHandicapLance&&e.onHandicapLance(...t))},[(0,o.Wm)(r,{class:"icon",icon:e.Icon.GAME},null,8,["icon"]),Ao]),(0,o._)("button",{class:"button",onClick:t[3]||(t[3]=(...t)=>e.onHandicapRightLance&&e.onHandicapRightLance(...t))},[(0,o.Wm)(r,{class:"icon",icon:e.Icon.GAME},null,8,["icon"]),No]),(0,o._)("button",{class:"button",onClick:t[4]||(t[4]=(...t)=>e.onHandicapBishop&&e.onHandicapBishop(...t))},[(0,o.Wm)(r,{class:"icon",icon:e.Icon.GAME},null,8,["icon"]),Po]),(0,o._)("button",{class:"button",onClick:t[5]||(t[5]=(...t)=>e.onHandicapRook&&e.onHandicapRook(...t))},[(0,o.Wm)(r,{class:"icon",icon:e.Icon.GAME},null,8,["icon"]),Ro]),(0,o._)("button",{class:"button",onClick:t[6]||(t[6]=(...t)=>e.onHandicapRookLance&&e.onHandicapRookLance(...t))},[(0,o.Wm)(r,{class:"icon",icon:e.Icon.GAME},null,8,["icon"]),ko]),(0,o._)("button",{class:"button",onClick:t[7]||(t[7]=(...t)=>e.onHandicap2Pieces&&e.onHandicap2Pieces(...t))},[(0,o.Wm)(r,{class:"icon",icon:e.Icon.GAME},null,8,["icon"]),Oo]),(0,o._)("button",{class:"button",onClick:t[8]||(t[8]=(...t)=>e.onHandicap4Pieces&&e.onHandicap4Pieces(...t))},[(0,o.Wm)(r,{class:"icon",icon:e.Icon.GAME},null,8,["icon"]),Co]),(0,o._)("button",{class:"button",onClick:t[9]||(t[9]=(...t)=>e.onHandicap6Pieces&&e.onHandicap6Pieces(...t))},[(0,o.Wm)(r,{class:"icon",icon:e.Icon.GAME},null,8,["icon"]),Ho]),(0,o._)("button",{class:"button",onClick:t[10]||(t[10]=(...t)=>e.onHandicap8Pieces&&e.onHandicap8Pieces(...t))},[(0,o.Wm)(r,{class:"icon",icon:e.Icon.GAME},null,8,["icon"]),Mo]),(0,o._)("button",{class:"button",onClick:t[11]||(t[11]=(...t)=>e.onTsumeShogi&&e.onTsumeShogi(...t))},[(0,o.Wm)(r,{class:"icon",icon:e.Icon.QUIZ},null,8,["icon"]),Lo]),(0,o._)("button",{class:"button",onClick:t[12]||(t[12]=(...t)=>e.onTsumeShogi2Kings&&e.onTsumeShogi2Kings(...t))},[(0,o.Wm)(r,{class:"icon",icon:e.Icon.QUIZ},null,8,["icon"]),Do])])])],512)])}var Go=(0,o.aZ)({name:"InitialPositionMenu",components:{ButtonIcon:qn},emits:["close"],setup(e,t){const i=Bn(),n=(0,d.iH)(null);(0,o.bv)((()=>{go(n.value)}));const a=()=>{t.emit("close")},s=()=>{i.initializePosition(ke.STANDARD),t.emit("close")},r=()=>{i.initializePosition(ke.HANDICAP_LANCE),t.emit("close")},l=()=>{i.initializePosition(ke.HANDICAP_RIGHT_LANCE),t.emit("close")},c=()=>{i.initializePosition(ke.HANDICAP_BISHOP),t.emit("close")},h=()=>{i.initializePosition(ke.HANDICAP_ROOK),t.emit("close")},u=()=>{i.initializePosition(ke.HANDICAP_ROOK_LANCE),t.emit("close")},p=()=>{i.initializePosition(ke.HANDICAP_2PIECES),t.emit("close")},g=()=>{i.initializePosition(ke.HANDICAP_4PIECES),t.emit("close")},m=()=>{i.initializePosition(ke.HANDICAP_6PIECES),t.emit("close")},_=()=>{i.initializePosition(ke.HANDICAP_8PIECES),t.emit("close")},v=()=>{i.initializePosition(ke.TSUME_SHOGI),t.emit("close")},S=()=>{i.initializePosition(ke.TSUME_SHOGI_2KINGS),t.emit("close")};return{dialog:n,Icon:Wn,onClose:a,onStandard:s,onHandicapLance:r,onHandicapRightLance:l,onHandicapBishop:c,onHandicapRook:h,onHandicapRookLance:u,onHandicap2Pieces:p,onHandicap4Pieces:g,onHandicap6Pieces:m,onHandicap8Pieces:_,onTsumeShogi:v,onTsumeShogi2Kings:S}}});const xo=(0,mi.Z)(Go,[["render",Bo],["__scopeId","data-v-d7f89dd8"]]);var Wo=xo,Uo=(0,o.aZ)({name:"BoardPane",components:{BoardView:vi,ButtonIcon:qn,FileMenu:So,InitialPositionMenu:Wo},props:{maxSize:{type:ni,required:!0}},emits:["resize"],setup(e,t){const i=Bn(),n=(0,d.iH)(!1),a=(0,d.iH)(!1),s=e=>{t.emit("resize",e)},r=e=>{i.appState===En.GAME?pn.doMove(e):i.doMove(e)},l=e=>{i.editPosition(e)},c=()=>{i.showGameDialog()},h=()=>{i.stopGame()},u=()=>{pn.resign()},p=()=>{i.showResearchDialog()},g=()=>{i.stopResearch()},m=()=>{i.showAnalysisDialog()},_=()=>{i.stopAnalysis()},v=()=>{i.startPositionEditing()},S=()=>{i.endPositionEditing()},E=()=>{a.value=!0},w=()=>{i.changeTurn()},I=()=>{i.showAppSettingDialog()},f=()=>{i.showUsiEngineManagementDialog()},y=()=>{Bn().flipBoard()},b=()=>{n.value=!0},T=()=>{i.removeRecordAfter()},A=(0,o.Fl)((()=>i.appState===En.POSITION_EDITING)),N=(0,o.Fl)((()=>i.isMovableByUser)),P=(0,o.Fl)((()=>i.appSetting)),R=(0,o.Fl)((()=>i.record.position)),k=(0,o.Fl)((()=>{const e=i.record.current.move;return e instanceof Pe?e:void 0})),O=(0,o.Fl)((()=>i.record.metadata.getStandardMetadata(Ve.BLACK_NAME))),C=(0,o.Fl)((()=>i.record.metadata.getStandardMetadata(Ve.WHITE_NAME))),H=(0,o.Fl)((()=>i.appState===En.GAME?i.blackTimeMs:void 0)),M=(0,o.Fl)((()=>i.appState===En.GAME?i.blackByoyomi:void 0)),L=(0,o.Fl)((()=>i.appState===En.GAME?i.whiteTimeMs:void 0)),D=(0,o.Fl)((()=>i.appState===En.GAME?i.whiteByoyomi:void 0)),B=(0,o.Fl)((()=>({game:i.appState===En.NORMAL,stop:i.appState===En.GAME,resign:i.appState===En.GAME&&i.isMovableByUser,research:i.appState===En.NORMAL,endResearch:i.appState===En.RESEARCH,analysis:i.appState===En.NORMAL,endAnalysis:i.appState===En.ANALYSIS,startEditPosition:i.appState===En.NORMAL,endEditPosition:i.appState===En.POSITION_EDITING,initPosition:i.appState===En.POSITION_EDITING,removeAfter:i.appState===En.NORMAL||i.appState===En.RESEARCH,engineSettings:i.appState===En.NORMAL})));return{isFileMenuVisible:n,isInitialPositionMenuVisible:a,appSetting:P,position:R,lastMove:k,blackPlayerName:O,whitePlayerName:C,blackPlayerTimeMs:H,blackPlayerByoyomi:M,whitePlayerTimeMs:L,whitePlayerByoyomi:D,controlStates:B,onResize:s,onMove:r,onEdit:l,onGame:c,onStop:h,onResign:u,onResearch:p,onEndResearch:g,onAnalysis:m,onEndAnalysis:_,onStartEditPosition:v,onEndEditPosition:S,onInitPosition:E,onChangeTurn:w,onOpenAppSettings:I,onOpenEngineSettings:f,onFlip:y,onFileAction:b,onRemoveAfter:T,allowEdit:A,allowMove:N,Icon:Wn}}});const Ko=(0,mi.Z)(Uo,[["render",k],["__scopeId","data-v-9f2180b4"]]);var Fo=Ko;const qo=e=>((0,o.dD)("data-v-2f3c443f"),e=e(),(0,o.Cn)(),e),jo={class:"record-pane"},Vo={class:"record"},zo={class:"options"},Zo={class:"option"},Yo=["checked"],$o=qo((()=>(0,o._)("label",{for:"show-elapsed-time"},"消費時間",-1))),Jo={class:"option"},Qo=["checked"],Xo=qo((()=>(0,o._)("label",{for:"show-comment"},"コメント",-1)));function ea(e,t,i,n,a,s){const r=(0,o.up)("RecordView");return(0,o.wg)(),(0,o.iD)("div",jo,[(0,o._)("div",Vo,[(0,o.Wm)(r,{record:e.record,operational:e.isRecordOperational,"show-comment":e.showComment,"show-elapsed-time":e.showElapsedTime,onGoBegin:e.goBegin,onGoBack:e.goBack,onGoForward:e.goForward,onGoEnd:e.goEnd,onSelectMove:e.selectMove,onSelectBranch:e.selectBranch},null,8,["record","operational","show-comment","show-elapsed-time","onGoBegin","onGoBack","onGoForward","onGoEnd","onSelectMove","onSelectBranch"])]),(0,o._)("div",zo,[(0,o._)("div",Zo,[(0,o._)("input",{id:"show-elapsed-time",type:"checkbox",checked:e.showElapsedTime,onChange:t[0]||(t[0]=(...t)=>e.onToggleElapsedTime&&e.onToggleElapsedTime(...t))},null,40,Yo),$o]),(0,o._)("div",Jo,[(0,o._)("input",{id:"show-comment",type:"checkbox",checked:e.showComment,onChange:t[1]||(t[1]=(...t)=>e.onToggleComment&&e.onToggleComment(...t))},null,40,Qo),Xo])])])}const ta={class:"record-view"},ia={class:"controller"},na=["disabled"],oa=["disabled"],aa=["disabled"],sa=["disabled"],ra={ref:"moveList",class:"move-list"},la=["value","onClick"],ca={class:"move-number"},da={class:"move-text"},ha={key:0,class:"move-time"},ua={key:1,class:"move-comment"},pa={ref:"branchList",class:"branch-list"},ga=["value","onClick"],ma={class:"move-text"},_a={key:0,class:"move-comment"};function va(e,t,i,n,s,r){const l=(0,o.up)("ButtonIcon");return(0,o.wg)(),(0,o.iD)("div",ta,[(0,o._)("div",ia,[(0,o._)("button",{class:"control-button",disabled:!e.operational,onClick:t[0]||(t[0]=t=>e.goBegin())},[(0,o.Wm)(l,{class:"icon",icon:e.Icon.FIRST},null,8,["icon"])],8,na),(0,o._)("button",{class:"control-button",disabled:!e.operational,onClick:t[1]||(t[1]=t=>e.goBack())},[(0,o.Wm)(l,{class:"icon",icon:e.Icon.BACK},null,8,["icon"])],8,oa),(0,o._)("button",{class:"control-button",disabled:!e.operational,onClick:t[2]||(t[2]=t=>e.goForward())},[(0,o.Wm)(l,{class:"icon",icon:e.Icon.NEXT},null,8,["icon"])],8,aa),(0,o._)("button",{class:"control-button",disabled:!e.operational,onClick:t[3]||(t[3]=t=>e.goEnd())},[(0,o.Wm)(l,{class:"icon",icon:e.Icon.LAST},null,8,["icon"])],8,sa)]),(0,o._)("div",ra,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.moves,(t=>((0,o.wg)(),(0,o.iD)("div",{key:t.number,class:(0,a.C_)(["move-element",{"has-branch":t.hasBranch,selected:t.selected}]),value:t.number,onClick:i=>e.changeNumber(t.number)},[(0,o._)("div",ca,(0,a.zw)(0!==t.number?t.number:""),1),(0,o._)("div",da,(0,a.zw)(t.text),1),e.showElapsedTime?((0,o.wg)(),(0,o.iD)("div",ha,(0,a.zw)(t.time),1)):(0,o.kq)("",!0),e.showComment?((0,o.wg)(),(0,o.iD)("div",ua,(0,a.zw)(t.comment),1)):(0,o.kq)("",!0)],10,la)))),128))],512),(0,o._)("div",pa,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.branches,(t=>((0,o.wg)(),(0,o.iD)("div",{key:t.index,class:(0,a.C_)(["move-element",{selected:t.selected}]),value:t.index,onClick:i=>e.changeBranch(t.index)},[(0,o._)("div",ma,(0,a.zw)(t.text),1),e.showComment?((0,o.wg)(),(0,o.iD)("div",_a,(0,a.zw)(t.comment),1)):(0,o.kq)("",!0)],10,ga)))),128))],512)])}var Sa=(0,o.aZ)({name:"RecordView",components:{ButtonIcon:qn},props:{record:{type:Object,required:!0},operational:{type:Boolean,required:!1},showElapsedTime:{type:Boolean,required:!1},showComment:{type:Boolean,required:!1}},emits:["goBegin","goBack","goForward","goEnd","selectMove","selectBranch"],setup(e,t){const i=(0,d.iH)(null),n=(0,d.iH)(null),a=()=>{e.operational&&t.emit("goBegin")},s=()=>{e.operational&&t.emit("goBack")},r=()=>{e.operational&&t.emit("goForward")},l=()=>{e.operational&&t.emit("goEnd")},c=i=>{e.operational&&t.emit("selectMove",Number(i))},h=i=>{e.operational&&t.emit("selectBranch",Number(i))},u=(0,o.Fl)((()=>0===e.record.current.number)),p=(0,o.Fl)((()=>{const t=[];return e.record.moves.forEach((i=>{t.push({number:i.number,text:i.displayText,time:0!=i.number?i.timeText:"",hasBranch:i.hasBranch,comment:i.comment,selected:i===e.record.current})})),t})),g=(0,o.Fl)((()=>{if(!e.record.branchBegin.branch)return null;const t=[];let i;for(i=e.record.branchBegin;i&&i.move;i=i.branch)t.push({index:t.length,text:i.displayText,comment:i.comment,selected:i.activeBranch});return t}));return(0,o.ic)((()=>{const e=i.value;e.childNodes.forEach((e=>{e instanceof HTMLElement&&e.classList.contains("selected")&&e.scrollIntoView({behavior:"auto",block:"nearest"})}))})),{beginPosSelected:u,moves:p,branches:g,moveList:i,branchList:n,goBegin:a,goBack:s,goForward:r,goEnd:l,changeNumber:c,changeBranch:h,Icon:Wn}}});const Ea=(0,mi.Z)(Sa,[["render",va],["__scopeId","data-v-69eb6261"]]);var wa=Ea;const Ia=200;var fa=(0,o.aZ)({name:"RecordPane",components:{RecordView:wa},setup(){const e=Bn(),t=t=>{e.changeMoveNumber(t)},i=()=>{t(0)},n=()=>{t(e.record.current.number-1)},a=()=>{t(e.record.current.number+1)},s=()=>{t(Number.MAX_SAFE_INTEGER)},r=e=>{t(e)},l=t=>{e.changeBranch(t)},c=t=>{const i=t.target;e.updateAppSetting({showElapsedTimeInRecordView:i.checked})},d=t=>{const i=t.target;e.updateAppSetting({showCommentInRecordView:i.checked})},h=(0,o.Fl)((()=>e.appState===En.NORMAL||e.appState===En.RESEARCH)),u=(0,o.Fl)((()=>e.appSetting.showCommentInRecordView)),p=(0,o.Fl)((()=>e.appSetting.showElapsedTimeInRecordView)),g=(0,o.Fl)((()=>e.record));return{isRecordOperational:h,showElapsedTime:p,showComment:u,record:g,goBegin:i,goBack:n,goForward:a,goEnd:s,selectMove:r,selectBranch:l,onToggleElapsedTime:c,onToggleComment:d}}});const ya=(0,mi.Z)(fa,[["render",ea],["__scopeId","data-v-2f3c443f"]]);var ba=ya;const Ta={class:"root"},Aa={class:"tabs"},Na=(0,o.Uk)(" 棋譜情報 "),Pa=(0,o.Uk)(" コメント "),Ra=(0,o.Uk)(" 思考 "),ka=(0,o.Uk)(" 読み筋 "),Oa=(0,o.Uk)(" 評価値 "),Ca=(0,o.Uk)(" 期待勝率 "),Ha=(0,o.Uk)(" 最小化 "),Ma={class:"tab-contents"};function La(e,t,i,n,s,r){const l=(0,o.up)("ButtonIcon"),c=(0,o.up)("RecordInfo"),d=(0,o.up)("RecordComment"),h=(0,o.up)("EngineAnalytics"),u=(0,o.up)("EvaluationChart");return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("div",Ta,["invisible"===e.activeTab?((0,o.wg)(),(0,o.iD)("div",{key:0,style:(0,a.j5)(`height: calc(100% - ${e.headerHeight}px);`)},null,4)):(0,o.kq)("",!0),(0,o._)("div",Aa,[(0,o._)("span",{class:(0,a.C_)(["tab",{selected:e.activeTab===e.Tab.RECORD_INFO}]),onClick:t[0]||(t[0]=t=>e.changeSelect(e.Tab.RECORD_INFO))},[(0,o.Wm)(l,{class:"icon",icon:e.Icon.DESCRIPTION},null,8,["icon"]),Na],2),(0,o._)("span",{class:(0,a.C_)(["tab",{selected:e.activeTab===e.Tab.COMMENT}]),onClick:t[1]||(t[1]=t=>e.changeSelect(e.Tab.COMMENT))},[(0,o.Wm)(l,{class:"icon",icon:e.Icon.COMMENT},null,8,["icon"]),Pa],2),(0,o._)("span",{class:(0,a.C_)(["tab",{selected:e.activeTab===e.Tab.SEARCH}]),onClick:t[2]||(t[2]=t=>e.changeSelect(e.Tab.SEARCH))},[(0,o.Wm)(l,{class:"icon",icon:e.Icon.BRAIN},null,8,["icon"]),Ra],2),(0,o._)("span",{class:(0,a.C_)(["tab",{selected:e.activeTab===e.Tab.PV}]),onClick:t[3]||(t[3]=t=>e.changeSelect(e.Tab.PV))},[(0,o.Wm)(l,{class:"icon",icon:e.Icon.PV},null,8,["icon"]),ka],2),(0,o._)("span",{class:(0,a.C_)(["tab",{selected:e.activeTab===e.Tab.CHART}]),onClick:t[4]||(t[4]=t=>e.changeSelect(e.Tab.CHART))},[(0,o.Wm)(l,{class:"icon",icon:e.Icon.CHART},null,8,["icon"]),Oa],2),(0,o._)("span",{class:(0,a.C_)(["tab",{selected:e.activeTab===e.Tab.PERCENTAGE_CHART}]),onClick:t[5]||(t[5]=t=>e.changeSelect(e.Tab.PERCENTAGE_CHART))},[(0,o.Wm)(l,{class:"icon",icon:e.Icon.PERCENT},null,8,["icon"]),Ca],2),(0,o._)("span",{class:(0,a.C_)(["tab",{selected:e.activeTab===e.Tab.INVISIBLE}]),onClick:t[6]||(t[6]=t=>e.changeSelect(e.Tab.INVISIBLE))},[(0,o.Wm)(l,{class:"icon",icon:e.Icon.ARROW_DROP},null,8,["icon"]),Ha],2)]),(0,o._)("div",Ma,[(0,o.Wm)(c,{class:(0,a.C_)(["tab-content",{selected:e.activeTab===e.Tab.RECORD_INFO}]),size:e.contentSize},null,8,["class","size"]),(0,o.Wm)(d,{class:(0,a.C_)(["tab-content",{selected:e.activeTab===e.Tab.COMMENT}])},null,8,["class"]),(0,o.Wm)(h,{class:(0,a.C_)(["tab-content",{selected:e.activeTab===e.Tab.SEARCH}]),size:e.contentSize,"history-mode":!0},null,8,["class","size"]),(0,o.Wm)(h,{class:(0,a.C_)(["tab-content",{selected:e.activeTab===e.Tab.PV}]),size:e.contentSize,"history-mode":!1},null,8,["class","size"]),(0,o.Wm)(u,{class:(0,a.C_)(["tab-content",{selected:e.activeTab===e.Tab.CHART}]),size:e.contentSize,type:e.EvaluationChartType.RAW},null,8,["class","size","type"]),(0,o.Wm)(u,{class:(0,a.C_)(["tab-content",{selected:e.activeTab===e.Tab.PERCENTAGE_CHART}]),size:e.contentSize,type:e.EvaluationChartType.WIN_RATE},null,8,["class","size","type"])])])])}const Da={class:"root"},Ba=["value","readonly"];function Ga(e,t,i,n,a,s){return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("div",Da,[(0,o._)("textarea",{ref:"textarea",class:"text",value:e.comment,readonly:!!e.readonly,onInput:t[0]||(t[0]=(...t)=>e.change&&e.change(...t))},null,40,Ba)])])}var xa=(0,o.aZ)({name:"RecordComment",setup(){const e=Bn(),t=(0,o.Fl)((()=>e.record.current.comment)),i=(0,o.Fl)((()=>e.appState!=En.NORMAL)),n=(0,d.iH)(null),a=t=>{const i=t.target.value;e.updateRecordComment(i)};return(0,o.bv)((()=>{n.value.addEventListener("copy",(e=>{e.stopPropagation()})),n.value.addEventListener("paste",(e=>{e.stopPropagation()}))})),{textarea:n,comment:t,readonly:i,change:a}}});const Wa=(0,mi.Z)(xa,[["render",Ga],["__scopeId","data-v-74746424"]]);var Ua=Wa;const Ka={class:"root"};function Fa(e,t,i,n,a,s){const r=(0,o.up)("EngineAnalyticsElement");return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("div",Ka,[e.blackPlayer?((0,o.wg)(),(0,o.j4)(r,{key:0,"history-mode":e.historyMode,name:e.blackPlayer.name,info:e.blackPlayer,height:e.elementHeight},null,8,["history-mode","name","info","height"])):(0,o.kq)("",!0),e.whitePlayer?((0,o.wg)(),(0,o.j4)(r,{key:1,"history-mode":e.historyMode,name:e.whitePlayer.name,info:e.whitePlayer,height:e.elementHeight},null,8,["history-mode","name","info","height"])):(0,o.kq)("",!0),e.researcher?((0,o.wg)(),(0,o.j4)(r,{key:2,"history-mode":e.historyMode,name:e.researcher.name,info:e.researcher,height:e.elementHeight},null,8,["history-mode","name","info","height"])):(0,o.kq)("",!0)])])}const qa=e=>((0,o.dD)("data-v-3fd4e856"),e=e(),(0,o.Cn)(),e),ja={class:"root"},Va={class:"headers"},za={class:"header"},Za=qa((()=>(0,o._)("span",{class:"label"},"エンジン名: ",-1))),Ya={class:"value"},$a={class:"header"},Ja=qa((()=>(0,o._)("span",{class:"label"},"予想手: ",-1))),Qa={class:"value"},Xa={class:"header"},es=qa((()=>(0,o._)("span",{class:"label"},"最善手: ",-1))),ts={class:"value"},is={class:"header"},ns=qa((()=>(0,o._)("span",{class:"label"},"秒間探索ノード(NPS): ",-1))),os={class:"value"},as={class:"header"},ss=qa((()=>(0,o._)("span",{class:"label"},"探索ノード数: ",-1))),rs={class:"value"},ls={class:"header"},cs=qa((()=>(0,o._)("span",{class:"label"},"ハッシュ使用率: ",-1))),ds={class:"value"},hs=(0,o.uE)('<div class="list-header" data-v-3fd4e856><div class="list-column time" data-v-3fd4e856>経過時間</div><div class="list-column multipv-index" data-v-3fd4e856>順位</div><div class="list-column depth" data-v-3fd4e856>深さ</div><div class="list-column nodes" data-v-3fd4e856>探索局面数</div><div class="list-column score" data-v-3fd4e856>評価値</div></div>',1),us={class:"list-column time"},ps={class:"list-column multipv-index"},gs={class:"list-column depth"},ms={class:"list-column nodes"},_s={class:"list-column score"},vs={class:"list-column score-flag"},Ss={class:"list-column text"},Es=["onClick"],ws=(0,o.Uk)(" 再現 ");function Is(e,t,i,n,s,r){const l=(0,o.up)("ButtonIcon"),c=(0,o.up)("PVPreviewDialog");return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("div",ja,[(0,o._)("div",Va,[(0,o._)("div",za,[Za,(0,o._)("span",Ya,(0,a.zw)(e.name),1)]),(0,o._)("div",$a,[Ja,(0,o._)("span",Qa,(0,a.zw)(e.info.ponderMove?e.info.ponderMove:"---"),1)]),(0,o._)("div",Xa,[es,(0,o._)("span",ts,(0,a.zw)(e.info.currentMoveText||"---"),1)]),(0,o._)("div",is,[ns,(0,o._)("span",os,(0,a.zw)(e.info.nps||"---"),1)]),(0,o._)("div",as,[ss,(0,o._)("span",rs,(0,a.zw)(e.info.nodes||"---"),1)]),(0,o._)("div",ls,[cs,(0,o._)("span",ds,(0,a.zw)(e.info.hashfull?(100*e.info.hashfull).toFixed(1):"---")+" % ",1)])]),hs,(0,o._)("div",{class:"list",style:(0,a.j5)(`height:${e.height-37}px`)},[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.historyMode?e.info.iterates:e.info.latestIteration,((t,i)=>((0,o.wg)(),(0,o.iD)("div",{key:i,class:(0,a.C_)(["list-item",{highlight:e.historyMode&&1===t.multiPV}])},[(0,o._)("div",us,(0,a.zw)(t.timeMs?(t.timeMs/1e3).toFixed(1)+"s":""),1),(0,o._)("div",ps,(0,a.zw)(t.multiPV||""),1),(0,o._)("div",gs,(0,a.zw)(t.depth)+(0,a.zw)(t.selectiveDepth&&t.depth?"/":"")+(0,a.zw)(t.selectiveDepth),1),(0,o._)("div",ms,(0,a.zw)(t.nodes),1),(0,o._)("div",_s,(0,a.zw)(t.score)+" "+(0,a.zw)(t.scoreMate?t.scoreMate:""),1),(0,o._)("div",vs,(0,a.zw)(t.lowerBound?"++":"")+" "+(0,a.zw)(t.upperBound?"--":"")+" "+(0,a.zw)(t.scoreMate?"詰":""),1),(0,o._)("div",Ss,[t.pv&&0!==t.pv.length&&t.text?((0,o.wg)(),(0,o.iD)("button",{key:0,onClick:i=>e.showPreview(t)},[(0,o.Wm)(l,{class:"icon",icon:e.Icon.PLAY},null,8,["icon"]),ws],8,Es)):(0,o.kq)("",!0),(0,o.Uk)(" "+(0,a.zw)(t.text),1)])],2)))),128))],4),e.preview?((0,o.wg)(),(0,o.j4)(c,{key:0,position:e.preview.position,pv:e.preview.pv,infos:e.preview.infos,onClose:e.closePreview},null,8,["position","pv","infos","onClose"])):(0,o.kq)("",!0)])])}const fs={ref:"dialog"},ys={class:"control top"},bs={class:"control-row"},Ts={class:"control-row"},As={class:"control-row"},Ns={class:"informations"};function Ps(e,t,i,n,s,r){const l=(0,o.up)("ButtonIcon"),c=(0,o.up)("BoardView");return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("dialog",fs,[(0,o.Wm)(c,{class:"board","piece-image-type":e.appSetting.pieceImage,"board-image-type":e.appSetting.boardImage,"board-label-type":e.appSetting.boardLabelType,"max-size":e.maxSize,position:e.pos,"last-move":e.lastMove,flip:e.flip},{"right-control":(0,o.w5)((()=>[(0,o._)("div",ys,[(0,o._)("div",bs,[(0,o._)("button",{class:"control-item",onClick:t[0]||(t[0]=(...t)=>e.doFlip&&e.doFlip(...t))},[(0,o.Wm)(l,{class:"icon",icon:e.Icon.FLIP},null,8,["icon"])]),(0,o._)("button",{class:"control-item",onClick:t[1]||(t[1]=(...t)=>e.close&&e.close(...t))},[(0,o.Wm)(l,{class:"icon",icon:e.Icon.CLOSE},null,8,["icon"])])]),(0,o._)("div",Ts,[(0,o._)("button",{class:"control-item",onClick:t[2]||(t[2]=(...t)=>e.goBegin&&e.goBegin(...t))},[(0,o.Wm)(l,{class:"icon",icon:e.Icon.FIRST},null,8,["icon"])]),(0,o._)("button",{class:"control-item",onClick:t[3]||(t[3]=(...t)=>e.goEnd&&e.goEnd(...t))},[(0,o.Wm)(l,{class:"icon",icon:e.Icon.LAST},null,8,["icon"])])]),(0,o._)("div",As,[(0,o._)("button",{class:"control-item",onClick:t[4]||(t[4]=(...t)=>e.goBack&&e.goBack(...t))},[(0,o.Wm)(l,{class:"icon",icon:e.Icon.BACK},null,8,["icon"])]),(0,o._)("button",{class:"control-item",onClick:t[5]||(t[5]=(...t)=>e.goForward&&e.goForward(...t))},[(0,o.Wm)(l,{class:"icon",icon:e.Icon.NEXT},null,8,["icon"])])])])])),_:1},8,["piece-image-type","board-image-type","board-label-type","max-size","position","last-move","flip"]),(0,o._)("div",Ns,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.infos,(e=>((0,o.wg)(),(0,o.iD)("div",{key:e,class:"information"},(0,a.zw)(e),1)))),128))])],512)])}var Rs=(0,o.aZ)({name:"PVPreviewDialog",components:{BoardView:vi,ButtonIcon:qn},props:{position:{type:String,required:!0},pv:{type:Object,required:!0},infos:{type:Object,default:[],required:!1}},emits:["close"],setup(e,t){const i=Bn(),n=(0,d.iH)(null),a=(0,d.qj)(new ni(0,0)),s=(0,d.qj)(new Xe),r=(0,d.iH)(i.appSetting.boardFlipping),l=()=>{a.width=.8*window.innerWidth,a.height=.8*window.innerHeight-80},c=()=>{const t=xe.newBySFEN(e.position);if(t){s.clear(t);for(const t of e.pv){const e=s.position.createMoveBySFEN(t);if(!e)break;s.append(e,{ignoreValidation:!0})}s.goto(1)}};(0,o.bv)((async()=>{l(),c(),window.addEventListener("resize",l),go(n.value)})),(0,o.Ah)((()=>{window.removeEventListener("resize",l)})),(0,o.YP)([()=>e.position,()=>e.pv],(()=>{c(),go(n.value)}));const h=()=>{t.emit("close")},u=()=>{s.goto(0)},p=()=>{s.goto(Number.MAX_SAFE_INTEGER)},g=()=>{s.goBack()},m=()=>{s.goForward()},_=()=>{r.value=!r.value},v=(0,d.Fl)((()=>s.position)),S=(0,d.Fl)((()=>s.current.move instanceof Pe?s.current.move:null));return{dialog:n,appSetting:i.appSetting,pos:v,lastMove:S,maxSize:a,flip:r,close:h,goBegin:u,goEnd:p,goBack:g,goForward:m,doFlip:_,Icon:Wn}}});const ks=(0,mi.Z)(Rs,[["render",Ps],["__scopeId","data-v-0317ad55"]]);var Os=ks,Cs=(0,o.aZ)({name:"EngineAnalyticsElement",components:{ButtonIcon:qn,PVPreviewDialog:Os},props:{historyMode:{type:Boolean,required:!0},name:{type:String,required:!0},info:{type:sn,required:!0},height:{type:Number,required:!0}},setup:()=>{const e=(0,d.iH)(null),t=t=>{const i=[];void 0!==t.depth&&i.push(`深さ=${t.depth}`),void 0!==t.selectiveDepth&&i.push(`選択的深さ=${t.selectiveDepth}`),t.score&&(i.push(`評価値=${t.score}`),t.lowerBound&&i.push("（下界値）"),t.upperBound&&i.push("（上界値）")),t.scoreMate&&i.push(`詰み手数=${t.scoreMate}`),t.multiPV&&i.push(`順位=${t.multiPV}`),e.value={position:t.position,pv:t.pv||[],infos:[i.join(" / "),t.text||""]}},i=()=>{e.value=null};return{Icon:Wn,preview:e,showPreview:t,closePreview:i}}});const Hs=(0,mi.Z)(Cs,[["render",Is],["__scopeId","data-v-3fd4e856"]]);var Ms=Hs,Ls=(0,o.aZ)({name:"EngineAnalytics",components:{EngineAnalyticsElement:Ms},props:{size:{type:ni,required:!0},historyMode:{type:Boolean,required:!0}},setup(e){const t=Bn(),i=(0,o.Fl)((()=>t.usiBlackPlayerMonitor)),n=(0,o.Fl)((()=>t.usiWhitePlayerMonitor)),a=(0,o.Fl)((()=>t.usiResearcherMonitor)),s=(0,o.Fl)((()=>{const i=(t.usiBlackPlayerMonitor?1:0)+(t.usiWhitePlayerMonitor?1:0)+(t.usiResearcherMonitor?1:0);return 0!==i?e.size.height/i:0}));return{blackPlayer:i,whitePlayer:n,researcher:a,elementHeight:s}}});const Ds=(0,mi.Z)(Ls,[["render",Fa],["__scopeId","data-v-3b22508c"]]);var Bs=Ds;const Gs={class:"root"},xs=["width","height"];function Ws(e,t,i,n,a,s){return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("div",Gs,[(0,o._)("canvas",{ref:"canvas",width:e.size.width.toFixed(0),height:e.size.height.toFixed(0)},null,8,xs)])])}var Us=i(2728);const Ks=2e3,Fs=-Ks;function qs(e){switch(e){default:return{main:"black",ticks:"dimgray",grid:"lightgray",head:"red",blackPlayer:"royalblue",whitePlayer:"darkorange",researcher:"darkgreen"};case Ci.DARK:return{main:"white",ticks:"darkgray",grid:"dimgray",head:"red",blackPlayer:"deepskyblue",whitePlayer:"orange",researcher:"mediumseagreen"}}}var js;(function(e){e["RAW"]="raw",e["WIN_RATE"]="winRate"})(js||(js={}));var Vs=(0,o.aZ)({name:"EvaluationChart",props:{size:{type:ni,required:!0},type:{type:String,required:!0}},setup(e){const t=(0,d.iH)(null),i=Bn();let n,a=Ks,s=Fs;e.type===js.WIN_RATE&&(a=100,s=0);const r=(t,i,n,o)=>{const a=[];return n.moves.forEach((t=>{const n=new cn(t.customData);let s=n.evaluation&&n.evaluation[i];if(void 0!==s){switch(e.type){case js.RAW:s=Math.min(Math.max(s,Fs),Ks);break;case js.WIN_RATE:s=Rn(s,o);break}a.push({x:t.number,y:s})}})),{label:on(i),borderColor:t,data:a,showLine:!0}},l=(e,t)=>({label:"現在の局面",borderColor:t.head,data:[{x:e.current.number,y:a},{x:e.current.number,y:s}],showLine:!0,pointBorderWidth:0,pointRadius:0}),c=(e,t,i)=>[l(e,i),r(i.blackPlayer,nn.BLACK_PLAYER,e,t),r(i.whitePlayer,nn.WHITE_PLAYER,e,t),r(i.researcher,nn.RESEARCHER,e,t)],h=(e,t)=>({x:{min:0,max:e.length+10,ticks:{color:t.ticks},grid:{color:t.grid}},y:{min:s,max:a,ticks:{color:t.ticks},grid:{color:t.grid}}}),u=(e,t)=>{const i=qs(t.thema);n.data.datasets=c(e,t,i),n.options.color=i.main,n.options.scales=h(e,i),n.update()},p=(e,t,n)=>{if(null===e.x)return;const o=n.scales.x.max-n.scales.x.min,a=n.scales.x.right-n.scales.x.left,s=(e.x-n.scales.x.left)/a*o+n.scales.x.min,r=Math.round(s);i.changeMoveNumber(r)};return(0,o.bv)((()=>{const e=t.value,i=e.getContext("2d");n=new Us.kL(i,{type:"scatter",data:{datasets:[]},options:{animation:{duration:0},maintainAspectRatio:!1,events:["click"],onClick:p}}),n.draw()})),(0,o.Ah)((()=>{n.destroy()})),(0,o.YP)((()=>[i.record,i.appSetting]),(([e,t])=>u(e,t)),{deep:!0}),(0,o.YP)((()=>[e.size]),(([e])=>{n.resize(e.width,e.height)}),{deep:!0}),{canvas:t}}});const zs=(0,mi.Z)(Vs,[["render",Ws],["__scopeId","data-v-dbdea358"]]);var Zs=zs;const Ys=e=>((0,o.dD)("data-v-1fb9186d"),e=e(),(0,o.Cn)(),e),$s={class:"element"},Js=Ys((()=>(0,o._)("div",{class:"key"},"ファイル",-1))),Qs={class:"value"},Xs={class:"key"},er=["value","onInput"];function tr(e,t,i,n,s,r){return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("div",{ref:"root",class:"root",style:(0,a.j5)(`height:${e.size.height}px`)},[(0,o._)("div",$s,[Js,(0,o._)("div",Qs,(0,a.zw)(e.filePath||"（新規棋譜）"),1)]),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.list,(t=>((0,o.wg)(),(0,o.iD)("div",{key:t.key,class:"element"},[(0,o._)("div",Xs,(0,a.zw)(t.displayName),1),(0,o._)("input",{class:"value",value:t.value,onInput:i=>e.change(i,t.key)},null,40,er)])))),128))],4)])}var ir=(0,o.aZ)({name:"RecordComment",props:{size:{type:ni,required:!0}},setup(){const e=(0,d.iH)(null),t=Bn(),i=(0,o.Fl)((()=>t.recordFilePath)),n=(0,o.Fl)((()=>Object.values(Ve).map((e=>{const i=t.record.metadata;return{key:e,displayName:Ze(e),value:i.getStandardMetadata(e)||""}}))));(0,o.bv)((()=>{e.value.addEventListener("copy",(e=>{e.stopPropagation()})),e.value.addEventListener("paste",(e=>{e.stopPropagation()}))}));const a=(e,i)=>{const n=e.target;t.updateStandardRecordMetadata({key:i,value:n.value})};return{root:e,filePath:i,list:n,change:a}}});const nr=(0,mi.Z)(ir,[["render",tr],["__scopeId","data-v-1fb9186d"]]);var or=nr;const ar=30,sr=240+ar;var rr=(0,o.aZ)({name:"TabPane",components:{RecordComment:Ua,EngineAnalytics:Bs,EvaluationChart:Zs,RecordInfo:or,ButtonIcon:qn},props:{size:{type:ni,required:!0}},setup(e){const t=Bn(),i=e=>{t.updateAppSetting({tab:e}).catch((e=>{zi.log(Li.WARN,tt(e))}))},n=(0,o.Fl)((()=>t.appSetting.tab)),a=(0,o.Fl)((()=>e.size.reduce(new ni(0,ar))));return{activeTab:n,contentSize:a,headerHeight:ar,changeSelect:i,Icon:Wn,Tab:Hi,EvaluationChartType:js}}});const lr=(0,mi.Z)(rr,[["render",La],["__scopeId","data-v-a0779d9e"]]);var cr=lr,dr=(0,o.aZ)({name:"StandardLayout",components:{BoardPane:Fo,RecordPane:ba,TabPane:cr},setup(){const e=(0,d.qj)(new ni(0,0)),t=(0,d.iH)(new ni(0,0)),i=()=>{e.width=window.innerWidth,e.height=window.innerHeight};(0,o.bv)((()=>{i(),window.addEventListener("resize",i)})),(0,o.Ah)((()=>{window.removeEventListener("resize",i)}));const n=e=>{t.value=e},a=(0,o.Fl)((()=>{const t=Bn().appSetting.tab!==Hi.INVISIBLE?sr:ar;return new ni(e.width-Ia,e.height-t)})),s=(0,o.Fl)((()=>({width:e.width-t.value.width+"px",height:`${t.value.height}px`}))),r=(0,o.Fl)((()=>new ni(e.width,e.height-t.value.height)));return{boardPaneMaxSize:a,recordPaneStyle:s,bottomPaneSize:r,onBoardPaneResize:n}}});const hr=(0,mi.Z)(dr,[["render",c],["__scopeId","data-v-c97084ae"]]);var ur=hr;const pr=e=>((0,o.dD)("data-v-c5c0e252"),e=e(),(0,o.Cn)(),e),gr={ref:"dialog"},mr=pr((()=>(0,o._)("div",{class:"dialog-title"},"対局",-1))),_r={class:"dialog-form-area"},vr={class:"players"},Sr={class:"player"},Er=pr((()=>(0,o._)("div",{class:"top-label"},"先手（下手）",-1))),wr={class:"player"},Ir=pr((()=>(0,o._)("div",{class:"top-label"},"後手（上手）",-1))),fr={class:"players-control"},yr=(0,o.Uk)(" 先後入れ替え "),br={class:"dialog-form-areas-h"},Tr={class:"dialog-form-area time-limit"},Ar={class:"dialog-form-item"},Nr=pr((()=>(0,o._)("div",{class:"dialog-form-item-label"},"持ち時間",-1))),Pr={ref:"hours",class:"time-input",type:"number",min:"0",max:"99",step:"1"},Rr=pr((()=>(0,o._)("div",{class:"dialog-form-item-unit"},"時間",-1))),kr={ref:"minutes",class:"time-input",type:"number",min:"0",max:"59",step:"1"},Or=pr((()=>(0,o._)("div",{class:"dialog-form-item-unit"},"分",-1))),Cr={class:"dialog-form-item"},Hr=pr((()=>(0,o._)("div",{class:"dialog-form-item-label"},"秒読み",-1))),Mr={ref:"byoyomi",class:"time-input single",type:"number",min:"0",max:"60",step:"1"},Lr=pr((()=>(0,o._)("div",{class:"dialog-form-item-unit"},"秒",-1))),Dr={class:"dialog-form-item"},Br=pr((()=>(0,o._)("div",{class:"dialog-form-item-label"},"増加",-1))),Gr={ref:"increment",class:"time-input single",type:"number",min:"0",max:"99",step:"1"},xr=pr((()=>(0,o._)("div",{class:"dialog-form-item-unit"},"秒",-1))),Wr={class:"dialog-form-area flags"},Ur={class:"dialog-form-item"},Kr={ref:"startPosition"},Fr=(0,o.uE)('<option value="current" data-v-c5c0e252>現在の局面</option><option value="standard" data-v-c5c0e252>平手</option><option value="handicapLance" data-v-c5c0e252>香落ち</option><option value="handicapRightLance" data-v-c5c0e252>右香落ち</option><option value="handicapBishop" data-v-c5c0e252>角落ち</option><option value="handicapRook" data-v-c5c0e252>飛車落ち</option><option value="handicapRookLance" data-v-c5c0e252>飛車香落ち</option><option value="handicap2Pieces" data-v-c5c0e252>2枚落ち</option><option value="handicap4Pieces" data-v-c5c0e252>4枚落ち</option><option value="handicap6Pieces" data-v-c5c0e252>6枚落ち</option><option value="handicap8Pieces" data-v-c5c0e252>8枚落ち</option>',11),qr=[Fr],jr={class:"dialog-form-item"},Vr={id:"disable-engine-timeout",ref:"enableEngineTimeout",type:"checkbox"},zr=pr((()=>(0,o._)("label",{for:"disable-engine-timeout"},"エンジンの時間切れあり",-1))),Zr={class:"dialog-form-item"},Yr={id:"human-is-front",ref:"humanIsFront",type:"checkbox"},$r=pr((()=>(0,o._)("label",{for:"human-is-front"},"人を手前に表示する",-1))),Jr={class:"dialog-main-buttons"};function Qr(e,t,i,n,a,s){const r=(0,o.up)("PlayerSelector"),l=(0,o.up)("ButtonIcon");return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("dialog",gr,[mr,(0,o._)("div",_r,[(0,o._)("div",vr,[(0,o._)("div",Sr,[Er,(0,o.Wm)(r,{players:e.players,"player-uri":e.blackPlayerURI,"engine-settings":e.engineSettings.json,"display-ponder-state":!0,"display-thread-state":!0,"display-multi-pv-state":!0,onUpdateEngineSetting:e.onUpdatePlayerSetting,onSelectPlayer:e.onSelectBlackPlayer},null,8,["players","player-uri","engine-settings","onUpdateEngineSetting","onSelectPlayer"])]),(0,o._)("div",wr,[Ir,e.whitePlayerURI?((0,o.wg)(),(0,o.j4)(r,{key:0,players:e.players,"player-uri":e.whitePlayerURI,"engine-settings":e.engineSettings.json,"display-ponder-state":!0,"display-thread-state":!0,"display-multi-pv-state":!0,onUpdateEngineSetting:e.onUpdatePlayerSetting,onSelectPlayer:e.onSelectWhitePlayer},null,8,["players","player-uri","engine-settings","onUpdateEngineSetting","onSelectPlayer"])):(0,o.kq)("",!0)])]),(0,o._)("div",fr,[(0,o._)("button",{onClick:t[0]||(t[0]=(...t)=>e.onSwapColor&&e.onSwapColor(...t))},[(0,o.Wm)(l,{class:"icon",icon:e.Icon.SWAP_H},null,8,["icon"]),yr])])]),(0,o._)("div",br,[(0,o._)("div",Tr,[(0,o._)("div",Ar,[Nr,(0,o._)("input",Pr,null,512),Rr,(0,o._)("input",kr,null,512),Or]),(0,o._)("div",Cr,[Hr,(0,o._)("input",Mr,null,512),Lr]),(0,o._)("div",Dr,[Br,(0,o._)("input",Gr,null,512),xr])]),(0,o._)("div",Wr,[(0,o._)("div",Ur,[(0,o._)("select",Kr,qr,512)]),(0,o._)("div",jr,[(0,o._)("input",Vr,null,512),zr]),(0,o._)("div",Zr,[(0,o._)("input",Yr,null,512),$r])])]),(0,o._)("div",Jr,[(0,o._)("button",{class:"dialog-button",onClick:t[1]||(t[1]=t=>e.onStart())},"対局開始"),(0,o._)("button",{class:"dialog-button",onClick:t[2]||(t[2]=t=>e.onCancel())},"キャンセル")])],512)])}function Xr(e){let t=Number(e.value);return e.max&&(t=Math.min(t,Number(e.max))),e.min&&(t=Math.max(t,Number(e.min))),t}const el=e=>((0,o.dD)("data-v-7083fac1"),e=e(),(0,o.Cn)(),e),tl={class:"root"},il=["value"],nl=["value"],ol={key:0,class:"player-info"},al=el((()=>(0,o._)("span",{class:"player-info-key"},"先読み(Ponder):",-1))),sl={class:"player-info-value"},rl={key:1,class:"player-info"},ll=el((()=>(0,o._)("span",{class:"player-info-key"},"スレッド数:",-1))),cl={class:"player-info-value"},dl={key:2,class:"player-info"},hl=el((()=>(0,o._)("span",{class:"player-info-key"},"マルチPV:",-1))),ul={class:"player-info-value"},pl=["disabled"],gl=(0,o.Uk)(" 設定 ");function ml(e,t,i,n,s,r){const l=(0,o.up)("ButtonIcon"),c=(0,o.up)("USIEngineOptionDialog");return(0,o.wg)(),(0,o.iD)(o.HY,null,[(0,o._)("div",null,[(0,o._)("div",tl,[(0,o._)("select",{ref:"playerSelect",class:"player-select",size:"1",value:e.playerUri,onChange:t[0]||(t[0]=(...t)=>e.onPlayerChange&&e.onPlayerChange(...t))},[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.players,(e=>((0,o.wg)(),(0,o.iD)("option",{key:e.uri,value:e.uri},(0,a.zw)(e.name),9,nl)))),128))],40,il),e.displayPonderState?((0,o.wg)(),(0,o.iD)("div",ol,[al,(0,o._)("span",sl,(0,a.zw)(e.ponderState||"---"),1)])):(0,o.kq)("",!0),e.displayThreadState?((0,o.wg)(),(0,o.iD)("div",rl,[ll,(0,o._)("span",cl,(0,a.zw)(e.threadState||"---"),1)])):(0,o.kq)("",!0),e.displayMultiPvState?((0,o.wg)(),(0,o.iD)("div",dl,[hl,(0,o._)("span",ul,(0,a.zw)(e.multiPVState||"---"),1)])):(0,o.kq)("",!0),(0,o._)("button",{class:"player-setting",disabled:!e.isPlayerSettingEnabled,onClick:t[1]||(t[1]=(...t)=>e.openPlayerSetting&&e.openPlayerSetting(...t))},[(0,o.Wm)(l,{class:"icon",icon:e.Icon.SETTINGS},null,8,["icon"]),gl],8,pl)])]),e.engineSettingDialog?((0,o.wg)(),(0,o.j4)(c,{key:0,"latest-engine-setting":e.engineSettingDialog,"ok-button-text":"保存",onOk:e.savePlayerSetting,onCancel:e.closePlayerSetting},null,8,["latest-engine-setting","onOk","onCancel"])):(0,o.kq)("",!0)],64)}const _l=e=>((0,o.dD)("data-v-01e76537"),e=e(),(0,o.Cn)(),e),vl={ref:"dialog"},Sl=_l((()=>(0,o._)("div",{class:"dialog-title"},"エンジン設定",-1))),El={class:"dialog-form-area option-list"},wl={class:"option"},Il=_l((()=>(0,o._)("div",{class:"option-name"},"エンジン名",-1))),fl={class:"option-unchangeable"},yl={class:"option"},bl=_l((()=>(0,o._)("div",{class:"option-name"},"作者",-1))),Tl={class:"option-unchangeable"},Al={class:"option"},Nl=_l((()=>(0,o._)("div",{class:"option-name"},"場所",-1))),Pl={class:"option-unchangeable"},Rl={class:"option"},kl=_l((()=>(0,o._)("div",{class:"option-name"},"表示名",-1))),Ol={ref:"engineNameInput",class:"option-value-text",type:"text",name:"ElectronShogiEngineName"},Cl={class:"option-name"},Hl=["id","min","max","name"],Ml=["id","name"],Ll=["id","name"],Dl=["onClick"],Bl=["id"],Gl=_l((()=>(0,o._)("option",{value:""},"既定値",-1))),xl=_l((()=>(0,o._)("option",{value:"true"},"ON",-1))),Wl=_l((()=>(0,o._)("option",{value:"false"},"OFF",-1))),Ul=[Gl,xl,Wl],Kl=["id"],Fl=_l((()=>(0,o._)("option",{value:""},"既定値",-1))),ql=["value"],jl=["onClick"],Vl={class:"dialog-main-buttons"};function zl(e,t,i,n,s,r){return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("dialog",vl,[Sl,(0,o._)("div",El,[(0,o._)("div",wl,[Il,(0,o._)("div",fl,(0,a.zw)(e.engine.defaultName),1)]),(0,o._)("div",yl,[bl,(0,o._)("div",Tl,(0,a.zw)(e.engine.author),1)]),(0,o._)("div",Al,[Nl,(0,o._)("div",Pl,(0,a.zw)(e.engine.path),1)]),(0,o._)("div",Rl,[kl,(0,o._)("input",Ol,null,512)]),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.options,(t=>((0,o.wg)(),(0,o.iD)("div",{key:t.name,class:"option"},[(0,o._)("div",Cl,(0,a.zw)(t.name),1),"spin"===t.type?((0,o.wg)(),(0,o.iD)("input",{key:0,id:t.inputId,class:"option-value-number",type:"number",min:t.min,max:t.max,step:"1",name:t.name},null,8,Hl)):(0,o.kq)("",!0),"string"===t.type?((0,o.wg)(),(0,o.iD)("input",{key:1,id:t.inputId,class:"option-value-text",type:"text",name:t.name},null,8,Ml)):(0,o.kq)("",!0),"filename"===t.type?((0,o.wg)(),(0,o.iD)("input",{key:2,id:t.inputId,class:"option-value-filename",type:"text",name:t.name},null,8,Ll)):(0,o.kq)("",!0),"filename"===t.type?((0,o.wg)(),(0,o.iD)("button",{key:3,class:"dialog-button",onClick:i=>e.selectFile(t.inputId)}," 選択 ",8,Dl)):(0,o.kq)("",!0),"check"===t.type?((0,o.wg)(),(0,o.iD)("select",{key:4,id:t.inputId,class:"option-value-check"},Ul,8,Bl)):(0,o.kq)("",!0),"combo"===t.type?((0,o.wg)(),(0,o.iD)("select",{key:5,id:t.inputId,class:"option-value-combo"},[Fl,((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(t.vars,(e=>((0,o.wg)(),(0,o.iD)("option",{key:e,value:e},(0,a.zw)(e),9,ql)))),128))],8,Kl)):(0,o.kq)("",!0),"button"===t.type?((0,o.wg)(),(0,o.iD)("button",{key:6,class:"dialog-button",onClick:i=>e.sendOption(t.name)}," 実行 ",8,jl)):(0,o.kq)("",!0)])))),128))]),(0,o._)("button",{class:"dialog-wide-button",onClick:t[0]||(t[0]=t=>e.reset())}," エンジンの既定値に戻す "),(0,o._)("div",Vl,[(0,o._)("button",{class:"dialog-button",onClick:t[1]||(t[1]=t=>e.ok())},(0,a.zw)(e.okButtonText),1),(0,o._)("button",{class:"dialog-button",onClick:t[2]||(t[2]=t=>e.cancel())},"キャンセル")])],512)])}var Zl=(0,o.aZ)({name:"USIEngineOptionDialog",props:{latestEngineSetting:{type:Object,required:!0},okButtonText:{type:String,required:!1,default:"OK"}},emits:["ok","cancel"],setup(e,t){const i=Bn(),n=(0,d.iH)(null),a=(0,d.iH)(null),s=e.latestEngineSetting;let r=(0,d.iH)(s);const l=(0,o.Fl)((()=>Object.values(r.value.options).sort(((e,t)=>{const i=e.name.startsWith("USI_"),n=t.name.startsWith("USI_");return i!==n?i?-1:1:e.name<t.name?-1:1})).map(((e,t)=>({...e,inputId:"usiEngineOptionDialogOption"+t,value:Ni(e)})))));i.retainBussyState(),(0,o.bv)((async()=>{go(n.value);try{r.value=await zi.getUSIEngineInfo(s.path),Ri(r.value,s),a.value.value=r.value.name;for(const e of l.value){const t=mo(e.inputId);t&&void 0!==e.value&&(t.value=e.value+"")}}catch(e){i.pushError(e),t.emit("cancel")}finally{i.releaseBussyState()}}));const c=async e=>{i.retainBussyState();try{const t=await zi.showSelectFileDialog(),n=mo(e);t&&n&&(n.value=t)}catch(t){i.pushError(t)}finally{i.releaseBussyState()}},h=async e=>{i.retainBussyState();try{await zi.sendUSISetOption(r.value.path,e)}catch(t){i.pushError(t)}finally{i.releaseBussyState()}},u=()=>{a.value.value=r.value.defaultName;for(const e of l.value){const t=mo(e.inputId);t&&(void 0!==r.value.options[e.name].default?t.value=r.value.options[e.name].default+"":t.value="")}},p=()=>{r.value.name=a.value.value;for(const e of l.value){const t=mo(e.inputId);t&&(r.value.options[e.name].value=t.value?"spin"===e.type?Xr(t):t.value:void 0)}t.emit("ok",r.value)},g=()=>{t.emit("cancel")};return{engine:r,dialog:n,engineNameInput:a,options:l,selectFile:c,sendOption:h,reset:u,ok:p,cancel:g}}});const Yl=(0,mi.Z)(Zl,[["render",zl],["__scopeId","data-v-01e76537"]]);var $l=Yl,Jl=(0,o.aZ)({name:"PlayerSelector",components:{ButtonIcon:qn,USIEngineOptionDialog:$l},props:{players:{type:Array,required:!0},playerUri:{type:String,required:!0},engineSettings:{type:String,required:!0},displayPonderState:{type:Boolean,default:!1},displayThreadState:{type:Boolean,default:!1},displayMultiPvState:{type:Boolean,default:!1}},emits:["select-player","update-engine-setting"],setup(e,t){const i=(0,d.iH)(null),n=(0,d.iH)(null),a=(0,o.Fl)((()=>{if(!wi(e.playerUri))return null;const t=new ki(e.engineSettings),i=t.getEngine(e.playerUri);return"true"===Ni(i.options[fi])?"ON":"OFF"})),s=(0,o.Fl)((()=>{if(!wi(e.playerUri))return null;const t=new ki(e.engineSettings),i=t.getEngine(e.playerUri),n=Ni(i.options[bi])||Ni(i.options[Ti]);return n})),r=(0,o.Fl)((()=>{if(!wi(e.playerUri))return null;const t=new ki(e.engineSettings),i=t.getEngine(e.playerUri),n=Ni(i.options[yi])||Ni(i.options[Ai]);return n})),l=(0,o.Fl)((()=>wi(e.playerUri))),c=()=>{if(wi(e.playerUri)){const t=new ki(e.engineSettings),i=t.getEngine(e.playerUri);n.value=i}},h=e=>{n.value=null,t.emit("update-engine-setting",e)},u=()=>{n.value=null},p=()=>{t.emit("select-player",i.value.value)};return{playerSelect:i,ponderState:a,threadState:s,multiPVState:r,isPlayerSettingEnabled:l,engineSettingDialog:n,onPlayerChange:p,openPlayerSetting:c,savePlayerSetting:h,closePlayerSetting:u,Icon:Wn}}});const Ql=(0,mi.Z)(Jl,[["render",ml],["__scopeId","data-v-7083fac1"]]);var Xl=Ql,ec=(0,o.aZ)({name:"GameDialog",components:{ButtonIcon:qn,PlayerSelector:Xl},setup(){const e=Bn(),t=(0,d.iH)(null),i=(0,d.iH)(null),n=(0,d.iH)(null),a=(0,d.iH)(null),s=(0,d.iH)(null),r=(0,d.iH)(null),l=(0,d.iH)(null),c=(0,d.iH)(null),h=(0,d.iH)(Wi()),u=(0,d.iH)(new ki),p=(0,d.iH)(""),g=(0,d.iH)("");e.retainBussyState(),(0,o.bv)((async()=>{try{h.value=await zi.loadGameSetting(),u.value=await zi.loadUSIEngineSetting(),p.value=h.value.black.uri,g.value=h.value.white.uri,go(t.value)}catch(i){e.pushError(i),e.closeModalDialog()}finally{e.releaseBussyState()}}));let m=!1;(0,o.ic)((()=>{m||(i.value.value=Math.floor(h.value.timeLimit.timeSeconds/3600),n.value.value=Math.floor(h.value.timeLimit.timeSeconds/60)%60,a.value.value=h.value.timeLimit.byoyomi,s.value.value=h.value.timeLimit.increment,r.value.value=void 0!==h.value.startPosition?h.value.startPosition:"current",l.value.checked=h.value.enableEngineTimeout,c.value.checked=h.value.humanIsFront,m=!0)}));const _=e=>{if(wi(e)){const t=u.value.getEngine(e);return{name:t.name,uri:e,usi:t}}return{name:"人",uri:Si}},v=()=>{const t={black:_(p.value),white:_(g.value),timeLimit:{timeSeconds:60*(60*Xr(i.value)+Xr(n.value)),byoyomi:Xr(a.value),increment:Xr(s.value)},startPosition:"current"!==r.value.value?r.value.value:void 0,enableEngineTimeout:l.value.checked,humanIsFront:c.value.checked},o=Ui(t);o?e.pushError(o):e.startGame(t)},S=()=>{e.closeModalDialog()},E=async t=>{const i=new ki(u.value.json);i.updateEngine(t),e.retainBussyState();try{await zi.saveUSIEngineSetting(i),u.value=i}catch(n){e.pushError(n)}finally{e.releaseBussyState()}},w=e=>{p.value=e},I=e=>{g.value=e},f=()=>{[p.value,g.value]=[g.value,p.value]},y=(0,o.Fl)((()=>[{name:"人",uri:Si},...u.value.engineList]));return{dialog:t,hours:i,minutes:n,byoyomi:a,increment:s,startPosition:r,enableEngineTimeout:l,humanIsFront:c,engineSettings:u,blackPlayerURI:p,whitePlayerURI:g,players:y,onStart:v,onCancel:S,onUpdatePlayerSetting:E,onSelectBlackPlayer:w,onSelectWhitePlayer:I,onSwapColor:f,Icon:Wn}}});const tc=(0,mi.Z)(ec,[["render",Qr],["__scopeId","data-v-c5c0e252"]]);var ic=tc;const nc=e=>((0,o.dD)("data-v-34690848"),e=e(),(0,o.Cn)(),e),oc={ref:"dialog",class:"root"},ac=nc((()=>(0,o._)("div",{class:"dialog-title"},"検討",-1))),sc={class:"dialog-form-area"},rc={class:"dialog-form-item"},lc={class:"dialog-main-buttons"};function cc(e,t,i,n,a,s){const r=(0,o.up)("PlayerSelector");return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("dialog",oc,[ac,(0,o._)("div",sc,[(0,o._)("div",rc,[(0,o.Wm)(r,{players:e.engines,"player-uri":e.engineURI,"engine-settings":e.engineSettings.json,"display-thread-state":!0,"display-multi-pv-state":!0,onUpdateEngineSetting:e.onUpdatePlayerSetting,onSelectPlayer:e.onSelectPlayer},null,8,["players","player-uri","engine-settings","onUpdateEngineSetting","onSelectPlayer"])])]),(0,o._)("div",lc,[(0,o._)("button",{class:"dialog-button",onClick:t[0]||(t[0]=t=>e.onStart())},"検討開始"),(0,o._)("button",{class:"dialog-button",onClick:t[1]||(t[1]=t=>e.onCancel())},"キャンセル")])],512)])}var dc=(0,o.aZ)({name:"ResearchDialog",components:{PlayerSelector:Xl},setup(){const e=Bn(),t=(0,d.iH)(null),i=(0,d.iH)(Ki()),n=(0,d.iH)(new ki),a=(0,d.iH)("");e.retainBussyState(),(0,o.bv)((async()=>{go(t.value);try{i.value=await zi.loadResearchSetting(),n.value=await zi.loadUSIEngineSetting(),a.value=i.value.usi?.uri||""}catch(o){e.pushError(o),e.closeModalDialog()}finally{e.releaseBussyState()}}));const s=(0,o.Fl)((()=>n.value.engineList)),r=()=>{if(!a.value||!n.value.hasEngine(a.value))return void e.pushError("エンジンを選択してください。");const t=n.value.getEngine(a.value),i={usi:t};e.startResearch(i)},l=()=>{e.closeModalDialog()},c=async t=>{const i=new ki(n.value.json);i.updateEngine(t),e.retainBussyState();try{await zi.saveUSIEngineSetting(i),n.value=i}catch(o){e.pushError(o)}finally{e.releaseBussyState()}},h=e=>{a.value=e};return{dialog:t,engineSettings:n,engineURI:a,engines:s,onStart:r,onCancel:l,onUpdatePlayerSetting:c,onSelectPlayer:h}}});const hc=(0,mi.Z)(dc,[["render",cc],["__scopeId","data-v-34690848"]]);var uc=hc;const pc=e=>((0,o.dD)("data-v-9ca1beda"),e=e(),(0,o.Cn)(),e),gc={ref:"dialog"},mc=pc((()=>(0,o._)("div",{class:"dialog-title"},"エンジン管理",-1))),_c={class:"dialog-form-area engine-list"},vc={key:0,class:"engine"},Sc=["value"],Ec={class:"engine-name"},wc=["onClick"],Ic=["onClick"],fc=["onClick"],yc={class:"dialog-main-buttons"};function bc(e,t,i,n,s,r){const l=(0,o.up)("USIEngineOptionDialog");return(0,o.wg)(),(0,o.iD)(o.HY,null,[(0,o._)("div",null,[(0,o._)("dialog",gc,[mc,(0,o._)("div",_c,[0===e.engines.length?((0,o.wg)(),(0,o.iD)("div",vc," エンジンが登録されていません。 ")):(0,o.kq)("",!0),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.engines,(t=>((0,o.wg)(),(0,o.iD)("div",{key:t.uri,class:"engine",value:t.uri},[(0,o._)("div",Ec,(0,a.zw)(t.name),1),(0,o._)("button",{onClick:i=>e.openOptions(t.uri)},"設定",8,wc),(0,o._)("button",{onClick:i=>e.duplicate(t.uri)},"複製",8,Ic),(0,o._)("button",{onClick:i=>e.remove(t.uri)},"削除",8,fc)],8,Sc)))),128))]),(0,o._)("button",{class:"dialog-wide-button",onClick:t[0]||(t[0]=t=>e.add())},"追加"),(0,o._)("div",yc,[(0,o._)("button",{class:"dialog-button",onClick:t[1]||(t[1]=t=>e.saveAndClose())}," 保存して閉じる "),(0,o._)("button",{class:"dialog-button",onClick:t[2]||(t[2]=t=>e.cancel())},"キャンセル")])],512)]),e.optionDialog?((0,o.wg)(),(0,o.j4)(l,{key:0,"latest-engine-setting":e.optionDialog,onOk:e.optionOk,onCancel:e.optionCancel},null,8,["latest-engine-setting","onOk","onCancel"])):(0,o.kq)("",!0)],64)}var Tc=(0,o.aZ)({name:"USIEngineManagementDialog",components:{USIEngineOptionDialog:$l},setup(){const e=Bn(),t=(0,d.iH)(null),i=(0,d.iH)(null),n=(0,d.iH)(new ki);e.retainBussyState(),(0,o.bv)((async()=>{go(t.value);try{n.value=await zi.loadUSIEngineSetting()}catch(i){e.pushError(i),e.closeModalDialog()}finally{e.releaseBussyState()}}));const a=async()=>{try{e.retainBussyState();const t=await zi.showSelectUSIEngineDialog();if(!t)return;n.value.addEngine(await zi.getUSIEngineInfo(t))}catch(t){e.pushError(t)}finally{e.releaseBussyState()}},s=e=>{n.value.removeEngine(e)},r=e=>{i.value=n.value.getEngine(e)},l=e=>{const t=n.value.getEngine(e),i=Pi(t);n.value.addEngine(i)},c=async()=>{try{e.retainBussyState(),await zi.saveUSIEngineSetting(n.value),e.closeModalDialog()}catch(t){e.pushError(t)}finally{e.releaseBussyState()}},h=()=>{e.closeModalDialog()},u=e=>{n.value.updateEngine(e),i.value=null},p=()=>{i.value=null},g=(0,o.Fl)((()=>n.value.engineList));return{optionDialog:i,dialog:t,engines:g,add:a,remove:s,openOptions:r,duplicate:l,saveAndClose:c,cancel:h,optionOk:u,optionCancel:p}}});const Ac=(0,mi.Z)(Tc,[["render",bc],["__scopeId","data-v-9ca1beda"]]);var Nc=Ac;const Pc=e=>((0,o.dD)("data-v-4393f78a"),e=e(),(0,o.Cn)(),e),Rc={ref:"dialog"},kc=Pc((()=>(0,o._)("div",{class:"dialog-title"},"アプリ設定",-1))),Oc={class:"dialog-form-area settings"},Cc={class:"section"},Hc=Pc((()=>(0,o._)("div",{class:"section-title"},"外観",-1))),Mc={class:"dialog-form-item"},Lc=Pc((()=>(0,o._)("div",{class:"dialog-form-item-label-wide"},"テーマ",-1))),Dc=["value"],Bc=["value"],Gc={class:"dialog-form-item"},xc=Pc((()=>(0,o._)("div",{class:"dialog-form-item-label-wide"},"駒画像",-1))),Wc=["value"],Uc=["value"],Kc={class:"dialog-form-item"},Fc=Pc((()=>(0,o._)("div",{class:"dialog-form-item-label-wide"},"盤画像",-1))),qc=["value"],jc=["value"],Vc={class:"dialog-form-item"},zc=Pc((()=>(0,o._)("div",{class:"dialog-form-item-label-wide"},"段・筋を表示",-1))),Zc=["checked"],Yc=Pc((()=>(0,o._)("hr",{class:"separator"},null,-1))),$c={class:"section"},Jc=Pc((()=>(0,o._)("div",{class:"section-title"},"音",-1))),Qc={class:"dialog-form-item"},Xc=Pc((()=>(0,o._)("div",{class:"dialog-form-item-label-wide"},"駒音の大きさ",-1))),ed=["value"],td=Pc((()=>(0,o._)("div",{class:"dialog-form-item-unit"},"%",-1))),id={class:"dialog-form-item"},nd=Pc((()=>(0,o._)("div",{class:"dialog-form-item-label-wide"},"時計音の大きさ",-1))),od=["value"],ad=Pc((()=>(0,o._)("div",{class:"dialog-form-item-unit"},"%",-1))),sd={class:"dialog-form-item"},rd=Pc((()=>(0,o._)("div",{class:"dialog-form-item-label-wide"},"時計音の高さ",-1))),ld=["value"],cd=Pc((()=>(0,o._)("div",{class:"dialog-form-item-unit"},"Hz (220 ~ 880)",-1))),dd={class:"dialog-form-item"},hd=Pc((()=>(0,o._)("div",{class:"dialog-form-item-label-wide"},"時計音の対象",-1))),ud=["value"],pd=Pc((()=>(0,o._)("option",{value:"all"},"全ての手番",-1))),gd=Pc((()=>(0,o._)("option",{value:"onlyUser"},"人の手番のみ",-1))),md=[pd,gd],_d=Pc((()=>(0,o._)("hr",{class:"separator"},null,-1))),vd={class:"section"},Sd=Pc((()=>(0,o._)("div",{class:"section-title"},"ファイル",-1))),Ed={class:"dialog-form-item"},wd=Pc((()=>(0,o._)("div",{class:"dialog-form-item-label-wide"},"改行文字",-1))),Id=["value"],fd=Pc((()=>(0,o._)("option",{value:"crlf"},"CR + LF (Windows)",-1))),yd=Pc((()=>(0,o._)("option",{value:"lf"},"LF (UNIX/Mac)",-1))),bd=Pc((()=>(0,o._)("option",{value:"cr"},"CR (90年代Mac)",-1))),Td=[fd,yd,bd],Ad=Pc((()=>(0,o._)("hr",{class:"separator"},null,-1))),Nd={class:"section"},Pd=Pc((()=>(0,o._)("div",{class:"section-title"},"評価値・期待勝率",-1))),Rd={class:"dialog-form-item"},kd=Pc((()=>(0,o._)("div",{class:"dialog-form-item-label-wide"},"勝率換算係数",-1))),Od=["value"],Cd=Pc((()=>(0,o._)("div",{class:"dialog-form-item-unit"},"(推奨: 600 から 1500 まで)",-1))),Hd={class:"dialog-form-item"},Md=Pc((()=>(0,o._)("div",{class:"dialog-form-item-label-wide"},"緩手の閾値",-1))),Ld=["value"],Dd=Pc((()=>(0,o._)("div",{class:"dialog-form-item-unit"},"%",-1))),Bd={class:"dialog-form-item"},Gd=Pc((()=>(0,o._)("div",{class:"dialog-form-item-label-wide"},"疑問手の閾値",-1))),xd=["value"],Wd=Pc((()=>(0,o._)("div",{class:"dialog-form-item-unit"},"%",-1))),Ud={class:"dialog-form-item"},Kd=Pc((()=>(0,o._)("div",{class:"dialog-form-item-label-wide"},"悪手の閾値",-1))),Fd=["value"],qd=Pc((()=>(0,o._)("div",{class:"dialog-form-item-unit"},"%",-1))),jd={class:"dialog-form-item"},Vd=Pc((()=>(0,o._)("div",{class:"dialog-form-item-label-wide"},"大悪手の閾値",-1))),zd=["value"],Zd=Pc((()=>(0,o._)("div",{class:"dialog-form-item-unit"},"%",-1))),Yd=Pc((()=>(0,o._)("hr",{class:"separator"},null,-1))),$d={class:"section"},Jd=Pc((()=>(0,o._)("div",{class:"section-title"},"開発者向け",-1))),Qd={class:"dialog-form-item"},Xd=Pc((()=>(0,o._)("div",{class:"dialog-form-item-label-wide"},"アプリログを出力",-1))),eh=["checked"],th={key:0,class:"dialog-form-item-unit"},ih={key:1,class:"dialog-form-item-unit"},nh={class:"dialog-form-item"},oh=Pc((()=>(0,o._)("div",{class:"dialog-form-item-label-wide"},"USI通信ログを出力",-1))),ah=["checked"],sh={key:0,class:"dialog-form-item-unit"},rh={key:1,class:"dialog-form-item-unit"},lh={class:"dialog-main-buttons"};function ch(e,t,i,n,s,r){return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("dialog",Rc,[kc,(0,o._)("div",Oc,[(0,o._)("div",Cc,[Hc,(0,o._)("div",Mc,[Lc,(0,o._)("select",{ref:"thema",value:e.appSetting.thema},[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.themaOptions,(e=>((0,o.wg)(),(0,o.iD)("option",{key:e.value,value:e.value},(0,a.zw)(e.name),9,Bc)))),128))],8,Dc)]),(0,o._)("div",Gc,[xc,(0,o._)("select",{ref:"pieceImage",value:e.appSetting.pieceImage},[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.pieceImageTypes,(e=>((0,o.wg)(),(0,o.iD)("option",{key:e.value,value:e.value},(0,a.zw)(e.name),9,Uc)))),128))],8,Wc)]),(0,o._)("div",Kc,[Fc,(0,o._)("select",{ref:"boardImage",value:e.appSetting.boardImage},[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.boardImageTypes,(e=>((0,o.wg)(),(0,o.iD)("option",{key:e.value,value:e.value},(0,a.zw)(e.name),9,jc)))),128))],8,qc)]),(0,o._)("div",Vc,[zc,(0,o._)("input",{ref:"displayBoardLabels",class:"toggle",checked:e.appSetting.boardLabelType!=e.BoardLabelType.NONE,type:"checkbox"},null,8,Zc)])]),Yc,(0,o._)("div",$c,[Jc,(0,o._)("div",Qc,[Xc,(0,o._)("input",{ref:"pieceVolume",value:e.appSetting.pieceVolume,type:"number",max:"100",min:"0"},null,8,ed),td]),(0,o._)("div",id,[nd,(0,o._)("input",{ref:"clockVolume",value:e.appSetting.clockVolume,type:"number",max:"100",min:"0"},null,8,od),ad]),(0,o._)("div",sd,[rd,(0,o._)("input",{ref:"clockPitch",value:e.appSetting.clockPitch,type:"number",max:"880",min:"220"},null,8,ld),cd]),(0,o._)("div",dd,[hd,(0,o._)("select",{ref:"clockSoundTarget",value:e.appSetting.clockSoundTarget},md,8,ud)])]),_d,(0,o._)("div",vd,[Sd,(0,o._)("div",Ed,[wd,(0,o._)("select",{ref:"returnCode",value:e.appSetting.returnCode},Td,8,Id)])]),Ad,(0,o._)("div",Nd,[Pd,(0,o._)("div",Rd,[kd,(0,o._)("input",{ref:"coefficientInSigmoid",value:e.appSetting.coefficientInSigmoid,type:"number",max:"10000",min:"1"},null,8,Od),Cd]),(0,o._)("div",Hd,[Md,(0,o._)("input",{ref:"badMoveLevelThreshold1",value:e.appSetting.badMoveLevelThreshold1,type:"number",max:"100",min:"0"},null,8,Ld),Dd]),(0,o._)("div",Bd,[Gd,(0,o._)("input",{ref:"badMoveLevelThreshold2",value:e.appSetting.badMoveLevelThreshold2,type:"number",max:"100",min:"0"},null,8,xd),Wd]),(0,o._)("div",Ud,[Kd,(0,o._)("input",{ref:"badMoveLevelThreshold3",value:e.appSetting.badMoveLevelThreshold3,type:"number",max:"100",min:"0"},null,8,Fd),qd]),(0,o._)("div",jd,[Vd,(0,o._)("input",{ref:"badMoveLevelThreshold4",value:e.appSetting.badMoveLevelThreshold4,type:"number",max:"100",min:"0"},null,8,zd),Zd])]),Yd,(0,o._)("div",$d,[Jd,(0,o._)("div",Qd,[Xd,(0,o._)("input",{ref:"enableAppLog",class:"toggle",checked:e.appSetting.enableAppLog,type:"checkbox"},null,8,eh),e.isNative?((0,o.wg)(),(0,o.iD)("div",th," （再起動後に反映） ")):(0,o.kq)("",!0),e.isNative?(0,o.kq)("",!0):((0,o.wg)(),(0,o.iD)("div",ih," （ブラウザ版では機能しません） "))]),(0,o._)("div",nh,[oh,(0,o._)("input",{ref:"enableUSILog",class:"toggle",checked:e.appSetting.enableUSILog,type:"checkbox"},null,8,ah),e.isNative?((0,o.wg)(),(0,o.iD)("div",sh," （再起動後に反映） ")):(0,o.kq)("",!0),e.isNative?(0,o.kq)("",!0):((0,o.wg)(),(0,o.iD)("div",rh," （ブラウザ版では機能しません） "))])])]),(0,o._)("div",lh,[(0,o._)("button",{class:"dialog-button",onClick:t[0]||(t[0]=t=>e.saveAndClose())}," 保存して閉じる "),(0,o._)("button",{class:"dialog-button",onClick:t[1]||(t[1]=t=>e.cancel())},"キャンセル")])],512)])}const dh={"\r\n":"crlf","\n":"lf","\r":"cr"},hh={crlf:"\r\n",lf:"\n",cr:"\r"};var uh=(0,o.aZ)({name:"AppSettingDialog",setup(){const e=Bn(),t=(0,d.iH)(null),i=(0,d.iH)(null),n=(0,d.iH)(null),a=(0,d.iH)(null),s=(0,d.iH)(null),r=(0,d.iH)(null),l=(0,d.iH)(null),c=(0,d.iH)(null),h=(0,d.iH)(null),u=(0,d.iH)(null),p=(0,d.iH)(null),g=(0,d.iH)(null),m=(0,d.iH)(null),_=(0,d.iH)(null),v=(0,d.iH)(null),S=(0,d.iH)(null),E=(0,d.iH)(null);(0,o.bv)((()=>{go(t.value)}));const w=async()=>{const t={thema:i.value.value,pieceImage:n.value.value,boardImage:a.value.value,boardLabelType:s.value.checked?si.STANDARD:si.NONE,pieceVolume:Xr(r.value),clockVolume:Xr(l.value),clockPitch:Xr(c.value),clockSoundTarget:h.value.value,returnCode:hh[u.value.value],coefficientInSigmoid:Xr(p.value),badMoveLevelThreshold1:Xr(g.value),badMoveLevelThreshold2:Xr(m.value),badMoveLevelThreshold3:Xr(_.value),badMoveLevelThreshold4:Xr(v.value),enableAppLog:S.value.checked,enableUSILog:E.value.checked};e.retainBussyState();try{await e.updateAppSetting(t),e.closeAppSettingDialog()}catch(o){e.pushError(o)}finally{e.releaseBussyState()}},I=()=>{e.closeAppSettingDialog()},f=(0,o.Fl)((()=>({...e.appSetting,returnCode:dh[e.appSetting.returnCode]}))),y=[{name:"標準（緑）",value:Ci.STANDARD},{name:"桜",value:Ci.CHERRY_BLOSSOM},{name:"ダーク",value:Ci.DARK}],b=[{name:"一文字駒",value:oi.HITOMOJI},{name:"一文字駒（ゴシック体）",value:oi.HITOMOJI_GOTHIC},{name:"一文字駒（ダーク）",value:oi.HITOMOJI_DARK},{name:"一文字駒（ゴシック体・ダーク）",value:oi.HITOMOJI_GOTHIC_DARK}],T=[{name:"木目（明るい）",value:ai.LIGHT},{name:"木目（暖かい）",value:ai.WARM},{name:"塩化ビニル",value:ai.RESIN},{name:"ダーク",value:ai.DARK}];return{BoardLabelType:si,dialog:t,thema:i,pieceImage:n,boardImage:a,displayBoardLabels:s,pieceVolume:r,clockVolume:l,clockPitch:c,clockSoundTarget:h,returnCode:u,coefficientInSigmoid:p,badMoveLevelThreshold1:g,badMoveLevelThreshold2:m,badMoveLevelThreshold3:_,badMoveLevelThreshold4:v,enableAppLog:S,enableUSILog:E,appSetting:f,themaOptions:y,pieceImageTypes:b,boardImageTypes:T,isNative:Zi(),saveAndClose:w,cancel:I}}});const ph=(0,mi.Z)(uh,[["render",ch],["__scopeId","data-v-4393f78a"]]);var gh=ph;const mh=e=>((0,o.dD)("data-v-4490b135"),e=e(),(0,o.Cn)(),e),_h={ref:"dialog"},vh={ref:"content"},Sh={class:"dialog-form-area"},Eh=mh((()=>(0,o._)("div",{class:"message"},"以下の棋譜(または局面)を取り込みます。",-1))),wh=mh((()=>(0,o._)("div",{class:"message"},"※KIF形式/CSA形式/SFENに対応しています。",-1))),Ih={key:0,class:"message"},fh=(0,o.Uk)(" ※テキストエリアに棋譜を貼り付けてください。"),yh=mh((()=>(0,o._)("br",null,null,-1))),bh=(0,o.Uk)(" ※インストールアプリ版では自動的に貼り付けられます。 "),Th=[fh,yh,bh],Ah={ref:"textarea"},Nh={class:"dialog-main-buttons"};function Ph(e,t,i,n,a,s){return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("dialog",_h,[(0,o._)("div",vh,[(0,o._)("div",Sh,[Eh,wh,e.isNative?(0,o.kq)("",!0):((0,o.wg)(),(0,o.iD)("div",Ih,Th)),(0,o._)("textarea",Ah,null,512)])],512),(0,o._)("div",Nh,[(0,o._)("button",{class:"dialog-button",onClick:t[0]||(t[0]=(...t)=>e.onOk&&e.onOk(...t))},"取り込む"),(0,o._)("button",{class:"dialog-button",onClick:t[1]||(t[1]=(...t)=>e.onCancel&&e.onCancel(...t))},"キャンセル")])],512)])}var Rh=(0,o.aZ)({name:"PasteDialog",setup(){const e=Bn(),t=(0,d.iH)(null),i=(0,d.iH)(null);e.retainBussyState(),(0,o.bv)((async()=>{try{go(t.value),Zi()&&(i.value.value=await navigator.clipboard.readText())}finally{e.releaseBussyState()}}));const n=()=>{const t=i.value.value;e.closeModalDialog(),t&&e.pasteRecord(t)},a=()=>{e.closeModalDialog()};return{dialog:t,textarea:i,onOk:n,onCancel:a,isNative:Zi()}}});const kh=(0,mi.Z)(Rh,[["render",Ph],["__scopeId","data-v-4490b135"]]);var Oh=kh;const Ch=e=>((0,o.dD)("data-v-71bd87cb"),e=e(),(0,o.Cn)(),e),Hh={ref:"dialog",class:"bussy"},Mh={class:"content"},Lh=Ch((()=>(0,o._)("div",{class:"message"},"処理中です。お待ち下さい。",-1)));function Dh(e,t,i,n,a,s){const r=(0,o.up)("ButtonIcon");return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("dialog",Hh,[(0,o._)("div",Mh,[(0,o.Wm)(r,{class:"icon",icon:e.Icon.BUSSY},null,8,["icon"]),Lh])],512)])}var Bh=(0,o.aZ)({name:"BussyMessage",components:{ButtonIcon:qn},setup(){const e=(0,d.iH)(null);return(0,o.bv)((()=>{go(e.value)})),{dialog:e,Icon:Wn}}});const Gh=(0,mi.Z)(Bh,[["render",Dh],["__scopeId","data-v-71bd87cb"]]);var xh=Gh;const Wh={ref:"dialog",class:"confirm"},Uh={class:"content"},Kh={class:"message"},Fh={class:"dialog-main-buttons"};function qh(e,t,i,n,s,r){const l=(0,o.up)("ButtonIcon");return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("dialog",Wh,[(0,o._)("div",Uh,[(0,o.Wm)(l,{class:"icon",icon:e.Icon.QUESTION},null,8,["icon"]),(0,o._)("div",Kh,(0,a.zw)(e.message),1)]),(0,o._)("div",Fh,[(0,o._)("button",{class:"dialog-button",onClick:t[0]||(t[0]=t=>e.onOk())},"OK"),(0,o._)("button",{class:"dialog-button",onClick:t[1]||(t[1]=t=>e.onClose())},"キャンセル")])],512)])}var jh=(0,o.aZ)({name:"InfoMessage",components:{ButtonIcon:qn},setup(){const e=Bn(),t=(0,d.iH)(null),i=(0,o.Fl)((()=>e.confirmation));(0,o.bv)((()=>{go(t.value)}));const n=()=>{e.confirmationOk()},a=()=>{e.confirmationCancel()};return{dialog:t,message:i,onOk:n,onClose:a,Icon:Wn}}});const Vh=(0,mi.Z)(jh,[["render",qh],["__scopeId","data-v-7ae26b4e"]]);var zh=Vh;const Zh={ref:"dialog",class:"info"},Yh={class:"content"},$h={class:"message"},Jh={class:"dialog-main-buttons"};function Qh(e,t,i,n,s,r){const l=(0,o.up)("ButtonIcon");return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("dialog",Zh,[(0,o._)("div",Yh,[(0,o.Wm)(l,{class:"icon",icon:e.Icon.INFO},null,8,["icon"]),(0,o._)("div",$h,(0,a.zw)(e.message),1)]),(0,o._)("div",Jh,[(0,o._)("button",{onClick:t[0]||(t[0]=t=>e.onClose())},"閉じる")])],512)])}var Xh=(0,o.aZ)({name:"InfoMessage",components:{ButtonIcon:qn},setup(){const e=Bn(),t=(0,d.iH)(null);(0,o.bv)((()=>{go(t.value)}));const i=(0,o.Fl)((()=>e.message)),n=()=>{e.dequeueMessage()};return{dialog:t,message:i,onClose:n,Icon:Wn}}});const eu=(0,mi.Z)(Xh,[["render",Qh],["__scopeId","data-v-2d54feb7"]]);var tu=eu;const iu={ref:"dialog",class:"error"},nu={class:"content"},ou={class:"items"},au={class:"notice"},su={class:"index"},ru={class:"message"},lu={class:"dialog-main-buttons"};function cu(e,t,i,n,s,r){const l=(0,o.up)("ButtonIcon");return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("dialog",iu,[(0,o._)("div",nu,[(0,o.Wm)(l,{class:"icon",icon:e.Icon.ERROR},null,8,["icon"]),(0,o._)("div",ou,[(0,o._)("div",au,(0,a.zw)(e.errors.length)+" 件のエラーが発生しました。 ",1),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.errors,(e=>((0,o.wg)(),(0,o.iD)("div",{key:e.index,class:"item"},[(0,o._)("p",su,(0,a.zw)(e.index+1)+" 件目",1),(0,o._)("p",ru,(0,a.zw)(e.message),1)])))),128))])]),(0,o._)("div",lu,[(0,o._)("button",{onClick:t[0]||(t[0]=t=>e.onClose())},"閉じる")])],512)])}var du=(0,o.aZ)({name:"ErrorMessage",components:{ButtonIcon:qn},setup(){const e=Bn(),t=(0,d.iH)(null);(0,o.bv)((()=>{go(t.value)}));const i=(0,o.Fl)((()=>e.errors.map(((e,t)=>({message:e.message,index:t}))))),n=()=>{e.clearErrors()};return{dialog:t,errors:i,onClose:n,Icon:Wn}}});const hu=(0,mi.Z)(du,[["render",cu],["__scopeId","data-v-1a5cd743"]]);var uu=hu;function pu(){const e=document.activeElement;return e instanceof HTMLTextAreaElement||e instanceof HTMLInputElement||e instanceof HTMLSelectElement}function gu(e,t){if(!pu())switch(e){case"ArrowUp":return t.onArrowUp;case"ArrowDown":return t.onArrowDown;case"ArrowLeft":return t.onArrowLeft;case"ArrowRight":return t.onArrowRight}}function mu(e){document.addEventListener("keydown",(t=>{const i=gu(t.key,e);i&&(t.preventDefault(),i())}))}const _u=e=>((0,o.dD)("data-v-155615cc"),e=e(),(0,o.Cn)(),e),vu={ref:"dialog",class:"root"},Su=_u((()=>(0,o._)("div",{class:"dialog-title"},"棋譜解析",-1))),Eu={class:"dialog-form-area"},wu=_u((()=>(0,o._)("div",null,"エンジン",-1))),Iu={class:"dialog-form-item"},fu={class:"dialog-form-area"},yu=_u((()=>(0,o._)("div",null,"開始条件",-1))),bu={class:"dialog-form-item"},Tu=["checked"],Au=["disabled","value"],Nu=_u((()=>(0,o._)("div",{class:"dialog-form-item-unit"},"手目から",-1))),Pu={class:"dialog-form-area"},Ru=_u((()=>(0,o._)("div",null,"終了条件",-1))),ku={class:"dialog-form-item"},Ou=["checked"],Cu=["disabled","value"],Hu=_u((()=>(0,o._)("div",{class:"dialog-form-item-unit"},"手目まで",-1))),Mu={class:"dialog-form-area"},Lu=_u((()=>(0,o._)("div",null,"局面ごとの終了条件",-1))),Du={class:"dialog-form-item"},Bu=["value"],Gu=_u((()=>(0,o._)("div",{class:"dialog-form-item-unit"},"秒まで",-1))),xu={class:"dialog-form-area"},Wu=_u((()=>(0,o._)("div",null,"出力設定",-1))),Uu={class:"dialog-form-item"},Ku=_u((()=>(0,o._)("div",{class:"dialog-item-label"},"指し手コメント:",-1))),Fu=["value"],qu=_u((()=>(0,o._)("option",{value:"none"},"出力しない",-1))),ju=_u((()=>(0,o._)("option",{value:"insert"},"前方に加筆する",-1))),Vu=_u((()=>(0,o._)("option",{value:"append"},"末尾に加筆する",-1))),zu=_u((()=>(0,o._)("option",{value:"overwrite"},"上書きする",-1))),Zu=[qu,ju,Vu,zu],Yu={class:"dialog-main-buttons"};function $u(e,t,i,n,a,s){const r=(0,o.up)("PlayerSelector");return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("dialog",vu,[Su,(0,o._)("div",Eu,[wu,(0,o._)("div",Iu,[(0,o.Wm)(r,{players:e.engines,"player-uri":e.engineURI,"engine-settings":e.engineSettings.json,"display-thread-state":!0,"display-multi-pv-state":!0,onUpdateEngineSetting:e.onUpdatePlayerSetting,onSelectPlayer:e.onSelectPlayer},null,8,["players","player-uri","engine-settings","onUpdateEngineSetting","onSelectPlayer"])])]),(0,o._)("div",fu,[yu,(0,o._)("div",bu,[(0,o._)("input",{ref:"enableStartNumber",class:"toggle",type:"checkbox",checked:e.defaultValues.enableStartNumber,onChange:t[0]||(t[0]=(...t)=>e.updateToggle&&e.updateToggle(...t))},null,40,Tu),(0,o._)("input",{ref:"startNumber",class:"small",type:"number",min:"1",step:"1",disabled:!e.defaultValues.enableStartNumber,value:e.defaultValues.startNumber},null,8,Au),Nu])]),(0,o._)("div",Pu,[Ru,(0,o._)("div",ku,[(0,o._)("input",{ref:"enableEndNumber",class:"toggle",type:"checkbox",checked:e.defaultValues.enableEndNumber,onChange:t[1]||(t[1]=(...t)=>e.updateToggle&&e.updateToggle(...t))},null,40,Ou),(0,o._)("input",{ref:"endNumber",class:"small",type:"number",min:"1",step:"1",disabled:!e.defaultValues.enableEndNumber,value:e.defaultValues.endNumber},null,8,Cu),Hu])]),(0,o._)("div",Mu,[Lu,(0,o._)("div",Du,[(0,o._)("input",{ref:"maxSecondsPerMove",class:"small",type:"number",min:"0",step:"1",value:e.defaultValues.maxSecondsPerMove},null,8,Bu),Gu])]),(0,o._)("div",xu,[Wu,(0,o._)("div",Uu,[Ku,(0,o._)("select",{ref:"commentBehavior",size:"1",value:e.defaultValues.commentBehavior},Zu,8,Fu)])]),(0,o._)("div",Yu,[(0,o._)("button",{class:"dialog-button",onClick:t[2]||(t[2]=t=>e.onStart())},"解析実行"),(0,o._)("button",{class:"dialog-button",onClick:t[3]||(t[3]=t=>e.onCancel())},"キャンセル")])],512)])}var Ju=(0,o.aZ)({name:"ResearchDialog",components:{PlayerSelector:Xl},setup(){const e=Bn(),t=(0,d.iH)(null),i=(0,d.iH)(null),n=(0,d.iH)(null),a=(0,d.iH)(null),s=(0,d.iH)(null),r=(0,d.iH)(null),l=(0,d.iH)(null),c=(0,d.iH)(Bi()),h=(0,d.iH)(new ki),u=(0,d.iH)("");e.retainBussyState(),(0,o.bv)((async()=>{go(t.value);try{c.value=await zi.loadAnalysisSetting(),h.value=await zi.loadUSIEngineSetting(),u.value=c.value.usi?.uri||""}catch(i){e.pushError(i),e.closeModalDialog()}finally{e.releaseBussyState()}}));const p=()=>{n.value.disabled=!i.value.checked,s.value.disabled=!a.value.checked},g=()=>{if(!u.value||!h.value.hasEngine(u.value))return void e.pushError("エンジンを選択してください。");const t=h.value.getEngine(u.value),o={usi:t,startCriteria:{enableNumber:i.value.checked,number:Xr(n.value)},endCriteria:{enableNumber:a.value.checked,number:Xr(s.value)},perMoveCriteria:{maxSeconds:Xr(r.value)},commentBehavior:l.value.value};e.startAnalysis(o)},m=()=>{e.closeModalDialog()},_=async t=>{const i=new ki(h.value.json);i.updateEngine(t),e.retainBussyState();try{await zi.saveUSIEngineSetting(i),h.value=i}catch(n){e.pushError(n)}finally{e.releaseBussyState()}},v=e=>{u.value=e},S=(0,o.Fl)((()=>h.value.engineList)),E=(0,o.Fl)((()=>({enableStartNumber:c.value.startCriteria.enableNumber,startNumber:c.value.startCriteria.number,enableEndNumber:c.value.endCriteria.enableNumber,endNumber:c.value.endCriteria.number,maxSecondsPerMove:c.value.perMoveCriteria.maxSeconds,commentBehavior:c.value.commentBehavior})));return{dialog:t,engineSettings:h,engineURI:u,enableStartNumber:i,startNumber:n,enableEndNumber:a,endNumber:s,maxSecondsPerMove:r,commentBehavior:l,engines:S,defaultValues:E,updateToggle:p,onStart:g,onCancel:m,onUpdatePlayerSetting:_,onSelectPlayer:v}}});const Qu=(0,mi.Z)(Ju,[["render",$u],["__scopeId","data-v-155615cc"]]);var Xu=Qu,ep=(0,o.aZ)({name:"App",components:{StandardLayout:ur,GameDialog:ic,ResearchDialog:uc,USIEngineManagementDialog:Nc,AppSettingDialog:gh,PasteDialog:Oh,BussyMessage:xh,ConfirmDialog:zh,InfoMessage:tu,ErrorMessage:uu,AnalysisDialog:Xu},setup(){const e=Bn(),t=(0,o.Fl)((()=>e.appSetting.thema)),i=(0,o.Fl)((()=>({game:e.appState===En.GAME_DIALOG,research:e.appState===En.RESEARCH_DIALOG,analysis:e.appState===En.ANALYSIS_DIALOG,usiEngineSetting:e.appState===En.USI_ENGINE_SETTING_DIALOG,appSetting:e.isAppSettingDialogVisible,paste:e.appState===En.PASTE_DIALOG,bussy:e.isBussy,confirm:void 0!==e.confirmation}))),n=(0,o.Fl)((()=>e.hasMessage)),a=(0,o.Fl)((()=>e.hasError));return(0,o.bv)((()=>{const t=document.getElementsByTagName("body")[0];t.addEventListener("copy",(t=>{e.copyRecordKIF(),t.preventDefault()})),t.addEventListener("paste",(t=>{e.showPasteDialog(),t.preventDefault()})),t.addEventListener("dragover",(e=>{e.preventDefault()})),t.addEventListener("drop",(t=>{if(t.dataTransfer&&t.dataTransfer.files[0]){const i=t.dataTransfer.files[0].path;e.openRecord(i)}t.preventDefault()})),mu({onArrowUp(){const t=e.record.current.number;e.changeMoveNumber(t-1)},onArrowDown(){const t=e.record.current.number;e.changeMoveNumber(t+1)},onArrowLeft(){e.changeMoveNumber(0)},onArrowRight(){e.changeMoveNumber(Number.MAX_SAFE_INTEGER)}})})),{thema:t,dialogVisibilities:i,hasMessage:n,hasErrors:a}}});const tp=(0,mi.Z)(ep,[["render",s],["__scopeId","data-v-6e2058ba"]]);var ip,np=tp;function op(){const e=Bn();ji.onSendError((t=>{e.pushError(t)})),ji.onMenuEvent((t=>{if(!e.isBussy)switch(t){case ip.NEW_RECORD:e.newRecord();break;case ip.OPEN_RECORD:e.openRecord();break;case ip.SAVE_RECORD:e.saveRecord({overwrite:!0});break;case ip.SAVE_RECORD_AS:e.saveRecord();break;case ip.COPY_RECORD:e.copyRecordKIF();break;case ip.COPY_RECORD_CSA:e.copyRecordCSA();break;case ip.COPY_RECORD_USI_BEFORE:e.copyRecordUSIBefore();break;case ip.COPY_RECORD_USI_ALL:e.copyRecordUSIAll();break;case ip.COPY_BOARD_SFEN:e.copyBoardSFEN();break;case ip.PASTE_RECORD:e.showPasteDialog();break;case ip.INSERT_INTERRUPT:e.insertSpecialMove(ze.INTERRUPT);break;case ip.INSERT_RESIGN:e.insertSpecialMove(ze.RESIGN);break;case ip.INSERT_DRAW:e.insertSpecialMove(ze.DRAW);break;case ip.INSERT_REPETITION_DRAW:e.insertSpecialMove(ze.REPETITION_DRAW);break;case ip.INSERT_MATE:e.insertSpecialMove(ze.MATE);break;case ip.INSERT_TIMEOUT:e.insertSpecialMove(ze.TIMEOUT);break;case ip.INSERT_FOUL_WIN:e.insertSpecialMove(ze.FOUL_WIN);break;case ip.INSERT_FOUL_LOSE:e.insertSpecialMove(ze.FOUL_LOSE);break;case ip.INSERT_ENTERING_OF_KING:e.insertSpecialMove(ze.ENTERING_OF_KING);break;case ip.INSERT_WIN_BY_DEFAULT:e.insertSpecialMove(ze.WIN_BY_DEFAULT);break;case ip.INSERT_LOSS_BY_DEFAULT:e.insertSpecialMove(ze.LOSS_BY_DEFAULT);break;case ip.REMOVE_RECORD_AFTER:e.removeRecordAfter();break;case ip.START_POSITION_EDITING:e.startPositionEditing();break;case ip.END_POSITION_EDITING:e.endPositionEditing();break;case ip.CHANGE_TURN:e.changeTurn();break;case ip.INIT_POSITION_STANDARD:e.initializePosition(ke.STANDARD);break;case ip.INIT_POSITION_HANDICAP_LANCE:e.initializePosition(ke.HANDICAP_LANCE);break;case ip.INIT_POSITION_HANDICAP_RIGHT_LANCE:e.initializePosition(ke.HANDICAP_RIGHT_LANCE);break;case ip.INIT_POSITION_HANDICAP_BISHOP:e.initializePosition(ke.HANDICAP_BISHOP);break;case ip.INIT_POSITION_HANDICAP_ROOK:e.initializePosition(ke.HANDICAP_ROOK);break;case ip.INIT_POSITION_HANDICAP_ROOK_LANCE:e.initializePosition(ke.HANDICAP_ROOK_LANCE);break;case ip.INIT_POSITION_HANDICAP_2PIECES:e.initializePosition(ke.HANDICAP_2PIECES);break;case ip.INIT_POSITION_HANDICAP_4PIECES:e.initializePosition(ke.HANDICAP_4PIECES);break;case ip.INIT_POSITION_HANDICAP_6PIECES:e.initializePosition(ke.HANDICAP_6PIECES);break;case ip.INIT_POSITION_HANDICAP_8PIECES:e.initializePosition(ke.HANDICAP_8PIECES);break;case ip.INIT_POSITION_TSUME_SHOGI:e.initializePosition(ke.TSUME_SHOGI);break;case ip.INIT_POSITION_TSUME_SHOGI_2KINGS:e.initializePosition(ke.TSUME_SHOGI_2KINGS);break;case ip.START_GAME:e.showGameDialog();break;case ip.STOP_GAME:e.stopGame();break;case ip.RESIGN:pn.resign();break;case ip.START_RESEARCH:e.showResearchDialog();break;case ip.STOP_RESEARCH:e.stopResearch();break;case ip.START_ANALYSIS:e.showAnalysisDialog();break;case ip.STOP_ANALYSIS:e.stopAnalysis();break;case ip.FLIP_BOARD:e.flipBoard();break;case ip.APP_SETTING_DIALOG:e.showAppSettingDialog();break;case ip.USI_ENGINE_SETTING_DIALOG:e.showUsiEngineManagementDialog();break}})),ji.onUSIBestMove(((e,t,i,n)=>{_n(e,t,i,n)})),ji.onUSIInfo(((t,i,n,o,a)=>{e.updateUSIInfo(t,i,n,o,JSON.parse(a))})),ji.onUSIPonderInfo(((t,i,n,o,a)=>{e.updateUSIPonderInfo(t,i,n,o,JSON.parse(a))})),(0,o.YP)((()=>[e.appState,e.isBussy]),(([e,t])=>{ji.updateMenuState(e,t)})),ji.updateMenuState(e.appState,e.isBussy)}(function(e){e["NEW_RECORD"]="newRecord",e["OPEN_RECORD"]="openRecord",e["SAVE_RECORD"]="saveRecord",e["SAVE_RECORD_AS"]="saveRecordAs",e["COPY_RECORD"]="copyRecord",e["COPY_RECORD_CSA"]="copyRecordCsa",e["COPY_RECORD_USI_BEFORE"]="copyRecordUsiBefore",e["COPY_RECORD_USI_ALL"]="copyRecordUsiAll",e["COPY_BOARD_SFEN"]="copyRecordSfen",e["PASTE_RECORD"]="pasteRecord",e["INSERT_INTERRUPT"]="insertInterrupt",e["INSERT_RESIGN"]="insertResign",e["INSERT_DRAW"]="insertDraw",e["INSERT_REPETITION_DRAW"]="insertRepetitionDraw",e["INSERT_MATE"]="insertMate",e["INSERT_TIMEOUT"]="insertTimeout",e["INSERT_FOUL_WIN"]="insertFoulWin",e["INSERT_FOUL_LOSE"]="insertFoulLose",e["INSERT_ENTERING_OF_KING"]="insertEnteringOfKing",e["INSERT_WIN_BY_DEFAULT"]="insertWinByDefault",e["INSERT_LOSS_BY_DEFAULT"]="insertLossByDefault",e["REMOVE_RECORD_AFTER"]="remvoeRecordAfter",e["START_POSITION_EDITING"]="startPositionEditing",e["END_POSITION_EDITING"]="endPositionEditing",e["CHANGE_TURN"]="changeTurn",e["INIT_POSITION_STANDARD"]="initPositionStandard",e["INIT_POSITION_HANDICAP_LANCE"]="initPositionHandicapLance",e["INIT_POSITION_HANDICAP_RIGHT_LANCE"]="initPositionHandicapRightLance",e["INIT_POSITION_HANDICAP_BISHOP"]="initPositionHandicapBishop",e["INIT_POSITION_HANDICAP_ROOK"]="initPositionHandicapRook",e["INIT_POSITION_HANDICAP_ROOK_LANCE"]="initPositionHandicapRookLance",e["INIT_POSITION_HANDICAP_2PIECES"]="initPositionHandicap2Pieces",e["INIT_POSITION_HANDICAP_4PIECES"]="initPositionHandicap4Pieces",e["INIT_POSITION_HANDICAP_6PIECES"]="initPositionHandicap6Pieces",e["INIT_POSITION_HANDICAP_8PIECES"]="initPositionHandicap8Pieces",e["INIT_POSITION_TSUME_SHOGI"]="initPositionTsumeShogi",e["INIT_POSITION_TSUME_SHOGI_2KINGS"]="initPositionTsumeShogi2Kings",e["START_RESEARCH"]="startResearch",e["STOP_RESEARCH"]="stopResearch",e["START_ANALYSIS"]="startAnalysis",e["STOP_ANALYSIS"]="stopAnalysis",e["START_GAME"]="startGame",e["STOP_GAME"]="stopGame",e["RESIGN"]="resign",e["FLIP_BOARD"]="flipBoard",e["APP_SETTING_DIALOG"]="appSetting",e["USI_ENGINE_SETTING_DIALOG"]="usiEngineSetting"})(ip||(ip={})),zi.log(Li.INFO,"start renderer process"),Us.kL.register(...Us.zX),op();const ap=Bn();Promise.allSettled([zi.loadAppSetting().then((e=>{ap.updateAppSetting(e)})).catch((e=>{ap.pushError(new Error("アプリ設定の読み込み中にエラーが発生しました :"+e))})),async function(){const e=await zi.getRecordPathFromProcArg();e&&ap.openRecord(e)}()]).finally((()=>{zi.log(Li.INFO,"mount app"),(0,n.ri)(np).mount("#app")}))},5832:function(){}},t={};function i(n){var o=t[n];if(void 0!==o)return o.exports;var a=t[n]={exports:{}};return e[n](a,a.exports,i),a.exports}i.m=e,function(){var e=[];i.O=function(t,n,o,a){if(!n){var s=1/0;for(d=0;d<e.length;d++){n=e[d][0],o=e[d][1],a=e[d][2];for(var r=!0,l=0;l<n.length;l++)(!1&a||s>=a)&&Object.keys(i.O).every((function(e){return i.O[e](n[l])}))?n.splice(l--,1):(r=!1,a<s&&(s=a));if(r){e.splice(d--,1);var c=o();void 0!==c&&(t=c)}}return t}a=a||0;for(var d=e.length;d>0&&e[d-1][2]>a;d--)e[d]=e[d-1];e[d]=[n,o,a]}}(),function(){i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,{a:t}),t}}(),function(){i.d=function(e,t){for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}}(),function(){i.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={826:0};i.O.j=function(t){return 0===e[t]};var t=function(t,n){var o,a,s=n[0],r=n[1],l=n[2],c=0;if(s.some((function(t){return 0!==e[t]}))){for(o in r)i.o(r,o)&&(i.m[o]=r[o]);if(l)var d=l(i)}for(t&&t(n);c<s.length;c++)a=s[c],i.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return i.O(d)},n=self["webpackChunkelectron_shogi"]=self["webpackChunkelectron_shogi"]||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))}();var n=i.O(void 0,[998],(function(){return i(739)}));n=i.O(n)})();
//# sourceMappingURL=index.0acaeb87.js.map