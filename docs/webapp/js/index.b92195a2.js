(function(){var e={8569:function(e,t,i){"use strict";i(1703);var n=i(9963),o=i(6252);function a(e,t,i,n,a,s){const r=(0,o.up)("StandardLayout"),c=(0,o.up)("GameDialog"),l=(0,o.up)("ResearchDialog"),u=(0,o.up)("USIEngineManagementDialog"),d=(0,o.up)("AppSettingDialog"),h=(0,o.up)("PasteDialog"),p=(0,o.up)("BussyMessage"),m=(0,o.up)("ConfirmDialog"),_=(0,o.up)("InfoMessage"),g=(0,o.up)("ErrorMessage");return(0,o.wg)(),(0,o.iD)(o.HY,null,[(0,o.Wm)(r,{class:"main"}),e.dialogVisibilities.game?((0,o.wg)(),(0,o.j4)(c,{key:0})):(0,o.kq)("",!0),e.dialogVisibilities.research?((0,o.wg)(),(0,o.j4)(l,{key:1})):(0,o.kq)("",!0),e.dialogVisibilities.usiEngineSetting?((0,o.wg)(),(0,o.j4)(u,{key:2})):(0,o.kq)("",!0),e.dialogVisibilities.appSetting?((0,o.wg)(),(0,o.j4)(d,{key:3})):(0,o.kq)("",!0),e.dialogVisibilities.paste?((0,o.wg)(),(0,o.j4)(h,{key:4})):(0,o.kq)("",!0),e.dialogVisibilities.bussy?((0,o.wg)(),(0,o.j4)(p,{key:5})):(0,o.kq)("",!0),e.dialogVisibilities.confirm?((0,o.wg)(),(0,o.j4)(m,{key:6})):(0,o.kq)("",!0),e.hasMessage?((0,o.wg)(),(0,o.j4)(_,{key:7})):(0,o.kq)("",!0),e.hasErrors?((0,o.wg)(),(0,o.j4)(g,{key:8})):(0,o.kq)("",!0)],64)}const s={class:"main"},r={ref:"topPane",class:"top-pane"};function c(e,t,i,n,a,c){const l=(0,o.up)("BoardPane"),u=(0,o.up)("RecordPane"),d=(0,o.up)("TabPane");return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("div",s,[(0,o._)("div",r,[(0,o.Wm)(l,{class:"top-left-pane","max-size":e.boardPaneMaxSize},null,8,["max-size"]),(0,o.Wm)(u,{class:"top-right-pane"})],512),(0,o.Wm)(d,{class:"bottom-pane",size:e.bottomPaneSize},null,8,["size"])])])}var l=i(2262);const u={class:"control top"},d=(0,o.Uk)(" 対局 "),h=(0,o.Uk)(" 中断 "),p=(0,o.Uk)(" 投了 "),m=(0,o.Uk)(" 検討 "),_=(0,o.Uk)(" 検討終了 "),g=(0,o.Uk)(" 局面編集 "),E=(0,o.Uk)(" 局面編集終了 "),S=(0,o.Uk)(" 手番変更 "),I={class:"control bottom"},v=["disabled"],f=(0,o.Uk)(" アプリ設定 "),T=["disabled"],O=(0,o.Uk)(" エンジン設定 "),w=(0,o.Uk)(" 盤面反転 "),A=["disabled"],N=(0,o.Uk)(" 棋譜貼り付け "),R=(0,o.Uk)(" 棋譜コピー "),P=["disabled"],y=(0,o.Uk)(" 指し手削除 ");function b(e,t,i,n,a,s){const r=(0,o.up)("ButtonIcon"),c=(0,o.up)("BoardView");return(0,o.wg)(),(0,o.iD)("div",null,[(0,o.Wm)(c,{"piece-image-type":e.pieceImageType,"board-image-type":e.boardImageType,"max-size":e.maxSize,position:e.position,"last-move":e.lastMove,flip:e.flip,"allow-move":e.allowMove,"allow-edit":e.allowEdit,"black-player-name":e.blackPlayerName,"white-player-name":e.whitePlayerName,"black-player-time-ms":e.blackPlayerTimeMs,"black-player-byoyomi":e.blackPlayerByoyomi,"white-player-time-ms":e.whitePlayerTimeMs,"white-player-byoyomi":e.whitePlayerByoyomi,onMove:e.onMove,onEdit:e.onEdit},{"right-control":(0,o.w5)((()=>[(0,o._)("div",u,[e.controlStates.game?((0,o.wg)(),(0,o.iD)("button",{key:0,onClick:t[0]||(t[0]=(...t)=>e.onGame&&e.onGame(...t))},[(0,o.Wm)(r,{class:"icon",icon:"game"}),d])):(0,o.kq)("",!0),e.controlStates.stop?((0,o.wg)(),(0,o.iD)("button",{key:1,onClick:t[1]||(t[1]=(...t)=>e.onStop&&e.onStop(...t))},[(0,o.Wm)(r,{class:"icon",icon:"stop"}),h])):(0,o.kq)("",!0),e.controlStates.resign?((0,o.wg)(),(0,o.iD)("button",{key:2,onClick:t[2]||(t[2]=(...t)=>e.onResign&&e.onResign(...t))},[(0,o.Wm)(r,{class:"icon",icon:"resign"}),p])):(0,o.kq)("",!0),e.controlStates.research?((0,o.wg)(),(0,o.iD)("button",{key:3,onClick:t[3]||(t[3]=(...t)=>e.onResearch&&e.onResearch(...t))},[(0,o.Wm)(r,{class:"icon",icon:"research"}),m])):(0,o.kq)("",!0),e.controlStates.endResearch?((0,o.wg)(),(0,o.iD)("button",{key:4,onClick:t[4]||(t[4]=(...t)=>e.onEndResearch&&e.onEndResearch(...t))},[(0,o.Wm)(r,{class:"icon",icon:"end"}),_])):(0,o.kq)("",!0),e.controlStates.startEditPosition?((0,o.wg)(),(0,o.iD)("button",{key:5,onClick:t[5]||(t[5]=(...t)=>e.onStartEditPosition&&e.onStartEditPosition(...t))},[(0,o.Wm)(r,{class:"icon",icon:"edit"}),g])):(0,o.kq)("",!0),e.controlStates.endEditPosition?((0,o.wg)(),(0,o.iD)("button",{key:6,onClick:t[6]||(t[6]=(...t)=>e.onEndEditPosition&&e.onEndEditPosition(...t))},[(0,o.Wm)(r,{class:"icon",icon:"check"}),E])):(0,o.kq)("",!0),e.controlStates.initPosition?((0,o.wg)(),(0,o.iD)("button",{key:7,onClick:t[7]||(t[7]=(...t)=>e.onChangeTurn&&e.onChangeTurn(...t))},[(0,o.Wm)(r,{class:"icon",icon:"swap"}),S])):(0,o.kq)("",!0),e.controlStates.initPosition?((0,o.wg)(),(0,o.iD)("button",{key:8,onClick:t[8]||(t[8]=(...t)=>e.onInitPositionStandard&&e.onInitPositionStandard(...t))}," 平手 ")):(0,o.kq)("",!0),e.controlStates.initPosition?((0,o.wg)(),(0,o.iD)("button",{key:9,onClick:t[9]||(t[9]=(...t)=>e.onInitPositionTsumeShogi&&e.onInitPositionTsumeShogi(...t))}," 詰将棋 ")):(0,o.kq)("",!0)])])),"left-control":(0,o.w5)((()=>[(0,o._)("div",I,[(0,o._)("button",{disabled:!e.controlStates.appSettings,onClick:t[10]||(t[10]=(...t)=>e.onOpenAppSettings&&e.onOpenAppSettings(...t))},[(0,o.Wm)(r,{class:"icon",icon:"settings"}),f],8,v),(0,o._)("button",{disabled:!e.controlStates.engineSettings,onClick:t[11]||(t[11]=(...t)=>e.onOpenEngineSettings&&e.onOpenEngineSettings(...t))},[(0,o.Wm)(r,{class:"icon",icon:"engineSettings"}),O],8,T),(0,o._)("button",{onClick:t[12]||(t[12]=(...t)=>e.onFlip&&e.onFlip(...t))},[(0,o.Wm)(r,{class:"icon",icon:"flip"}),w]),(0,o._)("button",{disabled:!e.controlStates.paste,onClick:t[13]||(t[13]=(...t)=>e.onPaste&&e.onPaste(...t))},[(0,o.Wm)(r,{class:"icon",icon:"paste"}),N],8,A),(0,o._)("button",{onClick:t[14]||(t[14]=(...t)=>e.onCopy&&e.onCopy(...t))},[(0,o.Wm)(r,{class:"icon",icon:"copy"}),R]),(0,o._)("button",{disabled:!e.controlStates.removeAfter,onClick:t[15]||(t[15]=(...t)=>e.onRemoveAfter&&e.onRemoveAfter(...t))},[(0,o.Wm)(r,{class:"icon",icon:"delete"}),y],8,P)])])),_:1},8,["piece-image-type","board-image-type","max-size","position","last-move","flip","allow-move","allow-edit","black-player-name","white-player-name","black-player-time-ms","black-player-byoyomi","white-player-time-ms","white-player-byoyomi","onMove","onEdit"])])}var H=i(3577);const k=["src"],C={class:"player-name-text"},D={class:"clock-text"},L={class:"player-name-text"},M={class:"clock-text"},G=["src"],B=["onClick","onContextmenu"],x=["src"],U=["onClick"],W=["src"],K=["onClick"],F=["src"],q=["src"];function V(e,t,i,n,a,s){return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("div",{class:"frame",style:(0,H.j5)(e.layout.frame.style),onClick:t[2]||(t[2]=t=>e.clickFrame())},[(0,o._)("div",{class:"board",style:(0,H.j5)(e.layout.board.style)},[(0,o._)("img",{class:"board-image",src:e.layout.board.imagePath},null,8,k)],4),(0,o._)("div",{class:(0,H.C_)(["player-name",{active:"black"==e.position.color}]),style:(0,H.j5)(e.layout.blackPlayerName.style)},[(0,o._)("span",C,"▲"+(0,H.zw)(e.blackPlayerName),1)],6),(0,o._)("div",{class:(0,H.C_)(["clock",e.blackPlayerTimeSeverity]),style:(0,H.j5)(e.layout.blackClock.style)},[(0,o._)("span",D,(0,H.zw)(e.blackPlayerTimeText),1)],6),(0,o._)("div",{class:(0,H.C_)(["player-name",{active:"white"==e.position.color}]),style:(0,H.j5)(e.layout.whitePlayerName.style)},[(0,o._)("span",L,"△"+(0,H.zw)(e.whitePlayerName),1)],6),(0,o._)("div",{class:(0,H.C_)(["clock",e.whitePlayerTimeSeverity]),style:(0,H.j5)(e.layout.whiteClock.style)},[(0,o._)("span",M,(0,H.zw)(e.whitePlayerTimeText),1)],6),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.layout.square,(e=>((0,o.wg)(),(0,o.iD)("div",{key:e.id,class:"square",style:(0,H.j5)(e.backgroundStyle)},null,4)))),128)),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.layout.piece,(e=>((0,o.wg)(),(0,o.iD)("div",{key:e.id,class:"piece",style:(0,H.j5)(e.style)},[(0,o._)("img",{class:"piece-image",src:e.imagePath},null,8,G)],4)))),128)),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.layout.square,(t=>((0,o.wg)(),(0,o.iD)("div",{key:t.id,class:"square",style:(0,H.j5)(t.style),onClick:i=>e.clickSquare(i,t.file,t.rank),onContextmenu:i=>e.clickSquareR(i,t.file,t.rank)},null,44,B)))),128)),(0,o._)("div",{class:"hand",style:(0,H.j5)(e.layout.blackHand.style)},[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.layout.blackHand.pointers,(e=>((0,o.wg)(),(0,o.iD)("div",{key:e.id,class:"hand-pointer",style:(0,H.j5)(e.backgroundStyle)},null,4)))),128)),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.layout.blackHand.pieces,(e=>((0,o.wg)(),(0,o.iD)("div",{key:e.id,class:"piece",style:(0,H.j5)(e.style)},[(0,o._)("img",{class:"piece-image",src:e.imagePath},null,8,x)],4)))),128)),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.layout.blackHand.pointers,(t=>((0,o.wg)(),(0,o.iD)("div",{key:t.id,class:"hand-pointer",style:(0,H.j5)(t.style),onClick:i=>e.clickHand(i,"black",t.type)},null,12,U)))),128))],4),(0,o._)("div",{class:"hand",style:(0,H.j5)(e.layout.whiteHand.style)},[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.layout.whiteHand.pointers,(e=>((0,o.wg)(),(0,o.iD)("div",{key:e.id,class:"hand-pointer",style:(0,H.j5)(e.backgroundStyle)},null,4)))),128)),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.layout.whiteHand.pieces,(e=>((0,o.wg)(),(0,o.iD)("div",{key:e.id,class:"piece",style:(0,H.j5)(e.style)},[(0,o._)("img",{class:"piece-image",src:e.imagePath},null,8,W)],4)))),128)),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.layout.whiteHand.pointers,(t=>((0,o.wg)(),(0,o.iD)("div",{key:t.id,class:"hand-pointer",style:(0,H.j5)(t.style),onClick:i=>e.clickHand(i,"white",t.type)},null,12,K)))),128))],4),e.layout.promotion?((0,o.wg)(),(0,o.iD)("div",{key:0,class:"promotion-selector",style:(0,H.j5)(e.layout.promotion.style)},[(0,o._)("div",{class:"select-button promote",onClick:t[0]||(t[0]=t=>e.clickPromote(t))},[(0,o._)("img",{class:"piece-image",src:e.layout.promotion.promoteImagePath},null,8,F)]),(0,o._)("div",{class:"select-button not-promote",onClick:t[1]||(t[1]=t=>e.clickNotPromote(t))},[(0,o._)("img",{class:"piece-image",src:e.layout.promotion.notPromoteImagePath},null,8,q)])],4)):(0,o.kq)("",!0),(0,o._)("div",{class:"turn",style:(0,H.j5)(e.layout.turn.style)},"手番",4),(0,o._)("div",{style:(0,H.j5)(e.layout.control.left.style)},[(0,o.WI)(e.$slots,"left-control",{},void 0,!0)],4),(0,o._)("div",{style:(0,H.j5)(e.layout.control.right.style)},[(0,o.WI)(e.$slots,"right-control",{},void 0,!0)],4)],4)])}i(7686),i(4506);var Y,j,Z=i(2482);function z(e){return e===Y.BLACK?Y.WHITE:Y.BLACK}function J(e){return e===Y.BLACK?"b":"w"}function $(e){return"b"===e||"w"===e}function X(e){return"b"===e?Y.BLACK:Y.WHITE}(function(e){e["BLACK"]="black",e["WHITE"]="white"})(Y||(Y={})),function(e){e["PAWN"]="pawn",e["LANCE"]="lance",e["KNIGHT"]="knight",e["SILVER"]="silver",e["GOLD"]="gold",e["BISHOP"]="bishop",e["ROOK"]="rook",e["KING"]="king",e["PROM_PAWN"]="promPawn",e["PROM_LANCE"]="promLance",e["PROM_KNIGHT"]="promKnight",e["PROM_SILVER"]="promSilver",e["HORSE"]="horse",e["DRAGON"]="dragon"}(j||(j={}));const Q={pawn:"歩",lance:"香",knight:"桂",silver:"銀",gold:"金",bishop:"角",rook:"飛",king:"玉",promPawn:"と",promLance:"成香",promKnight:"成桂",promSilver:"成銀",horse:"馬",dragon:"竜"};function ee(e){const t=Q[e];return t||""}j.PAWN,j.LANCE,j.KNIGHT,j.SILVER,j.GOLD,j.BISHOP,j.ROOK,j.KING,j.PROM_PAWN,j.PROM_LANCE,j.PROM_KNIGHT,j.PROM_SILVER,j.HORSE,j.DRAGON;const te=[j.PAWN,j.LANCE,j.KNIGHT,j.SILVER,j.GOLD,j.BISHOP,j.ROOK],ie={pawn:!0,lance:!0,knight:!0,silver:!0,gold:!1,bishop:!0,rook:!0,king:!1,promPawn:!1,promLance:!1,promKnight:!1,promSilver:!1,horse:!1,dragon:!1},ne={pawn:j.PROM_PAWN,lance:j.PROM_LANCE,knight:j.PROM_KNIGHT,silver:j.PROM_SILVER,bishop:j.HORSE,rook:j.DRAGON},oe={promPawn:j.PAWN,promLance:j.LANCE,promKnight:j.KNIGHT,promSilver:j.SILVER,horse:j.BISHOP,dragon:j.ROOK},ae={pawn:"P",lance:"L",knight:"N",silver:"S",gold:"G",bishop:"B",rook:"R",king:"K",promPawn:"+P",promLance:"+L",promKnight:"+N",promSilver:"+S",horse:"+B",dragon:"+R"};function se(e){return ae[e]}const re={pawn:"p",lance:"l",knight:"n",silver:"s",gold:"g",bishop:"b",rook:"r",king:"k",promPawn:"+p",promLance:"+l",promKnight:"+n",promSilver:"+s",horse:"+b",dragon:"+r"},ce={P:j.PAWN,L:j.LANCE,N:j.KNIGHT,S:j.SILVER,G:j.GOLD,B:j.BISHOP,R:j.ROOK,K:j.KING,"+P":j.PROM_PAWN,"+L":j.PROM_LANCE,"+N":j.PROM_KNIGHT,"+S":j.PROM_SILVER,"+B":j.HORSE,"+R":j.DRAGON,p:j.PAWN,l:j.LANCE,n:j.KNIGHT,s:j.SILVER,g:j.GOLD,b:j.BISHOP,r:j.ROOK,k:j.KING,"+p":j.PROM_PAWN,"+l":j.PROM_LANCE,"+n":j.PROM_KNIGHT,"+s":j.PROM_SILVER,"+b":j.HORSE,"+r":j.DRAGON},le={P:Y.BLACK,L:Y.BLACK,N:Y.BLACK,S:Y.BLACK,G:Y.BLACK,B:Y.BLACK,R:Y.BLACK,K:Y.BLACK,"+P":Y.BLACK,"+L":Y.BLACK,"+N":Y.BLACK,"+S":Y.BLACK,"+B":Y.BLACK,"+R":Y.BLACK,p:Y.WHITE,l:Y.WHITE,n:Y.WHITE,s:Y.WHITE,g:Y.WHITE,b:Y.WHITE,r:Y.WHITE,k:Y.WHITE,"+p":Y.WHITE,"+l":Y.WHITE,"+n":Y.WHITE,"+s":Y.WHITE,"+b":Y.WHITE,"+r":Y.WHITE},ue=new Map;ue.set(j.PAWN,{type:j.PROM_PAWN,reverseColor:!1}),ue.set(j.LANCE,{type:j.PROM_LANCE,reverseColor:!1}),ue.set(j.KNIGHT,{type:j.PROM_KNIGHT,reverseColor:!1}),ue.set(j.SILVER,{type:j.PROM_SILVER,reverseColor:!1}),ue.set(j.GOLD,{type:j.GOLD,reverseColor:!0}),ue.set(j.BISHOP,{type:j.HORSE,reverseColor:!1}),ue.set(j.ROOK,{type:j.DRAGON,reverseColor:!1}),ue.set(j.KING,{type:j.KING,reverseColor:!0}),ue.set(j.PROM_PAWN,{type:j.PAWN,reverseColor:!0}),ue.set(j.PROM_LANCE,{type:j.LANCE,reverseColor:!0}),ue.set(j.PROM_KNIGHT,{type:j.KNIGHT,reverseColor:!0}),ue.set(j.PROM_SILVER,{type:j.SILVER,reverseColor:!0}),ue.set(j.HORSE,{type:j.BISHOP,reverseColor:!0}),ue.set(j.DRAGON,{type:j.ROOK,reverseColor:!0});class de{constructor(e,t){(0,Z.Z)(this,"color",void 0),(0,Z.Z)(this,"type",void 0),this.type=t,this.color=e}black(){return this.withColor(Y.BLACK)}white(){return this.withColor(Y.WHITE)}withColor(e){return new de(e,this.type)}equals(e){return this.type===e.type&&this.color===e.color}promoted(){const e=ne[this.type];return new de(this.color,e||this.type)}unpromoted(){const e=oe[this.type];return new de(this.color,e||this.type)}isPromotable(){return!!ie[this.type]}rotate(){const e=ue.get(this.type),t=new de(this.color,e?e.type:this.type);return e&&e.reverseColor&&(t.color=z(this.color)),t}get id(){return this.color+"_"+this.type}get sfen(){switch(this.color){default:case Y.BLACK:return ae[this.type];case Y.WHITE:return re[this.type]}}static isValidSFEN(e){return!!ce[e]}static newBySFEN(e){const t=ce[e];if(!t)return null;const i=le[e];return i?new de(i,t):null}}var he;(function(e){e["UP"]="up",e["DOWN"]="down",e["LEFT"]="left",e["RIGHT"]="right",e["LEFT_UP"]="left_up",e["RIGHT_UP"]="right_up",e["LEFT_DOWN"]="left_down",e["RIGHT_DOWN"]="right_down",e["LEFT_UP_KNIGHT"]="left_up_knight",e["RIGHT_UP_KNIGHT"]="right_up_knight",e["LEFT_DOWN_KNIGHT"]="left_down_knight",e["RIGHT_DOWN_KNIGHT"]="right_down_knight"})(he||(he={}));const pe={up:he.DOWN,down:he.UP,left:he.RIGHT,right:he.LEFT,left_up:he.RIGHT_DOWN,right_up:he.LEFT_DOWN,left_down:he.RIGHT_UP,right_down:he.LEFT_UP,left_up_knight:he.RIGHT_DOWN_KNIGHT,right_up_knight:he.LEFT_DOWN_KNIGHT,left_down_knight:he.RIGHT_UP_KNIGHT,right_down_knight:he.LEFT_UP_KNIGHT};function me(e){return pe[e]}const _e=[he.UP,he.DOWN,he.LEFT,he.RIGHT,he.LEFT_UP,he.RIGHT_UP,he.LEFT_DOWN,he.RIGHT_DOWN,he.LEFT_UP_KNIGHT,he.RIGHT_UP_KNIGHT,he.LEFT_DOWN_KNIGHT,he.RIGHT_DOWN_KNIGHT];var ge;(function(e){e["SHORT"]="short",e["LONG"]="long"})(ge||(ge={}));const Ee={black:{pawn:{up:ge.SHORT},lance:{up:ge.LONG},knight:{left_up_knight:ge.SHORT,right_up_knight:ge.SHORT},silver:{left_up:ge.SHORT,up:ge.SHORT,right_up:ge.SHORT,left_down:ge.SHORT,right_down:ge.SHORT},gold:{left_up:ge.SHORT,up:ge.SHORT,right_up:ge.SHORT,left:ge.SHORT,right:ge.SHORT,down:ge.SHORT},bishop:{left_up:ge.LONG,right_up:ge.LONG,left_down:ge.LONG,right_down:ge.LONG},rook:{up:ge.LONG,left:ge.LONG,right:ge.LONG,down:ge.LONG},king:{left_down:ge.SHORT,right_down:ge.SHORT,left_up:ge.SHORT,right_up:ge.SHORT,down:ge.SHORT,left:ge.SHORT,right:ge.SHORT,up:ge.SHORT},promPawn:{left_up:ge.SHORT,up:ge.SHORT,right_up:ge.SHORT,left:ge.SHORT,right:ge.SHORT,down:ge.SHORT},promLance:{left_up:ge.SHORT,up:ge.SHORT,right_up:ge.SHORT,left:ge.SHORT,right:ge.SHORT,down:ge.SHORT},promKnight:{left_up:ge.SHORT,up:ge.SHORT,right_up:ge.SHORT,left:ge.SHORT,right:ge.SHORT,down:ge.SHORT},promSilver:{left_up:ge.SHORT,up:ge.SHORT,right_up:ge.SHORT,left:ge.SHORT,right:ge.SHORT,down:ge.SHORT},horse:{left_up:ge.LONG,right_up:ge.LONG,left_down:ge.LONG,right_down:ge.LONG,up:ge.SHORT,left:ge.SHORT,right:ge.SHORT,down:ge.SHORT},dragon:{up:ge.LONG,left:ge.LONG,right:ge.LONG,down:ge.LONG,left_up:ge.SHORT,right_up:ge.SHORT,left_down:ge.SHORT,right_down:ge.SHORT}},white:{pawn:{down:ge.SHORT},lance:{down:ge.LONG},knight:{left_down_knight:ge.SHORT,right_down_knight:ge.SHORT},silver:{left_down:ge.SHORT,down:ge.SHORT,right_down:ge.SHORT,left_up:ge.SHORT,right_up:ge.SHORT},gold:{left_down:ge.SHORT,down:ge.SHORT,right_down:ge.SHORT,left:ge.SHORT,right:ge.SHORT,up:ge.SHORT},bishop:{left_down:ge.LONG,right_down:ge.LONG,left_up:ge.LONG,right_up:ge.LONG},rook:{down:ge.LONG,left:ge.LONG,right:ge.LONG,up:ge.LONG},king:{left_down:ge.SHORT,right_down:ge.SHORT,left_up:ge.SHORT,right_up:ge.SHORT,down:ge.SHORT,left:ge.SHORT,right:ge.SHORT,up:ge.SHORT},promPawn:{left_down:ge.SHORT,down:ge.SHORT,right_down:ge.SHORT,left:ge.SHORT,right:ge.SHORT,up:ge.SHORT},promLance:{left_down:ge.SHORT,down:ge.SHORT,right_down:ge.SHORT,left:ge.SHORT,right:ge.SHORT,up:ge.SHORT},promKnight:{left_down:ge.SHORT,down:ge.SHORT,right_down:ge.SHORT,left:ge.SHORT,right:ge.SHORT,up:ge.SHORT},promSilver:{left_down:ge.SHORT,down:ge.SHORT,right_down:ge.SHORT,left:ge.SHORT,right:ge.SHORT,up:ge.SHORT},horse:{left_down:ge.LONG,right_down:ge.LONG,left_up:ge.LONG,right_up:ge.LONG,down:ge.SHORT,left:ge.SHORT,right:ge.SHORT,up:ge.SHORT},dragon:{down:ge.LONG,left:ge.LONG,right:ge.LONG,up:ge.LONG,left_down:ge.SHORT,right_down:ge.SHORT,left_up:ge.SHORT,right_up:ge.SHORT}}};function Se(e){return Object.keys(Ee[e.color][e.type])}function Ie(e,t){return Ee[e.color][e.type][t]}const ve={up:{x:0,y:-1},down:{x:0,y:1},left:{x:-1,y:0},right:{x:1,y:0},left_up:{x:-1,y:-1},right_up:{x:1,y:-1},left_down:{x:-1,y:1},right_down:{x:1,y:1},left_up_knight:{x:-1,y:-2},right_up_knight:{x:1,y:-2},left_down_knight:{x:-1,y:2},right_down_knight:{x:1,y:2}};function fe(e,t){if(1===e&&-2===t)return{direction:he.RIGHT_UP_KNIGHT,distance:1,ok:!0};if(-1===e&&-2===t)return{direction:he.LEFT_UP_KNIGHT,distance:1,ok:!0};if(1===e&&2===t)return{direction:he.RIGHT_DOWN_KNIGHT,distance:1,ok:!0};if(-1===e&&2===t)return{direction:he.LEFT_DOWN_KNIGHT,distance:1,ok:!0};if(0!==e&&0!==t&&Math.abs(e)!==Math.abs(t))return{direction:"",distance:0,ok:!1};let i=e,n=t,o=0;return 0!==i&&(o=Math.abs(i),i/=o),0!==n&&(o=Math.abs(n),n/=o),-1===i&&-1===n?{direction:he.LEFT_UP,distance:o,ok:!0}:0===i&&-1===n?{direction:he.UP,distance:o,ok:!0}:1===i&&-1===n?{direction:he.RIGHT_UP,distance:o,ok:!0}:-1===i&&0===n?{direction:he.LEFT,distance:o,ok:!0}:1===i&&0===n?{direction:he.RIGHT,distance:o,ok:!0}:-1===i&&1===n?{direction:he.LEFT_DOWN,distance:o,ok:!0}:0===i&&1===n?{direction:he.DOWN,distance:o,ok:!0}:1===i&&1===n?{direction:he.RIGHT_DOWN,distance:o,ok:!0}:{direction:"",distance:0,ok:!1}}function Te(e){switch(e){case"1":return 1;case"2":return 2;case"3":return 3;case"4":return 4;case"5":return 5;case"6":return 6;case"7":return 7;case"8":return 8;case"9":return 9;default:return null}}function Oe(e){switch(e){case"a":return 1;case"b":return 2;case"c":return 3;case"d":return 4;case"e":return 5;case"f":return 6;case"g":return 7;case"h":return 8;case"i":return 9;default:return null}}const we=["a","b","c","d","e","f","g","h","i"];class Ae{constructor(e,t){(0,Z.Z)(this,"file",void 0),(0,Z.Z)(this,"rank",void 0),this.file=e,this.rank=t}get x(){return 9-this.file}get y(){return this.rank-1}get index(){return 9*this.y+this.x}get opposite(){return new Ae(10-this.file,10-this.rank)}neighbor(e,t){switch(e){case he.UP:return new Ae(this.file,this.rank-1);case he.DOWN:return new Ae(this.file,this.rank+1);case he.LEFT:return new Ae(this.file+1,this.rank);case he.RIGHT:return new Ae(this.file-1,this.rank);case he.LEFT_UP:return new Ae(this.file+1,this.rank-1);case he.RIGHT_UP:return new Ae(this.file-1,this.rank-1);case he.LEFT_DOWN:return new Ae(this.file+1,this.rank+1);case he.RIGHT_DOWN:return new Ae(this.file-1,this.rank+1);case he.LEFT_UP_KNIGHT:return new Ae(this.file+1,this.rank-2);case he.RIGHT_UP_KNIGHT:return new Ae(this.file-1,this.rank-2);case he.LEFT_DOWN_KNIGHT:return new Ae(this.file+1,this.rank+2);case he.RIGHT_DOWN_KNIGHT:return new Ae(this.file-1,this.rank+2)}const i=e,n=t;return new Ae(this.file-i,this.rank+n)}get valid(){return this.file>=1&&this.file<=9&&this.rank>=1&&this.rank<=9}equals(e){return!!e&&this.file===e.file&&this.rank===e.rank}static newByXY(e,t){return new Ae(9-e,t+1)}static newByIndex(e){return new Ae(9-e%9,Math.trunc(e/9)+1)}get sfen(){return this.file+we[this.rank-1]}static parseSFENSquare(e){const t=Te(e[0]),i=Oe(e[1]);return t&&i?new Ae(t,i):null}}(0,Z.Z)(Ae,"all",[]);for(let Qc=0;Qc<81;Qc+=1)Ae.all.push(Ae.newByIndex(Qc));const Ne=["１","２","３","４","５","６","７","８","９"],Re=["一","二","三","四","五","六","七","八","九"];class Pe{constructor(e,t,i,n,o,a){(0,Z.Z)(this,"from",void 0),(0,Z.Z)(this,"to",void 0),(0,Z.Z)(this,"promote",void 0),(0,Z.Z)(this,"color",void 0),(0,Z.Z)(this,"pieceType",void 0),(0,Z.Z)(this,"capturedPieceType",void 0),this.from=e,this.to=t,this.promote=i,this.color=n,this.pieceType=o,this.capturedPieceType=a}equals(e){return!!e&&((this.from instanceof Ae&&e.from instanceof Ae&&this.from.equals(e.from)||!(this.from instanceof Ae)&&!(e.from instanceof Ae)&&this.from===e.from)&&this.to.equals(e.to)&&this.promote===e.promote&&this.color===e.color&&this.pieceType===e.pieceType&&this.capturedPieceType===e.capturedPieceType)}withPromote(){return new Pe(this.from,this.to,!0,this.color,this.pieceType,this.capturedPieceType)}getDisplayText(e){let t="";if(t+=this.color===Y.BLACK?"▲":"△",e&&e.to.equals(this.to)?t+="同":(t+=Ne[this.to.file-1],t+=Re[this.to.rank-1]),t+=ee(this.pieceType),this.promote&&(t+="成"),this.from instanceof Ae){const e=this.from;t+=` (${e.file}${e.rank})`}else t+="打";return t}get sfen(){let e="";return this.from instanceof Ae?e+=this.from.sfen:e+=se(this.from)+"*",e+=this.to.sfen,this.promote&&(e+="+"),e}}function ye(e){let t;if("*"===e[1]){const i=de.newBySFEN(e[0]);if(!i)return null;t=i.type}else{const i=Ae.parseSFENSquare(e);if(!i)return null;t=i}const i=Ae.parseSFENSquare(e.substring(2));if(!i)return null;const n=e.length>=5&&"+"===e[4];return{from:t,to:i,promote:n}}var be;function He(e){switch(e){case"1":return 1;case"2":return 2;case"3":return 3;case"4":return 4;case"5":return 5;case"6":return 6;case"7":return 7;case"8":return 8;case"9":return 9;default:return null}}(function(e){e["STANDARD"]="standard",e["EMPTY"]="empty",e["HANDICAP_LANCE"]="handicapLance",e["HANDICAP_RIGHT_LANCE"]="handicapRightLance",e["HANDICAP_BISHOP"]="handicapBishop",e["HANDICAP_ROOK"]="handicapRook",e["HANDICAP_ROOK_LANCE"]="handicapRookLance",e["HANDICAP_2PIECES"]="handicap2Pieces",e["HANDICAP_4PIECES"]="handicap4Pieces",e["HANDICAP_6PIECES"]="handicap6Pieces",e["HANDICAP_8PIECES"]="handicap8Pieces",e["TSUME_SHOGI"]="tsumeShogi"})(be||(be={}));class ke{constructor(){(0,Z.Z)(this,"squares",void 0),this.squares=new Array;for(let e=0;e<81;e+=1)this.squares.push(null);this.reset(be.STANDARD)}at(e){return this.squares[e.index]}set(e,t){this.squares[e.index]=t}swap(e,t){const i=this.squares[e.index];this.squares[e.index]=this.squares[t.index],this.squares[t.index]=i}remove(e){const t=this.squares[e.index];return this.squares[e.index]=null,t}listNonEmptySquares(){const e=new Array;return Ae.all.forEach((t=>{this.squares[t.index]&&e.push(t)})),e}listSquaresByColor(e){const t=new Array;return Ae.all.forEach((i=>{const n=this.squares[i.index];n&&n.color===e&&t.push(i)})),t}clear(){Ae.all.forEach((e=>{this.squares[e.index]=null}))}reset(e){if(this.clear(),e!==be.EMPTY&&(this.squares[new Ae(5,1).index]=new de(Y.WHITE,j.KING),e!==be.TSUME_SHOGI))switch(this.squares[new Ae(5,9).index]=new de(Y.BLACK,j.KING),this.squares[new Ae(2,8).index]=new de(Y.BLACK,j.ROOK),this.squares[new Ae(8,2).index]=new de(Y.WHITE,j.ROOK),this.squares[new Ae(8,8).index]=new de(Y.BLACK,j.BISHOP),this.squares[new Ae(2,2).index]=new de(Y.WHITE,j.BISHOP),this.squares[new Ae(4,9).index]=new de(Y.BLACK,j.GOLD),this.squares[new Ae(6,9).index]=new de(Y.BLACK,j.GOLD),this.squares[new Ae(6,1).index]=new de(Y.WHITE,j.GOLD),this.squares[new Ae(4,1).index]=new de(Y.WHITE,j.GOLD),this.squares[new Ae(3,9).index]=new de(Y.BLACK,j.SILVER),this.squares[new Ae(7,9).index]=new de(Y.BLACK,j.SILVER),this.squares[new Ae(7,1).index]=new de(Y.WHITE,j.SILVER),this.squares[new Ae(3,1).index]=new de(Y.WHITE,j.SILVER),this.squares[new Ae(2,9).index]=new de(Y.BLACK,j.KNIGHT),this.squares[new Ae(8,9).index]=new de(Y.BLACK,j.KNIGHT),this.squares[new Ae(8,1).index]=new de(Y.WHITE,j.KNIGHT),this.squares[new Ae(2,1).index]=new de(Y.WHITE,j.KNIGHT),this.squares[new Ae(1,9).index]=new de(Y.BLACK,j.LANCE),this.squares[new Ae(9,9).index]=new de(Y.BLACK,j.LANCE),this.squares[new Ae(9,1).index]=new de(Y.WHITE,j.LANCE),this.squares[new Ae(1,1).index]=new de(Y.WHITE,j.LANCE),this.squares[new Ae(1,7).index]=new de(Y.BLACK,j.PAWN),this.squares[new Ae(2,7).index]=new de(Y.BLACK,j.PAWN),this.squares[new Ae(3,7).index]=new de(Y.BLACK,j.PAWN),this.squares[new Ae(4,7).index]=new de(Y.BLACK,j.PAWN),this.squares[new Ae(5,7).index]=new de(Y.BLACK,j.PAWN),this.squares[new Ae(6,7).index]=new de(Y.BLACK,j.PAWN),this.squares[new Ae(7,7).index]=new de(Y.BLACK,j.PAWN),this.squares[new Ae(8,7).index]=new de(Y.BLACK,j.PAWN),this.squares[new Ae(9,7).index]=new de(Y.BLACK,j.PAWN),this.squares[new Ae(1,3).index]=new de(Y.WHITE,j.PAWN),this.squares[new Ae(2,3).index]=new de(Y.WHITE,j.PAWN),this.squares[new Ae(3,3).index]=new de(Y.WHITE,j.PAWN),this.squares[new Ae(4,3).index]=new de(Y.WHITE,j.PAWN),this.squares[new Ae(5,3).index]=new de(Y.WHITE,j.PAWN),this.squares[new Ae(6,3).index]=new de(Y.WHITE,j.PAWN),this.squares[new Ae(7,3).index]=new de(Y.WHITE,j.PAWN),this.squares[new Ae(8,3).index]=new de(Y.WHITE,j.PAWN),this.squares[new Ae(9,3).index]=new de(Y.WHITE,j.PAWN),e){default:case be.STANDARD:return;case be.HANDICAP_LANCE:return void(this.squares[new Ae(1,1).index]=null);case be.HANDICAP_RIGHT_LANCE:return void(this.squares[new Ae(9,1).index]=null);case be.HANDICAP_BISHOP:return void(this.squares[new Ae(2,2).index]=null);case be.HANDICAP_ROOK:return void(this.squares[new Ae(8,2).index]=null);case be.HANDICAP_ROOK_LANCE:return this.squares[new Ae(8,2).index]=null,void(this.squares[new Ae(1,1).index]=null);case be.HANDICAP_2PIECES:return this.squares[new Ae(8,2).index]=null,void(this.squares[new Ae(2,2).index]=null);case be.HANDICAP_4PIECES:return this.squares[new Ae(8,2).index]=null,this.squares[new Ae(2,2).index]=null,this.squares[new Ae(1,1).index]=null,void(this.squares[new Ae(9,1).index]=null);case be.HANDICAP_6PIECES:return this.squares[new Ae(8,2).index]=null,this.squares[new Ae(2,2).index]=null,this.squares[new Ae(1,1).index]=null,this.squares[new Ae(2,1).index]=null,this.squares[new Ae(8,1).index]=null,void(this.squares[new Ae(9,1).index]=null);case be.HANDICAP_8PIECES:return this.squares[new Ae(8,2).index]=null,this.squares[new Ae(2,2).index]=null,this.squares[new Ae(1,1).index]=null,this.squares[new Ae(2,1).index]=null,this.squares[new Ae(3,1).index]=null,this.squares[new Ae(7,1).index]=null,this.squares[new Ae(8,1).index]=null,void(this.squares[new Ae(9,1).index]=null)}}get sfen(){let e="",t=0;for(let i=0;i<9;i+=1){for(let n=0;n<9;n+=1){const o=this.at(Ae.newByXY(n,i));o?(t&&(e+=t,t=0),e+=o.sfen):t+=1}t&&(e+=t,t=0),8!==i&&(e+="/")}return e}resetBySFEN(e){if(!ke.isValidSFEN(e))return!1;this.clear();const t=e.split("/");for(let i=0;i<9;i+=1){let e=0;for(let n=0;n<t[i].length;n+=1){let o=t[i][n];"+"===o&&(n+=1,o+=t[i][n]);const a=He(o);a?e+=a:(this.set(Ae.newByXY(e,i),de.newBySFEN(o)),e+=1)}}return!0}findKing(e){const t=new de(e,j.KING);return Ae.all.find((e=>{const i=this.at(e);if(i&&t.equals(i))return!0}))}hasPower(e,t,i){return!!_e.find((n=>{let o=0;for(let a=e.neighbor(n);a.valid;a=a.neighbor(n)){if(o+=1,i&&i.filled&&a.equals(i.filled))break;if(i&&i.ignore&&a.equals(i.ignore))continue;const e=this.at(a);if(e){if(e.color!==t)return!1;const i=me(n),a=Ie(e,i);return a===ge.LONG||a===ge.SHORT&&1===o}}return!1}))}isChecked(e,t){const i=this.findKing(e);return!!i&&this.hasPower(i,z(e),{filled:t&&t.filled,ignore:t&&t.ignore})}static isValidSFEN(e){const t=e.split("/");if(9!==t.length)return!1;for(let i=0;i<9;i+=1){let e=0;for(let n=0;n<t[i].length;n+=1){let o=t[i][n];"+"===o&&(n+=1,o+=t[i][n]);const a=He(o);if(a)e+=a;else{if(!de.isValidSFEN(o))return!1;e+=1}}if(9!==e)return!1}return!0}copyFrom(e){Ae.all.forEach((t=>{this.squares[t.index]=e.at(t)}))}}function Ce(e,t){return 0===e?"":(1!==e?e:"")+t.sfen}class De{constructor(){(0,Z.Z)(this,"pieces",void 0),this.pieces=new Map,this.pieces.set(j.PAWN,0),this.pieces.set(j.LANCE,0),this.pieces.set(j.KNIGHT,0),this.pieces.set(j.SILVER,0),this.pieces.set(j.GOLD,0),this.pieces.set(j.BISHOP,0),this.pieces.set(j.ROOK,0)}count(e){return this.pieces.get(e)}set(e,t){this.pieces.set(e,t)}add(e,t){let i=this.pieces.get(e);return i+=t,this.pieces.set(e,i),i}reduce(e,t){let i=this.pieces.get(e);return i-=t,this.pieces.set(e,i),i}forEach(e){e(j.PAWN,this.pieces.get(j.PAWN)),e(j.LANCE,this.pieces.get(j.LANCE)),e(j.KNIGHT,this.pieces.get(j.KNIGHT)),e(j.SILVER,this.pieces.get(j.SILVER)),e(j.GOLD,this.pieces.get(j.GOLD)),e(j.BISHOP,this.pieces.get(j.BISHOP)),e(j.ROOK,this.pieces.get(j.ROOK))}get sfenBlack(){return this.formatSFEN(Y.BLACK)}get sfenWhite(){return this.formatSFEN(Y.WHITE)}formatSFEN(e){let t="";return t+=Ce(this.count(j.ROOK),new de(e,j.ROOK)),t+=Ce(this.count(j.BISHOP),new de(e,j.BISHOP)),t+=Ce(this.count(j.GOLD),new de(e,j.GOLD)),t+=Ce(this.count(j.SILVER),new de(e,j.SILVER)),t+=Ce(this.count(j.KNIGHT),new de(e,j.KNIGHT)),t+=Ce(this.count(j.LANCE),new de(e,j.LANCE)),t+=Ce(this.count(j.PAWN),new de(e,j.PAWN)),""===t?"-":t}static formatSFEN(e,t){const i=e.sfenBlack,n=t.sfenWhite;return"-"===i&&"-"===n?"-":"-"===n?i:"-"===i?n:i+n}static isValidSFEN(e){return"-"===e||!!e.match(/^(?:[0-9]*[PLNSGBRplnsgbr])*$/)}static parseSFEN(e){if("-"===e)return{black:new De,white:new De};if(!e.match(/^(?:[0-9]*[PLNSGBRplnsgbr])*$/))return null;const t=e.match(/([0-9]*[PLNSGBRplnsgbr])/g),i=new De,n=new De;for(let o=0;o<t.length;o+=1){const e=t[o];let a=1;e.length>=2&&(a=Number(e.substring(0,e.length-1)));const s=de.newBySFEN(e[e.length-1]);s.color===Y.BLACK?i.add(s.type,a):n.add(s.type,a)}return{black:i,white:n}}copyFrom(e){e.pieces.forEach(((e,t)=>{this.pieces.set(t,e)}))}}const Le={black:{pawn:{1:!0},lance:{1:!0},knight:{1:!0,2:!0}},white:{pawn:{9:!0},lance:{9:!0},knight:{9:!0,8:!0}}};function Me(e,t,i){const n=Le[e][t];return!!n&&n[i]}function Ge(e,t){return e===Y.BLACK?t<=3:t>=7}function Be(e,t,i){for(let n=1;n<=9;n+=1){const o=t.at(new Ae(i,n));if(o&&o.type===j.PAWN&&o.color===e)return!0}return!1}class xe{constructor(){(0,Z.Z)(this,"_board",void 0),(0,Z.Z)(this,"_color",void 0),(0,Z.Z)(this,"_blackHand",void 0),(0,Z.Z)(this,"_whiteHand",void 0),this._board=new ke,this._color=Y.BLACK,this._blackHand=new De,this._whiteHand=new De}get board(){return this._board}get color(){return this._color}get blackHand(){return this._blackHand}get whiteHand(){return this._whiteHand}reset(e){switch(this._board.reset(e),this._blackHand=new De,this._whiteHand=new De,e){case be.STANDARD:case be.EMPTY:case be.TSUME_SHOGI:this._color=Y.BLACK;break;case be.HANDICAP_LANCE:case be.HANDICAP_RIGHT_LANCE:case be.HANDICAP_BISHOP:case be.HANDICAP_ROOK:case be.HANDICAP_ROOK_LANCE:case be.HANDICAP_2PIECES:case be.HANDICAP_4PIECES:case be.HANDICAP_6PIECES:case be.HANDICAP_8PIECES:this._color=Y.WHITE;break}e===be.TSUME_SHOGI&&(this._whiteHand.set(j.PAWN,18),this._whiteHand.set(j.LANCE,4),this._whiteHand.set(j.KNIGHT,4),this._whiteHand.set(j.SILVER,4),this._whiteHand.set(j.GOLD,4),this._whiteHand.set(j.BISHOP,2),this._whiteHand.set(j.ROOK,2))}hand(e){return this._hand(e)}_hand(e){return e===Y.BLACK?this._blackHand:this._whiteHand}get checked(){return this._board.isChecked(this.color)}createMove(e,t){let i;if(e instanceof Ae){const t=this._board.at(e);if(!t)return null;i=t.type}else i=e;const n=this._board.at(t);return new Pe(e,t,!1,this.color,i,n?n.type:null)}createMoveBySFEN(e){const t=ye(e);if(!t)return null;let i=this.createMove(t.from,t.to);return i?(t.promote&&(i=i.withPromote()),i):null}isPawnDropMate(e){if(e.from instanceof Ae)return!1;if(e.pieceType!==j.PAWN)return!1;const t=e.to.neighbor(e.color===Y.BLACK?he.UP:he.DOWN),i=this.board.at(t);if(!i||i.type!==j.KING||i.color===e.color)return!1;const n=Se(i).find((n=>{const o=t.neighbor(n);if(!o.valid)return!1;const a=this.board.at(o);return(!a||a.color!=i.color)&&!this.board.hasPower(o,e.color)}));return!n&&!this.board.listSquaresByColor(i.color).find((n=>!n.equals(t)&&this.isMovable(n,e.to)&&!this.board.isChecked(i.color,{filled:e.to,ignore:n})))}isValidMove(e){if(e.from instanceof Ae){const t=this._board.at(e.from);if(!t||t.color!==this.color)return!1;if(!this.isMovable(e.from,e.to))return!1;const i=this._board.at(e.to);if(i&&i.color===this.color)return!1;if(e.promote){if(!t.isPromotable())return!1;if(!Ge(this.color,e.from.rank)&&!Ge(this.color,e.to.rank))return!1}else if(Me(this.color,t.type,e.to.rank))return!1;if(e.pieceType!==j.KING?this._board.isChecked(this.color,{filled:e.to,ignore:e.from}):this._board.hasPower(e.to,z(this.color),{ignore:e.from}))return!1}else{if(e.promote)return!1;if(e.color!==this.color)return!1;if(0===this.hand(this.color).count(e.from))return!1;if(this._board.at(e.to))return!1;if(Me(this.color,e.from,e.to.rank))return!1;if(e.from===j.PAWN&&Be(this.color,this._board,e.to.file))return!1;if(this._board.isChecked(this.color,{filled:e.to}))return!1;if(this.isPawnDropMate(e))return!1}return!0}doMove(e,t){if((!t||!t.ignoreValidation)&&!this.isValidMove(e))return!1;if(e.from instanceof Ae){const t=this._board.at(e.from),i=this._board.at(e.to);this._board.remove(e.from),this._board.set(e.to,e.promote?t.promoted():t),i&&i.type!==j.KING&&this._hand(this.color).add(i.unpromoted().type,1)}else this._hand(this.color).reduce(e.from,1),this._board.set(e.to,new de(this.color,e.from));return this._color=z(this.color),!0}undoMove(e){if(this._color=z(this.color),e.from instanceof Ae)if(this._board.set(e.from,new de(this.color,e.pieceType)),e.capturedPieceType){const t=new de(z(this.color),e.capturedPieceType);this._board.set(e.to,t),t.type!==j.KING&&this._hand(this.color).reduce(t.unpromoted().type,1)}else this._board.remove(e.to);else this._hand(this.color).add(e.from,1),this._board.remove(e.to)}isValidEditing(e,t){if(e instanceof Ae){const i=this._board.at(e);if(!i)return!1;if(t instanceof Ae){if(e.equals(t))return!1}else if(i.type===j.KING)return!1}else{if(!e.color)return!1;if(0===this.hand(e.color).count(e.type))return!1;if(t instanceof Ae){if(this._board.at(t))return!1}else if(e.color===t)return!1}return!0}edit(e){if(e.move){if(!this.isValidEditing(e.move.from,e.move.to))return!1;if(e.move.from instanceof Ae)if(e.move.to instanceof Ae)this._board.swap(e.move.from,e.move.to);else{const t=this._board.remove(e.move.from);this._hand(e.move.to).add(t.unpromoted().type,1)}else this._hand(e.move.from.color).reduce(e.move.from.type,1),e.move.to instanceof Ae?this._board.set(e.move.to,e.move.from):this._hand(e.move.to).add(e.move.from.type,1)}if(e.rotate){const t=this._board.at(e.rotate);t&&this._board.set(e.rotate,t.rotate())}return!0}get sfen(){return this.getSfen(1)}getSfen(e){let t=`sfen ${this._board.sfen} ${J(this.color)} `;return t+=De.formatSFEN(this._blackHand,this._whiteHand),t+=" "+e,t}resetBySFEN(e){if(!xe.isValidSFEN(e))return!1;const t=e.split(" ");this._board.resetBySFEN(t[1]),this._color=X(t[2]);const i=De.parseSFEN(t[3]);return this._blackHand=i.black,this._whiteHand=i.white,!0}setColor(e){this._color=e}static isValidSFEN(e){const t=e.split(" ");return!(t.length<5)&&("sfen"===t[0]&&(!!ke.isValidSFEN(t[1])&&(!!$(t[2])&&!!De.isValidSFEN(t[3]))))}static newBySFEN(e){const t=new xe;return t.resetBySFEN(e)?t:null}isMovable(e,t){const i=t.x-e.x,n=t.y-e.y,{direction:o,distance:a,ok:s}=fe(i,n);if(!s)return!1;const r=this._board.at(e);if(!r)return!1;switch(Ie(r,o)){default:return!1;case ge.SHORT:return 1===a;case ge.LONG:{const i=ve[o];for(let n=e.neighbor(i.x,i.y);n.valid;n=n.neighbor(i.x,i.y)){if(n.equals(t))return!0;if(this._board.at(n))return!1}return!1}}}copyFrom(e){this._board.copyFrom(e._board),this._color=e.color,this._blackHand.copyFrom(e._blackHand),this._whiteHand.copyFrom(e._whiteHand)}clone(){const e=new xe;return e.copyFrom(this),e}}function Ue(e){return Ke(Math.floor(e/1e3))}function We(e){return Fe(Math.floor(e/1e3))}function Ke(e){const t=Math.floor(e/3600),i=Math.floor((e-3600*t)/60),n=e%60;return t+":"+String(i).padStart(2,"0")+":"+String(n).padStart(2,"0")}function Fe(e){const t=Math.floor(e/60),i=e%60;return String(t).padStart(2," ")+":"+String(i).padStart(2,"0")}var qe,Ve;function Ye(e){switch(e){case qe.BLACK_NAME:return"先手";case qe.WHITE_NAME:return"後手";case qe.START_DATETIME:return"開始日時";case qe.END_DATETIME:return"終了日時";case qe.DATE:return"対局日";case qe.TOURNAMENT:return"棋戦";case qe.STRATEGY:return"戦型";case qe.TITLE:return"表題";case qe.TIME_LIMIT:return"持ち時間";case qe.TIME_SPENT:return"消費時間";case qe.PLACE:return"場所";case qe.POSTED_ON:return"掲載";case qe.NOTE:return"備考";case qe.BLACK_SHORT_NAME:return"先手省略名";case qe.WHITE_SHORT_NAME:return"後手省略名";case qe.OPUS_NO:return"作品番号";case qe.OPUS_NAME:return"作品名";case qe.AUTHOR:return"作者";case qe.PUBLISHED_ON:return"発表誌";case qe.PUBLISHED_AT:return"発表年月";case qe.SOURCE:return"出典";case qe.LENGTH:return"手数";case qe.INTEGRITY:return"完全性";case qe.CATEGORY:return"分類";case qe.AWARD:return"受賞"}}(function(e){e["BLACK_NAME"]="blackName",e["WHITE_NAME"]="whiteName",e["START_DATETIME"]="startDatetime",e["END_DATETIME"]="endDatetime",e["DATE"]="date",e["TOURNAMENT"]="tournament",e["STRATEGY"]="strategy",e["TITLE"]="title",e["TIME_LIMIT"]="timeLimit",e["TIME_SPENT"]="timeSpent",e["PLACE"]="place",e["POSTED_ON"]="postedOn",e["NOTE"]="note",e["BLACK_SHORT_NAME"]="blackShortName",e["WHITE_SHORT_NAME"]="whiteShortName",e["OPUS_NO"]="opusNo",e["OPUS_NAME"]="opusName",e["AUTHOR"]="author",e["PUBLISHED_ON"]="publishedOn",e["PUBLISHED_AT"]="publishedAt",e["SOURCE"]="source",e["LENGTH"]="length",e["INTEGRITY"]="integrity",e["CATEGORY"]="category",e["AWARD"]="award"})(qe||(qe={}));class je{constructor(){(0,Z.Z)(this,"metadata",void 0),(0,Z.Z)(this,"customMetadata",void 0),this.metadata=new Map,this.customMetadata=new Map}get standardMetadataKeys(){return this.metadata.keys()}getStandardMetadata(e){return this.metadata.get(e)}setStandardMetadata(e,t){t?this.metadata.set(e,t):this.metadata.delete(e)}get customMetadataKeys(){return this.customMetadata.keys()}getCustomMetadata(e){return this.customMetadata.get(e)}setCustomMetadata(e,t){t?this.customMetadata.set(e,t):this.customMetadata.delete(e)}}(function(e){e["START"]="start",e["INTERRUPT"]="interrupt",e["RESIGN"]="resign",e["DRAW"]="draw",e["REPETITION_DRAW"]="repetitionDraw",e["MATE"]="mate",e["TIMEOUT"]="timeout",e["FOUL_WIN"]="foulWin",e["FOUL_LOSE"]="foulLose",e["ENTERING_OF_KING"]="enteringOfKing",e["WIN_BY_DEFAULT"]="winByDefault",e["LOSS_BY_DEFAULT"]="lossByDefault"})(Ve||(Ve={}));const Ze={start:"開始局面",resign:"投了",interrupt:"中断",draw:"持将棋",repetitionDraw:"千日手",mate:"詰み",timeout:"切れ負け",foulWin:"反則勝ち",foulLose:"反則負け",enteringOfKing:"入玉",winByDefault:"不戦勝",lossByDefault:"不戦敗"};function ze(e){return Ze[e]}class Je{constructor(e,t,i,n,o,a){(0,Z.Z)(this,"number",void 0),(0,Z.Z)(this,"prev",void 0),(0,Z.Z)(this,"branchIndex",void 0),(0,Z.Z)(this,"activeBranch",void 0),(0,Z.Z)(this,"move",void 0),(0,Z.Z)(this,"isCheck",void 0),(0,Z.Z)(this,"next",void 0),(0,Z.Z)(this,"branch",void 0),(0,Z.Z)(this,"comment",void 0),(0,Z.Z)(this,"customData",void 0),(0,Z.Z)(this,"elapsedMs",void 0),(0,Z.Z)(this,"totalElapsedMs",void 0),this.number=e,this.prev=t,this.branchIndex=i,this.activeBranch=n,this.move=o,this.isCheck=a,this.next=null,this.branch=null,this.comment="",this.elapsedMs=0,this.totalElapsedMs=0}get displayMoveText(){const e=this.prev&&this.prev.move instanceof Pe?this.prev.move:null;return this.move instanceof Pe?this.move.getDisplayText(e):ze(this.move)}get displayText(){let e=this.displayMoveText;if(0!==this.number){const t=We(this.elapsedMs),i=Ue(this.totalElapsedMs);e+=` (${t} / ${i})`}return e}get hasBranch(){return!!this.prev&&!!this.prev.next&&!!this.prev.next.branch}get isFirstBranch(){return!this.prev||this.prev.next===this}updateTotalElapsedMs(){this.totalElapsedMs=this.elapsedMs,this.prev&&this.prev.prev&&(this.totalElapsedMs+=this.prev.prev.totalElapsedMs)}setElapsedMs(e){this.elapsedMs=e,this.updateTotalElapsedMs();let t=this.next;const i=[];while(t)t.updateTotalElapsedMs(),t.branch&&i.push(t.branch),t=t.next?t.next:i.pop()||null}}class $e{constructor(e){(0,Z.Z)(this,"_metadata",void 0),(0,Z.Z)(this,"_initialPosition",void 0),(0,Z.Z)(this,"_position",void 0),(0,Z.Z)(this,"_first",void 0),(0,Z.Z)(this,"_current",void 0),(0,Z.Z)(this,"repetitionCounts",void 0),(0,Z.Z)(this,"repetitionStart",void 0),this._metadata=new je,this._initialPosition=e?e.clone():new xe,this._position=this.initialPosition.clone(),this._first=new Je(0,null,0,!0,Ve.START,!1),this._current=this._first,this.repetitionCounts={},this.repetitionStart={},this.incrementRepetition()}get metadata(){return this._metadata}get initialPosition(){return this._initialPosition}get position(){return this._position}get first(){return this._first}get current(){return this._current}get moves(){const e=this.movesBefore;for(let t=this._current.next;t;t=t.next){while(!t.activeBranch)t=t.branch;e.push(t)}return e}get movesBefore(){return this._movesBefore}get _movesBefore(){const e=new Array;e.unshift(this._current);for(let t=this._current.prev;t;t=t.prev)e.unshift(t);return e}get length(){let e=this._current.number;for(let t=this._current.next;t;t=t.next){while(!t.activeBranch)t=t.branch;e=t.number}return e}get branchBegin(){return this._current.prev?this._current.prev.next:this._current}clear(e){e&&(this._initialPosition=e.clone()),this._position=this.initialPosition.clone(),this.repetitionCounts={},this.incrementRepetition(),this._first.next=null,this._current=this._first}goBack(){return!!this._current.prev&&(this._current.move instanceof Pe&&(this.decrementRepetition(),this._position.undoMove(this._current.move)),this._current=this._current.prev,!0)}goForward(){if(this._current.next){this._current=this._current.next;while(!this._current.activeBranch)this._current=this._current.branch;return this._current.move instanceof Pe&&(this._position.doMove(this._current.move,{ignoreValidation:!0}),this.incrementRepetition()),!0}return!1}goto(e){while(e<this._current.number)if(!this.goBack())break;while(e>this._current.number)if(!this.goForward())break}resetAllBranchSelection(){this._forEach((e=>{e.activeBranch=e.isFirstBranch}))}switchBranchByIndex(e){if(!this._current.prev)return!1;let t=!1;for(let i=this._current.prev.next;i;i=i.branch)i.branchIndex===e?(i.activeBranch=!0,this._current.move instanceof Pe&&(this.decrementRepetition(),this._position.undoMove(this._current.move)),this._current=i,this._current.move instanceof Pe&&(this._position.doMove(this._current.move,{ignoreValidation:!0}),this.incrementRepetition()),t=!0):i.activeBranch=!1;return t}append(e,t){let i,n=!1;if(e instanceof Pe){if(!this._position.doMove(e,t))return!1;this.incrementRepetition(),n=this.position.checked}if(this._current===this.first||this._current.move instanceof Pe||this.goBack(),!this._current.next)return this._current.next=new Je(this._current.number+1,this._current,0,!0,e,n),this._current=this._current.next,!0;for(i=this._current.next;i;i=i.branch)i.activeBranch=!1;let o=this._current.next;for(i=this._current.next;i;i=i.branch){if(i.move instanceof Pe&&e instanceof Pe&&e.equals(i.move)||e===i.move)return this._current=i,this._current.activeBranch=!0,!0;o=i}return this._current=new Je(this._current.number+1,this._current,o.branchIndex+1,!0,e,n),o.branch=this._current,!0}removeAfter(){const e=this._current;if(!this.goBack())return void(this._current.next=null);if(this._current.next===e)this._current.next=e.branch;else for(let i=this._current.next;i;i=i.branch)if(i.branch===e){i.branch=e.branch;break}let t=0;for(let i=this._current.next;i;i=i.branch)i.branchIndex=t,t+=1;this._current.next&&(this._current.next.activeBranch=!0)}incrementRepetition(){const e=this.position.sfen;this.repetitionCounts[e]?this.repetitionCounts[e]+=1:(this.repetitionCounts[e]=1,this.repetitionStart[e]=this.current.number)}decrementRepetition(){const e=this.position.sfen;this.repetitionCounts[e]-=1,0===this.repetitionCounts[e]&&(delete this.repetitionCounts[e],delete this.repetitionStart[e])}get repetition(){return this.repetitionCounts[this.position.sfen]>=4}get perpetualCheck(){if(!this.repetition)return null;const e=this.position.sfen,t=this.repetitionStart[e];let i=!0,n=!0,o=this.position.color;for(let a=this.current;a.number>=t;a=a.prev)o=z(o),a.isCheck||(o===Y.BLACK?i=!1:n=!1);return i?Y.BLACK:n?Y.WHITE:null}get usi(){let e="position "+this.initialPosition.sfen+" moves";return this._movesBefore.forEach((t=>{t.move instanceof Pe&&(e+=" "+t.move.sfen)})),e}get sfen(){return"position "+this.position.getSfen(this._current.number+1)}forEach(e){this._forEach(e)}_forEach(e){let t=this._first;const i=[];while(t)e(t),t.branch&&i.push(t.branch),t=t.next?t.next:i.pop()||null}}const Xe={"先手":qe.BLACK_NAME,"後手":qe.WHITE_NAME,"開始日時":qe.START_DATETIME,"終了日時":qe.END_DATETIME,"対局日":qe.DATE,"棋戦":qe.TOURNAMENT,"戦型":qe.STRATEGY,"表題":qe.TITLE,"持ち時間":qe.TIME_LIMIT,"消費時間":qe.TIME_SPENT,"場所":qe.PLACE,"掲載":qe.POSTED_ON,"備考":qe.NOTE,"先手省略名":qe.BLACK_SHORT_NAME,"後手省略名":qe.WHITE_SHORT_NAME,"作品番号":qe.OPUS_NO,"作品名":qe.OPUS_NAME,"作者":qe.AUTHOR,"発表誌":qe.PUBLISHED_ON,"発表年月":qe.PUBLISHED_AT,"出典":qe.SOURCE,"手数":qe.LENGTH,"完全性":qe.INTEGRITY,"分類":qe.CATEGORY,"受賞":qe.AWARD},Qe={blackName:"先手",whiteName:"後手",startDatetime:"開始日時",endDatetime:"終了日時",date:"対局日",tournament:"棋戦",strategy:"戦型",title:"表題",timeLimit:"持ち時間",timeSpent:"消費時間",place:"場所",postedOn:"掲載",note:"備考",blackShortName:"先手省略名",whiteShortName:"後手省略名",opusNo:"作品番号",opusName:"作品名",author:"作者",publishedOn:"発表誌",publishedAt:"発表年月",source:"出典",length:"手数",integrity:"完全性",category:"分類",award:"受賞"};var et;(function(e){e[e["METADATA"]=0]="METADATA",e[e["HANDICAP"]=1]="HANDICAP",e[e["BLACK_HAND"]=2]="BLACK_HAND",e[e["WHITE_HAND"]=3]="WHITE_HAND",e[e["BOARD"]=4]="BOARD",e[e["BLACK_TURN"]=5]="BLACK_TURN",e[e["WHITE_TURN"]=6]="WHITE_TURN",e[e["MOVE"]=7]="MOVE",e[e["COMMENT"]=8]="COMMENT",e[e["UNKNOWN"]=9]="UNKNOWN"})(et||(et={}));const tt=[{prefix:/^手合割：/,type:et.HANDICAP,removePrefix:!0,isPosition:!0},{prefix:/^先手の持駒：/,type:et.BLACK_HAND,removePrefix:!0,isPosition:!0},{prefix:/^後手の持駒：/,type:et.WHITE_HAND,removePrefix:!0,isPosition:!0},{prefix:/^\|/,type:et.BOARD,removePrefix:!1,isPosition:!0},{prefix:/^先手番/,type:et.BLACK_TURN,removePrefix:!1,isPosition:!0},{prefix:/^後手番/,type:et.WHITE_TURN,removePrefix:!1,isPosition:!0},{prefix:/^ *[0-9]+ +/,type:et.MOVE,removePrefix:!1,isPosition:!1},{prefix:/^\*/,type:et.COMMENT,removePrefix:!0,isPosition:!1}];function it(e){let t=e.indexOf("#");-1===t&&(t=e.length);for(let n=0;n<tt.length;n++){const i=tt[n],o=e.match(i.prefix);if(o){const n=i.removePrefix?o[0].length:0;return{type:i.type,data:e.substring(n,t),isPosition:i.isPosition,metadataKey:""}}}const i=e.match(/^[^ ]+：/);if(i){const n=i[0];return{type:et.METADATA,data:e.substring(n.length,t),isPosition:!1,metadataKey:n.substring(0,n.length-1)}}return{type:et.UNKNOWN,data:e.substring(0,t),isPosition:!1,metadataKey:""}}function nt(e,t){switch(t.trim()){case"平手":return void e.reset(be.STANDARD);case"香落ち":return void e.reset(be.HANDICAP_LANCE);case"右香落ち":return void e.reset(be.HANDICAP_RIGHT_LANCE);case"角落ち":return void e.reset(be.HANDICAP_BISHOP);case"飛車落ち":return void e.reset(be.HANDICAP_ROOK);case"飛香落ち":return void e.reset(be.HANDICAP_ROOK_LANCE);case"二枚落ち":return void e.reset(be.HANDICAP_2PIECES);case"四枚落ち":return void e.reset(be.HANDICAP_4PIECES);case"六枚落ち":return void e.reset(be.HANDICAP_6PIECES);case"八枚落ち":return void e.reset(be.HANDICAP_8PIECES);case"その他":return void e.reset(be.EMPTY)}return new Error("不正なデータ:"+t)}const ot={"１":1,"２":2,"３":3,"４":4,"５":5,"６":6,"７":7,"８":8,"９":9},at={"一":1,"二":2,"三":3,"四":4,"五":5,"六":6,"七":7,"八":8,"九":9},st={"一":1,"二":2,"三":3,"四":4,"五":5,"六":6,"七":7,"八":8,"九":9,"十":10,"十一":11,"十二":12,"十三":13,"十四":14,"十五":15,"十六":16,"十七":17,"十八":18},rt={1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9},ct={"王":j.KING,"玉":j.KING,"飛":j.ROOK,"龍":j.DRAGON,"竜":j.DRAGON,"角":j.BISHOP,"馬":j.HORSE,"金":j.GOLD,"銀":j.SILVER,"成銀":j.PROM_SILVER,"全":j.PROM_SILVER,"桂":j.KNIGHT,"成桂":j.PROM_KNIGHT,"圭":j.PROM_KNIGHT,"香":j.LANCE,"成香":j.PROM_LANCE,"杏":j.PROM_LANCE,"歩":j.PAWN,"と":j.PROM_PAWN},lt={"中断":Ve.INTERRUPT,"投了":Ve.RESIGN,"持将棋":Ve.DRAW,"千日手":Ve.REPETITION_DRAW,"詰み":Ve.MATE,"切れ負け":Ve.TIMEOUT,"反則勝ち":Ve.FOUL_WIN,"反則負け":Ve.FOUL_LOSE,"入玉勝ち":Ve.ENTERING_OF_KING,"不戦勝":Ve.WIN_BY_DEFAULT,"不戦敗":Ve.LOSS_BY_DEFAULT},ut=/^ *([0-9]+) +[▲△]?([１２３４５６７８９][一二三四五六七八九]|同\u3000)(玉|飛|龍|竜|角|馬|金|銀|成銀|全|桂|成桂|圭|香|成香|杏|歩|と)(成?)(打|\([1-9][1-9]\)) *(.*)$/,dt=/\( *([0-9]+):([0-9]+)\/[0-9: ]*\)/,ht=/^ *([0-9]+) +(中断|投了|持将棋|千日手|詰み|切れ負け|反則勝ち|反則負け|入玉勝ち|不戦勝|不戦敗) *(.*)$/;function pt(e,t){if(t.length<21)return new Error("不正な盤面:"+t);const i=t[20],n=at[i];if(!n)return new Error("不正な盤面:"+t);for(let o=0;o<9;o+=1){const i=9-o,a=new Ae(i,n),s=2*o+1,r=t[s+1],c=ct[r];if(!c){e.remove(a);continue}const l="v"!==t[s]?Y.BLACK:Y.WHITE;e.set(a,new de(l,c))}}function mt(e,t){const i=t.split(/[ 　]/);for(const n of i){if(!n||"なし"===n)continue;const t=n[0],i=n.substring(1),o=ct[t],a=st[i]||1;if(!o)return new Error("不正な持ち駒: "+n);e.add(o,a)}}function _t(e,t){const i=dt.exec(t);if(i){const t=i[1],n=i[2],o=60*Number.parseInt(t)+Number.parseInt(n);e.current.setElapsedMs(1e3*o)}}function gt(e,t){let i=ht.exec(t);if(i){const t=Number(i[1]),n=lt[i[2]],o=i[3];return e.goto(t-1),e.append(n,{ignoreValidation:!0}),void _t(e,o)}if(i=ut.exec(t),!i)return new Error("不正な指し手形式:"+t);const n=Number(i[1]),o=i[2],a=i[3],s=i[4],r=i[5],c=i[6];if(0===n)return new Error("不正な手数:"+t);let l,u;if(e.goto(n-1),"同　"===o){if(!(e.current.move instanceof Pe))return new Error("不明な移動先: "+t);l=e.current.move.to}else{const e=ot[o[0]],t=at[o[1]];l=new Ae(e,t)}if("打"===r)u=ct[a];else{const e=rt[r[1]],t=rt[r[2]];u=new Ae(e,t)}let d=e.position.createMove(u,l);if(!d)return new Error("不正な指し手: "+t);"成"===s&&(d=d.withPromote()),e.append(d,{ignoreValidation:!0}),_t(e,c)}function Et(e){const t=new $e,i=e.split(/\r?\n/),n=new xe;let o=!1;for(const a of i){if(""===a)continue;const e=it(a);if(o&&e.isPosition)return new Error("不正なデータ: "+a);let i;switch(e.type){case et.METADATA:{const i=Xe[e.metadataKey];i?t.metadata.setStandardMetadata(i,e.data):t.metadata.setCustomMetadata(e.metadataKey,e.data);break}case et.HANDICAP:i=nt(n,e.data);break;case et.BLACK_HAND:i=mt(n.blackHand,e.data);break;case et.WHITE_HAND:i=mt(n.whiteHand,e.data);break;case et.BOARD:i=pt(n.board,e.data);break;case et.BLACK_TURN:n.setColor(Y.BLACK);break;case et.WHITE_TURN:n.setColor(Y.WHITE);break;case et.MOVE:o||(t.clear(n),o=!0),i=gt(t,e.data);break;case et.COMMENT:t.current.comment+=(0!==t.current.comment.length?"\n":"")+e.data;break;case et.UNKNOWN:console.log("skip",a);break}if(i)return i}return o||t.clear(n),t.goto(0),t.resetAllBranchSelection(),t}const St=["一","二","三","四","五","六","七","八","九","十","十一","十二","十三","十四","十五","十六","十七","十八"],It=["１","２","３","４","５","６","７","８","９"],vt=St,ft={king:"玉",rook:"飛",dragon:"龍",bishop:"角",horse:"馬",gold:"金",silver:"銀",promSilver:"成銀",knight:"桂",promKnight:"成桂",lance:"香",promLance:"成香",pawn:"歩",promPawn:"と"},Tt={king:"玉",rook:"飛",dragon:"龍",bishop:"角",horse:"馬",gold:"金",silver:"銀",promSilver:"全",knight:"桂",promKnight:"圭",lance:"香",promLance:"杏",pawn:"歩",promPawn:"と"},Ot={start:"",resign:"投了",interrupt:"中断",draw:"持将棋",repetitionDraw:"千日手",mate:"詰み",timeout:"切れ負け",foulWin:"反則勝ち",foulLose:"反則負け",enteringOfKing:"入玉勝ち",winByDefault:"不戦勝",lossByDefault:"不戦敗"};function wt(e,t){let i="";const n=t.returnCode?t.returnCode:"\n";for(const o of e.standardMetadataKeys)i+=Qe[o]+"："+e.getStandardMetadata(o)+n;for(const o of e.customMetadataKeys)i+=o+"："+e.getCustomMetadata(o)+n;return i}function At(e,t){let i="";const n=t.returnCode?t.returnCode:"\n";i+="後手の持駒："+Rt(e.whiteHand)+n,i+="  ９ ８ ７ ６ ５ ４ ３ ２ １"+n,i+="+---------------------------+"+n;for(let o=0;o<9;o++){i+="|";for(let t=0;t<9;t++){const n=Ae.newByXY(t,o),a=e.board.at(n);a?a.color===Y.BLACK?i+=" "+Tt[a.type]:i+="v"+Tt[a.type]:i+=" ・"}i+="|"+vt[o]+n}return i+="+---------------------------+"+n,i+="先手の持駒："+Rt(e.blackHand)+n,e.color===Y.BLACK?i+="先手番"+n:i+="後手番"+n,i}function Nt(e){let t="";return t+=It[e.to.file-1],t+=vt[e.to.rank-1],t+=ft[e.pieceType],e.promote&&(t+="成"),e.from instanceof Ae?t+="("+e.from.file+e.from.rank+")":t+="打",t}function Rt(e){let t="";return e.forEach(((e,i)=>{i>=1&&(t+=Tt[e],i>=2&&(t+=St[i-1]),t+="　")})),t}function Pt(e,t){let i="";const n=t.returnCode?t.returnCode:"\n";return i+="# KIF形式棋譜ファイル Generated by Electron Shogi"+n,i+=wt(e.metadata,t),i+=At(e.initialPosition,t),i+="手数----指手---------消費時間--"+n,e.forEach((e=>{if(0!==e.number){e.isFirstBranch||(i+=n,i+="変化："+e.number+"手"+n),i+=e.number+" ",e.move instanceof Pe?i+=Nt(e.move):i+=Ot[e.move];const t=We(e.elapsedMs),o=Ue(e.totalElapsedMs);i+=` (${t}/${o})`,e.isFirstBranch&&e.hasBranch&&(i+="+"),i+=n}0!==e.comment.length&&(i+="*"+e.comment.replaceAll("\n",n+"*")+n)})),i}const yt={};function bt(e){if(yt[e])return;const t=document.createElement("img");t.src=e,yt[e]=t}var Ht,kt;(function(e){e["HITOMOJI"]="hitomoji",e["HITOMOJI_GOTHIC"]="hitomojiGothic"})(Ht||(Ht={})),function(e){e["LIGHT"]="light",e["WARM"]="warm",e["RESIN"]="resin"}(kt||(kt={}));const Ct={frame:{width:1471,height:959},board:{x:296.5,y:0,width:878,height:960,squreWidth:94.8,squreHeight:104,leftSquarePadding:12,topSquarePadding:12.2,leftPiecePadding:17.5,topPiecePadding:18.5,highlight:{selected:{"background-color":"#ff4800",opacity:"0.7"},lastMove:{"background-color":"#00ddff",opacity:"0.5"}}},piece:{width:88,height:93},hand:{color:"#8b4513",black:{x:1184,y:600},white:{x:0,y:0},width:288,height:360,highlight:{selected:{"background-color":"#ff4800",opacity:"0.7"}}},turn:{black:{x:1184,y:425},white:{x:0,y:492},width:288,height:45,fontSize:32},playerName:{black:{x:1184,y:480},white:{x:0,y:370},width:288,height:45,fontSize:25},clock:{black:{x:1184,y:535},white:{x:0,y:425},width:288,height:55,fontSize:40},control:{left:{x:0,y:547,width:288,height:412,fontSize:26},right:{x:1184,y:0,width:288,height:412,fontSize:26}}},Dt={[Ht.HITOMOJI]:{black:{pawn:"./piece/hitomoji/black_pawn.png",lance:"./piece/hitomoji/black_lance.png",knight:"./piece/hitomoji/black_knight.png",silver:"./piece/hitomoji/black_silver.png",gold:"./piece/hitomoji/black_gold.png",bishop:"./piece/hitomoji/black_bishop.png",rook:"./piece/hitomoji/black_rook.png",king:"./piece/hitomoji/black_king.png",king2:"./piece/hitomoji/black_king2.png",promPawn:"./piece/hitomoji/black_prom_pawn.png",promLance:"./piece/hitomoji/black_prom_lance.png",promKnight:"./piece/hitomoji/black_prom_knight.png",promSilver:"./piece/hitomoji/black_prom_silver.png",horse:"./piece/hitomoji/black_horse.png",dragon:"./piece/hitomoji/black_dragon.png"},white:{pawn:"./piece/hitomoji/white_pawn.png",lance:"./piece/hitomoji/white_lance.png",knight:"./piece/hitomoji/white_knight.png",silver:"./piece/hitomoji/white_silver.png",gold:"./piece/hitomoji/white_gold.png",bishop:"./piece/hitomoji/white_bishop.png",rook:"./piece/hitomoji/white_rook.png",king:"./piece/hitomoji/white_king.png",king2:"./piece/hitomoji/white_king2.png",promPawn:"./piece/hitomoji/white_prom_pawn.png",promLance:"./piece/hitomoji/white_prom_lance.png",promKnight:"./piece/hitomoji/white_prom_knight.png",promSilver:"./piece/hitomoji/white_prom_silver.png",horse:"./piece/hitomoji/white_horse.png",dragon:"./piece/hitomoji/white_dragon.png"}},[Ht.HITOMOJI_GOTHIC]:{black:{pawn:"./piece/hitomoji_gothic/black_pawn.png",lance:"./piece/hitomoji_gothic/black_lance.png",knight:"./piece/hitomoji_gothic/black_knight.png",silver:"./piece/hitomoji_gothic/black_silver.png",gold:"./piece/hitomoji_gothic/black_gold.png",bishop:"./piece/hitomoji_gothic/black_bishop.png",rook:"./piece/hitomoji_gothic/black_rook.png",king:"./piece/hitomoji_gothic/black_king.png",king2:"./piece/hitomoji_gothic/black_king2.png",promPawn:"./piece/hitomoji_gothic/black_prom_pawn.png",promLance:"./piece/hitomoji_gothic/black_prom_lance.png",promKnight:"./piece/hitomoji_gothic/black_prom_knight.png",promSilver:"./piece/hitomoji_gothic/black_prom_silver.png",horse:"./piece/hitomoji_gothic/black_horse.png",dragon:"./piece/hitomoji_gothic/black_dragon.png"},white:{pawn:"./piece/hitomoji_gothic/white_pawn.png",lance:"./piece/hitomoji_gothic/white_lance.png",knight:"./piece/hitomoji_gothic/white_knight.png",silver:"./piece/hitomoji_gothic/white_silver.png",gold:"./piece/hitomoji_gothic/white_gold.png",bishop:"./piece/hitomoji_gothic/white_bishop.png",rook:"./piece/hitomoji_gothic/white_rook.png",king:"./piece/hitomoji_gothic/white_king.png",king2:"./piece/hitomoji_gothic/white_king2.png",promPawn:"./piece/hitomoji_gothic/white_prom_pawn.png",promLance:"./piece/hitomoji_gothic/white_prom_lance.png",promKnight:"./piece/hitomoji_gothic/white_prom_knight.png",promSilver:"./piece/hitomoji_gothic/white_prom_silver.png",horse:"./piece/hitomoji_gothic/white_horse.png",dragon:"./piece/hitomoji_gothic/white_dragon.png"}}},Lt={[kt.LIGHT]:"./board/light.png",[kt.WARM]:"./board/warm.png",[kt.RESIN]:"./board/resin.png"},Mt={black:{pawn:{row:3,column:0,width:2},lance:{row:2,column:0,width:1},knight:{row:2,column:1,width:1},silver:{row:1,column:0,width:1},gold:{row:1,column:1,width:1},bishop:{row:0,column:0,width:1},rook:{row:0,column:1,width:1},king:{row:0,column:0,width:0},promPawn:{row:0,column:0,width:0},promLance:{row:0,column:0,width:0},promKnight:{row:0,column:0,width:0},promSilver:{row:0,column:0,width:0},horse:{row:0,column:0,width:0},dragon:{row:0,column:0,width:0}},white:{pawn:{row:0,column:0,width:2},lance:{row:1,column:1,width:1},knight:{row:1,column:0,width:1},silver:{row:2,column:1,width:1},gold:{row:2,column:0,width:1},bishop:{row:3,column:1,width:1},rook:{row:3,column:0,width:1},king:{row:0,column:0,width:0},promPawn:{row:0,column:0,width:0},promLance:{row:0,column:0,width:0},promKnight:{row:0,column:0,width:0},promSilver:{row:0,column:0,width:0},horse:{row:0,column:0,width:0},dragon:{row:0,column:0,width:0}}};class Gt{constructor(e,t){(0,Z.Z)(this,"pieceImages",void 0),(0,Z.Z)(this,"boardImage",void 0),this.pieceImages=Dt[e]||Dt[Ht.HITOMOJI],this.boardImage=Lt[t]}preload(){bt(this.boardImage),Object.values(this.pieceImages.black).forEach(bt),Object.values(this.pieceImages.white).forEach(bt)}build(e,t,i,n,o,a){let s=e.width/Ct.frame.width;Ct.frame.height*s>e.height&&(s=e.height/Ct.frame.height);const r=()=>({style:{height:Ct.frame.height*s+"px",width:Ct.frame.width*s+"px"}}),c=()=>{const e=this.boardImage,t=Ct.board.x*s,i=Ct.board.y*s,n=Ct.board.width*s,o=Ct.board.height*s,a={left:t+"px",top:i+"px",height:o+"px",width:n+"px"};return{imagePath:e,x:t,y:i,style:a}},l=e=>{const i=[];return t.board.listNonEmptySquares().forEach((n=>{const o=t.board.at(n),r=o.id+n.index,c=a?z(o.color):o.color,l=o.type==j.KING&&o.color==Y.BLACK?"king2":o.type,u=this.pieceImages[c][l],d=e.x+(Ct.board.leftPiecePadding+Ct.board.squreWidth*(a?n.opposite:n).x)*s,h=e.y+(Ct.board.topPiecePadding+Ct.board.squreHeight*(a?n.opposite:n).y)*s,p=Ct.piece.width*s,m=Ct.piece.height*s;i.push({id:r,imagePath:u,style:{left:d+"px",top:h+"px",width:p+"px",height:m+"px"}})})),i},u=e=>{const t=[];return Ae.all.forEach((o=>{const r=o.index,{file:c}=o,{rank:l}=o,u=e.x+(Ct.board.leftSquarePadding+Ct.board.squreWidth*(a?o.opposite:o).x)*s,d=e.y+(Ct.board.topSquarePadding+Ct.board.squreHeight*(a?o.opposite:o).y)*s,h=Ct.board.squreWidth*s,p=Ct.board.squreHeight*s,m={left:u+"px",top:d+"px",width:h+"px",height:p+"px"};let _=m;i&&o.equals(i.to)&&(_={..._,...Ct.board.highlight.lastMove}),n instanceof Ae&&n.equals(o)&&(_={..._,...Ct.board.highlight.selected}),t.push({id:r,file:c,rank:l,style:m,backgroundStyle:_})})),t},d=(e,t)=>{const i=a?z(e):e,o=Ct.hand[i].x*s,r=Ct.hand[i].y*s,c=Ct.hand.width*s,l=Ct.hand.height*s,u={"background-color":Ct.hand.color,left:o+"px",top:r+"px",width:c+"px",height:l+"px"},d=[],h=[];return te.forEach((o=>{const a=t.count(o),r=Mt[i][o],c=Ct.hand.width/2*r.width*s,l=Ct.hand.height/4*s,u=c*r.column,p=l*r.row,m=Ct.piece.width*s,_=Ct.piece.height*s,g=Math.max(c-m*a,0)/(2*a),E=(c-m-2*g)/Math.max(a-1,1);for(let e=a-1;e>=0;e-=1){const t=o+e,n=this.pieceImages[i][o],a=u+g+E*e,s=p;d.push({id:t,imagePath:n,style:{left:a+"px",top:s+"px",width:m+"px",height:_+"px"}})}const S=o,I={left:u+"px",top:p+"px",width:c+"px",height:l+"px"};let v=I;n&&n instanceof de&&n.color===e&&n.type===o&&(v={...v,...Ct.hand.highlight.selected}),h.push({id:S,type:o,style:I,backgroundStyle:v})})),{style:u,pieces:d,pointers:h}},h=(e,t)=>{if(!t)return null;const i=a?z(t.color):t.color,n=a?t.to.opposite:t.to,o=new de(i,t.pieceType),r=o.promoted(),c=o.unpromoted(),l=this.pieceImages[i][r.type],u=this.pieceImages[i][c.type],d=e.x+(Ct.board.leftSquarePadding+Ct.board.squreWidth*(n.x-.5))*s,h=e.y+(Ct.board.topSquarePadding+Ct.board.squreHeight*n.y)*s,p=2*Ct.board.squreWidth*s,m=Ct.board.squreHeight*s,_={left:d+"px",top:h+"px",width:p+"px",height:m+"px","font-size":m/4+"px"};return{promoteImagePath:l,notPromoteImagePath:u,style:_}},p=()=>{const e=t.color,i=a?z(e):e,n=2;return{style:{left:Ct.turn[i].x*s-n+"px",top:Ct.turn[i].y*s-n+"px",width:Ct.turn.width*s-n+"px",height:Ct.turn.height*s-n+"px","font-size":Ct.turn.fontSize*s+"px","border-radius":Ct.turn.height*s*.4+"px","border-width":n+"px","border-style":"solid"}}},m=e=>{const t=a?z(e):e;return{style:{left:Ct.playerName[t].x*s+"px",top:Ct.playerName[t].y*s+"px",width:Ct.playerName.width*s+"px",height:Ct.playerName.height*s+"px","font-size":Ct.playerName.fontSize*s+"px"}}},_=e=>{const t=a?z(e):e;return{style:{left:Ct.clock[t].x*s+"px",top:Ct.clock[t].y*s+"px",width:Ct.clock.width*s+"px",height:Ct.clock.height*s+"px","font-size":Ct.clock.fontSize*s+"px"}}},g=()=>({left:{style:{left:Ct.control.left.x*s+"px",top:Ct.control.left.y*s+"px",width:Ct.control.left.width*s+"px",height:Ct.control.left.height*s+"px","font-size":Ct.control.left.fontSize*s+"px"}},right:{style:{left:Ct.control.right.x*s+"px",top:Ct.control.right.y*s+"px",width:Ct.control.right.width*s+"px",height:Ct.control.right.height*s+"px","font-size":Ct.control.right.fontSize*s+"px"}}}),E=r(),S=c(),I=l(S),v=u(S),f=d(Y.BLACK,t.hand(Y.BLACK)),T=d(Y.WHITE,t.hand(Y.WHITE)),O=h(S,o),w=p(),A=m(Y.BLACK),N=m(Y.WHITE),R=_(Y.BLACK),P=_(Y.WHITE),y=g();return{frame:E,board:S,piece:I,square:v,blackHand:f,whiteHand:T,promotion:O,turn:w,blackPlayerName:A,whitePlayerName:N,blackClock:R,whiteClock:P,control:y}}}class Bt{constructor(e,t){(0,Z.Z)(this,"width",void 0),(0,Z.Z)(this,"height",void 0),this.width=e,this.height=t}add(e){return new Bt(this.width+e.width,this.height+e.height)}reduce(e){return new Bt(this.width-e.width,this.height-e.height)}}var xt=(0,o.aZ)({name:"BoardView",props:{pieceImageType:{type:String,required:!0},boardImageType:{type:String,required:!0},maxSize:{type:Bt,required:!0},position:{type:Object,required:!0},lastMove:{type:Pe,required:!1,default:null},flip:{type:Boolean,required:!1},allowEdit:{type:Boolean,required:!1},allowMove:{type:Boolean,required:!1},blackPlayerName:{type:String,required:!1,default:"先手"},whitePlayerName:{type:String,required:!1,default:"後手"},blackPlayerTimeMs:{type:Number,required:!1,default:void 0},blackPlayerByoyomi:{type:Number,required:!1,default:void 0},whitePlayerTimeMs:{type:Number,required:!1,default:void 0},whitePlayerByoyomi:{type:Number,required:!1,default:void 0}},emits:["move","edit"],setup(e,t){const i=(0,l.qj)({pointer:null,reservedMove:null}),n=()=>{i.pointer=null,i.reservedMove=null};(0,o.YP)([()=>e.position,()=>e.allowEdit,()=>e.allowMove],(()=>{n()}));const a=()=>{n()},s=(o,a,s)=>{const r=i.pointer;if(n(),!(o instanceof Ae&&r instanceof Ae&&o.equals(r))&&!(o instanceof de&&r instanceof de&&o.equals(r))){if(r){const n=r,a=o instanceof Ae?o:o.color;if(e.allowEdit&&e.position.isValidEditing(n,a))return void t.emit("edit",{move:{from:r,to:a}});if(e.allowMove&&o instanceof Ae){const n=r instanceof Ae?r:r.type,a=o,s=e.position.createMove(n,a);if(!s)return;const c=e.position.isValidMove(s),l=e.position.isValidMove(s.withPromote());if(c&&l)return void(i.reservedMove=s);if(c)return void t.emit("move",s);if(l)return void t.emit("move",s.withPromote())}}!e.allowMove&&!e.allowEdit||a||(e.allowEdit||s===e.position.color)&&(i.pointer=o)}},r=(t,i,n)=>{t.stopPropagation(),t.preventDefault();const o=new Ae(i,n),a=e.position.board.at(o),r=!a;s(o,r,a?.color)},c=(t,i,n)=>{t.stopPropagation(),t.preventDefault();const o=0===e.position.hand(i).count(n);s(new de(i,n),o,i)},u=(i,o,a)=>{i.stopPropagation(),i.preventDefault(),n();const s=new Ae(o,a);e.allowEdit&&e.position.board.at(s)&&t.emit("edit",{rotate:s})},d=o=>{o.stopPropagation(),o.preventDefault();const a=i.reservedMove;n(),a&&e.position.isValidMove(a.withPromote())&&t.emit("move",a.withPromote())},h=o=>{o.stopPropagation(),o.preventDefault();const a=i.reservedMove;n(),a&&e.position.isValidMove(a)&&t.emit("move",a)},p=(0,o.Fl)((()=>{const t=new Gt(e.pieceImageType,e.boardImageType);return t.preload(),t})),m=(0,o.Fl)((()=>p.value.build(e.maxSize.reduce(new Bt(20,20)),e.position,e.lastMove,i.pointer,i.reservedMove,e.flip))),_=(e,t)=>e?Ke(Math.ceil(e/1e3)):void 0!==t?""+t:"0:00:00",g=(e,t)=>{if(!e&&!t)return"normal";const i=(e||0)/1e3+(t||0);return i<=5?"danger":i<=10?"warning":"normal"},E=(0,o.Fl)((()=>_(e.blackPlayerTimeMs,e.blackPlayerByoyomi))),S=(0,o.Fl)((()=>g(e.blackPlayerTimeMs,e.blackPlayerByoyomi))),I=(0,o.Fl)((()=>_(e.whitePlayerTimeMs,e.whitePlayerByoyomi))),v=(0,o.Fl)((()=>g(e.whitePlayerTimeMs,e.whitePlayerByoyomi)));return{clickFrame:a,clickSquare:r,clickHand:c,clickSquareR:u,clickPromote:d,clickNotPromote:h,layout:m,blackPlayerTimeText:E,blackPlayerTimeSeverity:S,whitePlayerTimeText:I,whitePlayerTimeSeverity:v}}}),Ut=i(3744);const Wt=(0,Ut.Z)(xt,[["render",V],["__scopeId","data-v-46c90ba8"]]);var Kt,Ft,qt,Vt=Wt;function Yt(e){return void 0!==e.value?e.value:void 0!==e.default?"string"===e.type&&"<empty>"===e.default?"":e.default:void 0}function jt(e,t){e.uri=t.uri,e.name=t.name,Object.keys(t.options).forEach((i=>{e.options[i]&&(e.options[i].value=t.options[i].value)}))}class Zt{constructor(e){if((0,Z.Z)(this,"engines",void 0),this.engines={},e){const t=JSON.parse(e);t.engines instanceof Object&&(this.engines=t.engines)}}hasEngine(e){return!!this.engines[e]}addEngine(e){this.engines[e.uri]=e}updateEngine(e){return!!this.engines[e.uri]&&(this.engines[e.uri]=e,!0)}removeEngine(e){return!!this.engines[e]&&(delete this.engines[e],!0)}getEngine(e){return this.engines[e]}get engineList(){return Object.values(this.engines).sort(((e,t)=>e.name>t.name?1:-1))}get json(){return JSON.stringify(this)}get jsonWithIndent(){return JSON.stringify(this,void 0,2)}}function zt(e){return{pieceImage:Ht.HITOMOJI,boardImage:kt.LIGHT,pieceVolume:30,clockVolume:30,clockPitch:500,clockSoundTarget:qt.ONLY_USER,boardFlipping:!1,tab:Ft.RECORD_INFO,returnCode:e||"\r\n"}}(function(e){e["NEW_RECORD"]="newRecord",e["OPEN_RECORD"]="openRecord",e["SAVE_RECORD"]="saveRecord",e["SAVE_RECORD_AS"]="saveRecordAs",e["COPY_RECORD"]="copyRecord",e["PASTE_RECORD"]="pasteRecord",e["REMOVE_RECORD_AFTER"]="remvoeRecordAfter",e["START_POSITION_EDITING"]="startPositionEditing",e["END_POSITION_EDITING"]="endPositionEditing",e["CHANGE_TURN"]="changeTurn",e["INIT_POSITION_STANDARD"]="initPositionStandard",e["INIT_POSITION_HANDICAP_LANCE"]="initPositionHandicapLance",e["INIT_POSITION_HANDICAP_RIGHT_LANCE"]="initPositionHandicapRightLance",e["INIT_POSITION_HANDICAP_BISHOP"]="initPositionHandicapBishop",e["INIT_POSITION_HANDICAP_ROOK"]="initPositionHandicapRook",e["INIT_POSITION_HANDICAP_ROOK_LANCE"]="initPositionHandicapRookLance",e["INIT_POSITION_HANDICAP_2PIECES"]="initPositionHandicap2Pieces",e["INIT_POSITION_HANDICAP_4PIECES"]="initPositionHandicap4Pieces",e["INIT_POSITION_HANDICAP_6PIECES"]="initPositionHandicap6Pieces",e["INIT_POSITION_HANDICAP_8PIECES"]="initPositionHandicap8Pieces",e["INIT_POSITION_TSUME_SHOGI"]="initPositionTsumeShogi",e["START_RESEARCH"]="startResearch",e["STOP_RESEARCH"]="stopResearch",e["START_GAME"]="startGame",e["STOP_GAME"]="stopGame",e["RESIGN"]="resign",e["FLIP_BOARD"]="flipBoard",e["APP_SETTING_DIALOG"]="appSetting",e["USI_ENGINE_SETTING_DIALOG"]="usiEngineSetting"})(Kt||(Kt={})),function(e){e["RECORD_INFO"]="recordInfo",e["COMMENT"]="comment",e["SEARCH"]="search",e["CHART"]="chart",e["INVISIBLE"]="invisible"}(Ft||(Ft={})),function(e){e["ALL"]="all",e["ONLY_USER"]="onlyUser"}(qt||(qt={}));const Jt="es://human",$t="es://usi-engine/";function Xt(e){return e.startsWith($t)}function Qt(){return{black:{name:"人",uri:Jt},white:{name:"人",uri:Jt},timeLimit:{timeSeconds:0,byoyomi:30,increment:0},enableEngineTimeout:!1,humanIsFront:!0}}function ei(e){return 0===e.timeLimit.timeSeconds&&0===e.timeLimit.byoyomi?new Error("持ち時間と秒読みが両方とも0です。"):0!==e.timeLimit.byoyomi&&0!==e.timeLimit.increment?new Error("秒読みとフィッシャールールは併用できません。"):void 0}function ti(){return{}}var ii;(function(e){e["APP_SETTING"]="appSetting",e["RESEARCH_SETTING"]="researchSetting",e["GAME_SETTING"]="gameSetting"})(ii||(ii={}));const ni={async getRecordPathFromProcArg(){return""},updateMenuState(){},async showOpenRecordDialog(){throw"Web版では利用できない機能です。"},async openRecord(){throw"Web版では利用できない機能です。"},async showSaveRecordDialog(){throw"Web版では利用できない機能です。"},async saveRecord(){throw"Web版では利用できない機能です。"},async showSelectFileDialog(){throw"Web版では利用できない機能です。"},async loadAppSetting(){const e=localStorage.getItem(ii.APP_SETTING);return e?JSON.stringify({...zt(),...JSON.parse(e)}):JSON.stringify(zt())},async saveAppSetting(e){localStorage.setItem(ii.APP_SETTING,e)},async loadResearchSetting(){const e=localStorage.getItem(ii.RESEARCH_SETTING);return e?JSON.stringify({...ti(),...JSON.parse(e)}):JSON.stringify(ti())},async saveResearchSetting(e){localStorage.setItem(ii.RESEARCH_SETTING,e)},async loadGameSetting(){const e=localStorage.getItem(ii.GAME_SETTING);return e?JSON.stringify({...Qt(),...JSON.parse(e)}):JSON.stringify(Qt())},async saveGameSetting(e){localStorage.setItem(ii.GAME_SETTING,e)},async loadUSIEngineSetting(){return(new Zt).json},async saveUSIEngineSetting(){},async showSelectUSIEngineDialog(){throw"Web版では利用できない機能です。"},async getUSIEngineInfo(){throw"Web版では利用できない機能です。"},async startResearch(){throw"Web版では利用できない機能です。"},async endResearch(){throw"Web版では利用できない機能です。"},async startGame(){},async endGame(){},async updateUSIPosition(){},async stopUSI(){},async sendUSISetOption(){},onSendError(){},onMenuEvent(){},onUSIBestMove(){},onUSIInfo(){}};function oi(){return window}function ai(){return!!oi().electronShogiAPI}function si(){return oi().electronShogiAPI||ni}async function ri(){return await si().getRecordPathFromProcArg()}async function ci(){return await si().showOpenRecordDialog()}async function li(e){return await si().openRecord(e)}async function ui(e){return await si().showSaveRecordDialog(e)}async function di(e,t){await si().saveRecord(e,t)}async function hi(){return await si().showSelectFileDialog()}async function pi(){return JSON.parse(await si().loadAppSetting())}async function mi(e){await si().saveAppSetting(JSON.stringify(e))}async function _i(){return JSON.parse(await si().loadResearchSetting())}async function gi(e){await si().saveResearchSetting(JSON.stringify(e))}async function Ei(){return JSON.parse(await si().loadGameSetting())}async function Si(e){await si().saveGameSetting(JSON.stringify(e))}async function Ii(){return new Zt(await si().loadUSIEngineSetting())}async function vi(e){await si().saveUSIEngineSetting(e.jsonWithIndent)}async function fi(){return await si().showSelectUSIEngineDialog()}async function Ti(e){return JSON.parse(await si().getUSIEngineInfo(e))}async function Oi(e,t){await si().startResearch(JSON.stringify(e),t)}async function wi(){await si().endResearch()}async function Ai(e,t){await si().startGame(JSON.stringify(e),t)}async function Ni(e,t){await si().endGame(e,t)}async function Ri(e,t,i,n){await si().updateUSIPosition(e,JSON.stringify(t),i,n)}async function Pi(e){await si().stopUSI(e)}async function yi(e,t){await si().sendUSISetOption(e,t)}function bi(e){const t=si();t.onSendError((t=>{e.commit(ji.PUSH_ERROR,t)})),t.onMenuEvent((t=>{if(!e.getters.isBussy)switch(t){case Kt.NEW_RECORD:e.commit(ji.NEW_RECORD);break;case Kt.OPEN_RECORD:e.dispatch(Zi.OPEN_RECORD);break;case Kt.SAVE_RECORD:e.dispatch(Zi.SAVE_RECORD,{overwrite:!0});break;case Kt.SAVE_RECORD_AS:e.dispatch(Zi.SAVE_RECORD);break;case Kt.COPY_RECORD:e.dispatch(Zi.COPY_RECORD);break;case Kt.PASTE_RECORD:e.commit(ji.SHOW_PASTE_DIALOG);break;case Kt.REMOVE_RECORD_AFTER:e.dispatch(Zi.REMOVE_RECORD_AFTER);break;case Kt.START_POSITION_EDITING:e.dispatch(Zi.START_POSITION_EDITING);break;case Kt.END_POSITION_EDITING:e.dispatch(Zi.END_POSITION_EDITING);break;case Kt.CHANGE_TURN:e.commit(ji.CHANGE_TURN);break;case Kt.INIT_POSITION_STANDARD:e.dispatch(Zi.INITIALIZE_POSITION,be.STANDARD);break;case Kt.INIT_POSITION_HANDICAP_LANCE:e.dispatch(Zi.INITIALIZE_POSITION,be.HANDICAP_LANCE);break;case Kt.INIT_POSITION_HANDICAP_RIGHT_LANCE:e.dispatch(Zi.INITIALIZE_POSITION,be.HANDICAP_RIGHT_LANCE);break;case Kt.INIT_POSITION_HANDICAP_BISHOP:e.dispatch(Zi.INITIALIZE_POSITION,be.HANDICAP_BISHOP);break;case Kt.INIT_POSITION_HANDICAP_ROOK:e.dispatch(Zi.INITIALIZE_POSITION,be.HANDICAP_ROOK);break;case Kt.INIT_POSITION_HANDICAP_ROOK_LANCE:e.dispatch(Zi.INITIALIZE_POSITION,be.HANDICAP_ROOK_LANCE);break;case Kt.INIT_POSITION_HANDICAP_2PIECES:e.dispatch(Zi.INITIALIZE_POSITION,be.HANDICAP_2PIECES);break;case Kt.INIT_POSITION_HANDICAP_4PIECES:e.dispatch(Zi.INITIALIZE_POSITION,be.HANDICAP_4PIECES);break;case Kt.INIT_POSITION_HANDICAP_6PIECES:e.dispatch(Zi.INITIALIZE_POSITION,be.HANDICAP_6PIECES);break;case Kt.INIT_POSITION_HANDICAP_8PIECES:e.dispatch(Zi.INITIALIZE_POSITION,be.HANDICAP_8PIECES);break;case Kt.INIT_POSITION_TSUME_SHOGI:e.dispatch(Zi.INITIALIZE_POSITION,be.TSUME_SHOGI);break;case Kt.START_GAME:e.commit(ji.SHOW_GAME_DIALOG);break;case Kt.STOP_GAME:e.dispatch(Zi.STOP_GAME);break;case Kt.RESIGN:e.dispatch(Zi.RESIGN_BY_USER);break;case Kt.START_RESEARCH:e.commit(ji.SHOW_RESEARCH_DIALOG);break;case Kt.STOP_RESEARCH:e.dispatch(Zi.STOP_RESEARCH);break;case Kt.FLIP_BOARD:e.commit(ji.FLIP_BOARD);break;case Kt.APP_SETTING_DIALOG:e.commit(ji.OPEN_APP_SETTING_DIALOG);break;case Kt.USI_ENGINE_SETTING_DIALOG:e.commit(ji.OPEN_USI_ENGINE_MANAGEMENT_DIALOG);break}})),t.onUSIBestMove(((t,i,n,o)=>{e.dispatch(Zi.DO_MOVE_BY_USI_ENGINE,{sessionID:t,usi:i,color:n,sfen:o})})),t.onUSIInfo(((t,i,n,o,a)=>{e.dispatch(Zi.UPDATE_USI_INFO,{sessionID:t,usi:i,sender:n,name:o,info:JSON.parse(a)})})),(0,o.YP)((()=>[e.state.mode,e.getters.isBussy]),(([e,i])=>{t.updateMenuState(e,i)})),t.updateMenuState(e.state.mode,e.getters.isBussy)}var Hi=i(3907),ki=i(4914),Ci=i.n(ki);function Di(e){const t=e?.type||"sine",i=e?.frequency||440,n=e?.volume||2,o=new AudioContext,a=o.createOscillator(),s=o.createGain();return a.connect(s),s.connect(o.destination),a.type=t,a.frequency.value=i,s.gain.value=.005*n,a.onended=()=>{s.disconnect(o.destination),a.disconnect(s)},a.start(o.currentTime),e?.time&&a.stop(o.currentTime+e.time),{stop:()=>{e?.time||a.stop()}}}function Li(e){Di({type:"sine",frequency:e.frequency,time:.1,volume:e.volume})}function Mi(e){return Di({type:"sine",frequency:e.frequency,volume:e.volume})}let Gi;function Bi(e){const t=Date.now();if(Gi&&t<Gi+200)return;const i=new Audio("sound/piece.mp3");i.volume=.01*e,i.play(),Gi=t}var xi;function Ui(e){switch(e){case xi.BLACK_PLAYER:return"先手";case xi.WHITE_PLAYER:return"後手";case xi.RESEARCHER:return"検討"}}(function(e){e["BLACK_PLAYER"]="blackPlayer",e["WHITE_PLAYER"]="whitePlayer",e["RESEARCHER"]="researcher"})(xi||(xi={}));const Wi=2e3,Ki=-Wi;class Fi{constructor(e){if((0,Z.Z)(this,"evaluation",void 0),e){const t=JSON.parse(e);this.evaluation=t.evaluation}}updateScore(e,t,i){switch(this.evaluation||(this.evaluation={}),t){case xi.BLACK_PLAYER:this.evaluation[xi.BLACK_PLAYER]=i;break;case xi.WHITE_PLAYER:this.evaluation[xi.WHITE_PLAYER]=-i;break;case xi.RESEARCHER:this.evaluation[xi.RESEARCHER]=e===Y.BLACK?i:-i;break}}updateUSIInfo(e,t,i){i.scoreCP?this.updateScore(e,t,Math.min(Math.max(i.scoreCP,Ki),Wi)):i.scoreMate&&this.updateScore(e,t,i.scoreMate>=0?Wi:Ki)}stringify(){return JSON.stringify(this)}}class qi{constructor(){(0,Z.Z)(this,"black",void 0),(0,Z.Z)(this,"white",void 0),(0,Z.Z)(this,"timerHandle",void 0),(0,Z.Z)(this,"timerStart",void 0),(0,Z.Z)(this,"lastTimeMs",void 0),(0,Z.Z)(this,"_elapsedMs",void 0),(0,Z.Z)(this,"_setting",void 0),this.black={timeMs:0,byoyomi:0},this.white={timeMs:0,byoyomi:0},this.timerHandle=0,this.timerStart=new Date,this.lastTimeMs=0,this._elapsedMs=0,this._setting=Qt()}get blackTimeMs(){return this.black.timeMs}get blackByoyomi(){return this.black.byoyomi}get whiteTimeMs(){return this.white.timeMs}get whiteByoyomi(){return this.white.byoyomi}get elapsedMs(){return this._elapsedMs}get setting(){return this._setting}setup(e){this.black.timeMs=1e3*e.timeLimit.timeSeconds,this.black.byoyomi=e.timeLimit.byoyomi,this.white.timeMs=1e3*e.timeLimit.timeSeconds,this.white.byoyomi=e.timeLimit.byoyomi,this._setting=e}getPlayerState(e){switch(e){case Y.BLACK:return this.black;case Y.WHITE:return this.white}}startTimer(e,t){const i=this.getPlayerState(e);this.timerStart=new Date,this.lastTimeMs=i.timeMs,i.byoyomi=this.setting.timeLimit.byoyomi,this.timerHandle=window.setInterval((()=>{const e=i.timeMs,n=i.byoyomi,o=new Date;this._elapsedMs=o.getTime()-this.timerStart.getTime();const a=this.lastTimeMs-this._elapsedMs;if(a>=0?i.timeMs=a:(i.timeMs=0,i.byoyomi=Math.max(Math.ceil(this.setting.timeLimit.byoyomi+a/1e3),0)),0===i.timeMs&&0===i.byoyomi)return void t.timeout();const s=Math.ceil(e/1e3),r=Math.ceil(i.timeMs/1e3),c=i.byoyomi;0===r&&(e>0||c!==n)?c<=5?t.onBeepUnlimited():(c<=10||c%10===0)&&t.onBeepShort():this.setting.timeLimit.byoyomi||r===s||(r<=5?t.onBeepUnlimited():(r<=10||20===r||30===r||60===r)&&t.onBeepShort())}),100)}increment(e){this.getPlayerState(e).timeMs+=1e3*this.setting.timeLimit.increment}clearTimer(){this.timerHandle&&(window.clearInterval(this.timerHandle),this.timerHandle=0),this._elapsedMs=0}}function Vi(e){let t=Yi(e);const i=e.metadata.getStandardMetadata(qe.TITLE)||e.metadata.getStandardMetadata(qe.TOURNAMENT)||e.metadata.getStandardMetadata(qe.OPUS_NAME)||e.metadata.getStandardMetadata(qe.OPUS_NO)||e.metadata.getStandardMetadata(qe.PLACE)||e.metadata.getStandardMetadata(qe.POSTED_ON)||e.metadata.getStandardMetadata(qe.AUTHOR);i&&(t+="_"+i);const n=e.metadata.getStandardMetadata(qe.BLACK_NAME)||e.metadata.getStandardMetadata(qe.BLACK_SHORT_NAME);n&&(t+="_"+n);const o=e.metadata.getStandardMetadata(qe.WHITE_NAME)||e.metadata.getStandardMetadata(qe.WHITE_SHORT_NAME);return o&&(t+="_"+o),t+".kif"}function Yi(e){const t=e.metadata.getStandardMetadata(qe.DATE);return t?t.trim().replaceAll(" ","_").replaceAll("/","").replaceAll(":",""):(new Date).toLocaleDateString(void 0,{year:"numeric",month:"2-digit",day:"2-digit"}).replaceAll("/","")}var ji,Zi;(function(e){e["UPDATE_APP_SETTING"]="updateAppSetting",e["FLIP_BOARD"]="flipBoard",e["SHOW_PASTE_DIALOG"]="showPasteDialog",e["CLOSE_PASTE_DIALOG"]="closePasteDialog",e["SHOW_GAME_DIALOG"]="showGameDialog",e["SHOW_RESEARCH_DIALOG"]="showResearchDialog",e["OPEN_APP_SETTING_DIALOG"]="openAppSettingDialog",e["OPEN_USI_ENGINE_MANAGEMENT_DIALOG"]="openUSIEngineManagementDialog",e["CLOSE_DIALOG"]="closeDialog",e["NEW_RECORD"]="newRecord",e["UPDATE_RECORD_COMMENT"]="updateRecordComment",e["UPDATE_STANDARD_RECORD_METADATA"]="updateStandardRecordMetadata",e["CHANGE_TURN"]="changeTurn",e["EDIT_POSITION"]="editPosition",e["CHANGE_MOVE_NUMBER"]="changeMoveNumber",e["CHANGE_BRANCH"]="changeBranch",e["CLEAR_GAME_TIMER"]="clearGameTimer",e["UPDATE_USI_INFO"]="updateUSIInfo",e["PUSH_MESSAGE"]="pushMessage",e["SHIFT_MESSAGE"]="shiftMessage",e["PUSH_ERROR"]="pushError",e["CLEAR_ERRORS"]="clearErrors",e["RETAIN_BUSSY_STATE"]="retainBussyState",e["RELEASE_BUSSY_STATE"]="releaseBussyState"})(ji||(ji={})),function(e){e["UPDATE_APP_SETTING"]="updateAppSetting",e["OPEN_RECORD"]="openRecord",e["SAVE_RECORD"]="saveRecord",e["COPY_RECORD"]="copyRecord",e["PASTE_RECORD"]="pasteRecord",e["REMOVE_RECORD_AFTER"]="removeRecordAfter",e["START_POSITION_EDITING"]="startPositionEditing",e["END_POSITION_EDITING"]="endPositionEditing",e["INITIALIZE_POSITION"]="initializePosition",e["UPDATE_USI_INFO"]="updateUsiInfo",e["START_RESEARCH"]="startResearch",e["STOP_RESEARCH"]="stopResearch",e["START_GAME"]="startGame",e["STOP_GAME"]="stopGame",e["RESIGN_BY_USER"]="resign",e["DO_MOVE_BY_USER"]="doMoveByUser",e["DO_MOVE_BY_USI_ENGINE"]="doMoveByUSIEngine",e["DO_MOVE"]="doMove",e["RESET_GAME_TIMER"]="resetGameTimer",e["BEEP_UNLIMITED"]="beepUnlimited",e["BEEP_SHORT"]="beepShort",e["SHOW_CONFIRMATION"]="showConfirmation",e["CONFIRMATION_OK"]="confirmationOk",e["CONFIRMATION_CANCEL"]="confirmationCancel"}(Zi||(Zi={}));const zi={state:{count:0},getters:{isBussy(e){return 0!==e.count}},mutations:{[ji.RETAIN_BUSSY_STATE](e){e.count+=1},[ji.RELEASE_BUSSY_STATE](e){e.count-=1}}};function Ji(e,t){const i=e.clone();let n,o="";for(const a of t){const e=i.createMoveBySFEN(a);if(!e)break;i.doMove(e,{ignoreValidation:!0}),o+=e.getDisplayText(n),n=e}return o}class $i{constructor(e){(0,Z.Z)(this,"name",void 0),(0,Z.Z)(this,"nodes",void 0),(0,Z.Z)(this,"nps",void 0),(0,Z.Z)(this,"iterates",void 0),(0,Z.Z)(this,"hashfull",void 0),(0,Z.Z)(this,"currentMove",void 0),(0,Z.Z)(this,"currentMoveText",void 0),this.name=e,this.iterates=[]}update(e,t){const i={};if(void 0!==t.depth&&(i.depth=t.depth),void 0!==t.seldepth&&(i.selectiveDepth=t.seldepth),void 0!==t.timeMs&&(i.timeMs=t.timeMs),void 0!==t.nodes&&(this.nodes=t.nodes),t.pv&&(i.pv=t.pv,i.text=Ji(e,t.pv)),void 0!==t.multipv&&(i.multiPV=t.multipv),void 0!==t.scoreCP&&(i.score=t.scoreCP),void 0!==t.scoreMate&&(i.scoreMate=t.scoreMate),void 0!==t.lowerbound&&(i.lowerBound=t.lowerbound),void 0!==t.upperbound&&(i.upperBound=t.upperbound),void 0!==t.currmove){this.currentMove=t.currmove;const i=e.createMoveBySFEN(t.currmove);i&&(this.currentMoveText=i.getDisplayText())}void 0!==t.hashfullPerMill&&(this.hashfull=t.hashfullPerMill/1e3),void 0!==t.nps&&(this.nps=t.nps),t.string&&(i.text=t.string),0!==Object.keys(i).length&&this.iterates.unshift(i)}}const Xi={mutations:{[ji.UPDATE_USI_INFO](e,t){switch(e.sessionID!=t.sessionID&&(e.blackPlayer=void 0,e.whitePlayer=void 0,e.researcher=void 0,e.sessionID=t.sessionID),t.sender){case xi.BLACK_PLAYER:e.blackPlayer&&e.blackPosition===t.position.sfen||(e.blackPlayer=new $i(t.name),e.blackPosition=t.position.sfen),e.blackPlayer.update(t.position,t.info);break;case xi.WHITE_PLAYER:e.whitePlayer&&e.whitePosition===t.position.sfen||(e.whitePlayer=new $i(t.name),e.whitePosition=t.position.sfen),e.whitePlayer.update(t.position,t.info);break;case xi.RESEARCHER:e.researcher&&e.researchPosition===t.position.sfen||(e.researcher=new $i(t.name),e.researchPosition=t.position.sfen),e.researcher.update(t.position,t.info);break}}}};var Qi;(function(e){e["NORMAL"]="normal",e["PASTE_DIALOG"]="pasteDialog",e["POSITION_EDITING"]="positionEditing",e["GAME"]="game",e["GAME_DIALOG"]="gameDialog",e["RESEARCH"]="research",e["RESEARCH_DIALOG"]="researchDialog",e["USI_ENGINE_SETTING_DIALOG"]="usiEngineSettingDialog",e["APP_SETTING_DIALOG"]="appSettingDialog",e["TEMPORARY"]="temporary"})(Qi||(Qi={}));const en={state:{queue:[]},getters:{hasMessage(e){return 0!==e.queue.length},message(e){return e.queue[0]}},mutations:{[ji.PUSH_MESSAGE](e,t){e.queue.push(t)},[ji.SHIFT_MESSAGE](e){e.queue.shift()}}},tn={state:{queue:[]},getters:{hasError(e){return 0!==e.queue.length}},mutations:{[ji.PUSH_ERROR](e,t){t instanceof Error?e.queue.push(t):e.queue.push(new Error(t))},[ji.CLEAR_ERRORS](e){e.queue=[]}}},nn={state:{},actions:{[Zi.SHOW_CONFIRMATION]({state:e,rootState:t},i){e.confirmation=i,e.lastMode=t.mode,t.mode=Qi.TEMPORARY},[Zi.CONFIRMATION_OK]({state:e,rootState:t}){const i=e.confirmation?.onOk;e.confirmation=void 0,e.lastMode&&(t.mode=e.lastMode,e.lastMode=void 0),i&&i()},[Zi.CONFIRMATION_CANCEL]({state:e,rootState:t}){const i=e.confirmation?.onCancel;e.confirmation=void 0,e.lastMode&&(t.mode=e.lastMode,e.lastMode=void 0),i&&i()}}},on=Symbol();function an(){return(0,Hi.oR)(on)}const sn=(0,Hi.MT)({state:{appSetting:zt(),record:new $e,mode:Qi.NORMAL,usiSessionID:0,game:new qi},modules:{usi:Xi,message:en,error:tn,bussy:zi,confirmation:nn},getters:{isMovableByUser(e){switch(e.mode){case Qi.NORMAL:case Qi.RESEARCH:return!0;case Qi.GAME:return(e.record.position.color===Y.BLACK?e.game.setting.black.uri:e.game.setting.white.uri)===Jt}return!1}},mutations:{[ji.UPDATE_APP_SETTING](e,t){e.appSetting={...e.appSetting,...t}},[ji.FLIP_BOARD](e){e.appSetting.boardFlipping=!e.appSetting.boardFlipping,mi(e.appSetting)},[ji.SHOW_PASTE_DIALOG](e){e.mode===Qi.NORMAL&&(e.mode=Qi.PASTE_DIALOG)},[ji.CLOSE_PASTE_DIALOG](e){e.mode===Qi.PASTE_DIALOG&&(e.mode=Qi.NORMAL)},[ji.SHOW_GAME_DIALOG](e){e.mode===Qi.NORMAL&&(e.mode=Qi.GAME_DIALOG)},[ji.SHOW_RESEARCH_DIALOG](e){e.mode===Qi.NORMAL&&(e.mode=Qi.RESEARCH_DIALOG)},[ji.OPEN_APP_SETTING_DIALOG](e){e.mode===Qi.NORMAL&&(e.mode=Qi.APP_SETTING_DIALOG)},[ji.OPEN_USI_ENGINE_MANAGEMENT_DIALOG](e){e.mode===Qi.NORMAL&&(e.mode=Qi.USI_ENGINE_SETTING_DIALOG)},[ji.CLOSE_DIALOG](e){e.mode!==Qi.USI_ENGINE_SETTING_DIALOG&&e.mode!==Qi.APP_SETTING_DIALOG&&e.mode!==Qi.GAME_DIALOG&&e.mode!==Qi.RESEARCH_DIALOG||(e.mode=Qi.NORMAL)},[ji.NEW_RECORD](e){e.mode==Qi.NORMAL&&(e.record.clear(new xe),e.recordFilePath=void 0)},[ji.UPDATE_RECORD_COMMENT](e,t){e.record.current.comment=t},[ji.UPDATE_STANDARD_RECORD_METADATA](e,t){e.record.metadata.setStandardMetadata(t.key,t.value)},[ji.CHANGE_TURN](e){if(e.mode!=Qi.POSITION_EDITING)return;const t=e.record.position.clone();t.setColor(z(t.color)),e.record.clear(t)},[ji.EDIT_POSITION](e,t){if(e.mode===Qi.POSITION_EDITING){const i=e.record.position.clone();i.edit(t),e.record.clear(i)}},[ji.CHANGE_MOVE_NUMBER](e,t){e.mode!==Qi.NORMAL&&e.mode!==Qi.RESEARCH||e.record.goto(t)},[ji.CHANGE_BRANCH](e,t){e.mode!==Qi.NORMAL&&e.mode!==Qi.RESEARCH||e.record.current.branchIndex!==t&&e.record.switchBranchByIndex(t)},[ji.CLEAR_GAME_TIMER](e){e.game.clearTimer(),e.beep5sHandler&&(e.beep5sHandler.stop(),e.beep5sHandler=void 0)}},actions:{async[Zi.UPDATE_APP_SETTING]({commit:e,state:t},i){await mi({...t.appSetting,...i}),e(ji.UPDATE_APP_SETTING,i)},async[Zi.OPEN_RECORD]({commit:e,state:t},i){if(t.mode!==Qi.NORMAL)return!1;e(ji.RETAIN_BUSSY_STATE);try{if(!i&&(i=await ci(),!i))return!1;const n=await li(i);if(i.match(/\.kif$/)||i.match(/\.kifu$/)){const o=i.match(/\.kif$/)?Ci().decode(n,"Shift_JIS"):n.toString(),a=Et(o);return a instanceof $e?(t.recordFilePath=i,t.record=a):e(ji.PUSH_ERROR,a),!0}return e(ji.PUSH_ERROR,"不明なファイル形式: "+i),!1}catch(n){return e(ji.PUSH_ERROR,"棋譜の読み込み中にエラーが出ました: "+n),!1}finally{e(ji.RELEASE_BUSSY_STATE)}},async[Zi.SAVE_RECORD]({commit:e,state:t},i){if(t.mode!==Qi.NORMAL)return!1;e(ji.RETAIN_BUSSY_STATE);try{let n=t.recordFilePath;if(!i?.overwrite||!n){const e=Vi(t.record);if(n=await ui(e),!n)return!1}if(n.match(/\.kif$/)||n.match(/\.kifu$/)){const e=Pt(t.record,{returnCode:t.appSetting.returnCode}),i=n.match(/\.kif$/)?Ci().encode(e,"Shift_JIS"):Buffer.from(e);return await di(n,i),t.recordFilePath=n,!0}return e(ji.PUSH_ERROR,"不明なファイル形式: "+n),!1}catch(n){return e(ji.PUSH_ERROR,"棋譜の保存中にエラーが出ました: "+n),!1}finally{e(ji.RELEASE_BUSSY_STATE)}},[Zi.COPY_RECORD]({state:e}){const t=Pt(e.record,{returnCode:e.appSetting.returnCode});navigator.clipboard.writeText(t)},[Zi.PASTE_RECORD]({state:e,commit:t},i){if(e.mode!==Qi.NORMAL)return;const n=Et(i);n instanceof $e?(e.recordFilePath=void 0,e.record=n):t(ji.PUSH_ERROR,n)},[Zi.REMOVE_RECORD_AFTER]({state:e,dispatch:t}){if(e.mode!==Qi.NORMAL&&e.mode!==Qi.RESEARCH)return;const i=e.record.current.next;i&&i.move instanceof Pe?t(Zi.SHOW_CONFIRMATION,{message:`${e.record.current.number}手目以降を削除します。よろしいですか？`,onOk:()=>{e.record.removeAfter()}}):e.record.removeAfter()},[Zi.START_POSITION_EDITING]({state:e,dispatch:t}){e.mode===Qi.NORMAL&&t(Zi.SHOW_CONFIRMATION,{message:"現在の棋譜は削除されます。よろしいですか？",onOk:()=>{e.mode=Qi.POSITION_EDITING,e.record.clear(e.record.position),e.recordFilePath=void 0}})},[Zi.END_POSITION_EDITING]({state:e}){e.mode===Qi.POSITION_EDITING&&(e.mode=Qi.NORMAL)},[Zi.INITIALIZE_POSITION]({state:e,dispatch:t},i){e.mode==Qi.POSITION_EDITING&&t(Zi.SHOW_CONFIRMATION,{message:"現在の局面は破棄されます。よろしいですか？",onOk:()=>{const t=new xe;t.reset(i),e.record.clear(t)}})},[Zi.UPDATE_USI_INFO]({state:e,commit:t},i){if(e.usiSessionID!==i.sessionID||e.record.usi!=i.usi)return;t(ji.UPDATE_USI_INFO,{sessionID:i.sessionID,position:e.record.position,sender:i.sender,name:i.name,info:i.info});const n=new Fi(e.record.current.customData);n.updateUSIInfo(e.record.position.color,i.sender,i.info),e.record.current.customData=n.stringify()},async[Zi.START_RESEARCH]({commit:e,state:t},i){if(t.mode!==Qi.RESEARCH_DIALOG)return!1;e(ji.RETAIN_BUSSY_STATE);try{return await gi(i),t.usiSessionID+=1,await Oi(i,t.usiSessionID),t.mode=Qi.RESEARCH,!0}catch(n){return e(ji.PUSH_ERROR,"検討の初期化中にエラーが出ました: "+n),!1}finally{e(ji.RELEASE_BUSSY_STATE)}},async[Zi.STOP_RESEARCH]({commit:e,state:t}){if(t.mode!==Qi.RESEARCH)return!1;e(ji.RETAIN_BUSSY_STATE);try{return await wi(),t.mode=Qi.NORMAL,!0}catch(i){return e(ji.PUSH_ERROR,"検討の終了中にエラーが出ました: "+i),!1}finally{e(ji.RELEASE_BUSSY_STATE)}},async[Zi.START_GAME]({commit:e,state:t},i){if(t.mode!==Qi.GAME_DIALOG)return!1;e(ji.RETAIN_BUSSY_STATE);try{if(await Si(i),i.startPosition){const e=new xe;e.reset(i.startPosition),t.record.clear(e),t.recordFilePath=void 0}if(t.usiSessionID+=1,await Ai(i,t.usiSessionID),t.game.setup(i),t.mode=Qi.GAME,t.record.metadata.setStandardMetadata(qe.BLACK_NAME,i.black.name),t.record.metadata.setStandardMetadata(qe.WHITE_NAME,i.white.name),i.humanIsFront){let n=t.appSetting.boardFlipping;i.black.uri===Jt&&i.white.uri!==Jt?n=!1:i.black.uri!==Jt&&i.white.uri===Jt&&(n=!0),n!==t.appSetting.boardFlipping&&e(ji.FLIP_BOARD)}return!0}catch(n){return e(ji.PUSH_ERROR,"対局の初期化中にエラーが出ました: "+n),!1}finally{e(ji.RELEASE_BUSSY_STATE)}},async[Zi.STOP_GAME]({commit:e,state:t},i){if(t.mode!==Qi.GAME)return!1;i&&e(ji.PUSH_MESSAGE,`対局終了（${ze(i)})`),e(ji.RETAIN_BUSSY_STATE);try{return await Ni(t.record.usi,i),t.record.append(i||Ve.INTERRUPT),t.record.current.setElapsedMs(t.game.elapsedMs),t.mode=Qi.NORMAL,!0}catch(n){return e(ji.PUSH_ERROR,"対局の終了中にエラーが出ました: "+n),!1}finally{e(ji.RELEASE_BUSSY_STATE)}},[Zi.RESIGN_BY_USER]({state:e,getters:t,dispatch:i}){return e.mode===Qi.GAME&&(t.isMovableByUser?i(Zi.STOP_GAME,Ve.RESIGN):void 0)},[Zi.DO_MOVE_BY_USER]({dispatch:e,state:t,getters:i},n){return!!i.isMovableByUser&&(t.mode===Qi.GAME&&t.game.increment(t.record.position.color),e(Zi.DO_MOVE,n),!0)},[Zi.DO_MOVE_BY_USI_ENGINE]({commit:e,dispatch:t,state:i},n){if(i.mode!==Qi.GAME)return!1;if(i.usiSessionID!==n.sessionID)return!1;if(i.record.usi!==n.usi)return!1;if(n.color!==i.record.position.color)return e(ji.PUSH_ERROR,"手番ではないエンジンから指し手を受信しました:"+n.sfen),t(Zi.STOP_GAME,Ve.FOUL_LOSE),!1;if("resign"===n.sfen)return t(Zi.STOP_GAME,Ve.RESIGN),!0;if("win"===n.sfen)return t(Zi.STOP_GAME,Ve.ENTERING_OF_KING),!0;const o=i.record.position.createMoveBySFEN(n.sfen);return o&&i.record.position.isValidMove(o)?(i.game.increment(i.record.position.color),t(Zi.DO_MOVE,o),!0):(e(ji.PUSH_ERROR,"エンジンから不明な指し手を受信しました:"+n.sfen),t(Zi.STOP_GAME,Ve.FOUL_LOSE),!1)},[Zi.DO_MOVE]({state:e,dispatch:t},i){if(e.record.append(i,{ignoreValidation:!0}),e.record.current.setElapsedMs(e.game.elapsedMs),Bi(e.appSetting.pieceVolume),e.mode!==Qi.GAME)return;const n=e.record.perpetualCheck;n?n===e.record.position.color?t(Zi.STOP_GAME,Ve.FOUL_LOSE):t(Zi.STOP_GAME,Ve.FOUL_WIN):e.record.repetition&&t(Zi.STOP_GAME,Ve.REPETITION_DRAW)},[Zi.RESET_GAME_TIMER]({dispatch:e,getters:t,state:i}){const n=i.record.position.color;i.game.startTimer(n,{timeout:()=>{t.isMovableByUser||i.game.setting.enableEngineTimeout?e(Zi.STOP_GAME,Ve.TIMEOUT):Pi(n)},onBeepShort:()=>{e(Zi.BEEP_SHORT)},onBeepUnlimited:()=>{e(Zi.BEEP_UNLIMITED)}})},[Zi.BEEP_UNLIMITED]({state:e,getters:t}){(e.appSetting.clockSoundTarget!==qt.ONLY_USER||t.isMovableByUser)&&(e.beep5sHandler||(e.beep5sHandler=Mi({frequency:e.appSetting.clockPitch,volume:e.appSetting.clockVolume})))},[Zi.BEEP_SHORT]({state:e,getters:t}){(e.appSetting.clockSoundTarget!==qt.ONLY_USER||t.isMovableByUser)&&(e.beep5sHandler||Li({frequency:e.appSetting.clockPitch,volume:e.appSetting.clockVolume}))}}});(0,o.YP)([()=>sn.state.mode,()=>sn.state.record.position],(()=>{sn.commit(ji.CLEAR_GAME_TIMER),sn.state.mode===Qi.GAME&&sn.dispatch(Zi.RESET_GAME_TIMER),sn.state.mode!==Qi.GAME&&sn.state.mode!==Qi.RESEARCH||Ri(sn.state.record.usi,sn.state.game.setting,sn.state.game.blackTimeMs,sn.state.game.whiteTimeMs)}),{deep:!0});const rn=["src"];function cn(e,t,i,n,a,s){return(0,o.wg)(),(0,o.iD)("img",{class:"icon",src:e.source},null,8,rn)}var ln;(function(e){e["BUSSY"]="bussy",e["ERROR"]="error",e["INFO"]="info",e["GAME"]="game",e["STOP"]="stop",e["RESIGN"]="resign",e["RESEARCH"]="research",e["END"]="end",e["EDIT"]="edit",e["CHECK"]="check",e["SWAP"]="swap",e["SWAP_H"]="swap_h",e["SETTINGS"]="settings",e["ENGINE_SETTINGS"]="engineSettings",e["FLIP"]="flip",e["PASTE"]="paste",e["COPY"]="copy",e["DELETE"]="delete",e["COMMENT"]="comment",e["BRAIN"]="brain",e["CHART"]="chart",e["ARROW_DROP"]="arrowDrop",e["FIRST"]="first",e["BACK"]="back",e["NEXT"]="next",e["LAST"]="last",e["QUESTION"]="question"})(ln||(ln={}));const un={[ln.BUSSY]:"icon/hourglass_empty_white_24dp.svg",[ln.ERROR]:"icon/error_outline_white_24dp.svg",[ln.INFO]:"icon/info_white_24dp.svg",[ln.GAME]:"icon/sports_esports_white_24dp.svg",[ln.STOP]:"icon/block_white_24dp.svg",[ln.RESIGN]:"icon/flag_white_24dp.svg",[ln.RESEARCH]:"icon/science_white_24dp.svg",[ln.END]:"icon/do_disturb_on_white_24dp.svg",[ln.EDIT]:"icon/app_registration_white_24dp.svg",[ln.CHECK]:"icon/check_circle_white_24dp.svg",[ln.SWAP]:"icon/swap_vert_white_24dp.svg",[ln.SWAP_H]:"icon/swap_horiz_white_24dp.svg",[ln.SETTINGS]:"icon/settings_white_24dp.svg",[ln.ENGINE_SETTINGS]:"icon/settings_input_component_white_24dp.svg",[ln.FLIP]:"icon/flip_camera_android_white_24dp.svg",[ln.PASTE]:"icon/content_paste_white_24dp.svg",[ln.COPY]:"icon/content_copy_white_24dp.svg",[ln.DELETE]:"icon/backspace_white_24dp.svg",[ln.COMMENT]:"icon/edit_note_white_24dp.svg",[ln.BRAIN]:"icon/psychology_white_24dp.svg",[ln.CHART]:"icon/show_chart_white_24dp.svg",[ln.ARROW_DROP]:"icon/arrow_drop_down_white_24dp.svg",[ln.FIRST]:"icon/first_page_white_24dp.svg",[ln.BACK]:"icon/chevron_left_white_24dp.svg",[ln.NEXT]:"icon/chevron_right_white_24dp.svg",[ln.LAST]:"icon/last_page_white_24dp.svg",[ln.QUESTION]:"icon/help_white_24dp.svg"};Object.values(un).forEach((e=>{bt(e)}));var dn=(0,o.aZ)({name:"ButtonIcon",props:{icon:{type:String,required:!0}},setup(e){return{source:un[e.icon]}}});const hn=(0,Ut.Z)(dn,[["render",cn]]);var pn=hn,mn=(0,o.aZ)({name:"BoardPane",components:{BoardView:Vt,ButtonIcon:pn},props:{maxSize:{type:Bt,required:!0}},setup(){const e=an(),t=t=>{e.dispatch(Zi.DO_MOVE_BY_USER,t)},i=t=>{e.commit(ji.EDIT_POSITION,t)},n=()=>{e.commit(ji.SHOW_GAME_DIALOG)},a=()=>{e.dispatch(Zi.STOP_GAME)},s=()=>{e.dispatch(Zi.RESIGN_BY_USER)},r=()=>{e.commit(ji.SHOW_RESEARCH_DIALOG)},c=()=>{e.dispatch(Zi.STOP_RESEARCH)},l=()=>{e.dispatch(Zi.START_POSITION_EDITING)},u=()=>{e.dispatch(Zi.END_POSITION_EDITING)},d=()=>{e.dispatch(Zi.INITIALIZE_POSITION,be.STANDARD)},h=()=>{e.dispatch(Zi.INITIALIZE_POSITION,be.TSUME_SHOGI)},p=()=>{e.commit(ji.CHANGE_TURN)},m=()=>{e.commit(ji.OPEN_APP_SETTING_DIALOG)},_=()=>{e.commit(ji.OPEN_USI_ENGINE_MANAGEMENT_DIALOG)},g=()=>{e.commit(ji.FLIP_BOARD)},E=()=>{e.commit(ji.SHOW_PASTE_DIALOG)},S=()=>{e.dispatch(Zi.COPY_RECORD)},I=()=>{e.dispatch(Zi.REMOVE_RECORD_AFTER)},v=(0,o.Fl)((()=>e.state.mode===Qi.POSITION_EDITING)),f=(0,o.Fl)((()=>e.getters.isMovableByUser)),T=(0,o.Fl)((()=>e.state.record.position)),O=(0,o.Fl)((()=>{const t=e.state.record.current.move;return t instanceof Pe?t:null})),w=(0,o.Fl)((()=>e.state.appSetting.pieceImage)),A=(0,o.Fl)((()=>e.state.appSetting.boardImage)),N=(0,o.Fl)((()=>e.state.appSetting.boardFlipping)),R=(0,o.Fl)((()=>e.state.record.metadata.getStandardMetadata(qe.BLACK_NAME))),P=(0,o.Fl)((()=>e.state.record.metadata.getStandardMetadata(qe.WHITE_NAME))),y=(0,o.Fl)((()=>e.state.mode===Qi.GAME?e.state.game.blackTimeMs:void 0)),b=(0,o.Fl)((()=>e.state.mode===Qi.GAME?e.state.game.blackByoyomi:void 0)),H=(0,o.Fl)((()=>e.state.mode===Qi.GAME?e.state.game.whiteTimeMs:void 0)),k=(0,o.Fl)((()=>e.state.mode===Qi.GAME?e.state.game.whiteByoyomi:void 0)),C=(0,o.Fl)((()=>({game:e.state.mode===Qi.NORMAL,stop:e.state.mode===Qi.GAME,resign:e.state.mode===Qi.GAME&&e.getters.isMovableByUser,research:e.state.mode===Qi.NORMAL,endResearch:e.state.mode===Qi.RESEARCH,startEditPosition:e.state.mode===Qi.NORMAL,endEditPosition:e.state.mode===Qi.POSITION_EDITING,initPosition:e.state.mode===Qi.POSITION_EDITING,removeAfter:e.state.mode===Qi.NORMAL,paste:e.state.mode===Qi.NORMAL,appSettings:e.state.mode===Qi.NORMAL,engineSettings:e.state.mode===Qi.NORMAL})));return{pieceImageType:w,boardImageType:A,position:T,lastMove:O,flip:N,blackPlayerName:R,whitePlayerName:P,blackPlayerTimeMs:y,blackPlayerByoyomi:b,whitePlayerTimeMs:H,whitePlayerByoyomi:k,controlStates:C,onMove:t,onEdit:i,onGame:n,onStop:a,onResign:s,onResearch:r,onEndResearch:c,onStartEditPosition:l,onEndEditPosition:u,onInitPositionStandard:d,onInitPositionTsumeShogi:h,onChangeTurn:p,onOpenAppSettings:m,onOpenEngineSettings:_,onFlip:g,onPaste:E,onCopy:S,onRemoveAfter:I,allowEdit:v,allowMove:f}}});const _n=(0,Ut.Z)(mn,[["render",b],["__scopeId","data-v-7af885f0"]]);var gn=_n;function En(e,t,i,n,a,s){const r=(0,o.up)("RecordView");return(0,o.wg)(),(0,o.iD)("div",null,[(0,o.Wm)(r,{class:"record",record:e.record,operational:e.isRecordOperational,onGoBegin:e.goBegin,onGoBack:e.goBack,onGoForward:e.goForward,onGoEnd:e.goEnd,onSelectMove:e.selectMove,onSelectBranch:e.selectBranch},null,8,["record","operational","onGoBegin","onGoBack","onGoForward","onGoEnd","onSelectMove","onSelectBranch"])])}const Sn={class:"frame"},In={class:"controller"},vn=["disabled"],fn=["disabled"],Tn=["disabled"],On=["disabled"],wn=["disabled"],An=["selected","value"],Nn=["disabled"],Rn=["selected","value"];function Pn(e,t,i,n,a,s){const r=(0,o.up)("ButtonIcon");return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("div",Sn,[(0,o._)("div",In,[(0,o._)("button",{class:"control-button",disabled:!e.operational,onClick:t[0]||(t[0]=t=>e.goBegin())},[(0,o.Wm)(r,{class:"icon",icon:"first"})],8,vn),(0,o._)("button",{class:"control-button",disabled:!e.operational,onClick:t[1]||(t[1]=t=>e.goBack())},[(0,o.Wm)(r,{class:"icon",icon:"back"})],8,fn),(0,o._)("button",{class:"control-button",disabled:!e.operational,onClick:t[2]||(t[2]=t=>e.goForward())},[(0,o.Wm)(r,{class:"icon",icon:"next"})],8,Tn),(0,o._)("button",{class:"control-button",disabled:!e.operational,onClick:t[3]||(t[3]=t=>e.goEnd())},[(0,o.Wm)(r,{class:"icon",icon:"last"})],8,On)]),(0,o._)("select",{ref:"moveList",class:"move-list",size:"2",disabled:!e.operational,onChange:t[4]||(t[4]=t=>e.changeNumber())},[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.moves,(e=>((0,o.wg)(),(0,o.iD)("option",{key:e.number,selected:e.selected,value:e.number},(0,H.zw)(0!==e.number?e.number+" ":"")+" "+(0,H.zw)(e.text)+" "+(0,H.zw)(e.hasBranch?" 分岐":""),9,An)))),128))],40,wn),(0,o._)("select",{ref:"branchList",class:"branch-list",size:"2",disabled:!e.operational,onChange:t[5]||(t[5]=t=>e.changeBranch())},[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.branches,(e=>((0,o.wg)(),(0,o.iD)("option",{key:e.index,selected:e.selected,value:e.index},(0,H.zw)(e.text),9,Rn)))),128))],40,Nn)])])}var yn=(0,o.aZ)({name:"RecordView",components:{ButtonIcon:pn},props:{record:{type:$e,required:!0},operational:{type:Boolean,required:!1}},emits:["goBegin","goBack","goForward","goEnd","selectMove","selectBranch"],setup(e,t){const i=(0,l.iH)(null),n=(0,l.iH)(null),a=()=>{t.emit("goBegin")},s=()=>{t.emit("goBack")},r=()=>{t.emit("goForward")},c=()=>{t.emit("goEnd")},u=()=>{t.emit("selectMove",Number(i.value.value))},d=()=>{t.emit("selectBranch",Number(n.value.value))},h=(0,o.Fl)((()=>0===e.record.current.number)),p=(0,o.Fl)((()=>{const t=[];return e.record.moves.forEach((i=>{t.push({number:i.number,text:i.displayText,hasBranch:i.hasBranch,selected:i===e.record.current})})),t})),m=(0,o.Fl)((()=>{if(!e.record.branchBegin.branch)return null;const t=[];let i;for(i=e.record.branchBegin;i&&i.move;i=i.branch)t.push({index:t.length,text:i.displayMoveText,selected:i.activeBranch});return t}));return{beginPosSelected:h,moves:p,branches:m,moveList:i,branchList:n,goBegin:a,goBack:s,goForward:r,goEnd:c,changeNumber:u,changeBranch:d}}});const bn=(0,Ut.Z)(yn,[["render",Pn],["__scopeId","data-v-251a274f"]]);var Hn=bn;const kn=200;var Cn=(0,o.aZ)({name:"RecordPane",components:{RecordView:Hn},setup(){const e=an(),t=t=>{e.commit(ji.CHANGE_MOVE_NUMBER,t)},i=()=>{t(0)},n=()=>{t(e.state.record.current.number-1)},a=()=>{t(e.state.record.current.number+1)},s=()=>{t(Number.MAX_SAFE_INTEGER)},r=e=>{t(e)},c=t=>{e.commit(ji.CHANGE_BRANCH,t)},l=(0,o.Fl)((()=>e.state.mode===Qi.NORMAL||e.state.mode===Qi.RESEARCH)),u=(0,o.Fl)((()=>e.state.record));return{isRecordOperational:l,record:u,goBegin:i,goBack:n,goForward:a,goEnd:s,selectMove:r,selectBranch:c}}});const Dn=(0,Ut.Z)(Cn,[["render",En],["__scopeId","data-v-6a2b9b67"]]);var Ln=Dn;const Mn=e=>((0,o.dD)("data-v-5d481b9c"),e=e(),(0,o.Cn)(),e),Gn={class:"root"},Bn={class:"tabs"},xn=(0,o.Uk)(" 棋譜情報 "),Un=(0,o.Uk)(" 指し手コメント "),Wn=(0,o.Uk)(" 思考 "),Kn=(0,o.Uk)(" 形勢グラフ "),Fn=(0,o.Uk)(" 最小化 "),qn=Mn((()=>(0,o._)("div",{class:"tab-border"},null,-1))),Vn={class:"tab-contents"};function Yn(e,t,i,n,a,s){const r=(0,o.up)("ButtonIcon"),c=(0,o.up)("RecordInfo"),l=(0,o.up)("RecordComment"),u=(0,o.up)("EngineAnalytics"),d=(0,o.up)("EvaluationChart");return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("div",Gn,["invisible"===e.activeTab?((0,o.wg)(),(0,o.iD)("div",{key:0,style:(0,H.j5)(`height: calc(100% - ${e.headerHeight}px);`)},null,4)):(0,o.kq)("",!0),(0,o._)("div",Bn,[(0,o._)("span",{class:(0,H.C_)(["tab",{selected:"recordInfo"===e.activeTab}]),onClick:t[0]||(t[0]=t=>e.changeSelect("recordInfo"))},[(0,o.Wm)(r,{class:"icon",icon:"recordInfo"}),xn],2),(0,o._)("span",{class:(0,H.C_)(["tab",{selected:"comment"===e.activeTab}]),onClick:t[1]||(t[1]=t=>e.changeSelect("comment"))},[(0,o.Wm)(r,{class:"icon",icon:"comment"}),Un],2),(0,o._)("span",{class:(0,H.C_)(["tab",{selected:"search"===e.activeTab}]),onClick:t[2]||(t[2]=t=>e.changeSelect("search"))},[(0,o.Wm)(r,{class:"icon",icon:"brain"}),Wn],2),(0,o._)("span",{class:(0,H.C_)(["tab",{selected:"chart"===e.activeTab}]),onClick:t[3]||(t[3]=t=>e.changeSelect("chart"))},[(0,o.Wm)(r,{class:"icon",icon:"chart"}),Kn],2),(0,o._)("span",{class:(0,H.C_)(["tab",{selected:"invisible"===e.activeTab}]),onClick:t[4]||(t[4]=t=>e.changeSelect("invisible"))},[(0,o.Wm)(r,{class:"icon",icon:"arrowDrop"}),Fn],2)]),qn,(0,o._)("div",Vn,[(0,o.Wm)(c,{class:(0,H.C_)(["tab-content",{selected:"recordInfo"===e.activeTab}]),size:e.contentSize},null,8,["class","size"]),(0,o.Wm)(l,{class:(0,H.C_)(["tab-content",{selected:"comment"===e.activeTab}])},null,8,["class"]),(0,o.Wm)(u,{class:(0,H.C_)(["tab-content",{selected:"search"===e.activeTab}]),size:e.contentSize},null,8,["class","size"]),(0,o.Wm)(d,{class:(0,H.C_)(["tab-content",{selected:"chart"===e.activeTab}]),size:e.contentSize},null,8,["class","size"])])])])}const jn={class:"root"},Zn=["value","readonly"];function zn(e,t,i,n,a,s){return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("div",jn,[(0,o._)("textarea",{ref:"textarea",class:"text",value:e.comment,readonly:!!e.readonly,onInput:t[0]||(t[0]=(...t)=>e.change&&e.change(...t))},null,40,Zn)])])}var Jn=(0,o.aZ)({name:"RecordComment",setup(){const e=an(),t=(0,o.Fl)((()=>e.state.record.current.comment)),i=(0,o.Fl)((()=>e.state.mode!=Qi.NORMAL)),n=(0,l.iH)(null),a=t=>{const i=t.target.value;e.commit(ji.UPDATE_RECORD_COMMENT,i)};return(0,o.bv)((()=>{n.value.addEventListener("copy",(e=>{e.stopPropagation()})),n.value.addEventListener("paste",(e=>{e.stopPropagation()}))})),{textarea:n,comment:t,readonly:i,change:a}}});const $n=(0,Ut.Z)(Jn,[["render",zn],["__scopeId","data-v-eb8b10d8"]]);var Xn=$n;const Qn={class:"root"};function eo(e,t,i,n,a,s){const r=(0,o.up)("EngineAnalyticsElement");return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("div",Qn,[e.infos.blackPlayer?((0,o.wg)(),(0,o.j4)(r,{key:0,name:e.infos.blackPlayer.name,info:e.infos.blackPlayer,height:e.elementHeight},null,8,["name","info","height"])):(0,o.kq)("",!0),e.infos.whitePlayer?((0,o.wg)(),(0,o.j4)(r,{key:1,name:e.infos.whitePlayer.name,info:e.infos.whitePlayer,height:e.elementHeight},null,8,["name","info","height"])):(0,o.kq)("",!0),e.infos.researcher?((0,o.wg)(),(0,o.j4)(r,{key:2,name:e.infos.researcher.name,info:e.infos.researcher,height:e.elementHeight},null,8,["name","info","height"])):(0,o.kq)("",!0)])])}const to=e=>((0,o.dD)("data-v-1e2e1910"),e=e(),(0,o.Cn)(),e),io={class:"root"},no={class:"headers"},oo={class:"header"},ao=to((()=>(0,o._)("span",{class:"label"},"エンジン名: ",-1))),so={class:"value"},ro={class:"header"},co=to((()=>(0,o._)("span",{class:"label"},"最善手: ",-1))),lo={class:"value"},uo={class:"header"},ho=to((()=>(0,o._)("span",{class:"label"},"秒間探索ノード(NPS): ",-1))),po={class:"value"},mo={class:"header"},_o=to((()=>(0,o._)("span",{class:"label"},"探索ノード数: ",-1))),go={class:"value"},Eo={class:"header"},So=to((()=>(0,o._)("span",{class:"label"},"ハッシュ使用率: ",-1))),Io={class:"value"},vo=(0,o.uE)('<div class="list-header" data-v-1e2e1910><div class="list-column time" data-v-1e2e1910>経過時間</div><div class="list-column multipv-index" data-v-1e2e1910>順位</div><div class="list-column depth" data-v-1e2e1910>深さ</div><div class="list-column score" data-v-1e2e1910>評価値</div></div>',1),fo={class:"list-column time"},To={class:"list-column multipv-index"},Oo={class:"list-column depth"},wo={class:"list-column score"},Ao={class:"list-column score-flag"},No={class:"list-column text"};function Ro(e,t,i,n,a,s){return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("div",io,[(0,o._)("div",no,[(0,o._)("div",oo,[ao,(0,o._)("span",so,(0,H.zw)(e.name),1)]),(0,o._)("div",ro,[co,(0,o._)("span",lo,(0,H.zw)(e.info.currentMoveText||"---"),1)]),(0,o._)("div",uo,[ho,(0,o._)("span",po,(0,H.zw)(e.info.nps||"---"),1)]),(0,o._)("div",mo,[_o,(0,o._)("span",go,(0,H.zw)(e.info.nodes||"---"),1)]),(0,o._)("div",Eo,[So,(0,o._)("span",Io,(0,H.zw)(e.info.hashfull?(100*e.info.hashfull).toFixed(1):"---")+" % ",1)])]),vo,(0,o._)("div",{class:"list",style:(0,H.j5)(`height:${e.height-37}px`)},[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.info.iterates,((e,t)=>((0,o.wg)(),(0,o.iD)("div",{key:t,class:"list-item"},[(0,o._)("div",fo,(0,H.zw)(e.timeMs?(e.timeMs/1e3).toFixed(1)+"s":""),1),(0,o._)("div",To,(0,H.zw)(e.multiPV||""),1),(0,o._)("div",Oo,(0,H.zw)(e.depth)+(0,H.zw)(e.selectiveDepth&&e.depth?"/":"")+(0,H.zw)(e.selectiveDepth),1),(0,o._)("div",wo,(0,H.zw)(e.score)+" "+(0,H.zw)(e.scoreMate?e.scoreMate:""),1),(0,o._)("div",Ao,(0,H.zw)(e.lowerBound?"++":"")+" "+(0,H.zw)(e.upperBound?"--":"")+" "+(0,H.zw)(e.scoreMate?"詰":""),1),(0,o._)("div",No,(0,H.zw)(e.text),1)])))),128))],4)])])}var Po=(0,o.aZ)({name:"EngineAnalyticsElement",props:{name:{type:String,required:!0},info:{type:$i,required:!0},height:{type:Number,required:!0}}});const yo=(0,Ut.Z)(Po,[["render",Ro],["__scopeId","data-v-1e2e1910"]]);var bo=yo,Ho=(0,o.aZ)({name:"EngineAnalytics",components:{EngineAnalyticsElement:bo},props:{size:{type:Bt,required:!0}},setup(e){const t=an(),i=(0,o.Fl)((()=>t.state.usi)),n=(0,o.Fl)((()=>{const i=(t.state.usi.blackPlayer?1:0)+(t.state.usi.whitePlayer?1:0)+(t.state.usi.researcher?1:0);return 0!==i?e.size.height/i:0}));return{infos:i,elementHeight:n}}});const ko=(0,Ut.Z)(Ho,[["render",eo],["__scopeId","data-v-7f58d4c6"]]);var Co=ko;const Do={class:"root"},Lo=["width","height"];function Mo(e,t,i,n,a,s){return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("div",Do,[(0,o._)("canvas",{ref:"canvas",width:e.size.width.toFixed(0),height:e.size.height.toFixed(0)},null,8,Lo)])])}var Go=i(2728),Bo=(0,o.aZ)({name:"EvaluationChart",props:{size:{type:Bt,required:!0}},setup(e){const t=(0,l.iH)(null),i=an();let n;const a=(e,t,i)=>{const n=[];return i.moves.forEach((e=>{const i=new Fi(e.customData),o=i.evaluation&&i.evaluation[t];o&&n.push({x:e.number,y:o})})),{label:Ui(t),borderColor:e,data:n,showLine:!0}},s=e=>({label:"現在の局面",borderColor:"red",data:[{x:e.current.number,y:Wi},{x:e.current.number,y:Ki}],showLine:!0,pointBorderWidth:0,pointRadius:0}),r=e=>[s(e),a("royalblue",xi.BLACK_PLAYER,e),a("darkorange",xi.WHITE_PLAYER,e),a("darkgreen",xi.RESEARCHER,e)],c=e=>({x:{min:0,max:e.length+10},y:{min:Ki,max:Wi}}),u=(e,t,n)=>{if(null===e.x)return;const o=n.scales.x.max-n.scales.x.min,a=n.scales.x.right-n.scales.x.left,s=(e.x-n.scales.x.left)/a*o+n.scales.x.min,r=Math.round(s);i.commit(ji.CHANGE_MOVE_NUMBER,r)};return(0,o.bv)((()=>{const e=t.value,o=e.getContext("2d");n=new Go.kL(o,{type:"scatter",data:{datasets:r(i.state.record)},options:{color:"black",animation:{duration:0},maintainAspectRatio:!1,events:["click"],onClick:u}}),n.draw()})),(0,o.Ah)((()=>{n.destroy()})),(0,o.YP)((()=>[i.state.record]),(([e])=>{n.data.datasets=r(e),n.options.scales=c(e),n.update()}),{deep:!0}),(0,o.YP)((()=>[e.size]),(([e])=>{n.resize(e.width,e.height)}),{deep:!0}),{canvas:t}}});const xo=(0,Ut.Z)(Bo,[["render",Mo],["__scopeId","data-v-c5919bb8"]]);var Uo=xo;const Wo={class:"key"},Ko=["value","onInput"];function Fo(e,t,i,n,a,s){return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("div",{class:"root",style:(0,H.j5)(`height:${e.size.height}px`)},[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.list,(t=>((0,o.wg)(),(0,o.iD)("div",{key:t.key,class:"element"},[(0,o._)("div",Wo,(0,H.zw)(t.displayName),1),(0,o._)("input",{class:"value-input",value:t.value,onInput:i=>e.change(i,t.key)},null,40,Ko)])))),128))],4)])}var qo=(0,o.aZ)({name:"RecordComment",props:{size:{type:Bt,required:!0}},setup(){const e=an(),t=(0,o.Fl)((()=>Object.values(qe).map((t=>{const i=e.state.record.metadata;return{key:t,displayName:Ye(t),value:i.getStandardMetadata(t)||""}})))),i=(t,i)=>{const n=t.target;e.commit(ji.UPDATE_STANDARD_RECORD_METADATA,{key:i,value:n.value})};return{list:t,change:i}}});const Vo=(0,Ut.Z)(qo,[["render",Fo],["__scopeId","data-v-51f6b1c6"]]);var Yo=Vo;const jo=30,Zo=240+jo;var zo=(0,o.aZ)({name:"TabPane",components:{RecordComment:Xn,EngineAnalytics:Co,EvaluationChart:Uo,RecordInfo:Yo,ButtonIcon:pn},props:{size:{type:Bt,required:!0}},setup(e){const t=an(),i=e=>{t.dispatch(Zi.UPDATE_APP_SETTING,{tab:e})},n=(0,o.Fl)((()=>t.state.appSetting.tab)),a=(0,o.Fl)((()=>e.size.reduce(new Bt(0,jo))));return{activeTab:n,contentSize:a,headerHeight:jo,changeSelect:i}}});const Jo=(0,Ut.Z)(zo,[["render",Yn],["__scopeId","data-v-5d481b9c"]]);var $o=Jo,Xo=(0,o.aZ)({name:"StandardLayout",components:{BoardPane:gn,RecordPane:Ln,TabPane:$o},setup(){const e=an(),t=(0,l.qj)(new Bt(0,0)),i=(0,l.iH)(0),n=(0,l.iH)(null),a=()=>{t.width=window.innerWidth,t.height=window.innerHeight},s=new ResizeObserver((e=>{i.value=e[0].contentRect.height}));(0,o.bv)((()=>{a(),window.addEventListener("resize",a),s.observe(n.value)})),(0,o.Ah)((()=>{window.removeEventListener("resize",a),s.disconnect()}));const r=(0,o.Fl)((()=>{const i=e.state.appSetting.tab!==Ft.INVISIBLE?Zo:jo;return new Bt(t.width-kn,t.height-i)})),c=(0,o.Fl)((()=>new Bt(t.width,t.height-i.value)));return{topPane:n,boardPaneMaxSize:r,bottomPaneSize:c}}});const Qo=(0,Ut.Z)(Xo,[["render",c],["__scopeId","data-v-940aeef0"]]);var ea=Qo;const ta=e=>((0,o.dD)("data-v-be412a88"),e=e(),(0,o.Cn)(),e),ia={ref:"dialog"},na=ta((()=>(0,o._)("div",{class:"dialog-title"},"対局",-1))),oa={class:"dialog-form-area"},aa={class:"players"},sa={class:"player"},ra=ta((()=>(0,o._)("div",{class:"top-label"},"先手（下手）",-1))),ca=["value"],la=["value"],ua={class:"player"},da=ta((()=>(0,o._)("div",{class:"top-label"},"後手（上手）",-1))),ha=["value"],pa=["value"],ma={class:"players-control"},_a=(0,o.Uk)(" 先後入れ替え "),ga={class:"dialog-form-areas-h"},Ea={class:"dialog-form-area time-limit"},Sa={class:"dialog-form-item"},Ia=ta((()=>(0,o._)("div",{class:"dialog-form-item-label"},"持ち時間",-1))),va=["value"],fa=ta((()=>(0,o._)("div",{class:"dialog-form-item-unit"},"時間",-1))),Ta=["value"],Oa=ta((()=>(0,o._)("div",{class:"dialog-form-item-unit"},"分",-1))),wa={class:"dialog-form-item"},Aa=ta((()=>(0,o._)("div",{class:"dialog-form-item-label"},"秒読み",-1))),Na=["value"],Ra=ta((()=>(0,o._)("div",{class:"dialog-form-item-unit"},"秒",-1))),Pa={class:"dialog-form-item"},ya=ta((()=>(0,o._)("div",{class:"dialog-form-item-label"},"増加",-1))),ba=["value"],Ha=ta((()=>(0,o._)("div",{class:"dialog-form-item-unit"},"秒",-1))),ka={class:"dialog-form-area flags"},Ca={class:"dialog-form-item"},Da=["value"],La=(0,o.uE)('<option value="current" data-v-be412a88>現在の局面</option><option value="standard" data-v-be412a88>平手</option><option value="handicapLance" data-v-be412a88>香落ち</option><option value="handicapRightLance" data-v-be412a88>右香落ち</option><option value="handicapBishop" data-v-be412a88>角落ち</option><option value="handicapRook" data-v-be412a88>飛車落ち</option><option value="handicapRookLance" data-v-be412a88>飛車香落ち</option><option value="handicap2Pieces" data-v-be412a88>2枚落ち</option><option value="handicap4Pieces" data-v-be412a88>4枚落ち</option><option value="handicap6Pieces" data-v-be412a88>6枚落ち</option><option value="handicap8Pieces" data-v-be412a88>8枚落ち</option>',11),Ma=[La],Ga={class:"dialog-form-item"},Ba=["checked"],xa=ta((()=>(0,o._)("label",{for:"disable-engine-timeout"},"エンジンの時間切れあり",-1))),Ua={class:"dialog-form-item"},Wa=["checked"],Ka=ta((()=>(0,o._)("label",{for:"human-is-front"},"人を手前に表示する",-1))),Fa={class:"dialog-main-buttons"};function qa(e,t,i,n,a,s){const r=(0,o.up)("ButtonIcon");return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("dialog",ia,[na,(0,o._)("div",oa,[(0,o._)("div",aa,[(0,o._)("div",sa,[ra,(0,o._)("select",{ref:"blackPlayerSelect",class:"player-select",size:"1",value:e.defaultValues.black.type},[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.players,(e=>((0,o.wg)(),(0,o.iD)("option",{key:e.uri,value:e.uri},(0,H.zw)(e.name),9,la)))),128))],8,ca)]),(0,o._)("div",ua,[da,(0,o._)("select",{ref:"whitePlayerSelect",class:"player-select",size:"1",value:e.defaultValues.white.type},[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.players,(e=>((0,o.wg)(),(0,o.iD)("option",{key:e.uri,value:e.uri},(0,H.zw)(e.name),9,pa)))),128))],8,ha)])]),(0,o._)("div",ma,[(0,o._)("button",{onClick:t[0]||(t[0]=(...t)=>e.onSwapColor&&e.onSwapColor(...t))},[(0,o.Wm)(r,{class:"icon",icon:"swap_h"}),_a])])]),(0,o._)("div",ga,[(0,o._)("div",Ea,[(0,o._)("div",Sa,[Ia,(0,o._)("input",{ref:"hours",class:"time-input",type:"number",min:"0",max:"99",step:"1",value:e.defaultValues.timeLimit.hours},null,8,va),fa,(0,o._)("input",{ref:"minutes",class:"time-input",type:"number",min:"0",max:"59",step:"1",value:e.defaultValues.timeLimit.minutes},null,8,Ta),Oa]),(0,o._)("div",wa,[Aa,(0,o._)("input",{ref:"byoyomi",class:"time-input single",type:"number",min:"0",max:"60",step:"1",value:e.defaultValues.timeLimit.byoyomi},null,8,Na),Ra]),(0,o._)("div",Pa,[ya,(0,o._)("input",{ref:"increment",class:"time-input single",type:"number",min:"0",max:"99",step:"1",value:e.defaultValues.timeLimit.increment},null,8,ba),Ha])]),(0,o._)("div",ka,[(0,o._)("div",Ca,[(0,o._)("select",{ref:"startPosition",value:e.defaultValues.startPosition},Ma,8,Da)]),(0,o._)("div",Ga,[(0,o._)("input",{id:"disable-engine-timeout",ref:"enableEngineTimeout",type:"checkbox",checked:e.defaultValues.enableEngineTimeout},null,8,Ba),xa]),(0,o._)("div",Ua,[(0,o._)("input",{id:"human-is-front",ref:"humanIsFront",type:"checkbox",checked:e.defaultValues.humanIsFront},null,8,Wa),Ka])])]),(0,o._)("div",Fa,[(0,o._)("button",{class:"dialog-button",onClick:t[1]||(t[1]=t=>e.onStart())},"対局開始"),(0,o._)("button",{class:"dialog-button",onClick:t[2]||(t[2]=t=>e.onCancel())},"キャンセル")])],512)])}function Va(e){e.addEventListener("cancel",(e=>{e.preventDefault(),e.stopPropagation()})),e.addEventListener("copy",(e=>{e.stopPropagation()})),e.addEventListener("paste",(e=>{e.stopPropagation()})),e.showModal()}function Ya(e){return document.getElementById(e)}function ja(e){const t=Number(e.value),i=Number(e.max),n=Number(e.min);return Math.min(Math.max(t,n),i)}var Za=(0,o.aZ)({name:"GameDialog",components:{ButtonIcon:pn},setup(){const e=an(),t=(0,l.iH)(null),i=(0,l.iH)(null),n=(0,l.iH)(null),a=(0,l.iH)(null),s=(0,l.iH)(null),r=(0,l.iH)(null),c=(0,l.iH)(null),u=(0,l.iH)(null),d=(0,l.iH)(null),h=(0,l.iH)(null),p=(0,l.iH)(Qt()),m=(0,l.iH)(new Zt);e.commit(ji.RETAIN_BUSSY_STATE),(0,o.bv)((async()=>{Va(t.value);try{p.value=await Ei(),m.value=await Ii(),e.commit(ji.RELEASE_BUSSY_STATE)}catch(i){e.commit(ji.PUSH_ERROR,i),e.commit(ji.CLOSE_DIALOG)}}));const _=e=>{if(Xt(e)){const t=m.value.getEngine(e);return{name:t.name,uri:e,usi:t}}return{name:"人",uri:Jt}},g=()=>{const t={black:_(i.value.value),white:_(n.value.value),timeLimit:{timeSeconds:60*(60*ja(a.value)+ja(s.value)),byoyomi:ja(r.value),increment:ja(c.value)},startPosition:"current"!==u.value.value?u.value.value:void 0,enableEngineTimeout:d.value.checked,humanIsFront:h.value.checked},o=ei(t);o?e.commit(ji.PUSH_ERROR,o):e.dispatch(Zi.START_GAME,t)},E=()=>{e.commit(ji.CLOSE_DIALOG)},S=()=>{[i.value.value,n.value.value]=[n.value.value,i.value.value]},I=(0,o.Fl)((()=>({black:{type:p.value.black.uri},white:{type:p.value.white.uri},timeLimit:{hours:Math.floor(p.value.timeLimit.timeSeconds/3600),minutes:Math.floor(p.value.timeLimit.timeSeconds/60)%60,byoyomi:p.value.timeLimit.byoyomi,increment:p.value.timeLimit.increment},startPosition:void 0!==p.value.startPosition?p.value.startPosition:"current",enableEngineTimeout:p.value.enableEngineTimeout,humanIsFront:p.value.humanIsFront}))),v=(0,o.Fl)((()=>[{name:"人",uri:Jt},...m.value.engineList]));return{dialog:t,blackPlayerSelect:i,whitePlayerSelect:n,hours:a,minutes:s,byoyomi:r,increment:c,startPosition:u,enableEngineTimeout:d,humanIsFront:h,defaultValues:I,players:v,onStart:g,onCancel:E,onSwapColor:S}}});const za=(0,Ut.Z)(Za,[["render",qa],["__scopeId","data-v-be412a88"]]);var Ja=za;const $a=e=>((0,o.dD)("data-v-35a19322"),e=e(),(0,o.Cn)(),e),Xa={ref:"dialog"},Qa=$a((()=>(0,o._)("div",{class:"dialog-title"},"検討",-1))),es={class:"dialog-form-area"},ts={class:"dialog-form-item"},is=$a((()=>(0,o._)("div",{class:"dialog-form-item-label"},"エンジン",-1))),ns={class:"dialog-form-item-unit"},os=["value"],as=["value"],ss={class:"dialog-main-buttons"};function rs(e,t,i,n,a,s){return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("dialog",Xa,[Qa,(0,o._)("div",es,[(0,o._)("div",ts,[is,(0,o._)("div",ns,[(0,o._)("select",{ref:"engineSelect",class:"engine-select",size:"1",value:e.defaultValue},[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.engines,(e=>((0,o.wg)(),(0,o.iD)("option",{key:e.uri,value:e.uri},(0,H.zw)(e.name),9,as)))),128))],8,os)])])]),(0,o._)("div",ss,[(0,o._)("button",{class:"dialog-button",onClick:t[0]||(t[0]=t=>e.onStart())},"検討開始"),(0,o._)("button",{class:"dialog-button",onClick:t[1]||(t[1]=t=>e.onCancel())},"キャンセル")])],512)])}var cs=(0,o.aZ)({name:"ResearchDialog",setup(){const e=an(),t=(0,l.iH)(null),i=(0,l.iH)(null),n=(0,l.iH)(ti()),a=(0,l.iH)(new Zt);e.commit(ji.RETAIN_BUSSY_STATE),(0,o.bv)((async()=>{Va(t.value);try{n.value=await _i(),a.value=await Ii(),e.commit(ji.RELEASE_BUSSY_STATE)}catch(i){e.commit(ji.PUSH_ERROR,i),e.commit(ji.CLOSE_DIALOG)}}));const s=()=>{const t=i.value.value;if(!a.value.hasEngine(t))return void e.commit(ji.PUSH_ERROR,"エンジンを選択してください。");const n=a.value.getEngine(t),o={usi:n};e.dispatch(Zi.START_RESEARCH,o)},r=()=>{e.commit(ji.CLOSE_DIALOG)},c=(0,o.Fl)((()=>a.value.engineList)),u=(0,o.Fl)((()=>n.value.usi?n.value.usi.uri:""));return{dialog:t,engineSelect:i,engines:c,defaultValue:u,onStart:s,onCancel:r}}});const ls=(0,Ut.Z)(cs,[["render",rs],["__scopeId","data-v-35a19322"]]);var us=ls;const ds=e=>((0,o.dD)("data-v-3cf8f19e"),e=e(),(0,o.Cn)(),e),hs={ref:"dialog"},ps=ds((()=>(0,o._)("div",{class:"dialog-title"},"エンジン管理",-1))),ms={class:"dialog-form-area engine-list"},_s={key:0,class:"engine"},gs=["value"],Es={class:"engine-name"},Ss=["onClick"],Is=["onClick"],vs={class:"dialog-main-buttons"};function fs(e,t,i,n,a,s){const r=(0,o.up)("USIEngineOptionDialog");return(0,o.wg)(),(0,o.iD)(o.HY,null,[(0,o._)("div",null,[(0,o._)("dialog",hs,[ps,(0,o._)("div",ms,[0===e.engines.length?((0,o.wg)(),(0,o.iD)("div",_s," エンジンが登録されていません。 ")):(0,o.kq)("",!0),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.engines,(t=>((0,o.wg)(),(0,o.iD)("div",{key:t.uri,class:"engine",value:t.uri},[(0,o._)("div",Es,(0,H.zw)(t.name),1),(0,o._)("button",{class:"dialog-button",onClick:i=>e.openOptions(t.uri)}," 設定 ",8,Ss),(0,o._)("button",{class:"dialog-button",onClick:i=>e.remove(t.uri)}," 削除 ",8,Is)],8,gs)))),128))]),(0,o._)("button",{class:"dialog-wide-button",onClick:t[0]||(t[0]=t=>e.add())},"追加"),(0,o._)("div",vs,[(0,o._)("button",{class:"dialog-button",onClick:t[1]||(t[1]=t=>e.saveAndClose())}," 保存して閉じる "),(0,o._)("button",{class:"dialog-button",onClick:t[2]||(t[2]=t=>e.cancel())},"キャンセル")])],512)]),e.optionDialog?((0,o.wg)(),(0,o.j4)(r,{key:0,"latest-engine-setting":e.optionDialog,onOk:e.optionOk,onCancel:e.optionCancel},null,8,["latest-engine-setting","onOk","onCancel"])):(0,o.kq)("",!0)],64)}const Ts=e=>((0,o.dD)("data-v-12f02a5e"),e=e(),(0,o.Cn)(),e),Os={ref:"dialog"},ws=Ts((()=>(0,o._)("div",{class:"dialog-title"},"エンジン設定",-1))),As={class:"dialog-form-area option-list"},Ns={class:"option"},Rs=Ts((()=>(0,o._)("div",{class:"option-name"},"エンジン名",-1))),Ps={class:"option-unchangeable"},ys={class:"option"},bs=Ts((()=>(0,o._)("div",{class:"option-name"},"作者",-1))),Hs={class:"option-unchangeable"},ks={class:"option"},Cs=Ts((()=>(0,o._)("div",{class:"option-name"},"場所",-1))),Ds={class:"option-unchangeable"},Ls={class:"option"},Ms=Ts((()=>(0,o._)("div",{class:"option-name"},"表示名",-1))),Gs={ref:"engineNameInput",class:"option-value-text",type:"text",name:"ElectronShogiEngineName"},Bs={class:"option-name"},xs=["id","min","max","name"],Us=["id","name"],Ws=["id","name"],Ks=["onClick"],Fs=["id"],qs=Ts((()=>(0,o._)("option",{value:""},"既定値",-1))),Vs=Ts((()=>(0,o._)("option",{value:"true"},"ON",-1))),Ys=Ts((()=>(0,o._)("option",{value:"false"},"OFF",-1))),js=[qs,Vs,Ys],Zs=["id"],zs=Ts((()=>(0,o._)("option",{value:""},"既定値",-1))),Js=["value"],$s=["onClick"],Xs={class:"dialog-main-buttons"};function Qs(e,t,i,n,a,s){return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("dialog",Os,[ws,(0,o._)("div",As,[(0,o._)("div",Ns,[Rs,(0,o._)("div",Ps,(0,H.zw)(e.engine.defaultName),1)]),(0,o._)("div",ys,[bs,(0,o._)("div",Hs,(0,H.zw)(e.engine.author),1)]),(0,o._)("div",ks,[Cs,(0,o._)("div",Ds,(0,H.zw)(e.engine.path),1)]),(0,o._)("div",Ls,[Ms,(0,o._)("input",Gs,null,512)]),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.options,(t=>((0,o.wg)(),(0,o.iD)("div",{key:t.name,class:"option"},[(0,o._)("div",Bs,(0,H.zw)(t.name),1),"spin"===t.type?((0,o.wg)(),(0,o.iD)("input",{key:0,id:t.inputId,class:"option-value-number",type:"number",min:t.min,max:t.max,step:"1",name:t.name},null,8,xs)):(0,o.kq)("",!0),"string"===t.type?((0,o.wg)(),(0,o.iD)("input",{key:1,id:t.inputId,class:"option-value-text",type:"text",name:t.name},null,8,Us)):(0,o.kq)("",!0),"filename"===t.type?((0,o.wg)(),(0,o.iD)("input",{key:2,id:t.inputId,class:"option-value-filename",type:"text",name:t.name},null,8,Ws)):(0,o.kq)("",!0),"filename"===t.type?((0,o.wg)(),(0,o.iD)("button",{key:3,class:"dialog-button",onClick:i=>e.selectFile(t.inputId)}," 選択 ",8,Ks)):(0,o.kq)("",!0),"check"===t.type?((0,o.wg)(),(0,o.iD)("select",{key:4,id:t.inputId,class:"option-value-check"},js,8,Fs)):(0,o.kq)("",!0),"combo"===t.type?((0,o.wg)(),(0,o.iD)("select",{key:5,id:t.inputId,class:"option-value-combo"},[zs,((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(t.vars,(e=>((0,o.wg)(),(0,o.iD)("option",{key:e,value:e},(0,H.zw)(e),9,Js)))),128))],8,Zs)):(0,o.kq)("",!0),"button"===t.type?((0,o.wg)(),(0,o.iD)("button",{key:6,class:"dialog-button",onClick:i=>e.sendOption(t.name)}," 実行 ",8,$s)):(0,o.kq)("",!0)])))),128))]),(0,o._)("button",{class:"dialog-wide-button",onClick:t[0]||(t[0]=t=>e.reset())}," エンジンの既定値に戻す "),(0,o._)("div",Xs,[(0,o._)("button",{class:"dialog-button",onClick:t[1]||(t[1]=t=>e.ok())},"OK"),(0,o._)("button",{class:"dialog-button",onClick:t[2]||(t[2]=t=>e.cancel())},"キャンセル")])],512)])}var er=(0,o.aZ)({name:"USIEngineOptionDialog",props:{latestEngineSetting:{type:Object,required:!0}},emits:["ok","cancel"],setup(e,t){const i=(0,l.iH)(null),n=(0,l.iH)(null),a=an(),s=e.latestEngineSetting;let r=(0,l.iH)(s);const c=(0,o.Fl)((()=>Object.values(r.value.options).sort(((e,t)=>{const i=e.name.startsWith("USI_"),n=t.name.startsWith("USI_");return i!==n?i?-1:1:e.name<t.name?-1:1})).map(((e,t)=>({...e,inputId:"usiEngineOptionDialogOption"+t,value:Yt(e)})))));a.commit(ji.RETAIN_BUSSY_STATE),(0,o.bv)((async()=>{Va(i.value);try{r.value=await Ti(s.path),jt(r.value,s),n.value.value=r.value.name;for(const e of c.value){const t=Ya(e.inputId);t&&void 0!==e.value&&(t.value=e.value+"")}}catch(e){a.commit(ji.PUSH_ERROR,e)}finally{a.commit(ji.RELEASE_BUSSY_STATE)}}));const u=async e=>{a.commit(ji.RETAIN_BUSSY_STATE);try{const t=await hi(),i=Ya(e);t&&i&&(i.value=t)}catch(t){a.commit(ji.PUSH_ERROR,t)}finally{a.commit(ji.RELEASE_BUSSY_STATE)}},d=async e=>{a.commit(ji.RETAIN_BUSSY_STATE);try{await yi(r.value.path,e)}catch(t){a.commit(ji.PUSH_ERROR,t)}finally{a.commit(ji.RELEASE_BUSSY_STATE)}},h=()=>{n.value.value=r.value.defaultName;for(const e of c.value){const t=Ya(e.inputId);t&&(void 0!==r.value.options[e.name].default?t.value=r.value.options[e.name].default+"":t.value="")}},p=()=>{r.value.name=n.value.value;for(const e of c.value){const t=Ya(e.inputId);t&&(r.value.options[e.name].value=t.value?"spin"===e.type?ja(t):t.value:void 0)}t.emit("ok",r.value)},m=()=>{t.emit("cancel")};return{engine:r,dialog:i,engineNameInput:n,options:c,selectFile:u,sendOption:d,reset:h,ok:p,cancel:m}}});const tr=(0,Ut.Z)(er,[["render",Qs],["__scopeId","data-v-12f02a5e"]]);var ir=tr,nr=(0,o.aZ)({name:"USIEngineManagementDialog",components:{USIEngineOptionDialog:ir},setup(){const e=(0,l.iH)(null),t=(0,l.iH)(null),i=(0,l.iH)(new Zt),n=an();n.commit(ji.RETAIN_BUSSY_STATE),(0,o.bv)((async()=>{Va(e.value);try{i.value=await Ii(),n.commit(ji.RELEASE_BUSSY_STATE)}catch(t){n.commit(ji.PUSH_ERROR,t),n.commit(ji.CLOSE_DIALOG)}}));const a=async()=>{try{n.commit(ji.RETAIN_BUSSY_STATE);const e=await fi();if(!e)return;i.value.addEngine(await Ti(e))}catch(e){n.commit(ji.PUSH_ERROR,e)}finally{n.commit(ji.RELEASE_BUSSY_STATE)}},s=e=>{i.value.removeEngine(e)},r=e=>{t.value=i.value.getEngine(e)},c=async()=>{try{n.commit(ji.RETAIN_BUSSY_STATE),await vi(i.value),n.commit(ji.CLOSE_DIALOG)}catch(e){n.commit(ji.PUSH_ERROR,e)}finally{n.commit(ji.RELEASE_BUSSY_STATE)}},u=()=>{n.commit(ji.CLOSE_DIALOG)},d=e=>{i.value.updateEngine(e),t.value=null},h=()=>{t.value=null},p=(0,o.Fl)((()=>i.value.engineList));return{optionDialog:t,dialog:e,engines:p,add:a,remove:s,openOptions:r,saveAndClose:c,cancel:u,optionOk:d,optionCancel:h}}});const or=(0,Ut.Z)(nr,[["render",fs],["__scopeId","data-v-3cf8f19e"]]);var ar=or;const sr=e=>((0,o.dD)("data-v-1a02b0d4"),e=e(),(0,o.Cn)(),e),rr={ref:"dialog"},cr=sr((()=>(0,o._)("div",{class:"dialog-title"},"アプリ設定",-1))),lr={class:"dialog-form-area settings"},ur={class:"dialog-form-item"},dr=sr((()=>(0,o._)("div",{class:"dialog-form-item-label-wide"},"駒画像",-1))),hr=["value"],pr=["value"],mr={class:"dialog-form-item"},_r=sr((()=>(0,o._)("div",{class:"dialog-form-item-label-wide"},"盤画像",-1))),gr=["value"],Er=["value"],Sr={class:"dialog-form-item"},Ir=sr((()=>(0,o._)("div",{class:"dialog-form-item-label-wide"},"駒音の大きさ",-1))),vr=["value"],fr=sr((()=>(0,o._)("div",{class:"dialog-form-item-unit"},"%",-1))),Tr={class:"dialog-form-item"},Or=sr((()=>(0,o._)("div",{class:"dialog-form-item-label-wide"},"時計音の大きさ",-1))),wr=["value"],Ar=sr((()=>(0,o._)("div",{class:"dialog-form-item-unit"},"%",-1))),Nr={class:"dialog-form-item"},Rr=sr((()=>(0,o._)("div",{class:"dialog-form-item-label-wide"},"時計音の高さ",-1))),Pr=["value"],yr=sr((()=>(0,o._)("div",{class:"dialog-form-item-unit"},"Hz (220 ~ 880)",-1))),br={class:"dialog-form-item"},Hr=sr((()=>(0,o._)("div",{class:"dialog-form-item-label-wide"},"時計音の対象",-1))),kr=["value"],Cr=sr((()=>(0,o._)("option",{value:"all"},"全ての手番",-1))),Dr=sr((()=>(0,o._)("option",{value:"onlyUser"},"人の手番のみ",-1))),Lr=[Cr,Dr],Mr={class:"dialog-form-item"},Gr=sr((()=>(0,o._)("div",{class:"dialog-form-item-label-wide"},"改行文字",-1))),Br=["value"],xr=sr((()=>(0,o._)("option",{value:"crlf"},"CR + LF (Windows)",-1))),Ur=sr((()=>(0,o._)("option",{value:"lf"},"LF (UNIX/Mac)",-1))),Wr=sr((()=>(0,o._)("option",{value:"cr"},"CR (90年代Mac)",-1))),Kr=[xr,Ur,Wr],Fr={class:"dialog-main-buttons"};function qr(e,t,i,n,a,s){return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("dialog",rr,[cr,(0,o._)("div",lr,[(0,o._)("div",ur,[dr,(0,o._)("select",{ref:"pieceImage",value:e.appSetting.pieceImage},[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.pieceImageTypes,(e=>((0,o.wg)(),(0,o.iD)("option",{key:e,value:e.value},(0,H.zw)(e.name),9,pr)))),128))],8,hr)]),(0,o._)("div",mr,[_r,(0,o._)("select",{ref:"boardImage",value:e.appSetting.boardImage},[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.boardImageTypes,(e=>((0,o.wg)(),(0,o.iD)("option",{key:e,value:e.value},(0,H.zw)(e.name),9,Er)))),128))],8,gr)]),(0,o._)("div",Sr,[Ir,(0,o._)("input",{ref:"pieceVolume",value:e.appSetting.pieceVolume,type:"number",max:"100",min:"0"},null,8,vr),fr]),(0,o._)("div",Tr,[Or,(0,o._)("input",{ref:"clockVolume",value:e.appSetting.clockVolume,type:"number",max:"100",min:"0"},null,8,wr),Ar]),(0,o._)("div",Nr,[Rr,(0,o._)("input",{ref:"clockPitch",value:e.appSetting.clockPitch,type:"number",max:"880",min:"220"},null,8,Pr),yr]),(0,o._)("div",br,[Hr,(0,o._)("select",{ref:"clockSoundTarget",value:e.appSetting.clockSoundTarget},Lr,8,kr)]),(0,o._)("div",Mr,[Gr,(0,o._)("select",{ref:"returnCode",value:e.appSetting.returnCode},Kr,8,Br)])]),(0,o._)("div",Fr,[(0,o._)("button",{class:"dialog-button",onClick:t[0]||(t[0]=t=>e.saveAndClose())}," 保存して閉じる "),(0,o._)("button",{class:"dialog-button",onClick:t[1]||(t[1]=t=>e.cancel())},"キャンセル")])],512)])}const Vr={"\r\n":"crlf","\n":"lf","\r":"cr"},Yr={crlf:"\r\n",lf:"\n",cr:"\r"};var jr=(0,o.aZ)({name:"AppSettingDialog",setup(){const e=an(),t=(0,l.iH)(null),i=(0,l.iH)(null),n=(0,l.iH)(null),a=(0,l.iH)(null),s=(0,l.iH)(null),r=(0,l.iH)(null),c=(0,l.iH)(null),u=(0,l.iH)(null);(0,o.bv)((()=>{Va(t.value)}));const d=async()=>{const t={pieceImage:i.value.value,boardImage:n.value.value,pieceVolume:ja(a.value),clockVolume:ja(s.value),clockPitch:ja(r.value),clockSoundTarget:c.value.value,returnCode:Yr[u.value.value]};e.commit(ji.RETAIN_BUSSY_STATE);try{await e.dispatch(Zi.UPDATE_APP_SETTING,t),e.commit(ji.CLOSE_DIALOG)}catch(o){e.commit(ji.PUSH_ERROR,o)}finally{e.commit(ji.RELEASE_BUSSY_STATE)}},h=()=>{e.commit(ji.CLOSE_DIALOG)},p=(0,o.Fl)((()=>({...e.state.appSetting,returnCode:Vr[e.state.appSetting.returnCode]}))),m=[{name:"一文字駒",value:Ht.HITOMOJI},{name:"一文字駒（ゴシック体）",value:Ht.HITOMOJI_GOTHIC}],_=[{name:"木目（明るい）",value:kt.LIGHT},{name:"木目（暖かい）",value:kt.WARM},{name:"塩化ビニル",value:kt.RESIN}];return{dialog:t,pieceImage:i,boardImage:n,pieceVolume:a,clockVolume:s,clockPitch:r,clockSoundTarget:c,returnCode:u,appSetting:p,pieceImageTypes:m,boardImageTypes:_,saveAndClose:d,cancel:h}}});const Zr=(0,Ut.Z)(jr,[["render",qr],["__scopeId","data-v-1a02b0d4"]]);var zr=Zr;const Jr=e=>((0,o.dD)("data-v-01a25e3a"),e=e(),(0,o.Cn)(),e),$r={ref:"dialog"},Xr={ref:"content"},Qr={class:"dialog-form-area"},ec=Jr((()=>(0,o._)("div",{class:"message"},"以下の棋譜を取り込みます。",-1))),tc={key:0,class:"message"},ic=(0,o.Uk)(" ※テキストエリアに棋譜を貼り付けてください。"),nc=Jr((()=>(0,o._)("br",null,null,-1))),oc=(0,o.Uk)(" ※インストールアプリ版では自動的に貼り付けられます。 "),ac=[ic,nc,oc],sc={ref:"textarea"},rc={class:"dialog-main-buttons"};function cc(e,t,i,n,a,s){return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("dialog",$r,[(0,o._)("div",Xr,[(0,o._)("div",Qr,[ec,e.isNative?(0,o.kq)("",!0):((0,o.wg)(),(0,o.iD)("div",tc,ac)),(0,o._)("textarea",sc,null,512)])],512),(0,o._)("div",rc,[(0,o._)("button",{class:"dialog-button",onClick:t[0]||(t[0]=(...t)=>e.onOk&&e.onOk(...t))},"取り込む"),(0,o._)("button",{class:"dialog-button",onClick:t[1]||(t[1]=(...t)=>e.onCancel&&e.onCancel(...t))},"キャンセル")])],512)])}var lc=(0,o.aZ)({name:"PasteDialog",setup(){const e=an(),t=(0,l.iH)(null),i=(0,l.iH)(null);e.commit(ji.RETAIN_BUSSY_STATE),(0,o.bv)((async()=>{try{Va(t.value),ai()&&(i.value.value=await navigator.clipboard.readText())}finally{e.commit(ji.RELEASE_BUSSY_STATE)}}));const n=()=>{const t=i.value.value;e.commit(ji.CLOSE_PASTE_DIALOG),t&&e.dispatch(Zi.PASTE_RECORD,t)},a=()=>{e.commit(ji.CLOSE_PASTE_DIALOG)};return{dialog:t,textarea:i,onOk:n,onCancel:a,isNative:ai()}}});const uc=(0,Ut.Z)(lc,[["render",cc],["__scopeId","data-v-01a25e3a"]]);var dc=uc;const hc=e=>((0,o.dD)("data-v-4939dcf2"),e=e(),(0,o.Cn)(),e),pc={ref:"dialog",class:"bussy"},mc={class:"content"},_c=hc((()=>(0,o._)("div",{class:"message"},"処理中です。お待ち下さい。",-1)));function gc(e,t,i,n,a,s){const r=(0,o.up)("ButtonIcon");return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("dialog",pc,[(0,o._)("div",mc,[(0,o.Wm)(r,{class:"icon",icon:"bussy"}),_c])],512)])}var Ec=(0,o.aZ)({name:"BussyMessage",components:{ButtonIcon:pn},setup(){const e=(0,l.iH)(null);return(0,o.bv)((()=>{Va(e.value)})),{dialog:e}}});const Sc=(0,Ut.Z)(Ec,[["render",gc],["__scopeId","data-v-4939dcf2"]]);var Ic=Sc;const vc={ref:"dialog"},fc={class:"content"},Tc={class:"message"},Oc={class:"dialog-main-buttons"};function wc(e,t,i,n,a,s){const r=(0,o.up)("ButtonIcon");return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("dialog",vc,[(0,o._)("div",fc,[(0,o.Wm)(r,{class:"icon",icon:"question"}),(0,o._)("div",Tc,(0,H.zw)(e.confirmation.message),1)]),(0,o._)("div",Oc,[(0,o._)("button",{class:"dialog-button",onClick:t[0]||(t[0]=t=>e.onOk())},"OK"),(0,o._)("button",{class:"dialog-button",onClick:t[1]||(t[1]=t=>e.onClose())},"キャンセル")])],512)])}var Ac=(0,o.aZ)({name:"InfoMessage",components:{ButtonIcon:pn},setup(){const e=an(),t=(0,l.iH)(null),i=(0,o.Fl)((()=>e.state.confirmation.confirmation));(0,o.bv)((()=>{Va(t.value)}));const n=()=>{e.dispatch(Zi.CONFIRMATION_OK)},a=()=>{e.dispatch(Zi.CONFIRMATION_CANCEL)};return{dialog:t,confirmation:i,onOk:n,onClose:a}}});const Nc=(0,Ut.Z)(Ac,[["render",wc]]);var Rc=Nc;const Pc={ref:"dialog"},yc={class:"content"},bc={class:"message"},Hc={class:"dialog-main-buttons"};function kc(e,t,i,n,a,s){const r=(0,o.up)("ButtonIcon");return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("dialog",Pc,[(0,o._)("div",yc,[(0,o.Wm)(r,{class:"icon",icon:"info"}),(0,o._)("div",bc,(0,H.zw)(e.message),1)]),(0,o._)("div",Hc,[(0,o._)("button",{onClick:t[0]||(t[0]=t=>e.onClose())},"閉じる")])],512)])}var Cc=(0,o.aZ)({name:"InfoMessage",components:{ButtonIcon:pn},setup(){const e=an(),t=(0,l.iH)(null);(0,o.bv)((()=>{Va(t.value)}));const i=(0,o.Fl)((()=>e.getters.message)),n=()=>{e.commit(ji.SHIFT_MESSAGE)};return{dialog:t,message:i,onClose:n}}});const Dc=(0,Ut.Z)(Cc,[["render",kc]]);var Lc=Dc;const Mc={ref:"dialog",class:"error"},Gc={class:"content"},Bc={class:"items"},xc={class:"notice"},Uc={class:"index"},Wc={class:"message"},Kc={class:"dialog-main-buttons"};function Fc(e,t,i,n,a,s){const r=(0,o.up)("ButtonIcon");return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("dialog",Mc,[(0,o._)("div",Gc,[(0,o.Wm)(r,{class:"icon",icon:"error"}),(0,o._)("div",Bc,[(0,o._)("div",xc,(0,H.zw)(e.errors.length)+" 件のエラーが発生しました。 ",1),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.errors,(e=>((0,o.wg)(),(0,o.iD)("div",{key:e.index,class:"item"},[(0,o._)("p",Uc,(0,H.zw)(e.index+1)+" 件目",1),(0,o._)("p",Wc,(0,H.zw)(e.message),1)])))),128))])]),(0,o._)("div",Kc,[(0,o._)("button",{onClick:t[0]||(t[0]=t=>e.onClose())},"閉じる")])],512)])}var qc=(0,o.aZ)({name:"ErrorMessage",components:{ButtonIcon:pn},setup(){const e=an(),t=(0,l.iH)(null);(0,o.bv)((()=>{Va(t.value)}));const i=(0,o.Fl)((()=>e.state.error.queue.map(((e,t)=>({message:e.message,index:t}))))),n=()=>{e.commit(ji.CLEAR_ERRORS)};return{dialog:t,errors:i,onClose:n}}});const Vc=(0,Ut.Z)(qc,[["render",Fc],["__scopeId","data-v-520b2a4a"]]);var Yc=Vc;function jc(){const e=document.activeElement;return e instanceof HTMLTextAreaElement||e instanceof HTMLInputElement||e instanceof HTMLSelectElement}function Zc(e,t){if(!jc())switch(e){case"ArrowUp":return t.onArrowUp;case"ArrowDown":return t.onArrowDown;case"ArrowLeft":return t.onArrowLeft;case"ArrowRight":return t.onArrowRight}}function zc(e){document.addEventListener("keydown",(t=>{const i=Zc(t.key,e);i&&(t.preventDefault(),i())}))}var Jc=(0,o.aZ)({name:"App",components:{StandardLayout:ea,GameDialog:Ja,ResearchDialog:us,USIEngineManagementDialog:ar,AppSettingDialog:zr,PasteDialog:dc,BussyMessage:Ic,ConfirmDialog:Rc,InfoMessage:Lc,ErrorMessage:Yc},setup(){const e=an(),t=(0,o.Fl)((()=>({game:e.state.mode===Qi.GAME_DIALOG,research:e.state.mode===Qi.RESEARCH_DIALOG,usiEngineSetting:e.state.mode===Qi.USI_ENGINE_SETTING_DIALOG,appSetting:e.state.mode===Qi.APP_SETTING_DIALOG,paste:e.state.mode===Qi.PASTE_DIALOG,bussy:e.getters.isBussy,confirm:e.state.confirmation.confirmation}))),i=(0,o.Fl)((()=>e.getters.hasMessage)),n=(0,o.Fl)((()=>e.getters.hasError));return(0,o.bv)((()=>{const t=document.getElementsByTagName("body")[0];t.addEventListener("copy",(t=>{e.dispatch(Zi.COPY_RECORD),t.preventDefault()})),t.addEventListener("paste",(t=>{e.commit(ji.SHOW_PASTE_DIALOG),t.preventDefault()})),t.addEventListener("dragover",(e=>{e.preventDefault()})),t.addEventListener("drop",(t=>{if(t.dataTransfer&&t.dataTransfer.files[0]){const i=t.dataTransfer.files[0].path;e.dispatch(Zi.OPEN_RECORD,i)}t.preventDefault()})),zc({onArrowUp(){const t=e.state.record.current.number;e.commit(ji.CHANGE_MOVE_NUMBER,t-1)},onArrowDown(){const t=e.state.record.current.number;e.commit(ji.CHANGE_MOVE_NUMBER,t+1)},onArrowLeft(){e.commit(ji.CHANGE_MOVE_NUMBER,0)},onArrowRight(){e.commit(ji.CHANGE_MOVE_NUMBER,Number.MAX_SAFE_INTEGER)}})})),{dialogVisibilities:t,hasMessage:i,hasErrors:n}}});const $c=(0,Ut.Z)(Jc,[["render",a]]);var Xc=$c;Go.kL.register(...Go.zX),bi(sn),Promise.allSettled([pi().then((e=>{sn.commit(ji.UPDATE_APP_SETTING,e)})).catch((e=>{sn.commit(ji.PUSH_ERROR,new Error("アプリ設定の読み込み中にエラーが発生しました :"+e))})),async function(){const e=await ri();e&&await sn.dispatch(Zi.OPEN_RECORD,e)}()]).finally((()=>{(0,n.ri)(Xc).use(sn,on).mount("#app")}))},5832:function(){}},t={};function i(n){var o=t[n];if(void 0!==o)return o.exports;var a=t[n]={exports:{}};return e[n](a,a.exports,i),a.exports}i.m=e,function(){var e=[];i.O=function(t,n,o,a){if(!n){var s=1/0;for(u=0;u<e.length;u++){n=e[u][0],o=e[u][1],a=e[u][2];for(var r=!0,c=0;c<n.length;c++)(!1&a||s>=a)&&Object.keys(i.O).every((function(e){return i.O[e](n[c])}))?n.splice(c--,1):(r=!1,a<s&&(s=a));if(r){e.splice(u--,1);var l=o();void 0!==l&&(t=l)}}return t}a=a||0;for(var u=e.length;u>0&&e[u-1][2]>a;u--)e[u]=e[u-1];e[u]=[n,o,a]}}(),function(){i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,{a:t}),t}}(),function(){i.d=function(e,t){for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}}(),function(){i.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={826:0};i.O.j=function(t){return 0===e[t]};var t=function(t,n){var o,a,s=n[0],r=n[1],c=n[2],l=0;if(s.some((function(t){return 0!==e[t]}))){for(o in r)i.o(r,o)&&(i.m[o]=r[o]);if(c)var u=c(i)}for(t&&t(n);l<s.length;l++)a=s[l],i.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return i.O(u)},n=self["webpackChunkelectron_shogi"]=self["webpackChunkelectron_shogi"]||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))}();var n=i.O(void 0,[998],(function(){return i(8569)}));n=i.O(n)})();
//# sourceMappingURL=index.b92195a2.js.map