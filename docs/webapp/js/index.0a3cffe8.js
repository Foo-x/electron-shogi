(function(){var e={3525:function(e,t,i){"use strict";i(1703);var n=i(9963),o=i(6252);function a(e,t,i,n,a,s){const r=(0,o.up)("StandardLayout"),l=(0,o.up)("GameDialog"),c=(0,o.up)("ResearchDialog"),u=(0,o.up)("AnalysisDialog"),h=(0,o.up)("USIEngineManagementDialog"),d=(0,o.up)("AppSettingDialog"),p=(0,o.up)("PasteDialog"),m=(0,o.up)("BussyMessage"),g=(0,o.up)("ConfirmDialog"),_=(0,o.up)("InfoMessage"),v=(0,o.up)("ErrorMessage");return(0,o.wg)(),(0,o.iD)(o.HY,null,[(0,o.Wm)(r,{class:"main"}),e.dialogVisibilities.game?((0,o.wg)(),(0,o.j4)(l,{key:0})):(0,o.kq)("",!0),e.dialogVisibilities.research?((0,o.wg)(),(0,o.j4)(c,{key:1})):(0,o.kq)("",!0),e.dialogVisibilities.analysis?((0,o.wg)(),(0,o.j4)(u,{key:2})):(0,o.kq)("",!0),e.dialogVisibilities.usiEngineSetting?((0,o.wg)(),(0,o.j4)(h,{key:3})):(0,o.kq)("",!0),e.dialogVisibilities.appSetting?((0,o.wg)(),(0,o.j4)(d,{key:4})):(0,o.kq)("",!0),e.dialogVisibilities.paste?((0,o.wg)(),(0,o.j4)(p,{key:5})):(0,o.kq)("",!0),e.dialogVisibilities.bussy?((0,o.wg)(),(0,o.j4)(m,{key:6})):(0,o.kq)("",!0),e.dialogVisibilities.confirm?((0,o.wg)(),(0,o.j4)(g,{key:7})):(0,o.kq)("",!0),e.hasMessage?((0,o.wg)(),(0,o.j4)(_,{key:8})):(0,o.kq)("",!0),e.hasErrors?((0,o.wg)(),(0,o.j4)(v,{key:9})):(0,o.kq)("",!0)],64)}const s={class:"main"},r={ref:"topPane",class:"top-pane"};function l(e,t,i,n,a,l){const c=(0,o.up)("BoardPane"),u=(0,o.up)("RecordPane"),h=(0,o.up)("TabPane");return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("div",s,[(0,o._)("div",r,[(0,o.Wm)(c,{class:"top-left-pane","max-size":e.boardPaneMaxSize},null,8,["max-size"]),(0,o.Wm)(u,{class:"top-right-pane"})],512),(0,o.Wm)(h,{class:"bottom-pane",size:e.bottomPaneSize},null,8,["size"])])])}var c=i(2262);const u=e=>((0,o.dD)("data-v-7b65bbae"),e=e(),(0,o.Cn)(),e),h={class:"control top"},d=(0,o.Uk)(" 対局 "),p=(0,o.Uk)(" 対局中断 "),m=(0,o.Uk)(" 投了 "),g=(0,o.Uk)(" 検討 "),_=(0,o.Uk)(" 検討終了 "),v=(0,o.Uk)(" 解析 "),S=(0,o.Uk)(" 解析中断 "),E=(0,o.Uk)(" 局面編集 "),f=(0,o.Uk)(" 局面編集終了 "),w=(0,o.Uk)(" 手番変更 "),I=u((()=>(0,o._)("option",null,"局面の初期化",-1))),T=u((()=>(0,o._)("option",{value:"standard"},"平手",-1))),y=u((()=>(0,o._)("option",{value:"handicapLance"},"香落ち",-1))),b=u((()=>(0,o._)("option",{value:"handicapRightLance"},"右香落ち",-1))),N=u((()=>(0,o._)("option",{value:"handicapBishop"},"角落ち",-1))),A=u((()=>(0,o._)("option",{value:"handicapRook"},"飛車落ち",-1))),R=u((()=>(0,o._)("option",{value:"handicapRookLance"},"飛車香落ち",-1))),O=u((()=>(0,o._)("option",{value:"handicap2Pieces"},"2枚落ち",-1))),P=u((()=>(0,o._)("option",{value:"handicap4Pieces"},"4枚落ち",-1))),k=u((()=>(0,o._)("option",{value:"handicap6Pieces"},"6枚落ち",-1))),H=u((()=>(0,o._)("option",{value:"handicap8Pieces"},"8枚落ち",-1))),C=u((()=>(0,o._)("option",{value:"tsumeShogi"},"詰め将棋",-1))),M=u((()=>(0,o._)("option",{value:"tsumeShogi2Kings"},"双玉詰め将棋",-1))),L=[I,T,y,b,N,A,R,O,P,k,H,C,M],D={class:"control bottom"},B=(0,o.Uk)(" アプリ設定 "),G=["disabled"],x=(0,o.Uk)(" エンジン設定 "),K=(0,o.Uk)(" 盤面反転 "),W=["disabled"],F=(0,o.Uk)(" 棋譜貼り付け "),U=(0,o.Uk)(" 棋譜コピー "),q=["disabled"],V=(0,o.Uk)(" 指し手削除 ");function Z(e,t,i,n,a,s){const r=(0,o.up)("ButtonIcon"),l=(0,o.up)("BoardView");return(0,o.wg)(),(0,o.iD)("div",null,[(0,o.Wm)(l,{"piece-image-type":e.pieceImageType,"board-image-type":e.boardImageType,"max-size":e.maxSize,position:e.position,"last-move":e.lastMove,flip:e.flip,"allow-move":e.allowMove,"allow-edit":e.allowEdit,"black-player-name":e.blackPlayerName,"white-player-name":e.whitePlayerName,"black-player-time-ms":e.blackPlayerTimeMs,"black-player-byoyomi":e.blackPlayerByoyomi,"white-player-time-ms":e.whitePlayerTimeMs,"white-player-byoyomi":e.whitePlayerByoyomi,onMove:e.onMove,onEdit:e.onEdit},{"right-control":(0,o.w5)((()=>[(0,o._)("div",h,[e.controlStates.game?((0,o.wg)(),(0,o.iD)("button",{key:0,class:"control-item",onClick:t[0]||(t[0]=(...t)=>e.onGame&&e.onGame(...t))},[(0,o.Wm)(r,{class:"icon",icon:e.Icon.GAME},null,8,["icon"]),d])):(0,o.kq)("",!0),e.controlStates.stop?((0,o.wg)(),(0,o.iD)("button",{key:1,class:"control-item",onClick:t[1]||(t[1]=(...t)=>e.onStop&&e.onStop(...t))},[(0,o.Wm)(r,{class:"icon",icon:e.Icon.STOP},null,8,["icon"]),p])):(0,o.kq)("",!0),e.controlStates.resign?((0,o.wg)(),(0,o.iD)("button",{key:2,class:"control-item",onClick:t[2]||(t[2]=(...t)=>e.onResign&&e.onResign(...t))},[(0,o.Wm)(r,{class:"icon",icon:e.Icon.RESIGN},null,8,["icon"]),m])):(0,o.kq)("",!0),e.controlStates.research?((0,o.wg)(),(0,o.iD)("button",{key:3,class:"control-item",onClick:t[3]||(t[3]=(...t)=>e.onResearch&&e.onResearch(...t))},[(0,o.Wm)(r,{class:"icon",icon:e.Icon.RESEARCH},null,8,["icon"]),g])):(0,o.kq)("",!0),e.controlStates.endResearch?((0,o.wg)(),(0,o.iD)("button",{key:4,class:"control-item",onClick:t[4]||(t[4]=(...t)=>e.onEndResearch&&e.onEndResearch(...t))},[(0,o.Wm)(r,{class:"icon",icon:e.Icon.END},null,8,["icon"]),_])):(0,o.kq)("",!0),e.controlStates.analysis?((0,o.wg)(),(0,o.iD)("button",{key:5,class:"control-item",onClick:t[5]||(t[5]=(...t)=>e.onAnalysis&&e.onAnalysis(...t))},[(0,o.Wm)(r,{class:"icon",icon:e.Icon.ANALYSIS},null,8,["icon"]),v])):(0,o.kq)("",!0),e.controlStates.endAnalysis?((0,o.wg)(),(0,o.iD)("button",{key:6,class:"control-item",onClick:t[6]||(t[6]=(...t)=>e.onEndAnalysis&&e.onEndAnalysis(...t))},[(0,o.Wm)(r,{class:"icon",icon:e.Icon.STOP},null,8,["icon"]),S])):(0,o.kq)("",!0),e.controlStates.startEditPosition?((0,o.wg)(),(0,o.iD)("button",{key:7,class:"control-item",onClick:t[7]||(t[7]=(...t)=>e.onStartEditPosition&&e.onStartEditPosition(...t))},[(0,o.Wm)(r,{class:"icon",icon:e.Icon.EDIT},null,8,["icon"]),E])):(0,o.kq)("",!0),e.controlStates.endEditPosition?((0,o.wg)(),(0,o.iD)("button",{key:8,class:"control-item",onClick:t[8]||(t[8]=(...t)=>e.onEndEditPosition&&e.onEndEditPosition(...t))},[(0,o.Wm)(r,{class:"icon",icon:e.Icon.CHECK},null,8,["icon"]),f])):(0,o.kq)("",!0),e.controlStates.initPosition?((0,o.wg)(),(0,o.iD)("button",{key:9,class:"control-item",onClick:t[9]||(t[9]=(...t)=>e.onChangeTurn&&e.onChangeTurn(...t))},[(0,o.Wm)(r,{class:"icon",icon:e.Icon.SWAP},null,8,["icon"]),w])):(0,o.kq)("",!0),e.controlStates.initPosition?((0,o.wg)(),(0,o.iD)("select",{key:10,class:"control-item",onChange:t[10]||(t[10]=(...t)=>e.onInitPosition&&e.onInitPosition(...t))},L,32)):(0,o.kq)("",!0)])])),"left-control":(0,o.w5)((()=>[(0,o._)("div",D,[(0,o._)("button",{class:"control-item",onClick:t[11]||(t[11]=(...t)=>e.onOpenAppSettings&&e.onOpenAppSettings(...t))},[(0,o.Wm)(r,{class:"icon",icon:e.Icon.SETTINGS},null,8,["icon"]),B]),(0,o._)("button",{class:"control-item",disabled:!e.controlStates.engineSettings,onClick:t[12]||(t[12]=(...t)=>e.onOpenEngineSettings&&e.onOpenEngineSettings(...t))},[(0,o.Wm)(r,{class:"icon",icon:e.Icon.ENGINE_SETTINGS},null,8,["icon"]),x],8,G),(0,o._)("button",{class:"control-item",onClick:t[13]||(t[13]=(...t)=>e.onFlip&&e.onFlip(...t))},[(0,o.Wm)(r,{class:"icon",icon:e.Icon.FLIP},null,8,["icon"]),K]),(0,o._)("button",{class:"control-item",disabled:!e.controlStates.paste,onClick:t[14]||(t[14]=(...t)=>e.onPaste&&e.onPaste(...t))},[(0,o.Wm)(r,{class:"icon",icon:e.Icon.PASTE},null,8,["icon"]),F],8,W),(0,o._)("button",{class:"control-item",onClick:t[15]||(t[15]=(...t)=>e.onCopy&&e.onCopy(...t))},[(0,o.Wm)(r,{class:"icon",icon:e.Icon.COPY},null,8,["icon"]),U]),(0,o._)("button",{class:"control-item",disabled:!e.controlStates.removeAfter,onClick:t[16]||(t[16]=(...t)=>e.onRemoveAfter&&e.onRemoveAfter(...t))},[(0,o.Wm)(r,{class:"icon",icon:e.Icon.DELETE},null,8,["icon"]),V],8,q)])])),_:1},8,["piece-image-type","board-image-type","max-size","position","last-move","flip","allow-move","allow-edit","black-player-name","white-player-name","black-player-time-ms","black-player-byoyomi","white-player-time-ms","white-player-byoyomi","onMove","onEdit"])])}var z=i(3577);const j=["src"],Y={class:"player-name-text"},$={class:"clock-text"},J={class:"player-name-text"},X={class:"clock-text"},Q=["src"],ee=["onClick","onContextmenu"],te=["src"],ie=["onClick"],ne=["src"],oe=["onClick"],ae=["src"],se=["src"];function re(e,t,i,n,a,s){return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("div",{class:"frame",style:(0,z.j5)(e.layout.frame.style),onClick:t[2]||(t[2]=t=>e.clickFrame())},[(0,o._)("div",{class:"board",style:(0,z.j5)(e.layout.board.style)},[(0,o._)("img",{class:"board-image",src:e.layout.board.imagePath},null,8,j)],4),(0,o._)("div",{class:(0,z.C_)(["player-name",{active:"black"==e.position.color}]),style:(0,z.j5)(e.layout.blackPlayerName.style)},[(0,o._)("span",Y,"▲"+(0,z.zw)(e.blackPlayerName),1)],6),(0,o._)("div",{class:(0,z.C_)(["clock",e.blackPlayerTimeSeverity]),style:(0,z.j5)(e.layout.blackClock.style)},[(0,o._)("span",$,(0,z.zw)(e.blackPlayerTimeText),1)],6),(0,o._)("div",{class:(0,z.C_)(["player-name",{active:"white"==e.position.color}]),style:(0,z.j5)(e.layout.whitePlayerName.style)},[(0,o._)("span",J,"△"+(0,z.zw)(e.whitePlayerName),1)],6),(0,o._)("div",{class:(0,z.C_)(["clock",e.whitePlayerTimeSeverity]),style:(0,z.j5)(e.layout.whiteClock.style)},[(0,o._)("span",X,(0,z.zw)(e.whitePlayerTimeText),1)],6),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.layout.square,(e=>((0,o.wg)(),(0,o.iD)("div",{key:e.id,class:"square",style:(0,z.j5)(e.backgroundStyle)},null,4)))),128)),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.layout.piece,(e=>((0,o.wg)(),(0,o.iD)("div",{key:e.id,class:"piece",style:(0,z.j5)(e.style)},[(0,o._)("img",{class:"piece-image",src:e.imagePath},null,8,Q)],4)))),128)),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.layout.square,(t=>((0,o.wg)(),(0,o.iD)("div",{key:t.id,class:"square",style:(0,z.j5)(t.style),onClick:i=>e.clickSquare(i,t.file,t.rank),onContextmenu:i=>e.clickSquareR(i,t.file,t.rank)},null,44,ee)))),128)),(0,o._)("div",{class:"hand",style:(0,z.j5)(e.layout.blackHand.style)},[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.layout.blackHand.pointers,(e=>((0,o.wg)(),(0,o.iD)("div",{key:e.id,class:"hand-pointer",style:(0,z.j5)(e.backgroundStyle)},null,4)))),128)),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.layout.blackHand.pieces,(e=>((0,o.wg)(),(0,o.iD)("div",{key:e.id,class:"piece",style:(0,z.j5)(e.style)},[(0,o._)("img",{class:"piece-image",src:e.imagePath},null,8,te)],4)))),128)),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.layout.blackHand.pointers,(t=>((0,o.wg)(),(0,o.iD)("div",{key:t.id,class:"hand-pointer",style:(0,z.j5)(t.style),onClick:i=>e.clickHand(i,e.Color.BLACK,t.type)},null,12,ie)))),128))],4),(0,o._)("div",{class:"hand",style:(0,z.j5)(e.layout.whiteHand.style)},[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.layout.whiteHand.pointers,(e=>((0,o.wg)(),(0,o.iD)("div",{key:e.id,class:"hand-pointer",style:(0,z.j5)(e.backgroundStyle)},null,4)))),128)),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.layout.whiteHand.pieces,(e=>((0,o.wg)(),(0,o.iD)("div",{key:e.id,class:"piece",style:(0,z.j5)(e.style)},[(0,o._)("img",{class:"piece-image",src:e.imagePath},null,8,ne)],4)))),128)),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.layout.whiteHand.pointers,(t=>((0,o.wg)(),(0,o.iD)("div",{key:t.id,class:"hand-pointer",style:(0,z.j5)(t.style),onClick:i=>e.clickHand(i,e.Color.WHITE,t.type)},null,12,oe)))),128))],4),e.layout.promotion?((0,o.wg)(),(0,o.iD)("div",{key:0,class:"promotion-selector",style:(0,z.j5)(e.layout.promotion.style)},[(0,o._)("div",{class:"select-button promote",onClick:t[0]||(t[0]=t=>e.clickPromote(t))},[(0,o._)("img",{class:"piece-image",src:e.layout.promotion.promoteImagePath},null,8,ae)]),(0,o._)("div",{class:"select-button not-promote",onClick:t[1]||(t[1]=t=>e.clickNotPromote(t))},[(0,o._)("img",{class:"piece-image",src:e.layout.promotion.notPromoteImagePath},null,8,se)])],4)):(0,o.kq)("",!0),(0,o._)("div",{class:"turn",style:(0,z.j5)(e.layout.turn.style)},"手番",4),(0,o._)("div",{style:(0,z.j5)(e.layout.control.left.style)},[(0,o.WI)(e.$slots,"left-control",{},void 0,!0)],4),(0,o._)("div",{style:(0,z.j5)(e.layout.control.right.style)},[(0,o.WI)(e.$slots,"right-control",{},void 0,!0)],4)],4)])}i(7686),i(4506);var le,ce,ue=i(2482);function he(e){return e===le.BLACK?le.WHITE:le.BLACK}function de(e){return e===le.BLACK?"b":"w"}function pe(e){return"b"===e||"w"===e}function me(e){return"b"===e?le.BLACK:le.WHITE}(function(e){e["BLACK"]="black",e["WHITE"]="white"})(le||(le={})),function(e){e["PAWN"]="pawn",e["LANCE"]="lance",e["KNIGHT"]="knight",e["SILVER"]="silver",e["GOLD"]="gold",e["BISHOP"]="bishop",e["ROOK"]="rook",e["KING"]="king",e["PROM_PAWN"]="promPawn",e["PROM_LANCE"]="promLance",e["PROM_KNIGHT"]="promKnight",e["PROM_SILVER"]="promSilver",e["HORSE"]="horse",e["DRAGON"]="dragon"}(ce||(ce={}));const ge={pawn:"歩",lance:"香",knight:"桂",silver:"銀",gold:"金",bishop:"角",rook:"飛",king:"玉",promPawn:"と",promLance:"成香",promKnight:"成桂",promSilver:"成銀",horse:"馬",dragon:"竜"};function _e(e){const t=ge[e];return t||""}ce.PAWN,ce.LANCE,ce.KNIGHT,ce.SILVER,ce.GOLD,ce.BISHOP,ce.ROOK,ce.KING,ce.PROM_PAWN,ce.PROM_LANCE,ce.PROM_KNIGHT,ce.PROM_SILVER,ce.HORSE,ce.DRAGON;const ve=[ce.PAWN,ce.LANCE,ce.KNIGHT,ce.SILVER,ce.GOLD,ce.BISHOP,ce.ROOK],Se={pawn:!0,lance:!0,knight:!0,silver:!0,gold:!1,bishop:!0,rook:!0,king:!1,promPawn:!1,promLance:!1,promKnight:!1,promSilver:!1,horse:!1,dragon:!1},Ee={pawn:ce.PROM_PAWN,lance:ce.PROM_LANCE,knight:ce.PROM_KNIGHT,silver:ce.PROM_SILVER,bishop:ce.HORSE,rook:ce.DRAGON};function fe(e){return Ee[e]||e}const we={promPawn:ce.PAWN,promLance:ce.LANCE,promKnight:ce.KNIGHT,promSilver:ce.SILVER,horse:ce.BISHOP,dragon:ce.ROOK};const Ie={pawn:"P",lance:"L",knight:"N",silver:"S",gold:"G",bishop:"B",rook:"R",king:"K",promPawn:"+P",promLance:"+L",promKnight:"+N",promSilver:"+S",horse:"+B",dragon:"+R"};function Te(e){return Ie[e]}const ye={pawn:"p",lance:"l",knight:"n",silver:"s",gold:"g",bishop:"b",rook:"r",king:"k",promPawn:"+p",promLance:"+l",promKnight:"+n",promSilver:"+s",horse:"+b",dragon:"+r"},be={P:ce.PAWN,L:ce.LANCE,N:ce.KNIGHT,S:ce.SILVER,G:ce.GOLD,B:ce.BISHOP,R:ce.ROOK,K:ce.KING,"+P":ce.PROM_PAWN,"+L":ce.PROM_LANCE,"+N":ce.PROM_KNIGHT,"+S":ce.PROM_SILVER,"+B":ce.HORSE,"+R":ce.DRAGON,p:ce.PAWN,l:ce.LANCE,n:ce.KNIGHT,s:ce.SILVER,g:ce.GOLD,b:ce.BISHOP,r:ce.ROOK,k:ce.KING,"+p":ce.PROM_PAWN,"+l":ce.PROM_LANCE,"+n":ce.PROM_KNIGHT,"+s":ce.PROM_SILVER,"+b":ce.HORSE,"+r":ce.DRAGON},Ne={P:le.BLACK,L:le.BLACK,N:le.BLACK,S:le.BLACK,G:le.BLACK,B:le.BLACK,R:le.BLACK,K:le.BLACK,"+P":le.BLACK,"+L":le.BLACK,"+N":le.BLACK,"+S":le.BLACK,"+B":le.BLACK,"+R":le.BLACK,p:le.WHITE,l:le.WHITE,n:le.WHITE,s:le.WHITE,g:le.WHITE,b:le.WHITE,r:le.WHITE,k:le.WHITE,"+p":le.WHITE,"+l":le.WHITE,"+n":le.WHITE,"+s":le.WHITE,"+b":le.WHITE,"+r":le.WHITE},Ae=new Map;Ae.set(ce.PAWN,{type:ce.PROM_PAWN,reverseColor:!1}),Ae.set(ce.LANCE,{type:ce.PROM_LANCE,reverseColor:!1}),Ae.set(ce.KNIGHT,{type:ce.PROM_KNIGHT,reverseColor:!1}),Ae.set(ce.SILVER,{type:ce.PROM_SILVER,reverseColor:!1}),Ae.set(ce.GOLD,{type:ce.GOLD,reverseColor:!0}),Ae.set(ce.BISHOP,{type:ce.HORSE,reverseColor:!1}),Ae.set(ce.ROOK,{type:ce.DRAGON,reverseColor:!1}),Ae.set(ce.KING,{type:ce.KING,reverseColor:!0}),Ae.set(ce.PROM_PAWN,{type:ce.PAWN,reverseColor:!0}),Ae.set(ce.PROM_LANCE,{type:ce.LANCE,reverseColor:!0}),Ae.set(ce.PROM_KNIGHT,{type:ce.KNIGHT,reverseColor:!0}),Ae.set(ce.PROM_SILVER,{type:ce.SILVER,reverseColor:!0}),Ae.set(ce.HORSE,{type:ce.BISHOP,reverseColor:!0}),Ae.set(ce.DRAGON,{type:ce.ROOK,reverseColor:!0});class Re{constructor(e,t){(0,ue.Z)(this,"color",void 0),(0,ue.Z)(this,"type",void 0),this.type=t,this.color=e}black(){return this.withColor(le.BLACK)}white(){return this.withColor(le.WHITE)}withColor(e){return new Re(e,this.type)}equals(e){return this.type===e.type&&this.color===e.color}promoted(){const e=Ee[this.type];return new Re(this.color,e||this.type)}unpromoted(){const e=we[this.type];return new Re(this.color,e||this.type)}isPromotable(){return!!Se[this.type]}rotate(){const e=Ae.get(this.type),t=new Re(this.color,e?e.type:this.type);return e&&e.reverseColor&&(t.color=he(this.color)),t}get id(){return this.color+"_"+this.type}get sfen(){switch(this.color){default:case le.BLACK:return Ie[this.type];case le.WHITE:return ye[this.type]}}static isValidSFEN(e){return!!be[e]}static newBySFEN(e){const t=be[e];if(!t)return null;const i=Ne[e];return i?new Re(i,t):null}}var Oe;(function(e){e["UP"]="up",e["DOWN"]="down",e["LEFT"]="left",e["RIGHT"]="right",e["LEFT_UP"]="left_up",e["RIGHT_UP"]="right_up",e["LEFT_DOWN"]="left_down",e["RIGHT_DOWN"]="right_down",e["LEFT_UP_KNIGHT"]="left_up_knight",e["RIGHT_UP_KNIGHT"]="right_up_knight",e["LEFT_DOWN_KNIGHT"]="left_down_knight",e["RIGHT_DOWN_KNIGHT"]="right_down_knight"})(Oe||(Oe={}));const Pe={up:Oe.DOWN,down:Oe.UP,left:Oe.RIGHT,right:Oe.LEFT,left_up:Oe.RIGHT_DOWN,right_up:Oe.LEFT_DOWN,left_down:Oe.RIGHT_UP,right_down:Oe.LEFT_UP,left_up_knight:Oe.RIGHT_DOWN_KNIGHT,right_up_knight:Oe.LEFT_DOWN_KNIGHT,left_down_knight:Oe.RIGHT_UP_KNIGHT,right_down_knight:Oe.LEFT_UP_KNIGHT};function ke(e){return Pe[e]}const He=[Oe.UP,Oe.DOWN,Oe.LEFT,Oe.RIGHT,Oe.LEFT_UP,Oe.RIGHT_UP,Oe.LEFT_DOWN,Oe.RIGHT_DOWN,Oe.LEFT_UP_KNIGHT,Oe.RIGHT_UP_KNIGHT,Oe.LEFT_DOWN_KNIGHT,Oe.RIGHT_DOWN_KNIGHT];var Ce;(function(e){e["SHORT"]="short",e["LONG"]="long"})(Ce||(Ce={}));const Me={black:{pawn:{up:Ce.SHORT},lance:{up:Ce.LONG},knight:{left_up_knight:Ce.SHORT,right_up_knight:Ce.SHORT},silver:{left_up:Ce.SHORT,up:Ce.SHORT,right_up:Ce.SHORT,left_down:Ce.SHORT,right_down:Ce.SHORT},gold:{left_up:Ce.SHORT,up:Ce.SHORT,right_up:Ce.SHORT,left:Ce.SHORT,right:Ce.SHORT,down:Ce.SHORT},bishop:{left_up:Ce.LONG,right_up:Ce.LONG,left_down:Ce.LONG,right_down:Ce.LONG},rook:{up:Ce.LONG,left:Ce.LONG,right:Ce.LONG,down:Ce.LONG},king:{left_down:Ce.SHORT,right_down:Ce.SHORT,left_up:Ce.SHORT,right_up:Ce.SHORT,down:Ce.SHORT,left:Ce.SHORT,right:Ce.SHORT,up:Ce.SHORT},promPawn:{left_up:Ce.SHORT,up:Ce.SHORT,right_up:Ce.SHORT,left:Ce.SHORT,right:Ce.SHORT,down:Ce.SHORT},promLance:{left_up:Ce.SHORT,up:Ce.SHORT,right_up:Ce.SHORT,left:Ce.SHORT,right:Ce.SHORT,down:Ce.SHORT},promKnight:{left_up:Ce.SHORT,up:Ce.SHORT,right_up:Ce.SHORT,left:Ce.SHORT,right:Ce.SHORT,down:Ce.SHORT},promSilver:{left_up:Ce.SHORT,up:Ce.SHORT,right_up:Ce.SHORT,left:Ce.SHORT,right:Ce.SHORT,down:Ce.SHORT},horse:{left_up:Ce.LONG,right_up:Ce.LONG,left_down:Ce.LONG,right_down:Ce.LONG,up:Ce.SHORT,left:Ce.SHORT,right:Ce.SHORT,down:Ce.SHORT},dragon:{up:Ce.LONG,left:Ce.LONG,right:Ce.LONG,down:Ce.LONG,left_up:Ce.SHORT,right_up:Ce.SHORT,left_down:Ce.SHORT,right_down:Ce.SHORT}},white:{pawn:{down:Ce.SHORT},lance:{down:Ce.LONG},knight:{left_down_knight:Ce.SHORT,right_down_knight:Ce.SHORT},silver:{left_down:Ce.SHORT,down:Ce.SHORT,right_down:Ce.SHORT,left_up:Ce.SHORT,right_up:Ce.SHORT},gold:{left_down:Ce.SHORT,down:Ce.SHORT,right_down:Ce.SHORT,left:Ce.SHORT,right:Ce.SHORT,up:Ce.SHORT},bishop:{left_down:Ce.LONG,right_down:Ce.LONG,left_up:Ce.LONG,right_up:Ce.LONG},rook:{down:Ce.LONG,left:Ce.LONG,right:Ce.LONG,up:Ce.LONG},king:{left_down:Ce.SHORT,right_down:Ce.SHORT,left_up:Ce.SHORT,right_up:Ce.SHORT,down:Ce.SHORT,left:Ce.SHORT,right:Ce.SHORT,up:Ce.SHORT},promPawn:{left_down:Ce.SHORT,down:Ce.SHORT,right_down:Ce.SHORT,left:Ce.SHORT,right:Ce.SHORT,up:Ce.SHORT},promLance:{left_down:Ce.SHORT,down:Ce.SHORT,right_down:Ce.SHORT,left:Ce.SHORT,right:Ce.SHORT,up:Ce.SHORT},promKnight:{left_down:Ce.SHORT,down:Ce.SHORT,right_down:Ce.SHORT,left:Ce.SHORT,right:Ce.SHORT,up:Ce.SHORT},promSilver:{left_down:Ce.SHORT,down:Ce.SHORT,right_down:Ce.SHORT,left:Ce.SHORT,right:Ce.SHORT,up:Ce.SHORT},horse:{left_down:Ce.LONG,right_down:Ce.LONG,left_up:Ce.LONG,right_up:Ce.LONG,down:Ce.SHORT,left:Ce.SHORT,right:Ce.SHORT,up:Ce.SHORT},dragon:{down:Ce.LONG,left:Ce.LONG,right:Ce.LONG,up:Ce.LONG,left_down:Ce.SHORT,right_down:Ce.SHORT,left_up:Ce.SHORT,right_up:Ce.SHORT}}};function Le(e){return Object.keys(Me[e.color][e.type])}function De(e,t){return Me[e.color][e.type][t]}const Be={up:{x:0,y:-1},down:{x:0,y:1},left:{x:-1,y:0},right:{x:1,y:0},left_up:{x:-1,y:-1},right_up:{x:1,y:-1},left_down:{x:-1,y:1},right_down:{x:1,y:1},left_up_knight:{x:-1,y:-2},right_up_knight:{x:1,y:-2},left_down_knight:{x:-1,y:2},right_down_knight:{x:1,y:2}};function Ge(e,t){if(1===e&&-2===t)return{direction:Oe.RIGHT_UP_KNIGHT,distance:1,ok:!0};if(-1===e&&-2===t)return{direction:Oe.LEFT_UP_KNIGHT,distance:1,ok:!0};if(1===e&&2===t)return{direction:Oe.RIGHT_DOWN_KNIGHT,distance:1,ok:!0};if(-1===e&&2===t)return{direction:Oe.LEFT_DOWN_KNIGHT,distance:1,ok:!0};if(0!==e&&0!==t&&Math.abs(e)!==Math.abs(t))return{direction:"",distance:0,ok:!1};let i=e,n=t,o=0;return 0!==i&&(o=Math.abs(i),i/=o),0!==n&&(o=Math.abs(n),n/=o),-1===i&&-1===n?{direction:Oe.LEFT_UP,distance:o,ok:!0}:0===i&&-1===n?{direction:Oe.UP,distance:o,ok:!0}:1===i&&-1===n?{direction:Oe.RIGHT_UP,distance:o,ok:!0}:-1===i&&0===n?{direction:Oe.LEFT,distance:o,ok:!0}:1===i&&0===n?{direction:Oe.RIGHT,distance:o,ok:!0}:-1===i&&1===n?{direction:Oe.LEFT_DOWN,distance:o,ok:!0}:0===i&&1===n?{direction:Oe.DOWN,distance:o,ok:!0}:1===i&&1===n?{direction:Oe.RIGHT_DOWN,distance:o,ok:!0}:{direction:"",distance:0,ok:!1}}function xe(e){switch(e){case"1":return 1;case"2":return 2;case"3":return 3;case"4":return 4;case"5":return 5;case"6":return 6;case"7":return 7;case"8":return 8;case"9":return 9;default:return null}}function Ke(e){switch(e){case"a":return 1;case"b":return 2;case"c":return 3;case"d":return 4;case"e":return 5;case"f":return 6;case"g":return 7;case"h":return 8;case"i":return 9;default:return null}}const We=["a","b","c","d","e","f","g","h","i"];class Fe{constructor(e,t){(0,ue.Z)(this,"file",void 0),(0,ue.Z)(this,"rank",void 0),this.file=e,this.rank=t}get x(){return 9-this.file}get y(){return this.rank-1}get index(){return 9*this.y+this.x}get opposite(){return new Fe(10-this.file,10-this.rank)}neighbor(e,t){switch(e){case Oe.UP:return new Fe(this.file,this.rank-1);case Oe.DOWN:return new Fe(this.file,this.rank+1);case Oe.LEFT:return new Fe(this.file+1,this.rank);case Oe.RIGHT:return new Fe(this.file-1,this.rank);case Oe.LEFT_UP:return new Fe(this.file+1,this.rank-1);case Oe.RIGHT_UP:return new Fe(this.file-1,this.rank-1);case Oe.LEFT_DOWN:return new Fe(this.file+1,this.rank+1);case Oe.RIGHT_DOWN:return new Fe(this.file-1,this.rank+1);case Oe.LEFT_UP_KNIGHT:return new Fe(this.file+1,this.rank-2);case Oe.RIGHT_UP_KNIGHT:return new Fe(this.file-1,this.rank-2);case Oe.LEFT_DOWN_KNIGHT:return new Fe(this.file+1,this.rank+2);case Oe.RIGHT_DOWN_KNIGHT:return new Fe(this.file-1,this.rank+2)}const i=e,n=t;return new Fe(this.file-i,this.rank+n)}get valid(){return this.file>=1&&this.file<=9&&this.rank>=1&&this.rank<=9}equals(e){return!!e&&this.file===e.file&&this.rank===e.rank}static newByXY(e,t){return new Fe(9-e,t+1)}static newByIndex(e){return new Fe(9-e%9,Math.trunc(e/9)+1)}get sfen(){return this.file+We[this.rank-1]}static parseSFENSquare(e){const t=xe(e[0]),i=Ke(e[1]);return t&&i?new Fe(t,i):null}}(0,ue.Z)(Fe,"all",[]);for(let Yh=0;Yh<81;Yh+=1)Fe.all.push(Fe.newByIndex(Yh));const Ue=["１","２","３","４","５","６","７","８","９"],qe=["一","二","三","四","五","六","七","八","九"];class Ve{constructor(e,t,i,n,o,a){(0,ue.Z)(this,"from",void 0),(0,ue.Z)(this,"to",void 0),(0,ue.Z)(this,"promote",void 0),(0,ue.Z)(this,"color",void 0),(0,ue.Z)(this,"pieceType",void 0),(0,ue.Z)(this,"capturedPieceType",void 0),this.from=e,this.to=t,this.promote=i,this.color=n,this.pieceType=o,this.capturedPieceType=a}equals(e){return!!e&&((this.from instanceof Fe&&e.from instanceof Fe&&this.from.equals(e.from)||!(this.from instanceof Fe)&&!(e.from instanceof Fe)&&this.from===e.from)&&this.to.equals(e.to)&&this.promote===e.promote&&this.color===e.color&&this.pieceType===e.pieceType&&this.capturedPieceType===e.capturedPieceType)}withPromote(){return new Ve(this.from,this.to,!0,this.color,this.pieceType,this.capturedPieceType)}getDisplayText(e){let t="";if(t+=this.color===le.BLACK?"▲":"△",e&&e.to.equals(this.to)?t+="同　":(t+=Ue[this.to.file-1],t+=qe[this.to.rank-1]),t+=_e(this.pieceType),this.promote&&(t+="成"),this.from instanceof Fe){const e=this.from;t+=`(${e.file}${e.rank})`}else t+="打";return t}get sfen(){let e="";return this.from instanceof Fe?e+=this.from.sfen:e+=Te(this.from)+"*",e+=this.to.sfen,this.promote&&(e+="+"),e}}function Ze(e){let t;if("*"===e[1]){const i=Re.newBySFEN(e[0]);if(!i)return null;t=i.type}else{const i=Fe.parseSFENSquare(e);if(!i)return null;t=i}const i=Fe.parseSFENSquare(e.substring(2));if(!i)return null;const n=e.length>=5&&"+"===e[4];return{from:t,to:i,promote:n}}var ze;function je(e){switch(e){case"1":return 1;case"2":return 2;case"3":return 3;case"4":return 4;case"5":return 5;case"6":return 6;case"7":return 7;case"8":return 8;case"9":return 9;default:return null}}(function(e){e["STANDARD"]="standard",e["EMPTY"]="empty",e["HANDICAP_LANCE"]="handicapLance",e["HANDICAP_RIGHT_LANCE"]="handicapRightLance",e["HANDICAP_BISHOP"]="handicapBishop",e["HANDICAP_ROOK"]="handicapRook",e["HANDICAP_ROOK_LANCE"]="handicapRookLance",e["HANDICAP_2PIECES"]="handicap2Pieces",e["HANDICAP_4PIECES"]="handicap4Pieces",e["HANDICAP_6PIECES"]="handicap6Pieces",e["HANDICAP_8PIECES"]="handicap8Pieces",e["TSUME_SHOGI"]="tsumeShogi",e["TSUME_SHOGI_2KINGS"]="tsumeShogi2Kings"})(ze||(ze={}));class Ye{constructor(){(0,ue.Z)(this,"squares",void 0),this.squares=new Array;for(let e=0;e<81;e+=1)this.squares.push(null);this.reset(ze.STANDARD)}at(e){return this.squares[e.index]}set(e,t){this.squares[e.index]=t}swap(e,t){const i=this.squares[e.index];this.squares[e.index]=this.squares[t.index],this.squares[t.index]=i}remove(e){const t=this.squares[e.index];return this.squares[e.index]=null,t}listNonEmptySquares(){const e=new Array;return Fe.all.forEach((t=>{this.squares[t.index]&&e.push(t)})),e}listSquaresByColor(e){const t=new Array;return Fe.all.forEach((i=>{const n=this.squares[i.index];n&&n.color===e&&t.push(i)})),t}clear(){Fe.all.forEach((e=>{this.squares[e.index]=null}))}reset(e){if(this.clear(),e!==ze.EMPTY&&(this.squares[new Fe(5,1).index]=new Re(le.WHITE,ce.KING),e!==ze.TSUME_SHOGI&&(this.squares[new Fe(5,9).index]=new Re(le.BLACK,ce.KING),e!==ze.TSUME_SHOGI_2KINGS)))switch(this.squares[new Fe(2,8).index]=new Re(le.BLACK,ce.ROOK),this.squares[new Fe(8,2).index]=new Re(le.WHITE,ce.ROOK),this.squares[new Fe(8,8).index]=new Re(le.BLACK,ce.BISHOP),this.squares[new Fe(2,2).index]=new Re(le.WHITE,ce.BISHOP),this.squares[new Fe(4,9).index]=new Re(le.BLACK,ce.GOLD),this.squares[new Fe(6,9).index]=new Re(le.BLACK,ce.GOLD),this.squares[new Fe(6,1).index]=new Re(le.WHITE,ce.GOLD),this.squares[new Fe(4,1).index]=new Re(le.WHITE,ce.GOLD),this.squares[new Fe(3,9).index]=new Re(le.BLACK,ce.SILVER),this.squares[new Fe(7,9).index]=new Re(le.BLACK,ce.SILVER),this.squares[new Fe(7,1).index]=new Re(le.WHITE,ce.SILVER),this.squares[new Fe(3,1).index]=new Re(le.WHITE,ce.SILVER),this.squares[new Fe(2,9).index]=new Re(le.BLACK,ce.KNIGHT),this.squares[new Fe(8,9).index]=new Re(le.BLACK,ce.KNIGHT),this.squares[new Fe(8,1).index]=new Re(le.WHITE,ce.KNIGHT),this.squares[new Fe(2,1).index]=new Re(le.WHITE,ce.KNIGHT),this.squares[new Fe(1,9).index]=new Re(le.BLACK,ce.LANCE),this.squares[new Fe(9,9).index]=new Re(le.BLACK,ce.LANCE),this.squares[new Fe(9,1).index]=new Re(le.WHITE,ce.LANCE),this.squares[new Fe(1,1).index]=new Re(le.WHITE,ce.LANCE),this.squares[new Fe(1,7).index]=new Re(le.BLACK,ce.PAWN),this.squares[new Fe(2,7).index]=new Re(le.BLACK,ce.PAWN),this.squares[new Fe(3,7).index]=new Re(le.BLACK,ce.PAWN),this.squares[new Fe(4,7).index]=new Re(le.BLACK,ce.PAWN),this.squares[new Fe(5,7).index]=new Re(le.BLACK,ce.PAWN),this.squares[new Fe(6,7).index]=new Re(le.BLACK,ce.PAWN),this.squares[new Fe(7,7).index]=new Re(le.BLACK,ce.PAWN),this.squares[new Fe(8,7).index]=new Re(le.BLACK,ce.PAWN),this.squares[new Fe(9,7).index]=new Re(le.BLACK,ce.PAWN),this.squares[new Fe(1,3).index]=new Re(le.WHITE,ce.PAWN),this.squares[new Fe(2,3).index]=new Re(le.WHITE,ce.PAWN),this.squares[new Fe(3,3).index]=new Re(le.WHITE,ce.PAWN),this.squares[new Fe(4,3).index]=new Re(le.WHITE,ce.PAWN),this.squares[new Fe(5,3).index]=new Re(le.WHITE,ce.PAWN),this.squares[new Fe(6,3).index]=new Re(le.WHITE,ce.PAWN),this.squares[new Fe(7,3).index]=new Re(le.WHITE,ce.PAWN),this.squares[new Fe(8,3).index]=new Re(le.WHITE,ce.PAWN),this.squares[new Fe(9,3).index]=new Re(le.WHITE,ce.PAWN),e){default:case ze.STANDARD:return;case ze.HANDICAP_LANCE:return void(this.squares[new Fe(1,1).index]=null);case ze.HANDICAP_RIGHT_LANCE:return void(this.squares[new Fe(9,1).index]=null);case ze.HANDICAP_BISHOP:return void(this.squares[new Fe(2,2).index]=null);case ze.HANDICAP_ROOK:return void(this.squares[new Fe(8,2).index]=null);case ze.HANDICAP_ROOK_LANCE:return this.squares[new Fe(8,2).index]=null,void(this.squares[new Fe(1,1).index]=null);case ze.HANDICAP_2PIECES:return this.squares[new Fe(8,2).index]=null,void(this.squares[new Fe(2,2).index]=null);case ze.HANDICAP_4PIECES:return this.squares[new Fe(8,2).index]=null,this.squares[new Fe(2,2).index]=null,this.squares[new Fe(1,1).index]=null,void(this.squares[new Fe(9,1).index]=null);case ze.HANDICAP_6PIECES:return this.squares[new Fe(8,2).index]=null,this.squares[new Fe(2,2).index]=null,this.squares[new Fe(1,1).index]=null,this.squares[new Fe(2,1).index]=null,this.squares[new Fe(8,1).index]=null,void(this.squares[new Fe(9,1).index]=null);case ze.HANDICAP_8PIECES:return this.squares[new Fe(8,2).index]=null,this.squares[new Fe(2,2).index]=null,this.squares[new Fe(1,1).index]=null,this.squares[new Fe(2,1).index]=null,this.squares[new Fe(3,1).index]=null,this.squares[new Fe(7,1).index]=null,this.squares[new Fe(8,1).index]=null,void(this.squares[new Fe(9,1).index]=null)}}get sfen(){let e="",t=0;for(let i=0;i<9;i+=1){for(let n=0;n<9;n+=1){const o=this.at(Fe.newByXY(n,i));o?(t&&(e+=t,t=0),e+=o.sfen):t+=1}t&&(e+=t,t=0),8!==i&&(e+="/")}return e}resetBySFEN(e){if(!Ye.isValidSFEN(e))return!1;this.clear();const t=e.split("/");for(let i=0;i<9;i+=1){let e=0;for(let n=0;n<t[i].length;n+=1){let o=t[i][n];"+"===o&&(n+=1,o+=t[i][n]);const a=je(o);a?e+=a:(this.set(Fe.newByXY(e,i),Re.newBySFEN(o)),e+=1)}}return!0}findKing(e){const t=new Re(e,ce.KING);return Fe.all.find((e=>{const i=this.at(e);if(i&&t.equals(i))return!0}))}hasPower(e,t,i){return!!He.find((n=>{let o=0;for(let a=e.neighbor(n);a.valid;a=a.neighbor(n)){if(o+=1,i&&i.filled&&a.equals(i.filled))break;if(i&&i.ignore&&a.equals(i.ignore))continue;const e=this.at(a);if(e){if(e.color!==t)return!1;const i=ke(n),a=De(e,i);return a===Ce.LONG||a===Ce.SHORT&&1===o}}return!1}))}isChecked(e,t){const i=this.findKing(e);return!!i&&this.hasPower(i,he(e),{filled:t&&t.filled,ignore:t&&t.ignore})}static isValidSFEN(e){const t=e.split("/");if(9!==t.length)return!1;for(let i=0;i<9;i+=1){let e=0;for(let n=0;n<t[i].length;n+=1){let o=t[i][n];"+"===o&&(n+=1,o+=t[i][n]);const a=je(o);if(a)e+=a;else{if(!Re.isValidSFEN(o))return!1;e+=1}}if(9!==e)return!1}return!0}copyFrom(e){Fe.all.forEach((t=>{this.squares[t.index]=e.at(t)}))}}function $e(e,t){return 0===e?"":(1!==e?e:"")+t.sfen}class Je{constructor(){(0,ue.Z)(this,"pieces",void 0),this.pieces=new Map,this.pieces.set(ce.PAWN,0),this.pieces.set(ce.LANCE,0),this.pieces.set(ce.KNIGHT,0),this.pieces.set(ce.SILVER,0),this.pieces.set(ce.GOLD,0),this.pieces.set(ce.BISHOP,0),this.pieces.set(ce.ROOK,0)}count(e){return this.pieces.get(e)}set(e,t){this.pieces.set(e,t)}add(e,t){let i=this.pieces.get(e);return i+=t,this.pieces.set(e,i),i}reduce(e,t){let i=this.pieces.get(e);return i-=t,this.pieces.set(e,i),i}forEach(e){e(ce.PAWN,this.pieces.get(ce.PAWN)),e(ce.LANCE,this.pieces.get(ce.LANCE)),e(ce.KNIGHT,this.pieces.get(ce.KNIGHT)),e(ce.SILVER,this.pieces.get(ce.SILVER)),e(ce.GOLD,this.pieces.get(ce.GOLD)),e(ce.BISHOP,this.pieces.get(ce.BISHOP)),e(ce.ROOK,this.pieces.get(ce.ROOK))}get sfenBlack(){return this.formatSFEN(le.BLACK)}get sfenWhite(){return this.formatSFEN(le.WHITE)}formatSFEN(e){let t="";return t+=$e(this.count(ce.ROOK),new Re(e,ce.ROOK)),t+=$e(this.count(ce.BISHOP),new Re(e,ce.BISHOP)),t+=$e(this.count(ce.GOLD),new Re(e,ce.GOLD)),t+=$e(this.count(ce.SILVER),new Re(e,ce.SILVER)),t+=$e(this.count(ce.KNIGHT),new Re(e,ce.KNIGHT)),t+=$e(this.count(ce.LANCE),new Re(e,ce.LANCE)),t+=$e(this.count(ce.PAWN),new Re(e,ce.PAWN)),""===t?"-":t}static formatSFEN(e,t){const i=e.sfenBlack,n=t.sfenWhite;return"-"===i&&"-"===n?"-":"-"===n?i:"-"===i?n:i+n}static isValidSFEN(e){return"-"===e||!!e.match(/^(?:[0-9]*[PLNSGBRplnsgbr])*$/)}static parseSFEN(e){if("-"===e)return{black:new Je,white:new Je};if(!e.match(/^(?:[0-9]*[PLNSGBRplnsgbr])*$/))return null;const t=e.match(/([0-9]*[PLNSGBRplnsgbr])/g),i=new Je,n=new Je;for(let o=0;o<t.length;o+=1){const e=t[o];let a=1;e.length>=2&&(a=Number(e.substring(0,e.length-1)));const s=Re.newBySFEN(e[e.length-1]);s.color===le.BLACK?i.add(s.type,a):n.add(s.type,a)}return{black:i,white:n}}copyFrom(e){e.pieces.forEach(((e,t)=>{this.pieces.set(t,e)}))}}const Xe={black:{pawn:{1:!0},lance:{1:!0},knight:{1:!0,2:!0}},white:{pawn:{9:!0},lance:{9:!0},knight:{9:!0,8:!0}}};function Qe(e,t,i){const n=Xe[e][t];return!!n&&n[i]}function et(e,t){return e===le.BLACK?t<=3:t>=7}function tt(e,t,i){for(let n=1;n<=9;n+=1){const o=t.at(new Fe(i,n));if(o&&o.type===ce.PAWN&&o.color===e)return!0}return!1}class it{constructor(){(0,ue.Z)(this,"_board",void 0),(0,ue.Z)(this,"_color",void 0),(0,ue.Z)(this,"_blackHand",void 0),(0,ue.Z)(this,"_whiteHand",void 0),this._board=new Ye,this._color=le.BLACK,this._blackHand=new Je,this._whiteHand=new Je}get board(){return this._board}get color(){return this._color}get blackHand(){return this._blackHand}get whiteHand(){return this._whiteHand}reset(e){switch(this._board.reset(e),this._blackHand=new Je,this._whiteHand=new Je,e){case ze.STANDARD:case ze.EMPTY:case ze.TSUME_SHOGI:case ze.TSUME_SHOGI_2KINGS:this._color=le.BLACK;break;case ze.HANDICAP_LANCE:case ze.HANDICAP_RIGHT_LANCE:case ze.HANDICAP_BISHOP:case ze.HANDICAP_ROOK:case ze.HANDICAP_ROOK_LANCE:case ze.HANDICAP_2PIECES:case ze.HANDICAP_4PIECES:case ze.HANDICAP_6PIECES:case ze.HANDICAP_8PIECES:this._color=le.WHITE;break}e!==ze.TSUME_SHOGI&&e!==ze.TSUME_SHOGI_2KINGS||(this._whiteHand.set(ce.PAWN,18),this._whiteHand.set(ce.LANCE,4),this._whiteHand.set(ce.KNIGHT,4),this._whiteHand.set(ce.SILVER,4),this._whiteHand.set(ce.GOLD,4),this._whiteHand.set(ce.BISHOP,2),this._whiteHand.set(ce.ROOK,2))}hand(e){return this._hand(e)}_hand(e){return e===le.BLACK?this._blackHand:this._whiteHand}get checked(){return this._board.isChecked(this.color)}createMove(e,t){let i;if(e instanceof Fe){const t=this._board.at(e);if(!t)return null;i=t.type}else i=e;const n=this._board.at(t);return new Ve(e,t,!1,this.color,i,n?n.type:null)}createMoveBySFEN(e){const t=Ze(e);if(!t)return null;let i=this.createMove(t.from,t.to);return i?(t.promote&&(i=i.withPromote()),i):null}isPawnDropMate(e){if(e.from instanceof Fe)return!1;if(e.pieceType!==ce.PAWN)return!1;const t=e.to.neighbor(e.color===le.BLACK?Oe.UP:Oe.DOWN),i=this.board.at(t);if(!i||i.type!==ce.KING||i.color===e.color)return!1;const n=Le(i).find((n=>{const o=t.neighbor(n);if(!o.valid)return!1;const a=this.board.at(o);return(!a||a.color!=i.color)&&!this.board.hasPower(o,e.color)}));return!n&&!this.board.listSquaresByColor(i.color).find((n=>!n.equals(t)&&this.isMovable(n,e.to)&&!this.board.isChecked(i.color,{filled:e.to,ignore:n})))}isValidMove(e){if(e.from instanceof Fe){const t=this._board.at(e.from);if(!t||t.color!==this.color)return!1;if(!this.isMovable(e.from,e.to))return!1;const i=this._board.at(e.to);if(i&&i.color===this.color)return!1;if(e.promote){if(!t.isPromotable())return!1;if(!et(this.color,e.from.rank)&&!et(this.color,e.to.rank))return!1}else if(Qe(this.color,t.type,e.to.rank))return!1;if(e.pieceType!==ce.KING?this._board.isChecked(this.color,{filled:e.to,ignore:e.from}):this._board.hasPower(e.to,he(this.color),{ignore:e.from}))return!1}else{if(e.promote)return!1;if(e.color!==this.color)return!1;if(0===this.hand(this.color).count(e.from))return!1;if(this._board.at(e.to))return!1;if(Qe(this.color,e.from,e.to.rank))return!1;if(e.from===ce.PAWN&&tt(this.color,this._board,e.to.file))return!1;if(this._board.isChecked(this.color,{filled:e.to}))return!1;if(this.isPawnDropMate(e))return!1}return!0}doMove(e,t){if((!t||!t.ignoreValidation)&&!this.isValidMove(e))return!1;if(e.from instanceof Fe){const t=this._board.at(e.from),i=this._board.at(e.to);this._board.remove(e.from),this._board.set(e.to,e.promote?t.promoted():t),i&&i.type!==ce.KING&&this._hand(this.color).add(i.unpromoted().type,1)}else this._hand(this.color).reduce(e.from,1),this._board.set(e.to,new Re(this.color,e.from));return this._color=he(this.color),!0}undoMove(e){if(this._color=he(this.color),e.from instanceof Fe)if(this._board.set(e.from,new Re(this.color,e.pieceType)),e.capturedPieceType){const t=new Re(he(this.color),e.capturedPieceType);this._board.set(e.to,t),t.type!==ce.KING&&this._hand(this.color).reduce(t.unpromoted().type,1)}else this._board.remove(e.to);else this._hand(this.color).add(e.from,1),this._board.remove(e.to)}isValidEditing(e,t){if(e instanceof Fe){const i=this._board.at(e);if(!i)return!1;if(t instanceof Fe){if(e.equals(t))return!1}else if(i.type===ce.KING)return!1}else{if(!e.color)return!1;if(0===this.hand(e.color).count(e.type))return!1;if(t instanceof Fe){if(this._board.at(t))return!1}else if(e.color===t)return!1}return!0}edit(e){if(e.move){if(!this.isValidEditing(e.move.from,e.move.to))return!1;if(e.move.from instanceof Fe)if(e.move.to instanceof Fe)this._board.swap(e.move.from,e.move.to);else{const t=this._board.remove(e.move.from);this._hand(e.move.to).add(t.unpromoted().type,1)}else this._hand(e.move.from.color).reduce(e.move.from.type,1),e.move.to instanceof Fe?this._board.set(e.move.to,e.move.from):this._hand(e.move.to).add(e.move.from.type,1)}if(e.rotate){const t=this._board.at(e.rotate);t&&this._board.set(e.rotate,t.rotate())}return!0}get sfen(){return this.getSfen(1)}getSfen(e){let t=`sfen ${this._board.sfen} ${de(this.color)} `;return t+=Je.formatSFEN(this._blackHand,this._whiteHand),t+=" "+e,t}resetBySFEN(e){if(!it.isValidSFEN(e))return!1;const t=e.split(" ");"sfen"===t[0]&&t.shift(),this._board.resetBySFEN(t[0]),this._color=me(t[1]);const i=Je.parseSFEN(t[2]);return this._blackHand=i.black,this._whiteHand=i.white,!0}setColor(e){this._color=e}static isValidSFEN(e){const t=e.split(" ");return 5===t.length&&"sfen"===t[0]&&t.shift(),4===t.length&&(!!Ye.isValidSFEN(t[0])&&(!!pe(t[1])&&(!!Je.isValidSFEN(t[2])&&!!t[3].match(/[0-9]+/))))}static newBySFEN(e){const t=new it;return t.resetBySFEN(e)?t:null}isMovable(e,t){const i=t.x-e.x,n=t.y-e.y,{direction:o,distance:a,ok:s}=Ge(i,n);if(!s)return!1;const r=this._board.at(e);if(!r)return!1;switch(De(r,o)){default:return!1;case Ce.SHORT:return 1===a;case Ce.LONG:{const i=Be[o];for(let n=e.neighbor(i.x,i.y);n.valid;n=n.neighbor(i.x,i.y)){if(n.equals(t))return!0;if(this._board.at(n))return!1}return!1}}}copyFrom(e){this._board.copyFrom(e._board),this._color=e.color,this._blackHand.copyFrom(e._blackHand),this._whiteHand.copyFrom(e._whiteHand)}clone(){const e=new it;return e.copyFrom(this),e}}function nt(e){const t={pawn:0,lance:0,knight:0,silver:0,gold:0,bishop:0,rook:0,king:0,promPawn:0,promLance:0,promKnight:0,promSilver:0,horse:0,dragon:0};return Fe.all.forEach((i=>{const n=e.board.at(i);n&&(t[n.type]+=1)})),e.blackHand.forEach(((e,i)=>{t[e]+=i})),e.whiteHand.forEach(((e,i)=>{t[e]+=i})),t}function ot(e){const t=nt(e);return{pawn:18-t.pawn-t.promPawn,lance:4-t.lance-t.promLance,knight:4-t.knight-t.promKnight,silver:4-t.silver-t.promSilver,gold:4-t.gold,bishop:2-t.bishop-t.horse,rook:2-t.rook-t.dragon,king:2-t.king,promPawn:0,promLance:0,promKnight:0,promSilver:0,horse:0,dragon:0}}function at(e){return rt(Math.floor(e/1e3))}function st(e){return lt(Math.floor(e/1e3))}function rt(e){const t=Math.floor(e/3600),i=Math.floor((e-3600*t)/60),n=e%60;return t+":"+String(i).padStart(2,"0")+":"+String(n).padStart(2,"0")}function lt(e){const t=Math.floor(e/60),i=e%60;return String(t).padStart(2," ")+":"+String(i).padStart(2,"0")}var ct,ut;function ht(e){switch(e){case ct.BLACK_NAME:return"先手";case ct.WHITE_NAME:return"後手";case ct.START_DATETIME:return"開始日時";case ct.END_DATETIME:return"終了日時";case ct.DATE:return"対局日";case ct.TOURNAMENT:return"棋戦";case ct.STRATEGY:return"戦型";case ct.TITLE:return"表題";case ct.TIME_LIMIT:return"持ち時間";case ct.TIME_SPENT:return"消費時間";case ct.PLACE:return"場所";case ct.POSTED_ON:return"掲載";case ct.NOTE:return"備考";case ct.BLACK_SHORT_NAME:return"先手省略名";case ct.WHITE_SHORT_NAME:return"後手省略名";case ct.OPUS_NO:return"作品番号";case ct.OPUS_NAME:return"作品名";case ct.AUTHOR:return"作者";case ct.PUBLISHED_ON:return"発表誌";case ct.PUBLISHED_AT:return"発表年月";case ct.SOURCE:return"出典";case ct.LENGTH:return"手数";case ct.INTEGRITY:return"完全性";case ct.CATEGORY:return"分類";case ct.AWARD:return"受賞"}}(function(e){e["BLACK_NAME"]="blackName",e["WHITE_NAME"]="whiteName",e["START_DATETIME"]="startDatetime",e["END_DATETIME"]="endDatetime",e["DATE"]="date",e["TOURNAMENT"]="tournament",e["STRATEGY"]="strategy",e["TITLE"]="title",e["TIME_LIMIT"]="timeLimit",e["TIME_SPENT"]="timeSpent",e["PLACE"]="place",e["POSTED_ON"]="postedOn",e["NOTE"]="note",e["BLACK_SHORT_NAME"]="blackShortName",e["WHITE_SHORT_NAME"]="whiteShortName",e["OPUS_NO"]="opusNo",e["OPUS_NAME"]="opusName",e["AUTHOR"]="author",e["PUBLISHED_ON"]="publishedOn",e["PUBLISHED_AT"]="publishedAt",e["SOURCE"]="source",e["LENGTH"]="length",e["INTEGRITY"]="integrity",e["CATEGORY"]="category",e["AWARD"]="award"})(ct||(ct={}));class dt{constructor(){(0,ue.Z)(this,"standard",void 0),(0,ue.Z)(this,"custom",void 0),this.standard=new Map,this.custom=new Map}get standardMetadataKeys(){return this.standard.keys()}getStandardMetadata(e){return this.standard.get(e)}setStandardMetadata(e,t){t?this.standard.set(e,t):this.standard.delete(e)}get customMetadataKeys(){return this.custom.keys()}getCustomMetadata(e){return this.custom.get(e)}setCustomMetadata(e,t){t?this.custom.set(e,t):this.custom.delete(e)}}(function(e){e["START"]="start",e["INTERRUPT"]="interrupt",e["RESIGN"]="resign",e["DRAW"]="draw",e["REPETITION_DRAW"]="repetitionDraw",e["MATE"]="mate",e["TIMEOUT"]="timeout",e["FOUL_WIN"]="foulWin",e["FOUL_LOSE"]="foulLose",e["ENTERING_OF_KING"]="enteringOfKing",e["WIN_BY_DEFAULT"]="winByDefault",e["LOSS_BY_DEFAULT"]="lossByDefault"})(ut||(ut={}));const pt={start:"開始局面",resign:"投了",interrupt:"中断",draw:"持将棋",repetitionDraw:"千日手",mate:"詰み",timeout:"切れ負け",foulWin:"反則勝ち",foulLose:"反則負け",enteringOfKing:"入玉",winByDefault:"不戦勝",lossByDefault:"不戦敗"};function mt(e){return pt[e]}class gt{constructor(e,t,i,n,o,a){(0,ue.Z)(this,"number",void 0),(0,ue.Z)(this,"prev",void 0),(0,ue.Z)(this,"branchIndex",void 0),(0,ue.Z)(this,"activeBranch",void 0),(0,ue.Z)(this,"move",void 0),(0,ue.Z)(this,"isCheck",void 0),(0,ue.Z)(this,"next",void 0),(0,ue.Z)(this,"branch",void 0),(0,ue.Z)(this,"comment",void 0),(0,ue.Z)(this,"customData",void 0),(0,ue.Z)(this,"elapsedMs",void 0),(0,ue.Z)(this,"totalElapsedMs",void 0),this.number=e,this.prev=t,this.branchIndex=i,this.activeBranch=n,this.move=o,this.isCheck=a,this.next=null,this.branch=null,this.comment="",this.elapsedMs=0,this.totalElapsedMs=0}get displayMoveText(){const e=this.prev&&this.prev.move instanceof Ve?this.prev.move:null;return this.move instanceof Ve?this.move.getDisplayText(e):mt(this.move)}get displayText(){let e=this.displayMoveText;if(0!==this.number){const t=st(this.elapsedMs),i=at(this.totalElapsedMs);e+=` (${t} / ${i})`}return e}get hasBranch(){return!!this.prev&&!!this.prev.next&&!!this.prev.next.branch}get isFirstBranch(){return!this.prev||this.prev.next===this}updateTotalElapsedMs(){this.totalElapsedMs=this.elapsedMs,this.prev&&this.prev.prev&&(this.totalElapsedMs+=this.prev.prev.totalElapsedMs)}setElapsedMs(e){this.elapsedMs=e,this.updateTotalElapsedMs();let t=this.next;const i=[];while(t)t.updateTotalElapsedMs(),t.branch&&i.push(t.branch),t=t.next?t.next:i.pop()||null}static newRootEntry(){return new gt(0,null,0,!0,ut.START,!1)}}class _t{constructor(e){(0,ue.Z)(this,"metadata",void 0),(0,ue.Z)(this,"_initialPosition",void 0),(0,ue.Z)(this,"_position",void 0),(0,ue.Z)(this,"_first",void 0),(0,ue.Z)(this,"_current",void 0),(0,ue.Z)(this,"repetitionCounts",void 0),(0,ue.Z)(this,"repetitionStart",void 0),this.metadata=new dt,this._initialPosition=e?e.clone():new it,this._position=this.initialPosition.clone(),this._first=gt.newRootEntry(),this._current=this._first,this.repetitionCounts={},this.repetitionStart={},this.incrementRepetition()}get initialPosition(){return this._initialPosition}get position(){return this._position}get first(){return this._first}get current(){return this._current}get moves(){const e=this.movesBefore;for(let t=this._current.next;t;t=t.next){while(!t.activeBranch)t=t.branch;e.push(t)}return e}get movesBefore(){return this._movesBefore}get _movesBefore(){const e=new Array;e.unshift(this._current);for(let t=this._current.prev;t;t=t.prev)e.unshift(t);return e}get length(){let e=this._current.number;for(let t=this._current.next;t;t=t.next){while(!t.activeBranch)t=t.branch;e=t.number}return e}get branchBegin(){return this._current.prev?this._current.prev.next:this._current}clear(e){this.metadata=new dt,e&&(this._initialPosition=e.clone()),this._position=this.initialPosition.clone(),this._first=gt.newRootEntry(),this._current=this._first,this.repetitionCounts={},this.repetitionStart={},this.incrementRepetition()}goBack(){return!!this._current.prev&&(this._current.move instanceof Ve&&(this.decrementRepetition(),this._position.undoMove(this._current.move)),this._current=this._current.prev,!0)}goForward(){if(this._current.next){this._current=this._current.next;while(!this._current.activeBranch)this._current=this._current.branch;return this._current.move instanceof Ve&&(this._position.doMove(this._current.move,{ignoreValidation:!0}),this.incrementRepetition()),!0}return!1}goto(e){while(e<this._current.number)if(!this.goBack())break;while(e>this._current.number)if(!this.goForward())break}resetAllBranchSelection(){this._forEach((e=>{e.activeBranch=e.isFirstBranch}))}switchBranchByIndex(e){if(!this._current.prev)return!1;let t=!1;for(let i=this._current.prev.next;i;i=i.branch)i.branchIndex===e?(i.activeBranch=!0,this._current.move instanceof Ve&&(this.decrementRepetition(),this._position.undoMove(this._current.move)),this._current=i,this._current.move instanceof Ve&&(this._position.doMove(this._current.move,{ignoreValidation:!0}),this.incrementRepetition()),t=!0):i.activeBranch=!1;return t}append(e,t){let i,n=!1;if(e instanceof Ve){if(!this._position.doMove(e,t))return!1;this.incrementRepetition(),n=this.position.checked}if(this._current===this.first||this._current.move instanceof Ve||this.goBack(),!this._current.next)return this._current.next=new gt(this._current.number+1,this._current,0,!0,e,n),this._current=this._current.next,!0;for(i=this._current.next;i;i=i.branch)i.activeBranch=!1;let o=this._current.next;for(i=this._current.next;i;i=i.branch){if(i.move instanceof Ve&&e instanceof Ve&&e.equals(i.move)||e===i.move)return this._current=i,this._current.activeBranch=!0,!0;o=i}return this._current=new gt(this._current.number+1,this._current,o.branchIndex+1,!0,e,n),o.branch=this._current,!0}removeAfter(){const e=this._current;if(!this.goBack())return void(this._current.next=null);if(this._current.next===e)this._current.next=e.branch;else for(let i=this._current.next;i;i=i.branch)if(i.branch===e){i.branch=e.branch;break}let t=0;for(let i=this._current.next;i;i=i.branch)i.branchIndex=t,t+=1;this._current.next&&(this._current.next.activeBranch=!0)}incrementRepetition(){const e=this.position.sfen;this.repetitionCounts[e]?this.repetitionCounts[e]+=1:(this.repetitionCounts[e]=1,this.repetitionStart[e]=this.current.number)}decrementRepetition(){const e=this.position.sfen;this.repetitionCounts[e]-=1,0===this.repetitionCounts[e]&&(delete this.repetitionCounts[e],delete this.repetitionStart[e])}get repetition(){return this.repetitionCounts[this.position.sfen]>=4}get perpetualCheck(){if(!this.repetition)return null;const e=this.position.sfen,t=this.repetitionStart[e];let i=!0,n=!0,o=this.position.color;for(let a=this.current;a.number>=t;a=a.prev)o=he(o),a.isCheck||(o===le.BLACK?i=!1:n=!1);return i?le.BLACK:n?le.WHITE:null}get usi(){let e="position "+this.initialPosition.sfen+" moves";return this.movesBefore.forEach((t=>{t.move instanceof Ve&&(e+=" "+t.move.sfen)})),e}get usiAll(){let e=this.usi;for(let t=this._current.next;t;t=t.next){while(!t.activeBranch)t=t.branch;t.move instanceof Ve&&(e+=" "+t.move.sfen)}return e}get sfen(){return this.position.getSfen(this._current.number+1)}forEach(e){this._forEach(e)}_forEach(e){let t=this._first;const i=[];while(t)e(t),t.branch&&i.push(t.branch),t=t.next?t.next:i.pop()||null}static newByUSI(e){const t="position startpos ",i="position sfen ",n="startpos ",o="sfen ",a="moves ";return e.startsWith(t)?_t.newByUSIFromMoves(new it,e.slice(t.length)):e.startsWith(i)?_t.newByUSIFromSFENPosition(e.slice(i.length)):e.startsWith(n)?_t.newByUSIFromMoves(new it,e.slice(n.length)):e.startsWith(o)?_t.newByUSIFromSFENPosition(e.slice(o.length)):e.startsWith(a)?_t.newByUSIFromMoves(new it,e):new Error("不正なUSI(1): "+e)}static newByUSIFromSFENPosition(e){const t=e.split(" ");if(t.length<4)return new Error("不正なUSI(2): "+e);const i=it.newBySFEN(t.slice(0,4).join(" "));return i?_t.newByUSIFromMoves(i,t.slice(4).join(" ")):new Error("不正なUSI(3): "+e)}static newByUSIFromMoves(e,t){const i=new _t(e);if(0===t.length)return i;const n=t.split(" ");if("moves"!==n[0])return new Error("不正なUSI(4): "+t);for(let o=1;o<n.length;o++){const e=Ze(n[o]);if(!e)break;let t=i.position.createMove(e.from,e.to);if(!t)return new Error("不正な指し手: "+n[o]);e.promote&&(t=t.withPromote()),i.append(t,{ignoreValidation:!0})}return i}}function vt(e,t){return e+(!e||e.endsWith("\n")?"":"\n")+t}function St(e){return e instanceof Object?JSON.stringify(e):String(e)}const Et={"先手":ct.BLACK_NAME,"後手":ct.WHITE_NAME,"開始日時":ct.START_DATETIME,"終了日時":ct.END_DATETIME,"対局日":ct.DATE,"棋戦":ct.TOURNAMENT,"戦型":ct.STRATEGY,"表題":ct.TITLE,"持ち時間":ct.TIME_LIMIT,"消費時間":ct.TIME_SPENT,"場所":ct.PLACE,"掲載":ct.POSTED_ON,"備考":ct.NOTE,"先手省略名":ct.BLACK_SHORT_NAME,"後手省略名":ct.WHITE_SHORT_NAME,"作品番号":ct.OPUS_NO,"作品名":ct.OPUS_NAME,"作者":ct.AUTHOR,"発表誌":ct.PUBLISHED_ON,"発表年月":ct.PUBLISHED_AT,"出典":ct.SOURCE,"手数":ct.LENGTH,"完全性":ct.INTEGRITY,"分類":ct.CATEGORY,"受賞":ct.AWARD},ft={blackName:"先手",whiteName:"後手",startDatetime:"開始日時",endDatetime:"終了日時",date:"対局日",tournament:"棋戦",strategy:"戦型",title:"表題",timeLimit:"持ち時間",timeSpent:"消費時間",place:"場所",postedOn:"掲載",note:"備考",blackShortName:"先手省略名",whiteShortName:"後手省略名",opusNo:"作品番号",opusName:"作品名",author:"作者",publishedOn:"発表誌",publishedAt:"発表年月",source:"出典",length:"手数",integrity:"完全性",category:"分類",award:"受賞"};var wt;(function(e){e[e["PROGRAM_COMMENT"]=0]="PROGRAM_COMMENT",e[e["METADATA"]=1]="METADATA",e[e["HANDICAP"]=2]="HANDICAP",e[e["BLACK_HAND"]=3]="BLACK_HAND",e[e["WHITE_HAND"]=4]="WHITE_HAND",e[e["BOARD"]=5]="BOARD",e[e["BLACK_TURN"]=6]="BLACK_TURN",e[e["WHITE_TURN"]=7]="WHITE_TURN",e[e["MOVE"]=8]="MOVE",e[e["COMMENT"]=9]="COMMENT",e[e["UNKNOWN"]=10]="UNKNOWN"})(wt||(wt={}));const It=[{prefix:/^#/,type:wt.PROGRAM_COMMENT,removePrefix:!1,isPosition:!1},{prefix:/^手合割：/,type:wt.HANDICAP,removePrefix:!0,isPosition:!0},{prefix:/^先手の持駒：/,type:wt.BLACK_HAND,removePrefix:!0,isPosition:!0},{prefix:/^後手の持駒：/,type:wt.WHITE_HAND,removePrefix:!0,isPosition:!0},{prefix:/^\|/,type:wt.BOARD,removePrefix:!1,isPosition:!0},{prefix:/^先手番/,type:wt.BLACK_TURN,removePrefix:!1,isPosition:!0},{prefix:/^後手番/,type:wt.WHITE_TURN,removePrefix:!1,isPosition:!0},{prefix:/^ *[0-9]+ +/,type:wt.MOVE,removePrefix:!1,isPosition:!1},{prefix:/^\*/,type:wt.COMMENT,removePrefix:!0,isPosition:!1}];function Tt(e){for(let i=0;i<It.length;i++){const t=It[i],n=e.match(t.prefix);if(n){const i=t.removePrefix?n[0].length:0;return{type:t.type,data:e.substring(i),isPosition:t.isPosition,metadataKey:""}}}const t=e.match(/^[^ ]+：/);if(t){const i=t[0];return{type:wt.METADATA,data:e.substring(i.length),isPosition:!1,metadataKey:i.substring(0,i.length-1)}}return{type:wt.UNKNOWN,data:e,isPosition:!1,metadataKey:""}}function yt(e,t){switch(t.trim()){case"平手":return void e.reset(ze.STANDARD);case"香落ち":return void e.reset(ze.HANDICAP_LANCE);case"右香落ち":return void e.reset(ze.HANDICAP_RIGHT_LANCE);case"角落ち":return void e.reset(ze.HANDICAP_BISHOP);case"飛車落ち":return void e.reset(ze.HANDICAP_ROOK);case"飛香落ち":return void e.reset(ze.HANDICAP_ROOK_LANCE);case"二枚落ち":return void e.reset(ze.HANDICAP_2PIECES);case"四枚落ち":return void e.reset(ze.HANDICAP_4PIECES);case"六枚落ち":return void e.reset(ze.HANDICAP_6PIECES);case"八枚落ち":return void e.reset(ze.HANDICAP_8PIECES);case"その他":return void e.reset(ze.EMPTY)}return new Error("不正なデータ:"+t)}const bt={"１":1,"２":2,"３":3,"４":4,"５":5,"６":6,"７":7,"８":8,"９":9},Nt={"一":1,"二":2,"三":3,"四":4,"五":5,"六":6,"七":7,"八":8,"九":9},At={"一":1,"二":2,"三":3,"四":4,"五":5,"六":6,"七":7,"八":8,"九":9,"十":10,"十一":11,"十二":12,"十三":13,"十四":14,"十五":15,"十六":16,"十七":17,"十八":18},Rt={1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9},Ot={"王":ce.KING,"玉":ce.KING,"飛":ce.ROOK,"龍":ce.DRAGON,"竜":ce.DRAGON,"角":ce.BISHOP,"馬":ce.HORSE,"金":ce.GOLD,"銀":ce.SILVER,"成銀":ce.PROM_SILVER,"全":ce.PROM_SILVER,"桂":ce.KNIGHT,"成桂":ce.PROM_KNIGHT,"圭":ce.PROM_KNIGHT,"香":ce.LANCE,"成香":ce.PROM_LANCE,"杏":ce.PROM_LANCE,"歩":ce.PAWN,"と":ce.PROM_PAWN},Pt={"中断":ut.INTERRUPT,"投了":ut.RESIGN,"持将棋":ut.DRAW,"千日手":ut.REPETITION_DRAW,"詰み":ut.MATE,"切れ負け":ut.TIMEOUT,"反則勝ち":ut.FOUL_WIN,"反則負け":ut.FOUL_LOSE,"入玉勝ち":ut.ENTERING_OF_KING,"不戦勝":ut.WIN_BY_DEFAULT,"不戦敗":ut.LOSS_BY_DEFAULT},kt=/^ *([0-9]+) +[▲△]?([１２３４５６７８９][一二三四五六七八九]|同\u3000)(王|玉|飛|龍|竜|角|馬|金|銀|成銀|全|桂|成桂|圭|香|成香|杏|歩|と)(成?)(打|\([1-9][1-9]\)) *(.*)$/,Ht=/\( *([0-9]+):([0-9]+)\/[0-9: ]*\)/,Ct=/^ *([0-9]+) +(中断|投了|持将棋|千日手|詰み|切れ負け|反則勝ち|反則負け|入玉勝ち|不戦勝|不戦敗) *(.*)$/;function Mt(e,t){if(t.length<21)return new Error("不正な盤面:"+t);const i=t[20],n=Nt[i];if(!n)return new Error("不正な盤面:"+t);for(let o=0;o<9;o+=1){const i=9-o,a=new Fe(i,n),s=2*o+1,r=t[s+1],l=Ot[r];if(!l){e.remove(a);continue}const c="v"!==t[s]?le.BLACK:le.WHITE;e.set(a,new Re(c,l))}}function Lt(e,t){const i=t.split(/[ 　]/);for(const n of i){if(!n||"なし"===n)continue;const t=n[0],i=n.substring(1),o=Ot[t],a=At[i]||1;if(!o)return new Error("不正な持ち駒: "+n);e.add(o,a)}}function Dt(e,t){const i=Ht.exec(t);if(i){const t=i[1],n=i[2],o=60*Number.parseInt(t)+Number.parseInt(n);e.current.setElapsedMs(1e3*o)}}function Bt(e,t){let i=Ct.exec(t);if(i){const t=Number(i[1]),n=Pt[i[2]],o=i[3];return e.goto(t-1),e.append(n,{ignoreValidation:!0}),void Dt(e,o)}if(i=kt.exec(t),!i)return new Error("不正な指し手形式:"+t);const n=Number(i[1]),o=i[2],a=i[3],s=i[4],r=i[5],l=i[6];if(0===n)return new Error("不正な手数:"+t);let c,u;if(e.goto(n-1),"同　"===o){if(!(e.current.move instanceof Ve))return new Error("不明な移動先: "+t);c=e.current.move.to}else{const e=bt[o[0]],t=Nt[o[1]];c=new Fe(e,t)}if("打"===r)u=Ot[a];else{const e=Rt[r[1]],t=Rt[r[2]];u=new Fe(e,t)}let h=e.position.createMove(u,c);if(!h)return new Error("不正な指し手: "+t);"成"===s&&(h=h.withPromote()),e.append(h,{ignoreValidation:!0}),Dt(e,l)}function Gt(e){const t=new dt,i=new _t,n=e.split(/\r?\n/),o=new it;let a="",s=!1;for(const r of n){if(""===r)continue;const e=Tt(r);if(s&&e.isPosition)return new Error("不正なデータ: "+r);let n;switch(e.type){case wt.METADATA:{const i=Et[e.metadataKey];i?t.setStandardMetadata(i,e.data):t.setCustomMetadata(e.metadataKey,e.data);break}case wt.HANDICAP:n=yt(o,e.data);break;case wt.BLACK_HAND:n=Lt(o.blackHand,e.data);break;case wt.WHITE_HAND:n=Lt(o.whiteHand,e.data);break;case wt.BOARD:n=Mt(o.board,e.data);break;case wt.BLACK_TURN:o.setColor(le.BLACK);break;case wt.WHITE_TURN:o.setColor(le.WHITE);break;case wt.MOVE:s||(i.clear(o),i.first.comment=a,s=!0),n=Bt(i,e.data);break;case wt.COMMENT:s?i.current.comment=vt(i.current.comment,e.data):a=vt(a,e.data);break;case wt.PROGRAM_COMMENT:break;case wt.UNKNOWN:break}if(n)return n}return s||(i.clear(o),i.first.comment=a),i.goto(0),i.resetAllBranchSelection(),i.metadata=t,i}const xt=["一","二","三","四","五","六","七","八","九","十","十一","十二","十三","十四","十五","十六","十七","十八"],Kt=["１","２","３","４","５","６","７","８","９"],Wt=xt,Ft={king:"玉",rook:"飛",dragon:"龍",bishop:"角",horse:"馬",gold:"金",silver:"銀",promSilver:"成銀",knight:"桂",promKnight:"成桂",lance:"香",promLance:"成香",pawn:"歩",promPawn:"と"},Ut={king:"玉",rook:"飛",dragon:"龍",bishop:"角",horse:"馬",gold:"金",silver:"銀",promSilver:"全",knight:"桂",promKnight:"圭",lance:"香",promLance:"杏",pawn:"歩",promPawn:"と"},qt={start:"",resign:"投了",interrupt:"中断",draw:"持将棋",repetitionDraw:"千日手",mate:"詰み",timeout:"切れ負け",foulWin:"反則勝ち",foulLose:"反則負け",enteringOfKing:"入玉勝ち",winByDefault:"不戦勝",lossByDefault:"不戦敗"};function Vt(e,t){let i="";const n=t.returnCode?t.returnCode:"\n";for(const o of e.standardMetadataKeys)i+=ft[o]+"："+e.getStandardMetadata(o)+n;for(const o of e.customMetadataKeys)i+=o+"："+e.getCustomMetadata(o)+n;return i}function Zt(e,t){let i="";const n=t.returnCode?t.returnCode:"\n";i+="後手の持駒："+jt(e.whiteHand)+n,i+="  ９ ８ ７ ６ ５ ４ ３ ２ １"+n,i+="+---------------------------+"+n;for(let o=0;o<9;o++){i+="|";for(let t=0;t<9;t++){const n=Fe.newByXY(t,o),a=e.board.at(n);a?a.color===le.BLACK?i+=" "+Ut[a.type]:i+="v"+Ut[a.type]:i+=" ・"}i+="|"+Wt[o]+n}return i+="+---------------------------+"+n,i+="先手の持駒："+jt(e.blackHand)+n,e.color===le.BLACK?i+="先手番"+n:i+="後手番"+n,i}function zt(e){let t="";return t+=Kt[e.to.file-1],t+=Wt[e.to.rank-1],t+=Ft[e.pieceType],e.promote&&(t+="成"),e.from instanceof Fe?t+="("+e.from.file+e.from.rank+")":t+="打",t}function jt(e){let t="";return e.forEach(((e,i)=>{i>=1&&(t+=Ut[e],i>=2&&(t+=xt[i-1]),t+="　")})),t}function Yt(e,t){let i="";const n=t.returnCode?t.returnCode:"\n";return i+="# KIF形式棋譜ファイル Generated by Electron Shogi"+n,i+=Vt(e.metadata,t),i+=Zt(e.initialPosition,t),i+="手数----指手---------消費時間--"+n,e.forEach((e=>{if(0!==e.number){e.isFirstBranch||(i+=n,i+="変化："+e.number+"手"+n),i+=e.number+" ",e.move instanceof Ve?i+=zt(e.move):i+=qt[e.move];const t=st(e.elapsedMs),o=at(e.totalElapsedMs);i+=` (${t}/${o})`,e.isFirstBranch&&e.hasBranch&&(i+="+"),i+=n}0!==e.comment.length&&(i+="*"+e.comment.replaceAll("\n",n+"*")+n)})),i}var $t,Jt;(function(e){e[e["VERSION"]=0]="VERSION",e[e["COMMENT"]=1]="COMMENT",e[e["BLACK_NAME"]=2]="BLACK_NAME",e[e["WHITE_NAME"]=3]="WHITE_NAME",e[e["METADATA"]=4]="METADATA",e[e["POSITION"]=5]="POSITION",e[e["RANK"]=6]="RANK",e[e["PIECES"]=7]="PIECES",e[e["FIRST_TURN"]=8]="FIRST_TURN",e[e["MOVE"]=9]="MOVE",e[e["SPECIAL_MOVE"]=10]="SPECIAL_MOVE",e[e["ELAPSED"]=11]="ELAPSED"})($t||($t={})),function(e){e[e["HEADER"]=0]="HEADER",e[e["MOVE"]=1]="MOVE",e[e["NEUTRAL"]=2]="NEUTRAL"}(Jt||(Jt={}));const Xt=[{pattern:/^V/,type:$t.VERSION,sectionType:Jt.HEADER},{pattern:/^'/,type:$t.COMMENT,sectionType:Jt.NEUTRAL},{pattern:/^N\+(.+)$/,type:$t.BLACK_NAME,sectionType:Jt.HEADER},{pattern:/^N-(.+)$/,type:$t.WHITE_NAME,sectionType:Jt.HEADER},{pattern:/^\$([^:]+):(.+)$/,type:$t.METADATA,sectionType:Jt.HEADER},{pattern:/^PI([1-9]{2}[A-Z]{2})*$/,type:$t.POSITION,sectionType:Jt.HEADER},{pattern:/^P[1-9]( \* |[-+][A-Z][A-Z]){9}$/,type:$t.RANK,sectionType:Jt.HEADER},{pattern:/^P[-+]([0-9]{2}[A-Z]{2})*/,type:$t.PIECES,sectionType:Jt.HEADER},{pattern:/^[-+]$/,type:$t.FIRST_TURN,sectionType:Jt.HEADER},{pattern:/^[-+][0-9]{4}[A-Z]{2}/,type:$t.MOVE,sectionType:Jt.MOVE},{pattern:/^%[-+A-Z_]+/,type:$t.SPECIAL_MOVE,sectionType:Jt.MOVE},{pattern:/^T([0-9]+)/,type:$t.ELAPSED,sectionType:Jt.MOVE}];function Qt(e){const t=[],i=e.match(/^['N$]/)?[e]:e.split(",");for(const n of i)for(let e=0;e<Xt.length;e++){const i=Xt[e].pattern.exec(n);i&&t.push({type:Xt[e].type,line:n,args:i.slice(1),sectionType:Xt[e].sectionType})}return t}const ei={EVENT:ct.TITLE,SITE:ct.PLACE,START_TIME:ct.START_DATETIME,END_TIME:ct.END_DATETIME,TIME_LIMIT:ct.TIME_LIMIT,OPENING:ct.STRATEGY},ti={FU:ce.PAWN,KY:ce.LANCE,KE:ce.KNIGHT,GI:ce.SILVER,KI:ce.GOLD,KA:ce.BISHOP,HI:ce.ROOK,OU:ce.KING,TO:ce.PROM_PAWN,NY:ce.PROM_LANCE,NK:ce.PROM_KNIGHT,NG:ce.PROM_SILVER,UM:ce.HORSE,RY:ce.DRAGON};function ii(e,t){t.reset(ze.STANDARD);for(let i=2;i+4<=e.length;i+=4){const n=Number(e[i]),o=Number(e[i+1]);t.board.remove(new Fe(n,o))}}function ni(e,t){const i=Number(e[1]);for(let n=0;n<9;n+=1){const o=9-n,a=3*n+2,s=e.slice(a,a+3);if(" "===s[0])continue;const r="+"===s[0]?le.BLACK:le.WHITE,l=ti[s.slice(1)];if(!l)return new Error("不正な駒: "+s);t.board.set(new Fe(o,i),new Re(r,l))}}function oi(e,t){const i="+"===e[1]?le.BLACK:le.WHITE;for(let n=2;n+4<=e.length;n+=4){const o=e.slice(n,n+4);if("00AL"===o){const e=ot(t);return void(i===le.BLACK?t.blackHand.forEach((i=>{t.blackHand.add(i,e[i])})):t.whiteHand.forEach((i=>{t.whiteHand.add(i,e[i])})))}const a=Number(o[0]),s=Number(o[1]),r=ti[o.slice(2)];if(!r)return new Error("不正な駒: "+o);0!==a&&0!==s?t.board.set(new Fe(a,s),new Re(i,r)):i===le.BLACK?t.blackHand.add(r,1):t.whiteHand.add(r,1)}}function ai(e,t){const i="+"===e[0]?le.BLACK:le.WHITE;if(i!=t.color)return new Error("不正な手番: "+e);const n=Number(e[1]),o=Number(e[2]),a=Number(e[3]),s=Number(e[4]),r=ti[e.slice(5,7)];if(!r)return new Error("不正な駒の種類: "+e);const l=0===n&&0===o?r:new Fe(n,o),c=new Fe(a,s);let u=t.createMove(l,c);if(!u)return new Error("不正な指し手: "+e);if(l instanceof Fe){const i=t.board.at(l);if(!i)return new Error("存在しない駒: "+e);if(i.type!==r){if(i.promoted().type!==r)return new Error("存在しない駒: "+e);u=u.withPromote()}}return u}function si(e){switch(e){case"%TORYO":return ut.RESIGN;case"%CHUDAN":return ut.INTERRUPT;case"%SENNICHITE":return ut.REPETITION_DRAW;case"%TIME_UP":return ut.TIMEOUT;case"%ILLEGAL_MOVE":return ut.FOUL_LOSE;case"%JISHOGI":return ut.DRAW;case"%KACHI":return ut.ENTERING_OF_KING;case"%HIKIWAKE":return ut.DRAW;case"%TSUMI":return ut.MATE}}function ri(e){const t=new dt,i=new _t,n=new it;n.reset(ze.EMPTY);let o=!1;const a=e.replace(/\r?\n\//,"").split(/\r?\n/);for(const s of a)for(const e of Qt(s)){if(e.sectionType===Jt.HEADER&&o||e.sectionType===Jt.MOVE&&!o)return new Error("不正な行が検出されました: "+e.line);switch(e.type){case $t.VERSION:break;case $t.COMMENT:break;case $t.BLACK_NAME:t.setStandardMetadata(ct.BLACK_NAME,e.args[0]);break;case $t.WHITE_NAME:t.setStandardMetadata(ct.WHITE_NAME,e.args[0]);break;case $t.METADATA:{const i=ei[e.args[0]];i?t.setStandardMetadata(i,e.args[1]):t.setCustomMetadata(e.args[0],e.args[1]);break}case $t.POSITION:ii(e.line,n);break;case $t.RANK:{const t=ni(e.line,n);if(t)return t;break}case $t.PIECES:{const t=oi(e.line,n);if(t)return t;break}case $t.FIRST_TURN:"+"===e.line[0]?n.setColor(le.BLACK):n.setColor(le.WHITE),i.clear(n),o=!0;break;case $t.MOVE:{const t=ai(e.line,i.position);if(t instanceof Error)return t;i.append(t,{ignoreValidation:!0});break}case $t.SPECIAL_MOVE:{const t=si(e.line);t&&i.append(t,{ignoreValidation:!0});break}case $t.ELAPSED:i.current.setElapsedMs(1e3*Number(e.args[0]));break}}return o||i.clear(n),i.goto(0),i.resetAllBranchSelection(),i.metadata=t,i}function li(e,t){let i="";const n=t.returnCode?t.returnCode:"\n",o=e.getStandardMetadata(ct.BLACK_NAME)||e.getStandardMetadata(ct.BLACK_SHORT_NAME);o&&(i+="N+"+o+n);const a=e.getStandardMetadata(ct.WHITE_NAME)||e.getStandardMetadata(ct.WHITE_SHORT_NAME);a&&(i+="N-"+a+n);const s=e.getStandardMetadata(ct.TOURNAMENT)||e.getStandardMetadata(ct.TITLE)||e.getStandardMetadata(ct.OPUS_NAME)||e.getStandardMetadata(ct.PUBLISHED_ON);s&&(i+="$EVENT:"+s+n);const r=e.getStandardMetadata(ct.PLACE);r&&(i+="$SITE:"+r+n);const l=e.getStandardMetadata(ct.START_DATETIME)||e.getStandardMetadata(ct.DATE);l&&(i+="$START_TIME:"+l.slice(10)+n);const c=e.getStandardMetadata(ct.DATE);c&&(i+="$END_TIME:"+c.slice(10)+n);const u=e.getStandardMetadata(ct.STRATEGY);return u&&(i+="$OPENING:"+u+n),i}const ci={king:"OU",rook:"HI",dragon:"RY",bishop:"KA",horse:"UM",gold:"KI",silver:"GI",promSilver:"NG",knight:"KE",promKnight:"NK",lance:"KY",promLance:"NY",pawn:"FU",promPawn:"TO"};function ui(e){let t="";return e.forEach(((e,i)=>{for(let n=0;n<i;n++)t+="00"+ci[e]})),t}function hi(e,t){let i="";const n=t.returnCode?t.returnCode:"\n";for(let o=1;o<=9;o+=1){i+="P"+o;for(let t=9;t>=1;t-=1){const n=e.board.at(new Fe(t,o));n?n.color===le.BLACK?i+="+"+ci[n.type]:i+="-"+ci[n.type]:i+=" * "}i+=n}return i+="P+"+ui(e.blackHand)+n,i+="P-"+ui(e.whiteHand)+n,i+=(e.color===le.BLACK?"+":"-")+n,i}function di(e){return e instanceof Fe?`${e.file}${e.rank}`:"00"}function pi(e){return(e.color===le.BLACK?"+":"-")+di(e.from)+di(e.to)+ci[e.promote?fe(e.pieceType):e.pieceType]}function mi(e){switch(e){case ut.RESIGN:return"%TORYO";case ut.INTERRUPT:return"%CHUDAN";case ut.REPETITION_DRAW:return"%SENNICHITE";case ut.TIMEOUT:return"%TIME_UP";case ut.FOUL_LOSE:return"%ILLEGAL_MOVE";case ut.DRAW:return"%JISHOGI";case ut.ENTERING_OF_KING:return"%KACHI";case ut.MATE:return"%TSUMI"}}function gi(e,t){let i="";const n=t.returnCode?t.returnCode:"\n";return i+="' CSA形式棋譜ファイル Generated by Electron Shogi"+n,i+="V2.2"+n,i+=li(e.metadata,t),i+=hi(e.initialPosition,t),e.moves.forEach((e=>{if(0===e.number)return;let t;t=e.move instanceof Ve?pi(e.move):mi(e.move),t&&(i+=t+n,i+="T"+Math.floor(e.elapsedMs/1e3)+n)})),i}var _i;function vi(e){if(e.startsWith("position sfen ")||e.startsWith("position startpos ")||e.startsWith("sfen ")||e.startsWith("startpos ")||e.startsWith("moves "))return _i.USI;if(it.isValidSFEN(e))return _i.SFEN;const t=/(^|\n)[#0-9開終棋手戦表持秒記消場掲備先後作発出完分受]/g,i=/(^|,|\n)[-+$%'VNPT]/g,n=e.match(t),o=e.match(i),a=n?n.length:0,s=o?o.length:0;return a>=s?_i.KIF:_i.CSA}(function(e){e[e["USI"]=0]="USI",e[e["SFEN"]=1]="SFEN",e[e["KIF"]=2]="KIF",e[e["CSA"]=3]="CSA"})(_i||(_i={}));const Si={};function Ei(e){if(Si[e])return;const t=document.createElement("img");t.src=e,Si[e]=t}var fi,wi;(function(e){e["HITOMOJI"]="hitomoji",e["HITOMOJI_GOTHIC"]="hitomojiGothic"})(fi||(fi={})),function(e){e["LIGHT"]="light",e["WARM"]="warm",e["RESIN"]="resin"}(wi||(wi={}));const Ii={frame:{width:1471,height:959},board:{x:296.5,y:0,width:878,height:960,squreWidth:94.8,squreHeight:104,leftSquarePadding:12,topSquarePadding:12.2,leftPiecePadding:17.5,topPiecePadding:18.5,highlight:{selected:{"background-color":"#0088ff",opacity:"0.8"},lastMoveTo:{"background-color":"#44cc44",opacity:"0.8"},lastMoveFrom:{"background-color":"#44cc44",opacity:"0.4"}}},piece:{width:88,height:93},hand:{color:"#8b4513",black:{x:1184,y:600},white:{x:0,y:0},width:288,height:360,highlight:{selected:{"background-color":"#ff4800",opacity:"0.7"}}},turn:{black:{x:1184,y:425},white:{x:0,y:492},width:288,height:45,fontSize:32},playerName:{black:{x:1184,y:480},white:{x:0,y:370},width:288,height:45,fontSize:25},clock:{black:{x:1184,y:535},white:{x:0,y:425},width:288,height:55,fontSize:40},control:{left:{x:0,y:547,width:288,height:412,fontSize:26},right:{x:1184,y:0,width:288,height:412,fontSize:26}}},Ti={[fi.HITOMOJI]:{black:{pawn:"./piece/hitomoji/black_pawn.png",lance:"./piece/hitomoji/black_lance.png",knight:"./piece/hitomoji/black_knight.png",silver:"./piece/hitomoji/black_silver.png",gold:"./piece/hitomoji/black_gold.png",bishop:"./piece/hitomoji/black_bishop.png",rook:"./piece/hitomoji/black_rook.png",king:"./piece/hitomoji/black_king.png",king2:"./piece/hitomoji/black_king2.png",promPawn:"./piece/hitomoji/black_prom_pawn.png",promLance:"./piece/hitomoji/black_prom_lance.png",promKnight:"./piece/hitomoji/black_prom_knight.png",promSilver:"./piece/hitomoji/black_prom_silver.png",horse:"./piece/hitomoji/black_horse.png",dragon:"./piece/hitomoji/black_dragon.png"},white:{pawn:"./piece/hitomoji/white_pawn.png",lance:"./piece/hitomoji/white_lance.png",knight:"./piece/hitomoji/white_knight.png",silver:"./piece/hitomoji/white_silver.png",gold:"./piece/hitomoji/white_gold.png",bishop:"./piece/hitomoji/white_bishop.png",rook:"./piece/hitomoji/white_rook.png",king:"./piece/hitomoji/white_king.png",king2:"./piece/hitomoji/white_king2.png",promPawn:"./piece/hitomoji/white_prom_pawn.png",promLance:"./piece/hitomoji/white_prom_lance.png",promKnight:"./piece/hitomoji/white_prom_knight.png",promSilver:"./piece/hitomoji/white_prom_silver.png",horse:"./piece/hitomoji/white_horse.png",dragon:"./piece/hitomoji/white_dragon.png"}},[fi.HITOMOJI_GOTHIC]:{black:{pawn:"./piece/hitomoji_gothic/black_pawn.png",lance:"./piece/hitomoji_gothic/black_lance.png",knight:"./piece/hitomoji_gothic/black_knight.png",silver:"./piece/hitomoji_gothic/black_silver.png",gold:"./piece/hitomoji_gothic/black_gold.png",bishop:"./piece/hitomoji_gothic/black_bishop.png",rook:"./piece/hitomoji_gothic/black_rook.png",king:"./piece/hitomoji_gothic/black_king.png",king2:"./piece/hitomoji_gothic/black_king2.png",promPawn:"./piece/hitomoji_gothic/black_prom_pawn.png",promLance:"./piece/hitomoji_gothic/black_prom_lance.png",promKnight:"./piece/hitomoji_gothic/black_prom_knight.png",promSilver:"./piece/hitomoji_gothic/black_prom_silver.png",horse:"./piece/hitomoji_gothic/black_horse.png",dragon:"./piece/hitomoji_gothic/black_dragon.png"},white:{pawn:"./piece/hitomoji_gothic/white_pawn.png",lance:"./piece/hitomoji_gothic/white_lance.png",knight:"./piece/hitomoji_gothic/white_knight.png",silver:"./piece/hitomoji_gothic/white_silver.png",gold:"./piece/hitomoji_gothic/white_gold.png",bishop:"./piece/hitomoji_gothic/white_bishop.png",rook:"./piece/hitomoji_gothic/white_rook.png",king:"./piece/hitomoji_gothic/white_king.png",king2:"./piece/hitomoji_gothic/white_king2.png",promPawn:"./piece/hitomoji_gothic/white_prom_pawn.png",promLance:"./piece/hitomoji_gothic/white_prom_lance.png",promKnight:"./piece/hitomoji_gothic/white_prom_knight.png",promSilver:"./piece/hitomoji_gothic/white_prom_silver.png",horse:"./piece/hitomoji_gothic/white_horse.png",dragon:"./piece/hitomoji_gothic/white_dragon.png"}}},yi={[wi.LIGHT]:"./board/light.png",[wi.WARM]:"./board/warm.png",[wi.RESIN]:"./board/resin.png"},bi={black:{pawn:{row:3,column:0,width:2},lance:{row:2,column:0,width:1},knight:{row:2,column:1,width:1},silver:{row:1,column:0,width:1},gold:{row:1,column:1,width:1},bishop:{row:0,column:0,width:1},rook:{row:0,column:1,width:1},king:{row:0,column:0,width:0},promPawn:{row:0,column:0,width:0},promLance:{row:0,column:0,width:0},promKnight:{row:0,column:0,width:0},promSilver:{row:0,column:0,width:0},horse:{row:0,column:0,width:0},dragon:{row:0,column:0,width:0}},white:{pawn:{row:0,column:0,width:2},lance:{row:1,column:1,width:1},knight:{row:1,column:0,width:1},silver:{row:2,column:1,width:1},gold:{row:2,column:0,width:1},bishop:{row:3,column:1,width:1},rook:{row:3,column:0,width:1},king:{row:0,column:0,width:0},promPawn:{row:0,column:0,width:0},promLance:{row:0,column:0,width:0},promKnight:{row:0,column:0,width:0},promSilver:{row:0,column:0,width:0},horse:{row:0,column:0,width:0},dragon:{row:0,column:0,width:0}}};class Ni{constructor(e,t){(0,ue.Z)(this,"pieceImages",void 0),(0,ue.Z)(this,"boardImage",void 0),this.pieceImages=Ti[e]||Ti[fi.HITOMOJI],this.boardImage=yi[t]}preload(){Ei(this.boardImage),Object.values(this.pieceImages.black).forEach(Ei),Object.values(this.pieceImages.white).forEach(Ei)}build(e,t,i,n,o,a){let s=e.width/Ii.frame.width;Ii.frame.height*s>e.height&&(s=e.height/Ii.frame.height);const r=()=>({style:{height:Ii.frame.height*s+"px",width:Ii.frame.width*s+"px"}}),l=()=>{const e=this.boardImage,t=Ii.board.x*s,i=Ii.board.y*s,n=Ii.board.width*s,o=Ii.board.height*s,a={left:t+"px",top:i+"px",height:o+"px",width:n+"px"};return{imagePath:e,x:t,y:i,style:a}},c=e=>{const i=[];return t.board.listNonEmptySquares().forEach((n=>{const o=t.board.at(n),r=o.id+n.index,l=a?he(o.color):o.color,c=o.type==ce.KING&&o.color==le.BLACK?"king2":o.type,u=this.pieceImages[l][c],h=e.x+(Ii.board.leftPiecePadding+Ii.board.squreWidth*(a?n.opposite:n).x)*s,d=e.y+(Ii.board.topPiecePadding+Ii.board.squreHeight*(a?n.opposite:n).y)*s,p=Ii.piece.width*s,m=Ii.piece.height*s;i.push({id:r,imagePath:u,style:{left:h+"px",top:d+"px",width:p+"px",height:m+"px"}})})),i},u=e=>{const t=[];return Fe.all.forEach((o=>{const r=o.index,{file:l}=o,{rank:c}=o,u=e.x+(Ii.board.leftSquarePadding+Ii.board.squreWidth*(a?o.opposite:o).x)*s,h=e.y+(Ii.board.topSquarePadding+Ii.board.squreHeight*(a?o.opposite:o).y)*s,d=Ii.board.squreWidth*s,p=Ii.board.squreHeight*s,m={left:u+"px",top:h+"px",width:d+"px",height:p+"px"};let g=m;i&&o.equals(i.to)&&(g={...g,...Ii.board.highlight.lastMoveTo}),i&&i.from instanceof Fe&&o.equals(i.from)&&(g={...g,...Ii.board.highlight.lastMoveFrom}),n instanceof Fe&&n.equals(o)&&(g={...g,...Ii.board.highlight.selected}),t.push({id:r,file:l,rank:c,style:m,backgroundStyle:g})})),t},h=(e,t)=>{const i=a?he(e):e,o=Ii.hand[i].x*s,r=Ii.hand[i].y*s,l=Ii.hand.width*s,c=Ii.hand.height*s,u={"background-color":Ii.hand.color,left:o+"px",top:r+"px",width:l+"px",height:c+"px"},h=[],d=[];return ve.forEach((o=>{const a=t.count(o),r=bi[i][o],l=Ii.hand.width/2*r.width*s,c=Ii.hand.height/4*s,u=l*r.column,p=c*r.row,m=Ii.piece.width*s,g=Ii.piece.height*s,_=Math.max(l-m*a,0)/(2*a),v=(l-m-2*_)/Math.max(a-1,1);for(let e=a-1;e>=0;e-=1){const t=o+e,n=this.pieceImages[i][o],a=u+_+v*e,s=p;h.push({id:t,imagePath:n,style:{left:a+"px",top:s+"px",width:m+"px",height:g+"px"}})}const S=o,E={left:u+"px",top:p+"px",width:l+"px",height:c+"px"};let f=E;n&&n instanceof Re&&n.color===e&&n.type===o&&(f={...f,...Ii.hand.highlight.selected}),d.push({id:S,type:o,style:E,backgroundStyle:f})})),{style:u,pieces:h,pointers:d}},d=(e,t)=>{if(!t)return null;const i=a?he(t.color):t.color,n=a?t.to.opposite:t.to,o=new Re(i,t.pieceType),r=o.promoted(),l=o.unpromoted(),c=this.pieceImages[i][r.type],u=this.pieceImages[i][l.type],h=e.x+(Ii.board.leftSquarePadding+Ii.board.squreWidth*(0===n.x?0:8===n.x?7:n.x-.5))*s,d=e.y+(Ii.board.topSquarePadding+Ii.board.squreHeight*n.y)*s,p=2*Ii.board.squreWidth*s,m=Ii.board.squreHeight*s,g={left:h+"px",top:d+"px",width:p+"px",height:m+"px","font-size":m/4+"px"};return{promoteImagePath:c,notPromoteImagePath:u,style:g}},p=()=>{const e=t.color,i=a?he(e):e,n=2;return{style:{left:Ii.turn[i].x*s-n+"px",top:Ii.turn[i].y*s-n+"px",width:Ii.turn.width*s-n+"px",height:Ii.turn.height*s-n+"px","font-size":Ii.turn.fontSize*s+"px","border-radius":Ii.turn.height*s*.4+"px","border-width":n+"px","border-style":"solid"}}},m=e=>{const t=a?he(e):e;return{style:{left:Ii.playerName[t].x*s+"px",top:Ii.playerName[t].y*s+"px",width:Ii.playerName.width*s+"px",height:Ii.playerName.height*s+"px","font-size":Ii.playerName.fontSize*s+"px"}}},g=e=>{const t=a?he(e):e;return{style:{left:Ii.clock[t].x*s+"px",top:Ii.clock[t].y*s+"px",width:Ii.clock.width*s+"px",height:Ii.clock.height*s+"px","font-size":Ii.clock.fontSize*s+"px"}}},_=()=>({left:{style:{left:Ii.control.left.x*s+"px",top:Ii.control.left.y*s+"px",width:Ii.control.left.width*s+"px",height:Ii.control.left.height*s+"px","font-size":Ii.control.left.fontSize*s+"px"}},right:{style:{left:Ii.control.right.x*s+"px",top:Ii.control.right.y*s+"px",width:Ii.control.right.width*s+"px",height:Ii.control.right.height*s+"px","font-size":Ii.control.right.fontSize*s+"px"}}}),v=r(),S=l(),E=c(S),f=u(S),w=h(le.BLACK,t.hand(le.BLACK)),I=h(le.WHITE,t.hand(le.WHITE)),T=d(S,o),y=p(),b=m(le.BLACK),N=m(le.WHITE),A=g(le.BLACK),R=g(le.WHITE),O=_();return{frame:v,board:S,piece:E,square:f,blackHand:w,whiteHand:I,promotion:T,turn:y,blackPlayerName:b,whitePlayerName:N,blackClock:A,whiteClock:R,control:O}}}class Ai{constructor(e,t){(0,ue.Z)(this,"width",void 0),(0,ue.Z)(this,"height",void 0),this.width=e,this.height=t}add(e){return new Ai(this.width+e.width,this.height+e.height)}reduce(e){return new Ai(this.width-e.width,this.height-e.height)}}var Ri=(0,o.aZ)({name:"BoardView",props:{pieceImageType:{type:String,required:!0},boardImageType:{type:String,required:!0},maxSize:{type:Ai,required:!0},position:{type:Object,required:!0},lastMove:{type:Object,required:!1,default:null},flip:{type:Boolean,required:!1},allowEdit:{type:Boolean,required:!1},allowMove:{type:Boolean,required:!1},blackPlayerName:{type:String,required:!1,default:"先手"},whitePlayerName:{type:String,required:!1,default:"後手"},blackPlayerTimeMs:{type:Number,required:!1,default:void 0},blackPlayerByoyomi:{type:Number,required:!1,default:void 0},whitePlayerTimeMs:{type:Number,required:!1,default:void 0},whitePlayerByoyomi:{type:Number,required:!1,default:void 0}},emits:["move","edit"],setup(e,t){const i=(0,c.qj)({pointer:null,reservedMove:null}),n=()=>{i.pointer=null,i.reservedMove=null};(0,o.YP)([()=>e.position,()=>e.allowEdit,()=>e.allowMove],(()=>{n()}));const a=()=>{n()},s=(o,a,s)=>{const r=i.pointer;if(n(),!(o instanceof Fe&&r instanceof Fe&&o.equals(r))&&!(o instanceof Re&&r instanceof Re&&o.equals(r))){if(r){const n=r,a=o instanceof Fe?o:o.color;if(e.allowEdit&&e.position.isValidEditing(n,a))return void t.emit("edit",{move:{from:r,to:a}});if(e.allowMove&&o instanceof Fe){const n=r instanceof Fe?r:r.type,a=o,s=e.position.createMove(n,a);if(!s)return;const l=e.position.isValidMove(s),c=e.position.isValidMove(s.withPromote());if(l&&c)return void(i.reservedMove=s);if(l)return void t.emit("move",s);if(c)return void t.emit("move",s.withPromote())}}!e.allowMove&&!e.allowEdit||a||(e.allowEdit||s===e.position.color)&&(i.pointer=o)}},r=(t,i,n)=>{t.stopPropagation(),t.preventDefault();const o=new Fe(i,n),a=e.position.board.at(o),r=!a;s(o,r,a?.color)},l=(t,i,n)=>{t.stopPropagation(),t.preventDefault();const o=0===e.position.hand(i).count(n);s(new Re(i,n),o,i)},u=(i,o,a)=>{i.stopPropagation(),i.preventDefault(),n();const s=new Fe(o,a);e.allowEdit&&e.position.board.at(s)&&t.emit("edit",{rotate:s})},h=o=>{o.stopPropagation(),o.preventDefault();const a=i.reservedMove;n(),a&&e.position.isValidMove(a.withPromote())&&t.emit("move",a.withPromote())},d=o=>{o.stopPropagation(),o.preventDefault();const a=i.reservedMove;n(),a&&e.position.isValidMove(a)&&t.emit("move",a)},p=(0,o.Fl)((()=>{const t=new Ni(e.pieceImageType,e.boardImageType);return t.preload(),t})),m=(0,o.Fl)((()=>p.value.build(e.maxSize.reduce(new Ai(20,20)),e.position,e.lastMove,i.pointer,i.reservedMove,e.flip))),g=(e,t)=>e?rt(Math.ceil(e/1e3)):void 0!==t?""+t:"0:00:00",_=(e,t)=>{if(!e&&!t)return"normal";const i=(e||0)/1e3+(t||0);return i<=5?"danger":i<=10?"warning":"normal"},v=(0,o.Fl)((()=>g(e.blackPlayerTimeMs,e.blackPlayerByoyomi))),S=(0,o.Fl)((()=>_(e.blackPlayerTimeMs,e.blackPlayerByoyomi))),E=(0,o.Fl)((()=>g(e.whitePlayerTimeMs,e.whitePlayerByoyomi))),f=(0,o.Fl)((()=>_(e.whitePlayerTimeMs,e.whitePlayerByoyomi)));return{clickFrame:a,clickSquare:r,clickHand:l,clickSquareR:u,clickPromote:h,clickNotPromote:d,layout:m,blackPlayerTimeText:v,blackPlayerTimeSeverity:S,whitePlayerTimeText:E,whitePlayerTimeSeverity:f,Color:le}}}),Oi=i(3744);const Pi=(0,Oi.Z)(Ri,[["render",re],["__scopeId","data-v-3ecdb7e9"]]);var ki=Pi;const Hi="es://human",Ci="es://usi-engine/";function Mi(e){return e.startsWith(Ci)}function Li(){const e=Date.now(),t=Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16);return Ci+`${e}/${t}`}function Di(e){return void 0!==e.value?e.value:void 0!==e.default?"string"===e.type&&"<empty>"===e.default?"":e.default:void 0}function Bi(e){const t=JSON.parse(JSON.stringify(e));return t.uri=Li(),t.name+=" のコピー",t}function Gi(e,t){e.uri=t.uri,e.name=t.name,Object.keys(t.options).forEach((i=>{e.options[i]&&(e.options[i].value=t.options[i].value)}))}class xi{constructor(e){if((0,ue.Z)(this,"engines",void 0),this.engines={},e){const t=JSON.parse(e);t.engines instanceof Object&&(this.engines=t.engines)}}hasEngine(e){return!!this.engines[e]}addEngine(e){this.engines[e.uri]=e}updateEngine(e){return!!this.engines[e.uri]&&(this.engines[e.uri]=e,!0)}removeEngine(e){return!!this.engines[e]&&(delete this.engines[e],!0)}getEngine(e){return this.engines[e]}get engineList(){return Object.values(this.engines).sort(((e,t)=>e.name!==t.name?e.name>t.name?1:-1:e.defaultName!==t.defaultName?e.defaultName>t.defaultName?1:-1:e.uri>t.uri?1:-1))}get json(){return JSON.stringify(this)}get jsonWithIndent(){return JSON.stringify(this,void 0,2)}}var Ki,Wi,Fi,Ui,qi,Vi;function Zi(){return{startCriteria:{enableNumber:!1,number:20},endCriteria:{enableNumber:!1,number:100},perMoveCriteria:{maxSeconds:5},commentBehavior:Wi.INSERT}}function zi(e,t,i){const n=e?"\n":"";switch(i){case Wi.NONE:return e;case Wi.INSERT:return t+n+e;case Wi.APPEND:return e+n+t;case Wi.OVERWRITE:return t}}function ji(e){return{pieceImage:fi.HITOMOJI,boardImage:wi.LIGHT,pieceVolume:30,clockVolume:30,clockPitch:500,clockSoundTarget:Ui.ONLY_USER,boardFlipping:!1,tab:Fi.RECORD_INFO,returnCode:e||"\r\n",coefficientInSigmoid:600,badMoveLevelThreshold1:5,badMoveLevelThreshold2:10,badMoveLevelThreshold3:20,badMoveLevelThreshold4:50,showElapsedTimeInRecordView:!0,showCommentInRecordView:!0,enableAppLog:!1,enableUSILog:!1}}function Yi(e){return e.pieceVolume<0||e.pieceVolume>100?new Error("駒音の大きさには0%～100%の値を指定してください。"):e.clockVolume<0||e.clockVolume>100?new Error("時計音の大きさには0%～100%の値を指定してください。"):e.clockPitch<220||e.clockPitch>880?new Error("時計音の高さには220Hz～880Hzの値を指定してください。"):e.coefficientInSigmoid<=0?new Error("勝率換算係数には0より大きい値を指定してください。"):e.badMoveLevelThreshold1<1||e.badMoveLevelThreshold1>100?new Error("緩手には1%～100%の値を指定してください。"):e.badMoveLevelThreshold2<1||e.badMoveLevelThreshold2>100?new Error("疑問手には1%～100%の値を指定してください。"):e.badMoveLevelThreshold3<1||e.badMoveLevelThreshold3>100?new Error("悪手には1%～100%の閾値を指定してください。"):e.badMoveLevelThreshold4<1||e.badMoveLevelThreshold4>100?new Error("大悪手には1%～100%の値を指定してください。"):e.badMoveLevelThreshold1>=e.badMoveLevelThreshold2?new Error("緩手には疑問手より小さい値を指定してください。"):e.badMoveLevelThreshold2>=e.badMoveLevelThreshold3?new Error("疑問手には悪手より小さい値を指定してください。"):e.badMoveLevelThreshold3>=e.badMoveLevelThreshold4?new Error("悪手には大悪手より小さい値を指定してください。"):void 0}function $i(e){return lt(e.timeSeconds)+"+"+String(e.byoyomi).padStart(2,"0")}function Ji(){return{black:{name:"人",uri:Hi},white:{name:"人",uri:Hi},timeLimit:{timeSeconds:0,byoyomi:30,increment:0},enableEngineTimeout:!1,humanIsFront:!0}}function Xi(e){return 0===e.timeLimit.timeSeconds&&0===e.timeLimit.byoyomi?new Error("持ち時間と秒読みが両方とも0です。"):0!==e.timeLimit.byoyomi&&0!==e.timeLimit.increment?new Error("秒読みとフィッシャールールは併用できません。"):void 0}function Qi(){return{}}(function(e){e["NEW_RECORD"]="newRecord",e["OPEN_RECORD"]="openRecord",e["SAVE_RECORD"]="saveRecord",e["SAVE_RECORD_AS"]="saveRecordAs",e["COPY_RECORD"]="copyRecord",e["COPY_RECORD_CSA"]="copyRecordCsa",e["COPY_RECORD_USI_BEFORE"]="copyRecordUsiBefore",e["COPY_RECORD_USI_ALL"]="copyRecordUsiAll",e["COPY_BOARD_SFEN"]="copyRecordSfen",e["PASTE_RECORD"]="pasteRecord",e["INSERT_INTERRUPT"]="insertInterrupt",e["INSERT_RESIGN"]="insertResign",e["INSERT_DRAW"]="insertDraw",e["INSERT_REPETITION_DRAW"]="insertRepetitionDraw",e["INSERT_MATE"]="insertMate",e["INSERT_TIMEOUT"]="insertTimeout",e["INSERT_FOUL_WIN"]="insertFoulWin",e["INSERT_FOUL_LOSE"]="insertFoulLose",e["INSERT_ENTERING_OF_KING"]="insertEnteringOfKing",e["INSERT_WIN_BY_DEFAULT"]="insertWinByDefault",e["INSERT_LOSS_BY_DEFAULT"]="insertLossByDefault",e["REMOVE_RECORD_AFTER"]="remvoeRecordAfter",e["START_POSITION_EDITING"]="startPositionEditing",e["END_POSITION_EDITING"]="endPositionEditing",e["CHANGE_TURN"]="changeTurn",e["INIT_POSITION_STANDARD"]="initPositionStandard",e["INIT_POSITION_HANDICAP_LANCE"]="initPositionHandicapLance",e["INIT_POSITION_HANDICAP_RIGHT_LANCE"]="initPositionHandicapRightLance",e["INIT_POSITION_HANDICAP_BISHOP"]="initPositionHandicapBishop",e["INIT_POSITION_HANDICAP_ROOK"]="initPositionHandicapRook",e["INIT_POSITION_HANDICAP_ROOK_LANCE"]="initPositionHandicapRookLance",e["INIT_POSITION_HANDICAP_2PIECES"]="initPositionHandicap2Pieces",e["INIT_POSITION_HANDICAP_4PIECES"]="initPositionHandicap4Pieces",e["INIT_POSITION_HANDICAP_6PIECES"]="initPositionHandicap6Pieces",e["INIT_POSITION_HANDICAP_8PIECES"]="initPositionHandicap8Pieces",e["INIT_POSITION_TSUME_SHOGI"]="initPositionTsumeShogi",e["INIT_POSITION_TSUME_SHOGI_2KINGS"]="initPositionTsumeShogi2Kings",e["START_RESEARCH"]="startResearch",e["STOP_RESEARCH"]="stopResearch",e["START_ANALYSIS"]="startAnalysis",e["STOP_ANALYSIS"]="stopAnalysis",e["START_GAME"]="startGame",e["STOP_GAME"]="stopGame",e["RESIGN"]="resign",e["FLIP_BOARD"]="flipBoard",e["APP_SETTING_DIALOG"]="appSetting",e["USI_ENGINE_SETTING_DIALOG"]="usiEngineSetting"})(Ki||(Ki={})),function(e){e["NONE"]="none",e["INSERT"]="insert",e["APPEND"]="append",e["OVERWRITE"]="overwrite"}(Wi||(Wi={})),function(e){e["RECORD_INFO"]="recordInfo",e["COMMENT"]="comment",e["SEARCH"]="search",e["CHART"]="chart",e["PERCENTAGE_CHART"]="percentageChart",e["INVISIBLE"]="invisible"}(Fi||(Fi={})),function(e){e["ALL"]="all",e["ONLY_USER"]="onlyUser"}(Ui||(Ui={})),function(e){e["INFO"]="info",e["WARN"]="warn",e["ERROR"]="error"}(qi||(qi={})),function(e){e["APP_SETTING"]="appSetting",e["RESEARCH_SETTING"]="researchSetting",e["ANALYSIS_SETTING"]="analysisSetting",e["GAME_SETTING"]="gameSetting"}(Vi||(Vi={}));const en={async getRecordPathFromProcArg(){return""},updateMenuState(){},async showOpenRecordDialog(){throw"Web版では利用できない機能です。"},async openRecord(){throw"Web版では利用できない機能です。"},async showSaveRecordDialog(){throw"Web版では利用できない機能です。"},async saveRecord(){throw"Web版では利用できない機能です。"},async showSelectFileDialog(){throw"Web版では利用できない機能です。"},async loadAppSetting(){const e=localStorage.getItem(Vi.APP_SETTING);return e?JSON.stringify({...ji(),...JSON.parse(e)}):JSON.stringify(ji())},async saveAppSetting(e){localStorage.setItem(Vi.APP_SETTING,e)},async loadResearchSetting(){const e=localStorage.getItem(Vi.RESEARCH_SETTING);return e?JSON.stringify({...Qi(),...JSON.parse(e)}):JSON.stringify(Qi())},async saveResearchSetting(e){localStorage.setItem(Vi.RESEARCH_SETTING,e)},async loadAnalysisSetting(){const e=localStorage.getItem(Vi.ANALYSIS_SETTING);return e?JSON.stringify({...Zi(),...JSON.parse(e)}):JSON.stringify(Zi())},async saveAnalysisSetting(e){localStorage.setItem(Vi.ANALYSIS_SETTING,e)},async loadGameSetting(){const e=localStorage.getItem(Vi.GAME_SETTING);return e?JSON.stringify({...Ji(),...JSON.parse(e)}):JSON.stringify(Ji())},async saveGameSetting(e){localStorage.setItem(Vi.GAME_SETTING,e)},async loadUSIEngineSetting(){return(new xi).json},async saveUSIEngineSetting(){},async showSelectUSIEngineDialog(){throw"Web版では利用できない機能です。"},async getUSIEngineInfo(){throw"Web版では利用できない機能です。"},async sendUSISetOption(){},async usiLaunch(){throw"Web版では利用できない機能です。"},async usiGo(){},async usiGoInfinite(){},async usiStop(){},async usiGameover(){},async usiQuit(){},log(e,t){switch(e){case qi.INFO:console.log(t);break;case qi.WARN:console.warn(t);break;case qi.ERROR:console.error(t);break}},onSendError(){},onMenuEvent(){},onUSIBestMove(){},onUSIInfo(){}};class tn{constructor(e){(0,ue.Z)(this,"setting",void 0),(0,ue.Z)(this,"sessionID",void 0),(0,ue.Z)(this,"usi",void 0),(0,ue.Z)(this,"position",void 0),(0,ue.Z)(this,"searchHandler",void 0),this.setting=e,this.sessionID=0}async launch(){this.sessionID=await On(this.setting),nn[this.sessionID]=this}isEngine(){return!0}async startSearch(e,t,i,n,o){this.searchHandler=o,this.usi=e.usi,this.position=e.position.clone(),Pn(this.sessionID,this.usi,t,i,n).catch((e=>{_o().pushError(e)}))}async startResearch(e){this.searchHandler=void 0,this.usi=e.usi,await kn(this.sessionID,e.usi)}async stop(){await Hn(this.sessionID)}async gameover(e){await Cn(this.sessionID,e)}async close(){this.searchHandler=void 0,await Mn(this.sessionID),delete nn[this.sessionID]}onBestMove(e,t){const i=this.searchHandler;if(this.searchHandler=void 0,!i||!this.position)return;if(e!==this.usi)return;if("resign"===t)return void i.onResign();if("win"===t)return void i.onWin();const n=this.position.createMoveBySFEN(t);if(!n)return _o().pushError("エンジンから不明な指し手を受信しました:"+t),void i.onResign();i.onMove(n)}}const nn={};function on(e,t,i){const n=nn[e];n&&n.onBestMove(t,i)}class an{constructor(){(0,ue.Z)(this,"searchHandler",void 0)}isEngine(){return!1}async startSearch(e,t,i,n,o){this.searchHandler=o}async stop(){}async gameover(){}async close(){this.searchHandler=void 0}doMove(e){const t=this.searchHandler;this.searchHandler=void 0,t&&t.onMove(e)}resign(){const e=this.searchHandler;this.searchHandler=void 0,e&&e.onResign()}}const sn=new an;function rn(){return window}function ln(){return!!rn().electronShogiAPI}function cn(){return rn().electronShogiAPI||en}async function un(){return await cn().getRecordPathFromProcArg()}async function hn(){return await cn().showOpenRecordDialog()}async function dn(e){return await cn().openRecord(e)}async function pn(e){return await cn().showSaveRecordDialog(e)}async function mn(e,t){await cn().saveRecord(e,t)}async function gn(){return await cn().showSelectFileDialog()}async function _n(){return JSON.parse(await cn().loadAppSetting())}async function vn(e){await cn().saveAppSetting(JSON.stringify(e))}async function Sn(){return JSON.parse(await cn().loadResearchSetting())}async function En(e){await cn().saveResearchSetting(JSON.stringify(e))}async function fn(){return JSON.parse(await cn().loadAnalysisSetting())}async function wn(e){await cn().saveAnalysisSetting(JSON.stringify(e))}async function In(){return JSON.parse(await cn().loadGameSetting())}async function Tn(e){await cn().saveGameSetting(JSON.stringify(e))}async function yn(){return new xi(await cn().loadUSIEngineSetting())}async function bn(e){await cn().saveUSIEngineSetting(e.jsonWithIndent)}async function Nn(){return await cn().showSelectUSIEngineDialog()}async function An(e){return JSON.parse(await cn().getUSIEngineInfo(e))}async function Rn(e,t){await cn().sendUSISetOption(e,t)}async function On(e){return await cn().usiLaunch(JSON.stringify(e))}async function Pn(e,t,i,n,o){await cn().usiGo(e,t,JSON.stringify(i),n,o)}async function kn(e,t){await cn().usiGoInfinite(e,t)}async function Hn(e){await cn().usiStop(e)}async function Cn(e,t){await cn().usiGameover(e,t)}async function Mn(e){await cn().usiQuit(e)}function Ln(e,t){cn().log(e,t)}function Dn(){const e=_o(),t=cn();t.onSendError((t=>{e.pushError(t)})),t.onMenuEvent((t=>{if(!e.isBussy)switch(t){case Ki.NEW_RECORD:e.newRecord();break;case Ki.OPEN_RECORD:e.openRecord();break;case Ki.SAVE_RECORD:e.saveRecord({overwrite:!0});break;case Ki.SAVE_RECORD_AS:e.saveRecord();break;case Ki.COPY_RECORD:e.copyRecordKIF();break;case Ki.COPY_RECORD_CSA:e.copyRecordCSA();break;case Ki.COPY_RECORD_USI_BEFORE:e.copyRecordUSIBefore();break;case Ki.COPY_RECORD_USI_ALL:e.copyRecordUSIAll();break;case Ki.COPY_BOARD_SFEN:e.copyBoardSFEN();break;case Ki.PASTE_RECORD:e.showPasteDialog();break;case Ki.INSERT_INTERRUPT:e.insertSpecialMove(ut.INTERRUPT);break;case Ki.INSERT_RESIGN:e.insertSpecialMove(ut.RESIGN);break;case Ki.INSERT_DRAW:e.insertSpecialMove(ut.DRAW);break;case Ki.INSERT_REPETITION_DRAW:e.insertSpecialMove(ut.REPETITION_DRAW);break;case Ki.INSERT_MATE:e.insertSpecialMove(ut.MATE);break;case Ki.INSERT_TIMEOUT:e.insertSpecialMove(ut.TIMEOUT);break;case Ki.INSERT_FOUL_WIN:e.insertSpecialMove(ut.FOUL_WIN);break;case Ki.INSERT_FOUL_LOSE:e.insertSpecialMove(ut.FOUL_LOSE);break;case Ki.INSERT_ENTERING_OF_KING:e.insertSpecialMove(ut.ENTERING_OF_KING);break;case Ki.INSERT_WIN_BY_DEFAULT:e.insertSpecialMove(ut.WIN_BY_DEFAULT);break;case Ki.INSERT_LOSS_BY_DEFAULT:e.insertSpecialMove(ut.LOSS_BY_DEFAULT);break;case Ki.REMOVE_RECORD_AFTER:e.removeRecordAfter();break;case Ki.START_POSITION_EDITING:e.startPositionEditing();break;case Ki.END_POSITION_EDITING:e.endPositionEditing();break;case Ki.CHANGE_TURN:e.changeTurn();break;case Ki.INIT_POSITION_STANDARD:e.initializePosition(ze.STANDARD);break;case Ki.INIT_POSITION_HANDICAP_LANCE:e.initializePosition(ze.HANDICAP_LANCE);break;case Ki.INIT_POSITION_HANDICAP_RIGHT_LANCE:e.initializePosition(ze.HANDICAP_RIGHT_LANCE);break;case Ki.INIT_POSITION_HANDICAP_BISHOP:e.initializePosition(ze.HANDICAP_BISHOP);break;case Ki.INIT_POSITION_HANDICAP_ROOK:e.initializePosition(ze.HANDICAP_ROOK);break;case Ki.INIT_POSITION_HANDICAP_ROOK_LANCE:e.initializePosition(ze.HANDICAP_ROOK_LANCE);break;case Ki.INIT_POSITION_HANDICAP_2PIECES:e.initializePosition(ze.HANDICAP_2PIECES);break;case Ki.INIT_POSITION_HANDICAP_4PIECES:e.initializePosition(ze.HANDICAP_4PIECES);break;case Ki.INIT_POSITION_HANDICAP_6PIECES:e.initializePosition(ze.HANDICAP_6PIECES);break;case Ki.INIT_POSITION_HANDICAP_8PIECES:e.initializePosition(ze.HANDICAP_8PIECES);break;case Ki.INIT_POSITION_TSUME_SHOGI:e.initializePosition(ze.TSUME_SHOGI);break;case Ki.INIT_POSITION_TSUME_SHOGI_2KINGS:e.initializePosition(ze.TSUME_SHOGI_2KINGS);break;case Ki.START_GAME:e.showGameDialog();break;case Ki.STOP_GAME:e.stopGame();break;case Ki.RESIGN:sn.resign();break;case Ki.START_RESEARCH:e.showResearchDialog();break;case Ki.STOP_RESEARCH:e.stopResearch();break;case Ki.START_ANALYSIS:e.showAnalysisDialog();break;case Ki.STOP_ANALYSIS:e.stopAnalysis();break;case Ki.FLIP_BOARD:e.flipBoard();break;case Ki.APP_SETTING_DIALOG:e.openAppSettingDialog();break;case Ki.USI_ENGINE_SETTING_DIALOG:e.openUsiEngineManagementDialog();break}})),t.onUSIBestMove(((e,t,i)=>{on(e,t,i)})),t.onUSIInfo(((t,i,n,o,a)=>{e.updateUSIInfo(t,i,n,o,JSON.parse(a))})),(0,o.YP)((()=>[e.appState,e.isBussy]),(([e,i])=>{t.updateMenuState(e,i)})),t.updateMenuState(e.appState,e.isBussy)}var Bn=i(4914),Gn=i.n(Bn);function xn(e){const t=e?.type||"sine",i=e?.frequency||440,n=e?.volume||2,o=new AudioContext,a=o.createOscillator(),s=o.createGain();return a.connect(s),s.connect(o.destination),a.type=t,a.frequency.value=i,s.gain.value=.005*n,a.onended=()=>{s.disconnect(o.destination),a.disconnect(s)},a.start(o.currentTime),e?.time&&a.stop(o.currentTime+e.time),{stop:()=>{e?.time||a.stop()}}}function Kn(e){xn({type:"sine",frequency:e.frequency,time:.1,volume:e.volume})}function Wn(e){return xn({type:"sine",frequency:e.frequency,volume:e.volume})}let Fn;function Un(e){const t=Date.now();if(Fn&&t<Fn+200)return;const i=new Audio("sound/piece.mp3");i.volume=.01*e,i.play(),Fn=t}var qn;function Vn(e){switch(e){case qn.BLACK_PLAYER:return"先手";case qn.WHITE_PLAYER:return"後手";case qn.RESEARCHER:return"検討"}}function Zn(e,t){const i=e.clone();let n,o="";for(const a of t){const e=i.createMoveBySFEN(a);if(!e)break;i.doMove(e,{ignoreValidation:!0}),o+=e.getDisplayText(n),n=e}return o}(function(e){e["BLACK_PLAYER"]="blackPlayer",e["WHITE_PLAYER"]="whitePlayer",e["RESEARCHER"]="researcher"})(qn||(qn={}));class zn{constructor(e,t){(0,ue.Z)(this,"sessionID",void 0),(0,ue.Z)(this,"name",void 0),(0,ue.Z)(this,"nodes",void 0),(0,ue.Z)(this,"nps",void 0),(0,ue.Z)(this,"iterates",void 0),(0,ue.Z)(this,"hashfull",void 0),(0,ue.Z)(this,"currentMove",void 0),(0,ue.Z)(this,"currentMoveText",void 0),this.sessionID=e,this.name=t,this.iterates=[]}update(e,t){const i={};if(void 0!==t.depth&&(i.depth=t.depth),void 0!==t.seldepth&&(i.selectiveDepth=t.seldepth),void 0!==t.timeMs&&(i.timeMs=t.timeMs),void 0!==t.nodes&&(this.nodes=t.nodes),t.pv&&(i.pv=t.pv,i.text=Zn(e,t.pv)),void 0!==t.multipv&&(i.multiPV=t.multipv),void 0!==t.scoreCP&&(i.score=t.scoreCP),void 0!==t.scoreMate&&(i.scoreMate=t.scoreMate),void 0!==t.lowerbound&&(i.lowerBound=t.lowerbound),void 0!==t.upperbound&&(i.upperBound=t.upperbound),void 0!==t.currmove){this.currentMove=t.currmove;const i=e.createMoveBySFEN(t.currmove);i&&(this.currentMoveText=i.getDisplayText())}void 0!==t.hashfullPerMill&&(this.hashfull=t.hashfullPerMill/1e3),void 0!==t.nps&&(this.nps=t.nps),t.string&&(i.text=t.string),0!==Object.keys(i).length&&this.iterates.unshift(i)}}class jn{constructor(){(0,ue.Z)(this,"_blackPlayer",void 0),(0,ue.Z)(this,"blackPosition",void 0),(0,ue.Z)(this,"_whitePlayer",void 0),(0,ue.Z)(this,"whitePosition",void 0),(0,ue.Z)(this,"_researcher",void 0),(0,ue.Z)(this,"researchPosition",void 0),(0,ue.Z)(this,"updateQueue",void 0),(0,ue.Z)(this,"timeoutHandle",void 0),this.updateQueue=[]}get blackPlayer(){return this._blackPlayer}get whitePlayer(){return this._whitePlayer}get researcher(){return this._researcher}update(e,t,i,n,o){this.updateQueue.push({sessionID:e,position:t,sender:i,name:n,info:o}),this.timeoutHandle||(this.timeoutHandle=setTimeout((()=>{this.dequeue()}),100))}dequeue(){for(const e of this.updateQueue)this._update(e);this.updateQueue=[],this.timeoutHandle=void 0}_update(e){switch(e.sender){case qn.BLACK_PLAYER:this._blackPlayer&&this._blackPlayer.sessionID===e.sessionID&&this.blackPosition===e.position.sfen||(this._blackPlayer=new zn(e.sessionID,e.name),this.blackPosition=e.position.sfen),this._blackPlayer.update(e.position,e.info),this._researcher=void 0;break;case qn.WHITE_PLAYER:this._whitePlayer&&this._whitePlayer.sessionID===e.sessionID&&this.whitePosition===e.position.sfen||(this._whitePlayer=new zn(e.sessionID,e.name),this.whitePosition=e.position.sfen),this._whitePlayer.update(e.position,e.info),this._researcher=void 0;break;case qn.RESEARCHER:this._researcher&&this._researcher.sessionID===e.sessionID&&this.researchPosition===e.position.sfen||(this._researcher=new zn(e.sessionID,e.name),this.researchPosition=e.position.sfen),this._researcher.update(e.position,e.info),this._blackPlayer=void 0,this._whitePlayer=void 0;break}}}const Yn=3e4;class $n{constructor(e){if((0,ue.Z)(this,"evaluation",void 0),e){const t=JSON.parse(e);this.evaluation=t.evaluation}}updateScore(e,t,i){switch(this.evaluation||(this.evaluation={}),t){case qn.BLACK_PLAYER:this.evaluation[qn.BLACK_PLAYER]=i;break;case qn.WHITE_PLAYER:this.evaluation[qn.WHITE_PLAYER]=-i;break;case qn.RESEARCHER:this.evaluation[qn.RESEARCHER]=e===le.BLACK?i:-i;break}}updateUSIInfo(e,t,i){void 0!==i.multipv&&1!==i.multipv||(i.scoreCP?this.updateScore(e,t,i.scoreCP):i.scoreMate&&this.updateScore(e,t,i.scoreMate>=0?Yn:-Yn))}stringify(){return JSON.stringify(this)}}var Jn,Xn,Qn;(function(e){e["WIN"]="win",e["LOSE"]="lose",e["DRAW"]="draw"})(Jn||(Jn={})),function(e){e["IDLE"]="idle",e["ACTIVE"]="active",e["PENDING"]="pending",e["BUSSY"]="bussy"}(Xn||(Xn={}));class eo{constructor(e){(0,ue.Z)(this,"state",void 0),(0,ue.Z)(this,"handlers",void 0),(0,ue.Z)(this,"blackState",void 0),(0,ue.Z)(this,"whiteState",void 0),(0,ue.Z)(this,"timerHandle",void 0),(0,ue.Z)(this,"timerStart",void 0),(0,ue.Z)(this,"lastTimeMs",void 0),(0,ue.Z)(this,"_elapsedMs",void 0),(0,ue.Z)(this,"_setting",void 0),(0,ue.Z)(this,"blackPlayer",void 0),(0,ue.Z)(this,"whitePlayer",void 0),(0,ue.Z)(this,"lastEventID",void 0),(0,ue.Z)(this,"record",void 0),this.state=Xn.IDLE,this.handlers=e,this.blackState={timeMs:0,byoyomi:0},this.whiteState={timeMs:0,byoyomi:0},this.timerHandle=0,this.timerStart=new Date,this.lastTimeMs=0,this._elapsedMs=0,this._setting=Ji(),this.lastEventID=0,this.record=new _t}get blackTimeMs(){return this.blackState.timeMs}get blackByoyomi(){return this.blackState.byoyomi}get whiteTimeMs(){return this.whiteState.timeMs}get whiteByoyomi(){return this.whiteState.byoyomi}get elapsedMs(){return this._elapsedMs}get setting(){return this._setting}async startGame(e,t){if(this.state!==Xn.IDLE)throw Error("前回の対局が正常に終了できていません。アプリを再起動してください。");this.blackState.timeMs=1e3*e.timeLimit.timeSeconds,this.blackState.byoyomi=e.timeLimit.byoyomi,this.whiteState.timeMs=1e3*e.timeLimit.timeSeconds,this.whiteState.byoyomi=e.timeLimit.byoyomi,this._setting=e,this.record=t;try{this.blackPlayer=await this.buildPlayer(e.black),this.whitePlayer=await this.buildPlayer(e.white)}catch(i){try{await this.closePlayers()}catch(n){this.handlers.onError(n)}throw i}this.state=Xn.ACTIVE,this.next()}next(){if(this.state!==Xn.ACTIVE)return void this.handlers.onError("予期せぬステータスです: GameManager.next(): "+this.state);const e=this.record.position.color;this.startTimer(e);const t=this.getPlayer(e);if(!t)return void this.handlers.onError("致命的なエラーが発生しました: GameManager.next(): player is undefined");const i=this.issueEventID();t.startSearch(this.record,this.setting,this.blackTimeMs,this.whiteTimeMs,{onMove:e=>this.onMove(i,e),onResign:()=>this.onResign(i),onWin:()=>this.onWin(i)}).catch((e=>{this.handlers.onError(new Error("プレイヤーにコマンドを送信できませんでした: "+e))}))}onMove(e,t){if(e!==this.lastEventID)return void Ln(qi.WARN,"指し手を受信しましたが既にイベントは無効です。");if(this.state!==Xn.ACTIVE)return void Ln(qi.WARN,"指し手を受信しましたが既に対局中ではありません。");if(!this.record.position.isValidMove(t))return this.handlers.onError("反則手: "+t.getDisplayText()),void this.endGame(ut.FOUL_LOSE);this.incrementTime(this.record.position.color),this.record=this.handlers.onMove(t);const i=this.record.perpetualCheck;if(i)return i===this.record.position.color?void this.endGame(ut.FOUL_LOSE):void this.endGame(ut.FOUL_WIN);this.record.repetition?this.endGame(ut.REPETITION_DRAW):this.next()}onResign(e){e===this.lastEventID?this.state===Xn.ACTIVE?this.endGame(ut.RESIGN):Ln(qi.WARN,"投了を受信しましたが既に対局中ではありません。"):Ln(qi.WARN,"投了を受信しましたが既にイベントは無効です。")}onWin(e){e===this.lastEventID?this.state===Xn.ACTIVE?this.endGame(ut.ENTERING_OF_KING):Ln(qi.WARN,"勝ち宣言を受信しましたが既に対局中ではありません。"):Ln(qi.WARN,"勝ち宣言を受信しましたが既にイベントは無効です。")}onTimeout(){this.state===Xn.ACTIVE?this.endGame(ut.TIMEOUT):this.handlers.onError("予期せぬステータスです: GameManager.onTimeout(): "+this.state)}startTimer(e){this.stopTimer();const t=this.getPlayerState(e);this.timerStart=new Date,this.lastTimeMs=t.timeMs,t.byoyomi=this.setting.timeLimit.byoyomi,this._elapsedMs=0,this.timerHandle=window.setInterval((()=>{const i=t.timeMs,n=t.byoyomi,o=new Date;this._elapsedMs=o.getTime()-this.timerStart.getTime();const a=this.lastTimeMs-this._elapsedMs;if(a>=0?t.timeMs=a:(t.timeMs=0,t.byoyomi=Math.max(Math.ceil(this.setting.timeLimit.byoyomi+a/1e3),0)),0===t.timeMs&&0===t.byoyomi)return void this.timeout(e);const s=Math.ceil(i/1e3),r=Math.ceil(t.timeMs/1e3),l=t.byoyomi;0===r&&(i>0||l!==n)?l<=5?this.handlers.onBeepUnlimited():(l<=10||l%10===0)&&this.handlers.onBeepShort():this.setting.timeLimit.byoyomi||r===s||(r<=5?this.handlers.onBeepUnlimited():(r<=10||20===r||30===r||60===r)&&this.handlers.onBeepShort())}),100)}timeout(e){this.stopTimer();const t=this.getPlayer(e);t&&t.isEngine()&&!this.setting.enableEngineTimeout?t.stop().catch((e=>{this.handlers.onError(new Error("プレイヤーにコマンドを送信できませんでした: "+e))})):this.onTimeout()}endGame(e){this.state!==Xn.ACTIVE&&this.state!==Xn.PENDING||(this.state=Xn.BUSSY,this.stopTimer(),this.endGameAsync(e).then((()=>{this.state=Xn.IDLE})).catch((e=>{this.handlers.onError(e),this.state=Xn.PENDING})))}async endGameAsync(e){if(e){const t=this.record.position.color;await this.sendGameResults(t,e)}await this.closePlayers(),this.handlers.onEndGame(e)}async sendGameResults(e,t){if(this.blackPlayer){const i=this.getGameResult(e,le.BLACK,t);i&&await this.blackPlayer.gameover(i)}if(this.whitePlayer){const i=this.getGameResult(e,le.WHITE,t);i&&await this.whitePlayer.gameover(i)}}getGameResult(e,t,i){switch(i){case ut.FOUL_WIN:case ut.ENTERING_OF_KING:return e==t?Jn.WIN:Jn.LOSE;case ut.RESIGN:case ut.MATE:case ut.TIMEOUT:case ut.FOUL_LOSE:return e==t?Jn.LOSE:Jn.WIN;case ut.DRAW:case ut.REPETITION_DRAW:return Jn.DRAW}return null}stopTimer(){this.handlers.onStopBeep(),this.timerHandle&&(window.clearInterval(this.timerHandle),this.timerHandle=0)}incrementTime(e){this.getPlayerState(e).timeMs+=1e3*this.setting.timeLimit.increment}async buildPlayer(e){if(e.uri===Hi)return sn;if(Mi(e.uri)&&e.usi){const t=new tn(e.usi);return await t.launch(),t}throw new Error("予期せぬプレイヤーURIです: "+e.uri)}async closePlayers(){this.blackPlayer&&(await this.blackPlayer.close(),this.blackPlayer=void 0),this.whitePlayer&&(await this.whitePlayer.close(),this.whitePlayer=void 0)}getPlayer(e){switch(e){case le.BLACK:return this.blackPlayer;case le.WHITE:return this.whitePlayer}}getPlayerState(e){switch(e){case le.BLACK:return this.blackState;case le.WHITE:return this.whiteState}}issueEventID(){return this.lastEventID+=1,this.lastEventID}}function to(e){let t=io(e);const i=e.getStandardMetadata(ct.TITLE)||e.getStandardMetadata(ct.TOURNAMENT)||e.getStandardMetadata(ct.OPUS_NAME)||e.getStandardMetadata(ct.OPUS_NO)||e.getStandardMetadata(ct.PLACE)||e.getStandardMetadata(ct.POSTED_ON)||e.getStandardMetadata(ct.AUTHOR);i&&(t+="_"+i);const n=e.getStandardMetadata(ct.BLACK_NAME)||e.getStandardMetadata(ct.BLACK_SHORT_NAME);n&&(t+="_"+n);const o=e.getStandardMetadata(ct.WHITE_NAME)||e.getStandardMetadata(ct.WHITE_SHORT_NAME);return o&&(t+="_"+o),t+".kif"}function io(e){const t=e.getStandardMetadata(ct.DATE);return t?t.trim().replaceAll(" ","_").replaceAll("/","").replaceAll(":",""):(new Date).toLocaleDateString(void 0,{year:"numeric",month:"2-digit",day:"2-digit"}).replaceAll("/","")}class no{constructor(){(0,ue.Z)(this,"count",void 0),this.count=0}get isBussy(){return 0!==this.count}retain(){this.count+=1}release(){this.count-=1}}(function(e){e["NORMAL"]="normal",e["PASTE_DIALOG"]="pasteDialog",e["POSITION_EDITING"]="positionEditing",e["GAME"]="game",e["GAME_DIALOG"]="gameDialog",e["RESEARCH"]="research",e["RESEARCH_DIALOG"]="researchDialog",e["ANALYSIS"]="analysis",e["ANALYSIS_DIALOG"]="analysisDialog",e["USI_ENGINE_SETTING_DIALOG"]="usiEngineSettingDialog",e["TEMPORARY"]="temporary"})(Qn||(Qn={}));class oo{constructor(){(0,ue.Z)(this,"_queue",void 0),this._queue=[]}get message(){return this._queue[0]}get hasMessage(){return 0!==this._queue.length}enqueue(e){this._queue.push(e)}dequeue(){this._queue.shift()}}class ao{constructor(){(0,ue.Z)(this,"_queue",void 0),this._queue=[]}get errors(){return this._queue}get hasError(){return 0!==this._queue.length}push(e){e instanceof Error?this._queue.push(e):this._queue.push(new Error(""+e))}clear(){this._queue=[]}}function so(e){return(e||new Date).toLocaleDateString(void 0,{year:"numeric",month:"2-digit",day:"2-digit"})}function ro(e){return(e||new Date).toLocaleTimeString(void 0,{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1})}function lo(e){return e>=1500?"先手勝勢":e>=600?"先手優勢":e>=400?"先手有利":e>=200?"先手有望":e>=-200?"互角":e>=-400?"後手有望":e>=-600?"後手有利":e>=-1500?"後手優勢":"後手勝勢"}function co(e,t){return 100/(1+Math.exp(-e/t.coefficientInSigmoid))}function uo(e,t,i){const n=co(e,i)-co(t,i);return n>=i.badMoveLevelThreshold4?"大悪手":n>=i.badMoveLevelThreshold3?"悪手":n>=i.badMoveLevelThreshold2?"疑問手":n>=i.badMoveLevelThreshold1?"緩手":null}class ho{constructor(e,t){if((0,ue.Z)(this,"handler",void 0),(0,ue.Z)(this,"researcher",void 0),(0,ue.Z)(this,"_setting",void 0),(0,ue.Z)(this,"number",void 0),(0,ue.Z)(this,"actualMove",void 0),(0,ue.Z)(this,"color",void 0),(0,ue.Z)(this,"lastScore",void 0),(0,ue.Z)(this,"score",void 0),(0,ue.Z)(this,"mate",void 0),(0,ue.Z)(this,"lastPV",void 0),(0,ue.Z)(this,"pv",void 0),(0,ue.Z)(this,"timerHandle",void 0),!e.usi)throw new Error("エンジンが設定されていません。");this._setting=e,this.handler=t,this.color=le.BLACK}get setting(){return this._setting}async start(){await this.setupEngine(this.setting.usi),setTimeout((()=>this.next()))}async setupEngine(e){await this.closeEngine();const t=new tn(e);await t.launch(),this.researcher=t}finish(){this.handler.onFinish(),this.close()}close(){this.clearTimer(),this.closeEngine().catch((e=>{this.handler.onError(e)}))}next(){if(this.clearTimer(),this.onResult(),this.actualMove=void 0,this.lastScore=this.score,this.score=void 0,this.mate=void 0,this.lastPV=this.pv,this.pv=void 0,this.number=void 0!==this.number?this.number+1:this.setting.startCriteria.enableNumber?this.setting.startCriteria.number-1:0,this.setting.endCriteria.enableNumber&&this.number>=this.setting.endCriteria.number)return void this.finish();const e=this.handler.onNext(this.number);e&&(e.current.next||e.current.move instanceof Ve)?(this.actualMove=e.current.move instanceof Ve?e.current.move:void 0,this.color=he(e.position.color),this.timerHandle=setTimeout((()=>this.next()),1e3*this.setting.perMoveCriteria.maxSeconds),this.goAsync(e).catch((e=>{this.handler.onError(e)}))):this.finish()}clearTimer(){this.timerHandle&&(clearTimeout(this.timerHandle),this.timerHandle=void 0)}onResult(){void 0!==this.number&&this.handler.onResult({number:this.number,score:this.score,negaScore:this.score?this.color===le.BLACK?this.score:-this.score:void 0,scoreDelta:void 0!==this.score&&void 0!==this.lastScore?this.color===le.BLACK?this.score-this.lastScore:-(this.score-this.lastScore):void 0,mate:this.mate,pv:this.pv,isBestMove:this.actualMove&&this.lastPV?this.actualMove.equals(this.lastPV[0]):void 0})}async goAsync(e){this.researcher&&await this.researcher.startResearch(e)}async closeEngine(){this.researcher&&(this.researcher.close(),this.researcher=void 0)}updateUSIInfo(e,t){if(void 0===t.multipv||1===t.multipv)if(void 0!==t.scoreCP&&(this.score=e.color===le.BLACK?t.scoreCP:-t.scoreCP),t.scoreMate&&(this.mate=Math.abs(t.scoreMate)),t.pv&&0!==t.pv.length){this.pv=[];const i=e.clone();for(const e of t.pv){const t=i.createMoveBySFEN(e);if(!t||!i.doMove(t))break;this.pv.push(t)}}else if(t.currmove){const i=e.createMoveBySFEN(t.currmove);i&&(this.pv=[i])}}}function po(e,t){let i="";if(e.mate&&(i+=`${e.mate}手詰\n`),void 0!==e.scoreDelta&&void 0!==e.negaScore&&!e.isBestMove){const n=uo(e.negaScore-e.scoreDelta,e.negaScore,t);n&&(i+=`【${n}】\n`)}if(void 0!==e.score&&(i+=`#評価値=${e.score}\n`,i+=lo(e.score)+"\n"),e.pv&&0!==e.pv.length){for(const t of e.pv)i+=`${t.getDisplayText()}`;i+="\n"}return i}class mo{constructor(){(0,ue.Z)(this,"_bussy",void 0),(0,ue.Z)(this,"_message",void 0),(0,ue.Z)(this,"_error",void 0),(0,ue.Z)(this,"_appSetting",void 0),(0,ue.Z)(this,"_appState",void 0),(0,ue.Z)(this,"lastAppState",void 0),(0,ue.Z)(this,"_displayAppSetting",void 0),(0,ue.Z)(this,"_confirmation",void 0),(0,ue.Z)(this,"_usi",void 0),(0,ue.Z)(this,"game",void 0),(0,ue.Z)(this,"researcher",void 0),(0,ue.Z)(this,"analysis",void 0),(0,ue.Z)(this,"unlimitedBeepHandler",void 0),(0,ue.Z)(this,"_recordFilePath",void 0),(0,ue.Z)(this,"_record",void 0),this._bussy=new no,this._message=new oo,this._error=new ao,this._appSetting=ji(),this._appState=Qn.NORMAL,this._displayAppSetting=!1,this._usi=new jn,this.game=new eo(this),this._record=new _t}get isBussy(){return this._bussy.isBussy}retainBussyState(){return this._bussy.retain()}releaseBussyState(){return this._bussy.release()}get message(){return this._message.message}get hasMessage(){return this._message.hasMessage}enqueueMessage(e){this._message.enqueue(e)}dequeueMessage(){this._message.dequeue()}get errors(){return this._error.errors}get hasError(){return this._error.hasError}pushError(e){Ln(qi.ERROR,St(e)),this._error.push(e)}clearErrors(){this._error.clear()}get appSetting(){return this._appSetting}async updateAppSetting(e){const t={...this.appSetting,...e},i=Yi(t);if(i)throw i;await vn(t),this._appSetting=t}flipBoard(){this._appSetting.boardFlipping=!this.appSetting.boardFlipping,vn(this.appSetting)}get appState(){return this._appState}get confirmation(){return this._confirmation?.message}showConfirmation(e){this._confirmation=e,this.lastAppState=this.appState,this._appState=Qn.TEMPORARY}confirmationOk(){const e=this._confirmation?.onOk;this._confirmation=void 0,this.lastAppState&&(this._appState=this.lastAppState,this.lastAppState=void 0),e&&e()}confirmationCancel(){const e=this._confirmation?.onCancel;this._confirmation=void 0,this.lastAppState&&(this._appState=this.lastAppState,this.lastAppState=void 0),e&&e()}showPasteDialog(){this.appState===Qn.NORMAL&&(this._appState=Qn.PASTE_DIALOG)}closePasteDialog(){this.appState===Qn.PASTE_DIALOG&&(this._appState=Qn.NORMAL)}showGameDialog(){this.appState===Qn.NORMAL&&(this._appState=Qn.GAME_DIALOG)}showResearchDialog(){this.appState===Qn.NORMAL&&(this._appState=Qn.RESEARCH_DIALOG)}showAnalysisDialog(){this.appState===Qn.NORMAL&&(this._appState=Qn.ANALYSIS_DIALOG)}get displayAppSetting(){return this._displayAppSetting}openAppSettingDialog(){this._displayAppSetting=!0}closeAppSettingDialog(){this._displayAppSetting=!1}openUsiEngineManagementDialog(){this.appState===Qn.NORMAL&&(this._appState=Qn.USI_ENGINE_SETTING_DIALOG)}closeDialog(){this.appState!==Qn.USI_ENGINE_SETTING_DIALOG&&this.appState!==Qn.GAME_DIALOG&&this.appState!==Qn.RESEARCH_DIALOG&&this.appState!==Qn.ANALYSIS_DIALOG||(this._appState=Qn.NORMAL)}get usiBlackPlayerMonitor(){return this._usi.blackPlayer}get usiWhitePlayerMonitor(){return this._usi.whitePlayer}get usiResearcherMonitor(){return this._usi.researcher}updateUSIInfo(e,t,i,n,o){if(this.record.usi!=t)return;this._usi.update(e,this.record.position,i,n,o);const a=new $n(this.record.current.customData);a.updateUSIInfo(this.record.position.color,i,o),this.record.current.customData=a.stringify(),this.analysis&&this.analysis.updateUSIInfo(this.record.position,o)}get gameSetting(){return this.game.setting}get blackTimeMs(){return this.game.blackTimeMs}get blackByoyomi(){return this.game.blackByoyomi}get whiteTimeMs(){return this.game.whiteTimeMs}get whiteByoyomi(){return this.game.whiteByoyomi}get elapsedMs(){return this.game.elapsedMs}startGame(e){this.startGameAsync(e).catch((e=>{this.pushError("対局の初期化中にエラーが出ました: "+e)}))}async startGameAsync(e){if(this.appState===Qn.GAME_DIALOG){this.retainBussyState();try{await Tn(e),this.initializeRecordForGame(e),this.initializeDisplaySettingForGame(e),await this.game.startGame(e,this.record),this._appState=Qn.GAME}finally{this.releaseBussyState()}}}initializeRecordForGame(e){if(e.startPosition){const t=new it;t.reset(e.startPosition),this._record.clear(t),this.onUpdatePosition(),this.clearRecordFilePath()}this._record.metadata.setStandardMetadata(ct.BLACK_NAME,e.black.name),this._record.metadata.setStandardMetadata(ct.WHITE_NAME,e.white.name),this._record.metadata.setStandardMetadata(ct.DATE,so()),this._record.metadata.setStandardMetadata(ct.START_DATETIME,ro()),this._record.metadata.setStandardMetadata(ct.TIME_LIMIT,$i(e.timeLimit))}initializeDisplaySettingForGame(e){if(e.humanIsFront){let t=this.appSetting.boardFlipping;e.black.uri===Hi&&e.white.uri!==Hi?t=!1:e.black.uri!==Hi&&e.white.uri===Hi&&(t=!0),t!==this.appSetting.boardFlipping&&this.flipBoard()}}stopGame(){this.appState===Qn.GAME&&this.game.endGame(ut.INTERRUPT)}onMove(e){return this.appState===Qn.GAME&&(this._record.append(e,{ignoreValidation:!0}),this.onUpdatePosition(),this.record.current.setElapsedMs(this.elapsedMs),Un(this.appSetting.pieceVolume)),this.record}onEndGame(e){this.appState===Qn.GAME&&(e&&this.enqueueMessage(`対局終了（${mt(e)})`),this._record.append(e||ut.INTERRUPT),this.onUpdatePosition(),this._record.current.setElapsedMs(this.elapsedMs),this._record.metadata.setStandardMetadata(ct.END_DATETIME,ro()),this._appState=Qn.NORMAL)}onBeepShort(){(this.appSetting.clockSoundTarget!==Ui.ONLY_USER||this.isMovableByUser)&&(this.unlimitedBeepHandler||Kn({frequency:this.appSetting.clockPitch,volume:this.appSetting.clockVolume}))}onBeepUnlimited(){(this.appSetting.clockSoundTarget!==Ui.ONLY_USER||this.isMovableByUser)&&(this.unlimitedBeepHandler||(this.unlimitedBeepHandler=Wn({frequency:this.appSetting.clockPitch,volume:this.appSetting.clockVolume})))}onStopBeep(){this.unlimitedBeepHandler&&(this.unlimitedBeepHandler.stop(),this.unlimitedBeepHandler=void 0)}doMove(e){this.appState!==Qn.NORMAL&&this.appState!==Qn.RESEARCH||(this._record.append(e),this.onUpdatePosition(),Un(this.appSetting.pieceVolume))}onNext(e){return this.appState===Qn.ANALYSIS?(this._record.goto(e),this.record.current.number===e?this.record:null):null}onResult(e){if(this.appState===Qn.ANALYSIS&&this.analysis){const t=po(e,this.appSetting);t&&(this._record.current.comment=zi(this._record.current.comment,t,this.analysis.setting.commentBehavior))}}onFinish(){this.appState===Qn.ANALYSIS&&(this._message.enqueue("棋譜解析が終了しました。"),this._appState=Qn.NORMAL)}onError(e){this.pushError(e)}startResearch(e){this.startResearchAsync(e).then((()=>{this.onUpdatePosition()})).catch((e=>{this.pushError("検討の初期化中にエラーが出ました: "+e)}))}async startResearchAsync(e){if(this.appState===Qn.RESEARCH_DIALOG){this.retainBussyState();try{if(await En(e),!e.usi)throw new Error("エンジンが設定されていません。");const t=new tn(e.usi);await t.launch(),this.researcher=t,this._appState=Qn.RESEARCH}finally{this.releaseBussyState()}}}stopResearch(){this.appState===Qn.RESEARCH&&(this.researcher&&(this.researcher.close(),this.researcher=void 0),this._appState=Qn.NORMAL)}startAnalysis(e){this.startAnalysisAsync(e).catch((e=>{this.pushError("検討の初期化中にエラーが出ました: "+e)}))}async startAnalysisAsync(e){if(this.appState===Qn.ANALYSIS_DIALOG){this.retainBussyState();try{await wn(e);const t=new ho(e,this);await t.start(),this.analysis=t,this._appState=Qn.ANALYSIS}finally{this.releaseBussyState()}}}stopAnalysis(){this.appState===Qn.ANALYSIS&&(this.analysis&&(this.analysis.close(),this.analysis=void 0),this._appState=Qn.NORMAL)}onUpdatePosition(){this.researcher&&this.researcher.startResearch(this.record)}get recordFilePath(){return this._recordFilePath}updateRecordFilePath(e){this._recordFilePath=e}clearRecordFilePath(){this._recordFilePath=void 0}get record(){return this._record}newRecord(){this.appState==Qn.NORMAL&&(this._record.clear(),this.onUpdatePosition(),this.clearRecordFilePath())}updateRecordComment(e){this.record.current.comment=e}updateStandardRecordMetadata(e){this._record.metadata.setStandardMetadata(e.key,e.value)}insertSpecialMove(e){this.appState!==Qn.NORMAL&&this.appState!==Qn.RESEARCH||(this._record.append(e),this.onUpdatePosition())}startPositionEditing(){this.appState===Qn.NORMAL&&this.showConfirmation({message:"現在の棋譜は削除されます。よろしいですか？",onOk:()=>{this._appState=Qn.POSITION_EDITING,this._record.clear(this.record.position),this.onUpdatePosition(),this.clearRecordFilePath()}})}endPositionEditing(){this.appState===Qn.POSITION_EDITING&&(this._appState=Qn.NORMAL)}initializePosition(e){this.appState==Qn.POSITION_EDITING&&this.showConfirmation({message:"現在の局面は破棄されます。よろしいですか？",onOk:()=>{const t=new it;t.reset(e),this._record.clear(t),this.onUpdatePosition(),this.clearRecordFilePath()}})}changeTurn(){if(this.appState!=Qn.POSITION_EDITING)return;const e=this.record.position.clone();e.setColor(he(e.color)),this._record.clear(e),this.onUpdatePosition(),this.clearRecordFilePath()}editPosition(e){if(this.appState===Qn.POSITION_EDITING){const t=this.record.position.clone();t.edit(e),this._record.clear(t),this.onUpdatePosition(),this.clearRecordFilePath()}}changeMoveNumber(e){this.appState!==Qn.NORMAL&&this.appState!==Qn.RESEARCH||(this._record.goto(e),this.onUpdatePosition())}changeBranch(e){this.appState!==Qn.NORMAL&&this.appState!==Qn.RESEARCH||this.record.current.branchIndex!==e&&(this._record.switchBranchByIndex(e),this.onUpdatePosition())}removeRecordAfter(){if(this.appState!==Qn.NORMAL&&this.appState!==Qn.RESEARCH)return;const e=this.record.current.next;if(!e||!(e.move instanceof Ve))return this._record.removeAfter(),void this.onUpdatePosition();this.showConfirmation({message:`${this.record.current.number}手目以降を削除します。よろしいですか？`,onOk:()=>{this._record.removeAfter(),this.onUpdatePosition()}})}copyRecordKIF(){const e=Yt(this._record,{returnCode:this.appSetting.returnCode});navigator.clipboard.writeText(e)}copyRecordCSA(){const e=gi(this._record,{returnCode:this.appSetting.returnCode});navigator.clipboard.writeText(e)}copyRecordUSIBefore(){const e=this._record.usi;navigator.clipboard.writeText(e)}copyRecordUSIAll(){const e=this._record.usiAll;navigator.clipboard.writeText(e)}copyBoardSFEN(){const e=this._record.sfen;navigator.clipboard.writeText(e)}pasteRecord(e){if(this.appState!==Qn.NORMAL)return;let t;switch(vi(e)){case _i.SFEN:{const i=it.newBySFEN(e);t=i?new _t(i):new Error("局面を読み込めませんでした。");break}case _i.USI:t=_t.newByUSI(e)||new Error("棋譜を読み込めませんでした。");break;case _i.KIF:t=Gt(e);break;case _i.CSA:t=ri(e);break;default:t=new Error("棋譜フォーマットの検出ができませんでした。");break}t instanceof Error?this.pushError(t):(this.clearRecordFilePath(),this._record=t,this.onUpdatePosition())}openRecord(e){this.openRecordAsync(e).catch((e=>{this.pushError("棋譜の読み込み中にエラーが出ました: "+e)}))}async openRecordAsync(e){if(this.appState===Qn.NORMAL){this.retainBussyState();try{if(!e&&(e=await hn(),!e))return;const t=await dn(e);let i;if(e.match(/\.kif$/)||e.match(/\.kifu$/)){const n=e.match(/\.kif$/)?Gn().decode(t,"Shift_JIS"):(new TextDecoder).decode(t);i=Gt(n)}else i=e.match(/\.csa$/)?ri((new TextDecoder).decode(t)):new Error("不明なファイル形式: "+e);if(i instanceof Error)throw i;this.updateRecordFilePath(e),this._record=i,this.onUpdatePosition()}finally{this.releaseBussyState()}}}saveRecord(e){this.saveRecordAsync(e).catch((e=>{this.pushError("棋譜の保存中にエラーが出ました: "+e)}))}async saveRecordAsync(e){if(this.appState===Qn.NORMAL){this.retainBussyState();try{let t,i=this.recordFilePath;if(!e?.overwrite||!i){const e=to(this._record.metadata);if(i=await pn(e),!i)return}if(i.match(/\.kif$/)||i.match(/\.kifu$/)){const e=Yt(this.record,{returnCode:this.appSetting.returnCode});t=i.match(/\.kif$/)?Gn().encode(e,"Shift_JIS"):(new TextEncoder).encode(e)}else{if(!i.match(/\.csa$/))throw new Error("不明なファイル形式: "+i);t=(new TextEncoder).encode(gi(this.record,{returnCode:this.appSetting.returnCode}))}await mn(i,t),this.updateRecordFilePath(i)}finally{this.releaseBussyState()}}}get isMovableByUser(){switch(this.appState){case Qn.NORMAL:case Qn.RESEARCH:return!0;case Qn.GAME:return(this.record.position.color===le.BLACK?this.gameSetting.black.uri:this.gameSetting.white.uri)===Hi}return!1}}const go=(0,c.qj)(new mo);function _o(){return go}const vo=["src"];function So(e,t,i,n,a,s){return(0,o.wg)(),(0,o.iD)("img",{class:"icon",src:e.source},null,8,vo)}var Eo;(function(e){e["BUSSY"]="bussy",e["ERROR"]="error",e["INFO"]="info",e["GAME"]="game",e["STOP"]="stop",e["RESIGN"]="resign",e["RESEARCH"]="research",e["END"]="end",e["EDIT"]="edit",e["CHECK"]="check",e["SWAP"]="swap",e["SWAP_H"]="swap_h",e["SETTINGS"]="settings",e["ENGINE_SETTINGS"]="engineSettings",e["FLIP"]="flip",e["PASTE"]="paste",e["COPY"]="copy",e["DELETE"]="delete",e["COMMENT"]="comment",e["BRAIN"]="brain",e["CHART"]="chart",e["PERCENT"]="percent",e["ARROW_DROP"]="arrowDrop",e["FIRST"]="first",e["BACK"]="back",e["NEXT"]="next",e["LAST"]="last",e["QUESTION"]="question",e["ANALYSIS"]="analysis",e["DESCRIPTION"]="description"})(Eo||(Eo={}));const fo={[Eo.BUSSY]:"icon/hourglass_empty_white_24dp.svg",[Eo.ERROR]:"icon/error_outline_white_24dp.svg",[Eo.INFO]:"icon/info_white_24dp.svg",[Eo.GAME]:"icon/sports_esports_white_24dp.svg",[Eo.STOP]:"icon/block_white_24dp.svg",[Eo.RESIGN]:"icon/flag_white_24dp.svg",[Eo.RESEARCH]:"icon/science_white_24dp.svg",[Eo.END]:"icon/do_disturb_on_white_24dp.svg",[Eo.EDIT]:"icon/app_registration_white_24dp.svg",[Eo.CHECK]:"icon/check_circle_white_24dp.svg",[Eo.SWAP]:"icon/swap_vert_white_24dp.svg",[Eo.SWAP_H]:"icon/swap_horiz_white_24dp.svg",[Eo.SETTINGS]:"icon/settings_white_24dp.svg",[Eo.ENGINE_SETTINGS]:"icon/settings_input_component_white_24dp.svg",[Eo.FLIP]:"icon/flip_camera_android_white_24dp.svg",[Eo.PASTE]:"icon/content_paste_white_24dp.svg",[Eo.COPY]:"icon/content_copy_white_24dp.svg",[Eo.DELETE]:"icon/backspace_white_24dp.svg",[Eo.COMMENT]:"icon/edit_note_white_24dp.svg",[Eo.BRAIN]:"icon/psychology_white_24dp.svg",[Eo.CHART]:"icon/show_chart_white_24dp.svg",[Eo.PERCENT]:"icon/percent_white_24dp.svg",[Eo.ARROW_DROP]:"icon/arrow_drop_down_white_24dp.svg",[Eo.FIRST]:"icon/first_page_white_24dp.svg",[Eo.BACK]:"icon/chevron_left_white_24dp.svg",[Eo.NEXT]:"icon/chevron_right_white_24dp.svg",[Eo.LAST]:"icon/last_page_white_24dp.svg",[Eo.QUESTION]:"icon/help_white_24dp.svg",[Eo.ANALYSIS]:"icon/query_stats_white_24dp.svg",[Eo.DESCRIPTION]:"icon/description_white_24dp.svg"};Object.values(fo).forEach((e=>{Ei(e)}));var wo=(0,o.aZ)({name:"ButtonIcon",props:{icon:{type:String,required:!0}},setup(e){return{source:fo[e.icon]}}});const Io=(0,Oi.Z)(wo,[["render",So]]);var To=Io,yo=(0,o.aZ)({name:"BoardPane",components:{BoardView:ki,ButtonIcon:To},props:{maxSize:{type:Ai,required:!0}},setup(){const e=_o(),t=t=>{e.appState===Qn.GAME?sn.doMove(t):e.doMove(t)},i=t=>{e.editPosition(t)},n=()=>{e.showGameDialog()},a=()=>{e.stopGame()},s=()=>{sn.resign()},r=()=>{e.showResearchDialog()},l=()=>{e.stopResearch()},c=()=>{e.showAnalysisDialog()},u=()=>{e.stopAnalysis()},h=()=>{e.startPositionEditing()},d=()=>{e.endPositionEditing()},p=t=>{const i=t.target;i.value&&e.initializePosition(i.value)},m=()=>{e.changeTurn()},g=()=>{e.openAppSettingDialog()},_=()=>{e.openUsiEngineManagementDialog()},v=()=>{_o().flipBoard()},S=()=>{e.showPasteDialog()},E=()=>{e.copyRecordKIF()},f=()=>{e.removeRecordAfter()},w=(0,o.Fl)((()=>e.appState===Qn.POSITION_EDITING)),I=(0,o.Fl)((()=>e.isMovableByUser)),T=(0,o.Fl)((()=>e.record.position)),y=(0,o.Fl)((()=>{const t=e.record.current.move;return t instanceof Ve?t:void 0})),b=(0,o.Fl)((()=>e.appSetting.pieceImage)),N=(0,o.Fl)((()=>e.appSetting.boardImage)),A=(0,o.Fl)((()=>e.appSetting.boardFlipping)),R=(0,o.Fl)((()=>e.record.metadata.getStandardMetadata(ct.BLACK_NAME))),O=(0,o.Fl)((()=>e.record.metadata.getStandardMetadata(ct.WHITE_NAME))),P=(0,o.Fl)((()=>e.appState===Qn.GAME?e.blackTimeMs:void 0)),k=(0,o.Fl)((()=>e.appState===Qn.GAME?e.blackByoyomi:void 0)),H=(0,o.Fl)((()=>e.appState===Qn.GAME?e.whiteTimeMs:void 0)),C=(0,o.Fl)((()=>e.appState===Qn.GAME?e.whiteByoyomi:void 0)),M=(0,o.Fl)((()=>({game:e.appState===Qn.NORMAL,stop:e.appState===Qn.GAME,resign:e.appState===Qn.GAME&&e.isMovableByUser,research:e.appState===Qn.NORMAL,endResearch:e.appState===Qn.RESEARCH,analysis:e.appState===Qn.NORMAL,endAnalysis:e.appState===Qn.ANALYSIS,startEditPosition:e.appState===Qn.NORMAL,endEditPosition:e.appState===Qn.POSITION_EDITING,initPosition:e.appState===Qn.POSITION_EDITING,removeAfter:e.appState===Qn.NORMAL||e.appState===Qn.RESEARCH,paste:e.appState===Qn.NORMAL,engineSettings:e.appState===Qn.NORMAL})));return{pieceImageType:b,boardImageType:N,position:T,lastMove:y,flip:A,blackPlayerName:R,whitePlayerName:O,blackPlayerTimeMs:P,blackPlayerByoyomi:k,whitePlayerTimeMs:H,whitePlayerByoyomi:C,controlStates:M,onMove:t,onEdit:i,onGame:n,onStop:a,onResign:s,onResearch:r,onEndResearch:l,onAnalysis:c,onEndAnalysis:u,onStartEditPosition:h,onEndEditPosition:d,onInitPosition:p,onChangeTurn:m,onOpenAppSettings:g,onOpenEngineSettings:_,onFlip:v,onPaste:S,onCopy:E,onRemoveAfter:f,allowEdit:w,allowMove:I,Icon:Eo}}});const bo=(0,Oi.Z)(yo,[["render",Z],["__scopeId","data-v-7b65bbae"]]);var No=bo;const Ao=e=>((0,o.dD)("data-v-605e0211"),e=e(),(0,o.Cn)(),e),Ro={class:"frame"},Oo={class:"options"},Po={class:"option"},ko=["checked"],Ho=Ao((()=>(0,o._)("label",{for:"show-elapsed-time"},"消費時間",-1))),Co={class:"option"},Mo=["checked"],Lo=Ao((()=>(0,o._)("label",{for:"show-comment"},"コメント",-1)));function Do(e,t,i,n,a,s){const r=(0,o.up)("RecordView");return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("div",Ro,[(0,o.Wm)(r,{class:"record",record:e.record,operational:e.isRecordOperational,"show-comment":e.showComment,"show-elapsed-time":e.showElapsedTime,onGoBegin:e.goBegin,onGoBack:e.goBack,onGoForward:e.goForward,onGoEnd:e.goEnd,onSelectMove:e.selectMove,onSelectBranch:e.selectBranch},null,8,["record","operational","show-comment","show-elapsed-time","onGoBegin","onGoBack","onGoForward","onGoEnd","onSelectMove","onSelectBranch"]),(0,o._)("div",Oo,[(0,o._)("div",Po,[(0,o._)("input",{id:"show-elapsed-time",type:"checkbox",checked:e.showElapsedTime,onChange:t[0]||(t[0]=(...t)=>e.onToggleElapsedTime&&e.onToggleElapsedTime(...t))},null,40,ko),Ho]),(0,o._)("div",Co,[(0,o._)("input",{id:"show-comment",type:"checkbox",checked:e.showComment,onChange:t[1]||(t[1]=(...t)=>e.onToggleComment&&e.onToggleComment(...t))},null,40,Mo),Lo])])])])}const Bo={class:"frame"},Go={class:"controller"},xo=["disabled"],Ko=["disabled"],Wo=["disabled"],Fo=["disabled"],Uo=["disabled"],qo=["selected","value"],Vo=["disabled"],Zo=["selected","value"];function zo(e,t,i,n,a,s){const r=(0,o.up)("ButtonIcon");return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("div",Bo,[(0,o._)("div",Go,[(0,o._)("button",{class:"control-button",disabled:!e.operational,onClick:t[0]||(t[0]=t=>e.goBegin())},[(0,o.Wm)(r,{class:"icon",icon:e.Icon.FIRST},null,8,["icon"])],8,xo),(0,o._)("button",{class:"control-button",disabled:!e.operational,onClick:t[1]||(t[1]=t=>e.goBack())},[(0,o.Wm)(r,{class:"icon",icon:e.Icon.BACK},null,8,["icon"])],8,Ko),(0,o._)("button",{class:"control-button",disabled:!e.operational,onClick:t[2]||(t[2]=t=>e.goForward())},[(0,o.Wm)(r,{class:"icon",icon:e.Icon.NEXT},null,8,["icon"])],8,Wo),(0,o._)("button",{class:"control-button",disabled:!e.operational,onClick:t[3]||(t[3]=t=>e.goEnd())},[(0,o.Wm)(r,{class:"icon",icon:e.Icon.LAST},null,8,["icon"])],8,Fo)]),(0,o._)("select",{ref:"moveList",class:"move-list",size:"2",disabled:!e.operational,onChange:t[4]||(t[4]=t=>e.changeNumber())},[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.moves,(t=>((0,o.wg)(),(0,o.iD)("option",{key:t.number,class:(0,z.C_)({"has-branch":t.hasBranch,selected:t.selected}),selected:t.selected,value:t.number},(0,z.zw)(0!==t.number?t.number:"")+" "+(0,z.zw)(0!==t.number?" ":"")+" "+(0,z.zw)(t.text)+" "+(0,z.zw)(e.showComment&&t.comment?"-- "+t.comment:""),11,qo)))),128))],40,Uo),(0,o._)("select",{ref:"branchList",class:"branch-list",size:"2",disabled:!e.operational,onChange:t[5]||(t[5]=t=>e.changeBranch())},[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.branches,(t=>((0,o.wg)(),(0,o.iD)("option",{key:t.index,selected:t.selected,value:t.index},(0,z.zw)(t.text)+" "+(0,z.zw)(e.showComment&&t.comment?"-- "+t.comment:""),9,Zo)))),128))],40,Vo)])])}var jo=(0,o.aZ)({name:"RecordView",components:{ButtonIcon:To},props:{record:{type:Object,required:!0},operational:{type:Boolean,required:!1},showElapsedTime:{type:Boolean,required:!1},showComment:{type:Boolean,required:!1}},emits:["goBegin","goBack","goForward","goEnd","selectMove","selectBranch"],setup(e,t){const i=(0,c.iH)(null),n=(0,c.iH)(null),a=()=>{t.emit("goBegin")},s=()=>{t.emit("goBack")},r=()=>{t.emit("goForward")},l=()=>{t.emit("goEnd")},u=()=>{t.emit("selectMove",Number(i.value.value))},h=()=>{t.emit("selectBranch",Number(n.value.value))},d=(0,o.Fl)((()=>0===e.record.current.number)),p=(0,o.Fl)((()=>{const t=[];return e.record.moves.forEach((i=>{t.push({number:i.number,text:e.showElapsedTime?i.displayText:i.displayMoveText,hasBranch:i.hasBranch,comment:i.comment,selected:i===e.record.current})})),t})),m=(0,o.Fl)((()=>{if(!e.record.branchBegin.branch)return null;const t=[];let i;for(i=e.record.branchBegin;i&&i.move;i=i.branch)t.push({index:t.length,text:i.displayMoveText,comment:i.comment,selected:i.activeBranch});return t}));return{beginPosSelected:d,moves:p,branches:m,moveList:i,branchList:n,goBegin:a,goBack:s,goForward:r,goEnd:l,changeNumber:u,changeBranch:h,Icon:Eo}}});const Yo=(0,Oi.Z)(jo,[["render",zo],["__scopeId","data-v-124bbb9b"]]);var $o=Yo;const Jo=230;var Xo=(0,o.aZ)({name:"RecordPane",components:{RecordView:$o},setup(){const e=_o(),t=t=>{e.changeMoveNumber(t)},i=()=>{t(0)},n=()=>{t(e.record.current.number-1)},a=()=>{t(e.record.current.number+1)},s=()=>{t(Number.MAX_SAFE_INTEGER)},r=e=>{t(e)},l=t=>{e.changeBranch(t)},c=t=>{const i=t.target;e.updateAppSetting({showElapsedTimeInRecordView:i.checked})},u=t=>{const i=t.target;e.updateAppSetting({showCommentInRecordView:i.checked})},h=(0,o.Fl)((()=>e.appState===Qn.NORMAL||e.appState===Qn.RESEARCH)),d=(0,o.Fl)((()=>e.appSetting.showCommentInRecordView)),p=(0,o.Fl)((()=>e.appSetting.showElapsedTimeInRecordView)),m=(0,o.Fl)((()=>e.record));return{isRecordOperational:h,showElapsedTime:p,showComment:d,record:m,goBegin:i,goBack:n,goForward:a,goEnd:s,selectMove:r,selectBranch:l,onToggleElapsedTime:c,onToggleComment:u}}});const Qo=(0,Oi.Z)(Xo,[["render",Do],["__scopeId","data-v-605e0211"]]);var ea=Qo;const ta=e=>((0,o.dD)("data-v-771f2e34"),e=e(),(0,o.Cn)(),e),ia={class:"root"},na={class:"tabs"},oa=(0,o.Uk)(" 棋譜情報 "),aa=(0,o.Uk)(" コメント "),sa=(0,o.Uk)(" 思考 "),ra=(0,o.Uk)(" 評価値 "),la=(0,o.Uk)(" 期待勝率 "),ca=(0,o.Uk)(" 最小化 "),ua=ta((()=>(0,o._)("div",{class:"tab-border"},null,-1))),ha={class:"tab-contents"};function da(e,t,i,n,a,s){const r=(0,o.up)("ButtonIcon"),l=(0,o.up)("RecordInfo"),c=(0,o.up)("RecordComment"),u=(0,o.up)("EngineAnalytics"),h=(0,o.up)("EvaluationChart");return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("div",ia,["invisible"===e.activeTab?((0,o.wg)(),(0,o.iD)("div",{key:0,style:(0,z.j5)(`height: calc(100% - ${e.headerHeight}px);`)},null,4)):(0,o.kq)("",!0),(0,o._)("div",na,[(0,o._)("span",{class:(0,z.C_)(["tab",{selected:e.activeTab===e.Tab.RECORD_INFO}]),onClick:t[0]||(t[0]=t=>e.changeSelect(e.Tab.RECORD_INFO))},[(0,o.Wm)(r,{class:"icon",icon:e.Icon.DESCRIPTION},null,8,["icon"]),oa],2),(0,o._)("span",{class:(0,z.C_)(["tab",{selected:e.activeTab===e.Tab.COMMENT}]),onClick:t[1]||(t[1]=t=>e.changeSelect(e.Tab.COMMENT))},[(0,o.Wm)(r,{class:"icon",icon:e.Icon.COMMENT},null,8,["icon"]),aa],2),(0,o._)("span",{class:(0,z.C_)(["tab",{selected:e.activeTab===e.Tab.SEARCH}]),onClick:t[2]||(t[2]=t=>e.changeSelect(e.Tab.SEARCH))},[(0,o.Wm)(r,{class:"icon",icon:e.Icon.BRAIN},null,8,["icon"]),sa],2),(0,o._)("span",{class:(0,z.C_)(["tab",{selected:e.activeTab===e.Tab.CHART}]),onClick:t[3]||(t[3]=t=>e.changeSelect(e.Tab.CHART))},[(0,o.Wm)(r,{class:"icon",icon:e.Icon.CHART},null,8,["icon"]),ra],2),(0,o._)("span",{class:(0,z.C_)(["tab",{selected:e.activeTab===e.Tab.PERCENTAGE_CHART}]),onClick:t[4]||(t[4]=t=>e.changeSelect(e.Tab.PERCENTAGE_CHART))},[(0,o.Wm)(r,{class:"icon",icon:e.Icon.PERCENT},null,8,["icon"]),la],2),(0,o._)("span",{class:(0,z.C_)(["tab",{selected:e.activeTab===e.Tab.INVISIBLE}]),onClick:t[5]||(t[5]=t=>e.changeSelect(e.Tab.INVISIBLE))},[(0,o.Wm)(r,{class:"icon",icon:e.Icon.ARROW_DROP},null,8,["icon"]),ca],2)]),ua,(0,o._)("div",ha,[(0,o.Wm)(l,{class:(0,z.C_)(["tab-content",{selected:e.activeTab===e.Tab.RECORD_INFO}]),size:e.contentSize},null,8,["class","size"]),(0,o.Wm)(c,{class:(0,z.C_)(["tab-content",{selected:e.activeTab===e.Tab.COMMENT}])},null,8,["class"]),(0,o.Wm)(u,{class:(0,z.C_)(["tab-content",{selected:e.activeTab===e.Tab.SEARCH}]),size:e.contentSize},null,8,["class","size"]),(0,o.Wm)(h,{class:(0,z.C_)(["tab-content",{selected:e.activeTab===e.Tab.CHART}]),size:e.contentSize,type:e.EvaluationChartType.RAW},null,8,["class","size","type"]),(0,o.Wm)(h,{class:(0,z.C_)(["tab-content",{selected:e.activeTab===e.Tab.PERCENTAGE_CHART}]),size:e.contentSize,type:e.EvaluationChartType.WIN_RATE},null,8,["class","size","type"])])])])}const pa={class:"root"},ma=["value","readonly"];function ga(e,t,i,n,a,s){return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("div",pa,[(0,o._)("textarea",{ref:"textarea",class:"text",value:e.comment,readonly:!!e.readonly,onInput:t[0]||(t[0]=(...t)=>e.change&&e.change(...t))},null,40,ma)])])}var _a=(0,o.aZ)({name:"RecordComment",setup(){const e=_o(),t=(0,o.Fl)((()=>e.record.current.comment)),i=(0,o.Fl)((()=>e.appState!=Qn.NORMAL)),n=(0,c.iH)(null),a=t=>{const i=t.target.value;e.updateRecordComment(i)};return(0,o.bv)((()=>{n.value.addEventListener("copy",(e=>{e.stopPropagation()})),n.value.addEventListener("paste",(e=>{e.stopPropagation()}))})),{textarea:n,comment:t,readonly:i,change:a}}});const va=(0,Oi.Z)(_a,[["render",ga],["__scopeId","data-v-74746424"]]);var Sa=va;const Ea={class:"root"};function fa(e,t,i,n,a,s){const r=(0,o.up)("EngineAnalyticsElement");return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("div",Ea,[e.blackPlayer?((0,o.wg)(),(0,o.j4)(r,{key:0,name:e.blackPlayer.name,info:e.blackPlayer,height:e.elementHeight},null,8,["name","info","height"])):(0,o.kq)("",!0),e.whitePlayer?((0,o.wg)(),(0,o.j4)(r,{key:1,name:e.whitePlayer.name,info:e.whitePlayer,height:e.elementHeight},null,8,["name","info","height"])):(0,o.kq)("",!0),e.researcher?((0,o.wg)(),(0,o.j4)(r,{key:2,name:e.researcher.name,info:e.researcher,height:e.elementHeight},null,8,["name","info","height"])):(0,o.kq)("",!0)])])}const wa=e=>((0,o.dD)("data-v-182c61be"),e=e(),(0,o.Cn)(),e),Ia={class:"root"},Ta={class:"headers"},ya={class:"header"},ba=wa((()=>(0,o._)("span",{class:"label"},"エンジン名: ",-1))),Na={class:"value"},Aa={class:"header"},Ra=wa((()=>(0,o._)("span",{class:"label"},"最善手: ",-1))),Oa={class:"value"},Pa={class:"header"},ka=wa((()=>(0,o._)("span",{class:"label"},"秒間探索ノード(NPS): ",-1))),Ha={class:"value"},Ca={class:"header"},Ma=wa((()=>(0,o._)("span",{class:"label"},"探索ノード数: ",-1))),La={class:"value"},Da={class:"header"},Ba=wa((()=>(0,o._)("span",{class:"label"},"ハッシュ使用率: ",-1))),Ga={class:"value"},xa=(0,o.uE)('<div class="list-header" data-v-182c61be><div class="list-column time" data-v-182c61be>経過時間</div><div class="list-column multipv-index" data-v-182c61be>順位</div><div class="list-column depth" data-v-182c61be>深さ</div><div class="list-column score" data-v-182c61be>評価値</div></div>',1),Ka={class:"list-column time"},Wa={class:"list-column multipv-index"},Fa={class:"list-column depth"},Ua={class:"list-column score"},qa={class:"list-column score-flag"},Va={class:"list-column text"};function Za(e,t,i,n,a,s){return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("div",Ia,[(0,o._)("div",Ta,[(0,o._)("div",ya,[ba,(0,o._)("span",Na,(0,z.zw)(e.name),1)]),(0,o._)("div",Aa,[Ra,(0,o._)("span",Oa,(0,z.zw)(e.info.currentMoveText||"---"),1)]),(0,o._)("div",Pa,[ka,(0,o._)("span",Ha,(0,z.zw)(e.info.nps||"---"),1)]),(0,o._)("div",Ca,[Ma,(0,o._)("span",La,(0,z.zw)(e.info.nodes||"---"),1)]),(0,o._)("div",Da,[Ba,(0,o._)("span",Ga,(0,z.zw)(e.info.hashfull?(100*e.info.hashfull).toFixed(1):"---")+" % ",1)])]),xa,(0,o._)("div",{class:"list",style:(0,z.j5)(`height:${e.height-37}px`)},[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.info.iterates,((e,t)=>((0,o.wg)(),(0,o.iD)("div",{key:t,class:(0,z.C_)(["list-item",{best:1===e.multiPV}])},[(0,o._)("div",Ka,(0,z.zw)(e.timeMs?(e.timeMs/1e3).toFixed(1)+"s":""),1),(0,o._)("div",Wa,(0,z.zw)(e.multiPV||""),1),(0,o._)("div",Fa,(0,z.zw)(e.depth)+(0,z.zw)(e.selectiveDepth&&e.depth?"/":"")+(0,z.zw)(e.selectiveDepth),1),(0,o._)("div",Ua,(0,z.zw)(e.score)+" "+(0,z.zw)(e.scoreMate?e.scoreMate:""),1),(0,o._)("div",qa,(0,z.zw)(e.lowerBound?"++":"")+" "+(0,z.zw)(e.upperBound?"--":"")+" "+(0,z.zw)(e.scoreMate?"詰":""),1),(0,o._)("div",Va,(0,z.zw)(e.text),1)],2)))),128))],4)])])}var za=(0,o.aZ)({name:"EngineAnalyticsElement",props:{name:{type:String,required:!0},info:{type:zn,required:!0},height:{type:Number,required:!0}}});const ja=(0,Oi.Z)(za,[["render",Za],["__scopeId","data-v-182c61be"]]);var Ya=ja,$a=(0,o.aZ)({name:"EngineAnalytics",components:{EngineAnalyticsElement:Ya},props:{size:{type:Ai,required:!0}},setup(e){const t=_o(),i=(0,o.Fl)((()=>t.usiBlackPlayerMonitor)),n=(0,o.Fl)((()=>t.usiWhitePlayerMonitor)),a=(0,o.Fl)((()=>t.usiResearcherMonitor)),s=(0,o.Fl)((()=>{const i=(t.usiBlackPlayerMonitor?1:0)+(t.usiWhitePlayerMonitor?1:0)+(t.usiResearcherMonitor?1:0);return 0!==i?e.size.height/i:0}));return{blackPlayer:i,whitePlayer:n,researcher:a,elementHeight:s}}});const Ja=(0,Oi.Z)($a,[["render",fa],["__scopeId","data-v-3d2d2022"]]);var Xa=Ja;const Qa={class:"root"},es=["width","height"];function ts(e,t,i,n,a,s){return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("div",Qa,[(0,o._)("canvas",{ref:"canvas",width:e.size.width.toFixed(0),height:e.size.height.toFixed(0)},null,8,es)])])}var is=i(2728);const ns=2e3,os=-ns;var as;(function(e){e["RAW"]="raw",e["WIN_RATE"]="winRate"})(as||(as={}));var ss=(0,o.aZ)({name:"EvaluationChart",props:{size:{type:Ai,required:!0},type:{type:String,required:!0}},setup(e){const t=(0,c.iH)(null),i=_o();let n,a=ns,s=os;e.type===as.WIN_RATE&&(a=100,s=0);const r=(t,i,n,o)=>{const a=[];return n.moves.forEach((t=>{const n=new $n(t.customData);let s=n.evaluation&&n.evaluation[i];if(void 0!==s){switch(e.type){case as.RAW:s=Math.min(Math.max(s,os),ns);break;case as.WIN_RATE:s=co(s,o);break}a.push({x:t.number,y:s})}})),{label:Vn(i),borderColor:t,data:a,showLine:!0}},l=e=>({label:"現在の局面",borderColor:"red",data:[{x:e.current.number,y:a},{x:e.current.number,y:s}],showLine:!0,pointBorderWidth:0,pointRadius:0}),u=(e,t)=>[l(e),r("royalblue",qn.BLACK_PLAYER,e,t),r("darkorange",qn.WHITE_PLAYER,e,t),r("darkgreen",qn.RESEARCHER,e,t)],h=e=>({x:{min:0,max:e.length+10},y:{min:s,max:a}}),d=(e,t,n)=>{if(null===e.x)return;const o=n.scales.x.max-n.scales.x.min,a=n.scales.x.right-n.scales.x.left,s=(e.x-n.scales.x.left)/a*o+n.scales.x.min,r=Math.round(s);i.changeMoveNumber(r)};return(0,o.bv)((()=>{const e=t.value,o=e.getContext("2d"),a=i.record;n=new is.kL(o,{type:"scatter",data:{datasets:u(a,i.appSetting)},options:{color:"black",animation:{duration:0},maintainAspectRatio:!1,events:["click"],onClick:d}}),n.draw()})),(0,o.Ah)((()=>{n.destroy()})),(0,o.YP)((()=>[i.record,i.appSetting]),(([e,t])=>{n.data.datasets=u(e,t),n.options.scales=h(e),n.update()}),{deep:!0}),(0,o.YP)((()=>[e.size]),(([e])=>{n.resize(e.width,e.height)}),{deep:!0}),{canvas:t}}});const rs=(0,Oi.Z)(ss,[["render",ts],["__scopeId","data-v-65297975"]]);var ls=rs;const cs={class:"key"},us=["value","onInput"];function hs(e,t,i,n,a,s){return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("div",{class:"root",style:(0,z.j5)(`height:${e.size.height}px`)},[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.list,(t=>((0,o.wg)(),(0,o.iD)("div",{key:t.key,class:"element"},[(0,o._)("div",cs,(0,z.zw)(t.displayName),1),(0,o._)("input",{class:"value-input",value:t.value,onInput:i=>e.change(i,t.key)},null,40,us)])))),128))],4)])}var ds=(0,o.aZ)({name:"RecordComment",props:{size:{type:Ai,required:!0}},setup(){const e=_o(),t=(0,o.Fl)((()=>Object.values(ct).map((t=>{const i=e.record.metadata;return{key:t,displayName:ht(t),value:i.getStandardMetadata(t)||""}})))),i=(t,i)=>{const n=t.target;e.updateStandardRecordMetadata({key:i,value:n.value})};return{list:t,change:i}}});const ps=(0,Oi.Z)(ds,[["render",hs],["__scopeId","data-v-3b8399d9"]]);var ms=ps;const gs=30,_s=240+gs;var vs=(0,o.aZ)({name:"TabPane",components:{RecordComment:Sa,EngineAnalytics:Xa,EvaluationChart:ls,RecordInfo:ms,ButtonIcon:To},props:{size:{type:Ai,required:!0}},setup(e){const t=_o(),i=e=>{t.updateAppSetting({tab:e}).catch((e=>{Ln(qi.WARN,St(e))}))},n=(0,o.Fl)((()=>t.appSetting.tab)),a=(0,o.Fl)((()=>e.size.reduce(new Ai(0,gs))));return{activeTab:n,contentSize:a,headerHeight:gs,changeSelect:i,Icon:Eo,Tab:Fi,EvaluationChartType:as}}});const Ss=(0,Oi.Z)(vs,[["render",da],["__scopeId","data-v-771f2e34"]]);var Es=Ss,fs=(0,o.aZ)({name:"StandardLayout",components:{BoardPane:No,RecordPane:ea,TabPane:Es},setup(){const e=(0,c.qj)(new Ai(0,0)),t=(0,c.iH)(0),i=(0,c.iH)(null),n=()=>{e.width=window.innerWidth,e.height=window.innerHeight},a=new ResizeObserver((e=>{t.value=e[0].contentRect.height}));(0,o.bv)((()=>{n(),window.addEventListener("resize",n),a.observe(i.value)})),(0,o.Ah)((()=>{window.removeEventListener("resize",n),a.disconnect()}));const s=(0,o.Fl)((()=>{const t=_o().appSetting.tab!==Fi.INVISIBLE?_s:gs;return new Ai(e.width-Jo,e.height-t)})),r=(0,o.Fl)((()=>new Ai(e.width,e.height-t.value)));return{topPane:i,boardPaneMaxSize:s,bottomPaneSize:r}}});const ws=(0,Oi.Z)(fs,[["render",l],["__scopeId","data-v-6355277e"]]);var Is=ws;const Ts=e=>((0,o.dD)("data-v-b2598600"),e=e(),(0,o.Cn)(),e),ys={ref:"dialog"},bs=Ts((()=>(0,o._)("div",{class:"dialog-title"},"対局",-1))),Ns={class:"dialog-form-area"},As={class:"players"},Rs={class:"player"},Os=Ts((()=>(0,o._)("div",{class:"top-label"},"先手（下手）",-1))),Ps=["value"],ks=["value"],Hs={class:"player"},Cs=Ts((()=>(0,o._)("div",{class:"top-label"},"後手（上手）",-1))),Ms=["value"],Ls=["value"],Ds={class:"players-control"},Bs=(0,o.Uk)(" 先後入れ替え "),Gs={class:"dialog-form-areas-h"},xs={class:"dialog-form-area time-limit"},Ks={class:"dialog-form-item"},Ws=Ts((()=>(0,o._)("div",{class:"dialog-form-item-label"},"持ち時間",-1))),Fs=["value"],Us=Ts((()=>(0,o._)("div",{class:"dialog-form-item-unit"},"時間",-1))),qs=["value"],Vs=Ts((()=>(0,o._)("div",{class:"dialog-form-item-unit"},"分",-1))),Zs={class:"dialog-form-item"},zs=Ts((()=>(0,o._)("div",{class:"dialog-form-item-label"},"秒読み",-1))),js=["value"],Ys=Ts((()=>(0,o._)("div",{class:"dialog-form-item-unit"},"秒",-1))),$s={class:"dialog-form-item"},Js=Ts((()=>(0,o._)("div",{class:"dialog-form-item-label"},"増加",-1))),Xs=["value"],Qs=Ts((()=>(0,o._)("div",{class:"dialog-form-item-unit"},"秒",-1))),er={class:"dialog-form-area flags"},tr={class:"dialog-form-item"},ir=["value"],nr=(0,o.uE)('<option value="current" data-v-b2598600>現在の局面</option><option value="standard" data-v-b2598600>平手</option><option value="handicapLance" data-v-b2598600>香落ち</option><option value="handicapRightLance" data-v-b2598600>右香落ち</option><option value="handicapBishop" data-v-b2598600>角落ち</option><option value="handicapRook" data-v-b2598600>飛車落ち</option><option value="handicapRookLance" data-v-b2598600>飛車香落ち</option><option value="handicap2Pieces" data-v-b2598600>2枚落ち</option><option value="handicap4Pieces" data-v-b2598600>4枚落ち</option><option value="handicap6Pieces" data-v-b2598600>6枚落ち</option><option value="handicap8Pieces" data-v-b2598600>8枚落ち</option>',11),or=[nr],ar={class:"dialog-form-item"},sr=["checked"],rr=Ts((()=>(0,o._)("label",{for:"disable-engine-timeout"},"エンジンの時間切れあり",-1))),lr={class:"dialog-form-item"},cr=["checked"],ur=Ts((()=>(0,o._)("label",{for:"human-is-front"},"人を手前に表示する",-1))),hr={class:"dialog-main-buttons"};function dr(e,t,i,n,a,s){const r=(0,o.up)("ButtonIcon");return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("dialog",ys,[bs,(0,o._)("div",Ns,[(0,o._)("div",As,[(0,o._)("div",Rs,[Os,(0,o._)("select",{ref:"blackPlayerSelect",class:"player-select",size:"1",value:e.defaultValues.black.type},[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.players,(e=>((0,o.wg)(),(0,o.iD)("option",{key:e.uri,value:e.uri},(0,z.zw)(e.name),9,ks)))),128))],8,Ps)]),(0,o._)("div",Hs,[Cs,(0,o._)("select",{ref:"whitePlayerSelect",class:"player-select",size:"1",value:e.defaultValues.white.type},[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.players,(e=>((0,o.wg)(),(0,o.iD)("option",{key:e.uri,value:e.uri},(0,z.zw)(e.name),9,Ls)))),128))],8,Ms)])]),(0,o._)("div",Ds,[(0,o._)("button",{onClick:t[0]||(t[0]=(...t)=>e.onSwapColor&&e.onSwapColor(...t))},[(0,o.Wm)(r,{class:"icon",icon:e.Icon.SWAP_H},null,8,["icon"]),Bs])])]),(0,o._)("div",Gs,[(0,o._)("div",xs,[(0,o._)("div",Ks,[Ws,(0,o._)("input",{ref:"hours",class:"time-input",type:"number",min:"0",max:"99",step:"1",value:e.defaultValues.timeLimit.hours},null,8,Fs),Us,(0,o._)("input",{ref:"minutes",class:"time-input",type:"number",min:"0",max:"59",step:"1",value:e.defaultValues.timeLimit.minutes},null,8,qs),Vs]),(0,o._)("div",Zs,[zs,(0,o._)("input",{ref:"byoyomi",class:"time-input single",type:"number",min:"0",max:"60",step:"1",value:e.defaultValues.timeLimit.byoyomi},null,8,js),Ys]),(0,o._)("div",$s,[Js,(0,o._)("input",{ref:"increment",class:"time-input single",type:"number",min:"0",max:"99",step:"1",value:e.defaultValues.timeLimit.increment},null,8,Xs),Qs])]),(0,o._)("div",er,[(0,o._)("div",tr,[(0,o._)("select",{ref:"startPosition",value:e.defaultValues.startPosition},or,8,ir)]),(0,o._)("div",ar,[(0,o._)("input",{id:"disable-engine-timeout",ref:"enableEngineTimeout",type:"checkbox",checked:e.defaultValues.enableEngineTimeout},null,8,sr),rr]),(0,o._)("div",lr,[(0,o._)("input",{id:"human-is-front",ref:"humanIsFront",type:"checkbox",checked:e.defaultValues.humanIsFront},null,8,cr),ur])])]),(0,o._)("div",hr,[(0,o._)("button",{class:"dialog-button",onClick:t[1]||(t[1]=t=>e.onStart())},"対局開始"),(0,o._)("button",{class:"dialog-button",onClick:t[2]||(t[2]=t=>e.onCancel())},"キャンセル")])],512)])}function pr(e){e.addEventListener("cancel",(e=>{e.preventDefault(),e.stopPropagation()})),e.addEventListener("copy",(e=>{e.stopPropagation()})),e.addEventListener("paste",(e=>{e.stopPropagation()})),e.showModal()}function mr(e){return document.getElementById(e)}function gr(e){let t=Number(e.value);return e.max&&(t=Math.min(t,Number(e.max))),e.min&&(t=Math.max(t,Number(e.min))),t}var _r=(0,o.aZ)({name:"GameDialog",components:{ButtonIcon:To},setup(){const e=_o(),t=(0,c.iH)(null),i=(0,c.iH)(null),n=(0,c.iH)(null),a=(0,c.iH)(null),s=(0,c.iH)(null),r=(0,c.iH)(null),l=(0,c.iH)(null),u=(0,c.iH)(null),h=(0,c.iH)(null),d=(0,c.iH)(null),p=(0,c.iH)(Ji()),m=(0,c.iH)(new xi);e.retainBussyState(),(0,o.bv)((async()=>{pr(t.value);try{p.value=await In(),m.value=await yn(),e.releaseBussyState()}catch(i){e.pushError(i),e.closeDialog()}}));const g=e=>{if(Mi(e)){const t=m.value.getEngine(e);return{name:t.name,uri:e,usi:t}}return{name:"人",uri:Hi}},_=()=>{const t={black:g(i.value.value),white:g(n.value.value),timeLimit:{timeSeconds:60*(60*gr(a.value)+gr(s.value)),byoyomi:gr(r.value),increment:gr(l.value)},startPosition:"current"!==u.value.value?u.value.value:void 0,enableEngineTimeout:h.value.checked,humanIsFront:d.value.checked},o=Xi(t);o?e.pushError(o):e.startGame(t)},v=()=>{e.closeDialog()},S=()=>{[i.value.value,n.value.value]=[n.value.value,i.value.value]},E=(0,o.Fl)((()=>({black:{type:p.value.black.uri},white:{type:p.value.white.uri},timeLimit:{hours:Math.floor(p.value.timeLimit.timeSeconds/3600),minutes:Math.floor(p.value.timeLimit.timeSeconds/60)%60,byoyomi:p.value.timeLimit.byoyomi,increment:p.value.timeLimit.increment},startPosition:void 0!==p.value.startPosition?p.value.startPosition:"current",enableEngineTimeout:p.value.enableEngineTimeout,humanIsFront:p.value.humanIsFront}))),f=(0,o.Fl)((()=>[{name:"人",uri:Hi},...m.value.engineList]));return{dialog:t,blackPlayerSelect:i,whitePlayerSelect:n,hours:a,minutes:s,byoyomi:r,increment:l,startPosition:u,enableEngineTimeout:h,humanIsFront:d,defaultValues:E,players:f,onStart:_,onCancel:v,onSwapColor:S,Icon:Eo}}});const vr=(0,Oi.Z)(_r,[["render",dr],["__scopeId","data-v-b2598600"]]);var Sr=vr;const Er=e=>((0,o.dD)("data-v-3adf5e2b"),e=e(),(0,o.Cn)(),e),fr={ref:"dialog"},wr=Er((()=>(0,o._)("div",{class:"dialog-title"},"検討",-1))),Ir={class:"dialog-form-area"},Tr={class:"dialog-form-item"},yr=Er((()=>(0,o._)("div",{class:"dialog-form-item-label"},"エンジン",-1))),br=["value"],Nr=["value"],Ar={class:"dialog-main-buttons"};function Rr(e,t,i,n,a,s){return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("dialog",fr,[wr,(0,o._)("div",Ir,[(0,o._)("div",Tr,[yr,(0,o._)("select",{ref:"engineSelect",class:"engine-select",size:"1",value:e.defaultValue},[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.engines,(e=>((0,o.wg)(),(0,o.iD)("option",{key:e.uri,value:e.uri},(0,z.zw)(e.name),9,Nr)))),128))],8,br)])]),(0,o._)("div",Ar,[(0,o._)("button",{class:"dialog-button",onClick:t[0]||(t[0]=t=>e.onStart())},"検討開始"),(0,o._)("button",{class:"dialog-button",onClick:t[1]||(t[1]=t=>e.onCancel())},"キャンセル")])],512)])}var Or=(0,o.aZ)({name:"ResearchDialog",setup(){const e=_o(),t=(0,c.iH)(null),i=(0,c.iH)(null),n=(0,c.iH)(Qi()),a=(0,c.iH)(new xi);e.retainBussyState(),(0,o.bv)((async()=>{pr(t.value);try{n.value=await Sn(),a.value=await yn(),e.releaseBussyState()}catch(i){e.pushError(i),e.closeDialog()}}));const s=()=>{const t=i.value.value;if(!a.value.hasEngine(t))return void e.pushError("エンジンを選択してください。");const n=a.value.getEngine(t),o={usi:n};e.startResearch(o)},r=()=>{e.closeDialog()},l=(0,o.Fl)((()=>a.value.engineList)),u=(0,o.Fl)((()=>n.value.usi?n.value.usi.uri:""));return{dialog:t,engineSelect:i,engines:l,defaultValue:u,onStart:s,onCancel:r}}});const Pr=(0,Oi.Z)(Or,[["render",Rr],["__scopeId","data-v-3adf5e2b"]]);var kr=Pr;const Hr=e=>((0,o.dD)("data-v-e289221a"),e=e(),(0,o.Cn)(),e),Cr={ref:"dialog"},Mr=Hr((()=>(0,o._)("div",{class:"dialog-title"},"エンジン管理",-1))),Lr={class:"dialog-form-area engine-list"},Dr={key:0,class:"engine"},Br=["value"],Gr={class:"engine-name"},xr=["onClick"],Kr=["onClick"],Wr=["onClick"],Fr={class:"dialog-main-buttons"};function Ur(e,t,i,n,a,s){const r=(0,o.up)("USIEngineOptionDialog");return(0,o.wg)(),(0,o.iD)(o.HY,null,[(0,o._)("div",null,[(0,o._)("dialog",Cr,[Mr,(0,o._)("div",Lr,[0===e.engines.length?((0,o.wg)(),(0,o.iD)("div",Dr," エンジンが登録されていません。 ")):(0,o.kq)("",!0),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.engines,(t=>((0,o.wg)(),(0,o.iD)("div",{key:t.uri,class:"engine",value:t.uri},[(0,o._)("div",Gr,(0,z.zw)(t.name),1),(0,o._)("button",{class:"dialog-narrow-button",onClick:i=>e.openOptions(t.uri)}," 設定 ",8,xr),(0,o._)("button",{class:"dialog-narrow-button",onClick:i=>e.duplicate(t.uri)}," 複製 ",8,Kr),(0,o._)("button",{class:"dialog-narrow-button",onClick:i=>e.remove(t.uri)}," 削除 ",8,Wr)],8,Br)))),128))]),(0,o._)("button",{class:"dialog-wide-button",onClick:t[0]||(t[0]=t=>e.add())},"追加"),(0,o._)("div",Fr,[(0,o._)("button",{class:"dialog-button",onClick:t[1]||(t[1]=t=>e.saveAndClose())}," 保存して閉じる "),(0,o._)("button",{class:"dialog-button",onClick:t[2]||(t[2]=t=>e.cancel())},"キャンセル")])],512)]),e.optionDialog?((0,o.wg)(),(0,o.j4)(r,{key:0,"latest-engine-setting":e.optionDialog,onOk:e.optionOk,onCancel:e.optionCancel},null,8,["latest-engine-setting","onOk","onCancel"])):(0,o.kq)("",!0)],64)}const qr=e=>((0,o.dD)("data-v-c4e7276c"),e=e(),(0,o.Cn)(),e),Vr={ref:"dialog"},Zr=qr((()=>(0,o._)("div",{class:"dialog-title"},"エンジン設定",-1))),zr={class:"dialog-form-area option-list"},jr={class:"option"},Yr=qr((()=>(0,o._)("div",{class:"option-name"},"エンジン名",-1))),$r={class:"option-unchangeable"},Jr={class:"option"},Xr=qr((()=>(0,o._)("div",{class:"option-name"},"作者",-1))),Qr={class:"option-unchangeable"},el={class:"option"},tl=qr((()=>(0,o._)("div",{class:"option-name"},"場所",-1))),il={class:"option-unchangeable"},nl={class:"option"},ol=qr((()=>(0,o._)("div",{class:"option-name"},"表示名",-1))),al={ref:"engineNameInput",class:"option-value-text",type:"text",name:"ElectronShogiEngineName"},sl={class:"option-name"},rl=["id","min","max","name"],ll=["id","name"],cl=["id","name"],ul=["onClick"],hl=["id"],dl=qr((()=>(0,o._)("option",{value:""},"既定値",-1))),pl=qr((()=>(0,o._)("option",{value:"true"},"ON",-1))),ml=qr((()=>(0,o._)("option",{value:"false"},"OFF",-1))),gl=[dl,pl,ml],_l=["id"],vl=qr((()=>(0,o._)("option",{value:""},"既定値",-1))),Sl=["value"],El=["onClick"],fl={class:"dialog-main-buttons"};function wl(e,t,i,n,a,s){return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("dialog",Vr,[Zr,(0,o._)("div",zr,[(0,o._)("div",jr,[Yr,(0,o._)("div",$r,(0,z.zw)(e.engine.defaultName),1)]),(0,o._)("div",Jr,[Xr,(0,o._)("div",Qr,(0,z.zw)(e.engine.author),1)]),(0,o._)("div",el,[tl,(0,o._)("div",il,(0,z.zw)(e.engine.path),1)]),(0,o._)("div",nl,[ol,(0,o._)("input",al,null,512)]),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.options,(t=>((0,o.wg)(),(0,o.iD)("div",{key:t.name,class:"option"},[(0,o._)("div",sl,(0,z.zw)(t.name),1),"spin"===t.type?((0,o.wg)(),(0,o.iD)("input",{key:0,id:t.inputId,class:"option-value-number",type:"number",min:t.min,max:t.max,step:"1",name:t.name},null,8,rl)):(0,o.kq)("",!0),"string"===t.type?((0,o.wg)(),(0,o.iD)("input",{key:1,id:t.inputId,class:"option-value-text",type:"text",name:t.name},null,8,ll)):(0,o.kq)("",!0),"filename"===t.type?((0,o.wg)(),(0,o.iD)("input",{key:2,id:t.inputId,class:"option-value-filename",type:"text",name:t.name},null,8,cl)):(0,o.kq)("",!0),"filename"===t.type?((0,o.wg)(),(0,o.iD)("button",{key:3,class:"dialog-button",onClick:i=>e.selectFile(t.inputId)}," 選択 ",8,ul)):(0,o.kq)("",!0),"check"===t.type?((0,o.wg)(),(0,o.iD)("select",{key:4,id:t.inputId,class:"option-value-check"},gl,8,hl)):(0,o.kq)("",!0),"combo"===t.type?((0,o.wg)(),(0,o.iD)("select",{key:5,id:t.inputId,class:"option-value-combo"},[vl,((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(t.vars,(e=>((0,o.wg)(),(0,o.iD)("option",{key:e,value:e},(0,z.zw)(e),9,Sl)))),128))],8,_l)):(0,o.kq)("",!0),"button"===t.type?((0,o.wg)(),(0,o.iD)("button",{key:6,class:"dialog-button",onClick:i=>e.sendOption(t.name)}," 実行 ",8,El)):(0,o.kq)("",!0)])))),128))]),(0,o._)("button",{class:"dialog-wide-button",onClick:t[0]||(t[0]=t=>e.reset())}," エンジンの既定値に戻す "),(0,o._)("div",fl,[(0,o._)("button",{class:"dialog-button",onClick:t[1]||(t[1]=t=>e.ok())},"OK"),(0,o._)("button",{class:"dialog-button",onClick:t[2]||(t[2]=t=>e.cancel())},"キャンセル")])],512)])}var Il=(0,o.aZ)({name:"USIEngineOptionDialog",props:{latestEngineSetting:{type:Object,required:!0}},emits:["ok","cancel"],setup(e,t){const i=_o(),n=(0,c.iH)(null),a=(0,c.iH)(null),s=e.latestEngineSetting;let r=(0,c.iH)(s);const l=(0,o.Fl)((()=>Object.values(r.value.options).sort(((e,t)=>{const i=e.name.startsWith("USI_"),n=t.name.startsWith("USI_");return i!==n?i?-1:1:e.name<t.name?-1:1})).map(((e,t)=>({...e,inputId:"usiEngineOptionDialogOption"+t,value:Di(e)})))));i.retainBussyState(),(0,o.bv)((async()=>{pr(n.value);try{r.value=await An(s.path),Gi(r.value,s),a.value.value=r.value.name;for(const e of l.value){const t=mr(e.inputId);t&&void 0!==e.value&&(t.value=e.value+"")}}catch(e){i.pushError(e)}finally{i.releaseBussyState()}}));const u=async e=>{i.retainBussyState();try{const t=await gn(),n=mr(e);t&&n&&(n.value=t)}catch(t){i.pushError(t)}finally{i.releaseBussyState()}},h=async e=>{i.retainBussyState();try{await Rn(r.value.path,e)}catch(t){i.pushError(t)}finally{i.releaseBussyState()}},d=()=>{a.value.value=r.value.defaultName;for(const e of l.value){const t=mr(e.inputId);t&&(void 0!==r.value.options[e.name].default?t.value=r.value.options[e.name].default+"":t.value="")}},p=()=>{r.value.name=a.value.value;for(const e of l.value){const t=mr(e.inputId);t&&(r.value.options[e.name].value=t.value?"spin"===e.type?gr(t):t.value:void 0)}t.emit("ok",r.value)},m=()=>{t.emit("cancel")};return{engine:r,dialog:n,engineNameInput:a,options:l,selectFile:u,sendOption:h,reset:d,ok:p,cancel:m}}});const Tl=(0,Oi.Z)(Il,[["render",wl],["__scopeId","data-v-c4e7276c"]]);var yl=Tl,bl=(0,o.aZ)({name:"USIEngineManagementDialog",components:{USIEngineOptionDialog:yl},setup(){const e=_o(),t=(0,c.iH)(null),i=(0,c.iH)(null),n=(0,c.iH)(new xi);e.retainBussyState(),(0,o.bv)((async()=>{pr(t.value);try{n.value=await yn(),e.releaseBussyState()}catch(i){e.pushError(i),e.closeDialog()}}));const a=async()=>{try{e.retainBussyState();const t=await Nn();if(!t)return;n.value.addEngine(await An(t))}catch(t){e.pushError(t)}finally{e.releaseBussyState()}},s=e=>{n.value.removeEngine(e)},r=e=>{i.value=n.value.getEngine(e)},l=e=>{const t=n.value.getEngine(e),i=Bi(t);n.value.addEngine(i)},u=async()=>{try{e.retainBussyState(),await bn(n.value),e.closeDialog()}catch(t){e.pushError(t)}finally{e.releaseBussyState()}},h=()=>{e.closeDialog()},d=e=>{n.value.updateEngine(e),i.value=null},p=()=>{i.value=null},m=(0,o.Fl)((()=>n.value.engineList));return{optionDialog:i,dialog:t,engines:m,add:a,remove:s,openOptions:r,duplicate:l,saveAndClose:u,cancel:h,optionOk:d,optionCancel:p}}});const Nl=(0,Oi.Z)(bl,[["render",Ur],["__scopeId","data-v-e289221a"]]);var Al=Nl;const Rl=e=>((0,o.dD)("data-v-5362c170"),e=e(),(0,o.Cn)(),e),Ol={ref:"dialog"},Pl=Rl((()=>(0,o._)("div",{class:"dialog-title"},"アプリ設定",-1))),kl={class:"dialog-form-area settings"},Hl={class:"section"},Cl=Rl((()=>(0,o._)("div",{class:"section-title"},"画像",-1))),Ml={class:"dialog-form-item"},Ll=Rl((()=>(0,o._)("div",{class:"dialog-form-item-label-wide"},"駒画像",-1))),Dl=["value"],Bl=["value"],Gl={class:"dialog-form-item"},xl=Rl((()=>(0,o._)("div",{class:"dialog-form-item-label-wide"},"盤画像",-1))),Kl=["value"],Wl=["value"],Fl={class:"section"},Ul=Rl((()=>(0,o._)("div",{class:"section-title"},"音",-1))),ql={class:"dialog-form-item"},Vl=Rl((()=>(0,o._)("div",{class:"dialog-form-item-label-wide"},"駒音の大きさ",-1))),Zl=["value"],zl=Rl((()=>(0,o._)("div",{class:"dialog-form-item-unit"},"%",-1))),jl={class:"dialog-form-item"},Yl=Rl((()=>(0,o._)("div",{class:"dialog-form-item-label-wide"},"時計音の大きさ",-1))),$l=["value"],Jl=Rl((()=>(0,o._)("div",{class:"dialog-form-item-unit"},"%",-1))),Xl={class:"dialog-form-item"},Ql=Rl((()=>(0,o._)("div",{class:"dialog-form-item-label-wide"},"時計音の高さ",-1))),ec=["value"],tc=Rl((()=>(0,o._)("div",{class:"dialog-form-item-unit"},"Hz (220 ~ 880)",-1))),ic={class:"dialog-form-item"},nc=Rl((()=>(0,o._)("div",{class:"dialog-form-item-label-wide"},"時計音の対象",-1))),oc=["value"],ac=Rl((()=>(0,o._)("option",{value:"all"},"全ての手番",-1))),sc=Rl((()=>(0,o._)("option",{value:"onlyUser"},"人の手番のみ",-1))),rc=[ac,sc],lc={class:"section"},cc=Rl((()=>(0,o._)("div",{class:"section-title"},"ファイル",-1))),uc={class:"dialog-form-item"},hc=Rl((()=>(0,o._)("div",{class:"dialog-form-item-label-wide"},"改行文字",-1))),dc=["value"],pc=Rl((()=>(0,o._)("option",{value:"crlf"},"CR + LF (Windows)",-1))),mc=Rl((()=>(0,o._)("option",{value:"lf"},"LF (UNIX/Mac)",-1))),gc=Rl((()=>(0,o._)("option",{value:"cr"},"CR (90年代Mac)",-1))),_c=[pc,mc,gc],vc={class:"section"},Sc=Rl((()=>(0,o._)("div",{class:"section-title"},"評価値・期待勝率",-1))),Ec={class:"dialog-form-item"},fc=Rl((()=>(0,o._)("div",{class:"dialog-form-item-label-wide"},"勝率換算係数",-1))),wc=["value"],Ic=Rl((()=>(0,o._)("div",{class:"dialog-form-item-unit"},"(推奨: 600 から 1500 まで)",-1))),Tc={class:"dialog-form-item"},yc=Rl((()=>(0,o._)("div",{class:"dialog-form-item-label-wide"},"緩手の閾値",-1))),bc=["value"],Nc=Rl((()=>(0,o._)("div",{class:"dialog-form-item-unit"},"%",-1))),Ac={class:"dialog-form-item"},Rc=Rl((()=>(0,o._)("div",{class:"dialog-form-item-label-wide"},"疑問手の閾値",-1))),Oc=["value"],Pc=Rl((()=>(0,o._)("div",{class:"dialog-form-item-unit"},"%",-1))),kc={class:"dialog-form-item"},Hc=Rl((()=>(0,o._)("div",{class:"dialog-form-item-label-wide"},"悪手の閾値",-1))),Cc=["value"],Mc=Rl((()=>(0,o._)("div",{class:"dialog-form-item-unit"},"%",-1))),Lc={class:"dialog-form-item"},Dc=Rl((()=>(0,o._)("div",{class:"dialog-form-item-label-wide"},"大悪手の閾値",-1))),Bc=["value"],Gc=Rl((()=>(0,o._)("div",{class:"dialog-form-item-unit"},"%",-1))),xc={class:"section"},Kc=Rl((()=>(0,o._)("div",{class:"section-title"},"ログ",-1))),Wc={class:"dialog-form-item"},Fc=Rl((()=>(0,o._)("div",{class:"dialog-form-item-label-wide"},"アプリログを出力",-1))),Uc=["checked"],qc={key:0,class:"dialog-form-item-unit"},Vc={key:1,class:"dialog-form-item-unit"},Zc={class:"dialog-form-item"},zc=Rl((()=>(0,o._)("div",{class:"dialog-form-item-label-wide"},"USI通信ログを出力",-1))),jc=["checked"],Yc={key:0,class:"dialog-form-item-unit"},$c={key:1,class:"dialog-form-item-unit"},Jc={class:"dialog-main-buttons"};function Xc(e,t,i,n,a,s){return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("dialog",Ol,[Pl,(0,o._)("div",kl,[(0,o._)("div",Hl,[Cl,(0,o._)("div",Ml,[Ll,(0,o._)("select",{ref:"pieceImage",value:e.appSetting.pieceImage},[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.pieceImageTypes,(e=>((0,o.wg)(),(0,o.iD)("option",{key:e.value,value:e.value},(0,z.zw)(e.name),9,Bl)))),128))],8,Dl)]),(0,o._)("div",Gl,[xl,(0,o._)("select",{ref:"boardImage",value:e.appSetting.boardImage},[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.boardImageTypes,(e=>((0,o.wg)(),(0,o.iD)("option",{key:e.value,value:e.value},(0,z.zw)(e.name),9,Wl)))),128))],8,Kl)])]),(0,o._)("div",Fl,[Ul,(0,o._)("div",ql,[Vl,(0,o._)("input",{ref:"pieceVolume",value:e.appSetting.pieceVolume,type:"number",max:"100",min:"0"},null,8,Zl),zl]),(0,o._)("div",jl,[Yl,(0,o._)("input",{ref:"clockVolume",value:e.appSetting.clockVolume,type:"number",max:"100",min:"0"},null,8,$l),Jl]),(0,o._)("div",Xl,[Ql,(0,o._)("input",{ref:"clockPitch",value:e.appSetting.clockPitch,type:"number",max:"880",min:"220"},null,8,ec),tc]),(0,o._)("div",ic,[nc,(0,o._)("select",{ref:"clockSoundTarget",value:e.appSetting.clockSoundTarget},rc,8,oc)])]),(0,o._)("div",lc,[cc,(0,o._)("div",uc,[hc,(0,o._)("select",{ref:"returnCode",value:e.appSetting.returnCode},_c,8,dc)])]),(0,o._)("div",vc,[Sc,(0,o._)("div",Ec,[fc,(0,o._)("input",{ref:"coefficientInSigmoid",value:e.appSetting.coefficientInSigmoid,type:"number",max:"10000",min:"1"},null,8,wc),Ic]),(0,o._)("div",Tc,[yc,(0,o._)("input",{ref:"badMoveLevelThreshold1",value:e.appSetting.badMoveLevelThreshold1,type:"number",max:"100",min:"0"},null,8,bc),Nc]),(0,o._)("div",Ac,[Rc,(0,o._)("input",{ref:"badMoveLevelThreshold2",value:e.appSetting.badMoveLevelThreshold2,type:"number",max:"100",min:"0"},null,8,Oc),Pc]),(0,o._)("div",kc,[Hc,(0,o._)("input",{ref:"badMoveLevelThreshold3",value:e.appSetting.badMoveLevelThreshold3,type:"number",max:"100",min:"0"},null,8,Cc),Mc]),(0,o._)("div",Lc,[Dc,(0,o._)("input",{ref:"badMoveLevelThreshold4",value:e.appSetting.badMoveLevelThreshold4,type:"number",max:"100",min:"0"},null,8,Bc),Gc])]),(0,o._)("div",xc,[Kc,(0,o._)("div",Wc,[Fc,(0,o._)("input",{ref:"enableAppLog",class:"toggle",checked:e.appSetting.enableAppLog,type:"checkbox"},null,8,Uc),e.isNative?((0,o.wg)(),(0,o.iD)("div",qc," （再起動後に有効） ")):(0,o.kq)("",!0),e.isNative?(0,o.kq)("",!0):((0,o.wg)(),(0,o.iD)("div",Vc," （ブラウザ版では機能しません） "))]),(0,o._)("div",Zc,[zc,(0,o._)("input",{ref:"enableUSILog",class:"toggle",checked:e.appSetting.enableUSILog,type:"checkbox"},null,8,jc),e.isNative?((0,o.wg)(),(0,o.iD)("div",Yc," （再起動後に有効） ")):(0,o.kq)("",!0),e.isNative?(0,o.kq)("",!0):((0,o.wg)(),(0,o.iD)("div",$c," （ブラウザ版では機能しません） "))])])]),(0,o._)("div",Jc,[(0,o._)("button",{class:"dialog-button",onClick:t[0]||(t[0]=t=>e.saveAndClose())}," 保存して閉じる "),(0,o._)("button",{class:"dialog-button",onClick:t[1]||(t[1]=t=>e.cancel())},"キャンセル")])],512)])}const Qc={"\r\n":"crlf","\n":"lf","\r":"cr"},eu={crlf:"\r\n",lf:"\n",cr:"\r"};var tu=(0,o.aZ)({name:"AppSettingDialog",setup(){const e=_o(),t=(0,c.iH)(null),i=(0,c.iH)(null),n=(0,c.iH)(null),a=(0,c.iH)(null),s=(0,c.iH)(null),r=(0,c.iH)(null),l=(0,c.iH)(null),u=(0,c.iH)(null),h=(0,c.iH)(null),d=(0,c.iH)(null),p=(0,c.iH)(null),m=(0,c.iH)(null),g=(0,c.iH)(null),_=(0,c.iH)(null),v=(0,c.iH)(null);(0,o.bv)((()=>{pr(t.value)}));const S=async()=>{const t={pieceImage:i.value.value,boardImage:n.value.value,pieceVolume:gr(a.value),clockVolume:gr(s.value),clockPitch:gr(r.value),clockSoundTarget:l.value.value,returnCode:eu[u.value.value],coefficientInSigmoid:gr(h.value),badMoveLevelThreshold1:gr(d.value),badMoveLevelThreshold2:gr(p.value),badMoveLevelThreshold3:gr(m.value),badMoveLevelThreshold4:gr(g.value),enableAppLog:_.value.checked,enableUSILog:v.value.checked};e.retainBussyState();try{await e.updateAppSetting(t),e.closeAppSettingDialog()}catch(o){e.pushError(o)}finally{e.releaseBussyState()}},E=()=>{e.closeAppSettingDialog()},f=(0,o.Fl)((()=>({...e.appSetting,returnCode:Qc[e.appSetting.returnCode]}))),w=[{name:"一文字駒",value:fi.HITOMOJI},{name:"一文字駒（ゴシック体）",value:fi.HITOMOJI_GOTHIC}],I=[{name:"木目（明るい）",value:wi.LIGHT},{name:"木目（暖かい）",value:wi.WARM},{name:"塩化ビニル",value:wi.RESIN}];return{dialog:t,pieceImage:i,boardImage:n,pieceVolume:a,clockVolume:s,clockPitch:r,clockSoundTarget:l,returnCode:u,coefficientInSigmoid:h,badMoveLevelThreshold1:d,badMoveLevelThreshold2:p,badMoveLevelThreshold3:m,badMoveLevelThreshold4:g,enableAppLog:_,enableUSILog:v,appSetting:f,pieceImageTypes:w,boardImageTypes:I,isNative:ln(),saveAndClose:S,cancel:E}}});const iu=(0,Oi.Z)(tu,[["render",Xc],["__scopeId","data-v-5362c170"]]);var nu=iu;const ou=e=>((0,o.dD)("data-v-40322b95"),e=e(),(0,o.Cn)(),e),au={ref:"dialog"},su={ref:"content"},ru={class:"dialog-form-area"},lu=ou((()=>(0,o._)("div",{class:"message"},"以下の棋譜(または局面)を取り込みます。",-1))),cu=ou((()=>(0,o._)("div",{class:"message"},"※KIF形式/CSA形式/SFENに対応しています。",-1))),uu={key:0,class:"message"},hu=(0,o.Uk)(" ※テキストエリアに棋譜を貼り付けてください。"),du=ou((()=>(0,o._)("br",null,null,-1))),pu=(0,o.Uk)(" ※インストールアプリ版では自動的に貼り付けられます。 "),mu=[hu,du,pu],gu={ref:"textarea"},_u={class:"dialog-main-buttons"};function vu(e,t,i,n,a,s){return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("dialog",au,[(0,o._)("div",su,[(0,o._)("div",ru,[lu,cu,e.isNative?(0,o.kq)("",!0):((0,o.wg)(),(0,o.iD)("div",uu,mu)),(0,o._)("textarea",gu,null,512)])],512),(0,o._)("div",_u,[(0,o._)("button",{class:"dialog-button",onClick:t[0]||(t[0]=(...t)=>e.onOk&&e.onOk(...t))},"取り込む"),(0,o._)("button",{class:"dialog-button",onClick:t[1]||(t[1]=(...t)=>e.onCancel&&e.onCancel(...t))},"キャンセル")])],512)])}var Su=(0,o.aZ)({name:"PasteDialog",setup(){const e=_o(),t=(0,c.iH)(null),i=(0,c.iH)(null);e.retainBussyState(),(0,o.bv)((async()=>{try{pr(t.value),ln()&&(i.value.value=await navigator.clipboard.readText())}finally{e.releaseBussyState()}}));const n=()=>{const t=i.value.value;e.closePasteDialog(),t&&e.pasteRecord(t)},a=()=>{e.closePasteDialog()};return{dialog:t,textarea:i,onOk:n,onCancel:a,isNative:ln()}}});const Eu=(0,Oi.Z)(Su,[["render",vu],["__scopeId","data-v-40322b95"]]);var fu=Eu;const wu=e=>((0,o.dD)("data-v-71bd87cb"),e=e(),(0,o.Cn)(),e),Iu={ref:"dialog",class:"bussy"},Tu={class:"content"},yu=wu((()=>(0,o._)("div",{class:"message"},"処理中です。お待ち下さい。",-1)));function bu(e,t,i,n,a,s){const r=(0,o.up)("ButtonIcon");return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("dialog",Iu,[(0,o._)("div",Tu,[(0,o.Wm)(r,{class:"icon",icon:e.Icon.BUSSY},null,8,["icon"]),yu])],512)])}var Nu=(0,o.aZ)({name:"BussyMessage",components:{ButtonIcon:To},setup(){const e=(0,c.iH)(null);return(0,o.bv)((()=>{pr(e.value)})),{dialog:e,Icon:Eo}}});const Au=(0,Oi.Z)(Nu,[["render",bu],["__scopeId","data-v-71bd87cb"]]);var Ru=Au;const Ou={ref:"dialog"},Pu={class:"content"},ku={class:"message"},Hu={class:"dialog-main-buttons"};function Cu(e,t,i,n,a,s){const r=(0,o.up)("ButtonIcon");return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("dialog",Ou,[(0,o._)("div",Pu,[(0,o.Wm)(r,{class:"icon",icon:e.Icon.QUESTION},null,8,["icon"]),(0,o._)("div",ku,(0,z.zw)(e.message),1)]),(0,o._)("div",Hu,[(0,o._)("button",{class:"dialog-button",onClick:t[0]||(t[0]=t=>e.onOk())},"OK"),(0,o._)("button",{class:"dialog-button",onClick:t[1]||(t[1]=t=>e.onClose())},"キャンセル")])],512)])}var Mu=(0,o.aZ)({name:"InfoMessage",components:{ButtonIcon:To},setup(){const e=_o(),t=(0,c.iH)(null),i=(0,o.Fl)((()=>e.confirmation));(0,o.bv)((()=>{pr(t.value)}));const n=()=>{e.confirmationOk()},a=()=>{e.confirmationCancel()};return{dialog:t,message:i,onOk:n,onClose:a,Icon:Eo}}});const Lu=(0,Oi.Z)(Mu,[["render",Cu]]);var Du=Lu;const Bu={ref:"dialog"},Gu={class:"content"},xu={class:"message"},Ku={class:"dialog-main-buttons"};function Wu(e,t,i,n,a,s){const r=(0,o.up)("ButtonIcon");return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("dialog",Bu,[(0,o._)("div",Gu,[(0,o.Wm)(r,{class:"icon",icon:e.Icon.INFO},null,8,["icon"]),(0,o._)("div",xu,(0,z.zw)(e.message),1)]),(0,o._)("div",Ku,[(0,o._)("button",{onClick:t[0]||(t[0]=t=>e.onClose())},"閉じる")])],512)])}var Fu=(0,o.aZ)({name:"InfoMessage",components:{ButtonIcon:To},setup(){const e=_o(),t=(0,c.iH)(null);(0,o.bv)((()=>{pr(t.value)}));const i=(0,o.Fl)((()=>e.message)),n=()=>{e.dequeueMessage()};return{dialog:t,message:i,onClose:n,Icon:Eo}}});const Uu=(0,Oi.Z)(Fu,[["render",Wu]]);var qu=Uu;const Vu={ref:"dialog",class:"error"},Zu={class:"content"},zu={class:"items"},ju={class:"notice"},Yu={class:"index"},$u={class:"message"},Ju={class:"dialog-main-buttons"};function Xu(e,t,i,n,a,s){const r=(0,o.up)("ButtonIcon");return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("dialog",Vu,[(0,o._)("div",Zu,[(0,o.Wm)(r,{class:"icon",icon:e.Icon.ERROR},null,8,["icon"]),(0,o._)("div",zu,[(0,o._)("div",ju,(0,z.zw)(e.errors.length)+" 件のエラーが発生しました。 ",1),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.errors,(e=>((0,o.wg)(),(0,o.iD)("div",{key:e.index,class:"item"},[(0,o._)("p",Yu,(0,z.zw)(e.index+1)+" 件目",1),(0,o._)("p",$u,(0,z.zw)(e.message),1)])))),128))])]),(0,o._)("div",Ju,[(0,o._)("button",{onClick:t[0]||(t[0]=t=>e.onClose())},"閉じる")])],512)])}var Qu=(0,o.aZ)({name:"ErrorMessage",components:{ButtonIcon:To},setup(){const e=_o(),t=(0,c.iH)(null);(0,o.bv)((()=>{pr(t.value)}));const i=(0,o.Fl)((()=>e.errors.map(((e,t)=>({message:e.message,index:t}))))),n=()=>{e.clearErrors()};return{dialog:t,errors:i,onClose:n,Icon:Eo}}});const eh=(0,Oi.Z)(Qu,[["render",Xu],["__scopeId","data-v-4382663f"]]);var th=eh;function ih(){const e=document.activeElement;return e instanceof HTMLTextAreaElement||e instanceof HTMLInputElement||e instanceof HTMLSelectElement}function nh(e,t){if(!ih())switch(e){case"ArrowUp":return t.onArrowUp;case"ArrowDown":return t.onArrowDown;case"ArrowLeft":return t.onArrowLeft;case"ArrowRight":return t.onArrowRight}}function oh(e){document.addEventListener("keydown",(t=>{const i=nh(t.key,e);i&&(t.preventDefault(),i())}))}const ah=e=>((0,o.dD)("data-v-4b01faaf"),e=e(),(0,o.Cn)(),e),sh={ref:"dialog"},rh=ah((()=>(0,o._)("div",{class:"dialog-title"},"棋譜解析",-1))),lh={class:"dialog-form-area"},ch=ah((()=>(0,o._)("div",null,"エンジン",-1))),uh={class:"dialog-form-item"},hh=["value"],dh=["value"],ph={class:"dialog-form-area"},mh=ah((()=>(0,o._)("div",null,"開始条件",-1))),gh={class:"dialog-form-item"},_h=["checked"],vh=["disabled","value"],Sh=ah((()=>(0,o._)("div",{class:"dialog-form-item-unit"},"手目から",-1))),Eh={class:"dialog-form-area"},fh=ah((()=>(0,o._)("div",null,"終了条件",-1))),wh={class:"dialog-form-item"},Ih=["checked"],Th=["disabled","value"],yh=ah((()=>(0,o._)("div",{class:"dialog-form-item-unit"},"手目まで",-1))),bh={class:"dialog-form-area"},Nh=ah((()=>(0,o._)("div",null,"局面ごとの終了条件",-1))),Ah={class:"dialog-form-item"},Rh=["value"],Oh=ah((()=>(0,o._)("div",{class:"dialog-form-item-unit"},"秒まで",-1))),Ph={class:"dialog-form-area"},kh=ah((()=>(0,o._)("div",null,"出力設定",-1))),Hh={class:"dialog-form-item"},Ch=ah((()=>(0,o._)("div",{class:"dialog-item-label"},"指し手コメント:",-1))),Mh=["value"],Lh=ah((()=>(0,o._)("option",{value:"none"},"出力しない",-1))),Dh=ah((()=>(0,o._)("option",{value:"insert"},"前方に加筆する",-1))),Bh=ah((()=>(0,o._)("option",{value:"append"},"末尾に加筆する",-1))),Gh=ah((()=>(0,o._)("option",{value:"overwrite"},"上書きする",-1))),xh=[Lh,Dh,Bh,Gh],Kh={class:"dialog-main-buttons"};function Wh(e,t,i,n,a,s){return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("dialog",sh,[rh,(0,o._)("div",lh,[ch,(0,o._)("div",uh,[(0,o._)("select",{ref:"engineSelect",class:"engine-select",size:"1",value:e.defaultValues.engineURI},[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.engines,(e=>((0,o.wg)(),(0,o.iD)("option",{key:e.uri,value:e.uri},(0,z.zw)(e.name),9,dh)))),128))],8,hh)])]),(0,o._)("div",ph,[mh,(0,o._)("div",gh,[(0,o._)("input",{ref:"enableStartNumber",class:"toggle",type:"checkbox",checked:e.defaultValues.enableStartNumber,onChange:t[0]||(t[0]=(...t)=>e.updateToggle&&e.updateToggle(...t))},null,40,_h),(0,o._)("input",{ref:"startNumber",class:"small",type:"number",min:"1",step:"1",disabled:!e.defaultValues.enableStartNumber,value:e.defaultValues.startNumber},null,8,vh),Sh])]),(0,o._)("div",Eh,[fh,(0,o._)("div",wh,[(0,o._)("input",{ref:"enableEndNumber",class:"toggle",type:"checkbox",checked:e.defaultValues.enableEndNumber,onChange:t[1]||(t[1]=(...t)=>e.updateToggle&&e.updateToggle(...t))},null,40,Ih),(0,o._)("input",{ref:"endNumber",class:"small",type:"number",min:"1",step:"1",disabled:!e.defaultValues.enableEndNumber,value:e.defaultValues.endNumber},null,8,Th),yh])]),(0,o._)("div",bh,[Nh,(0,o._)("div",Ah,[(0,o._)("input",{ref:"maxSecondsPerMove",class:"small",type:"number",min:"0",step:"1",value:e.defaultValues.maxSecondsPerMove},null,8,Rh),Oh])]),(0,o._)("div",Ph,[kh,(0,o._)("div",Hh,[Ch,(0,o._)("select",{ref:"commentBehavior",size:"1",value:e.defaultValues.commentBehavior},xh,8,Mh)])]),(0,o._)("div",Kh,[(0,o._)("button",{class:"dialog-button",onClick:t[2]||(t[2]=t=>e.onStart())},"解析実行"),(0,o._)("button",{class:"dialog-button",onClick:t[3]||(t[3]=t=>e.onCancel())},"キャンセル")])],512)])}var Fh=(0,o.aZ)({name:"ResearchDialog",setup(){const e=_o(),t=(0,c.iH)(null),i=(0,c.iH)(null),n=(0,c.iH)(null),a=(0,c.iH)(null),s=(0,c.iH)(null),r=(0,c.iH)(null),l=(0,c.iH)(null),u=(0,c.iH)(null),h=(0,c.iH)(Zi()),d=(0,c.iH)(new xi);e.retainBussyState(),(0,o.bv)((async()=>{pr(t.value);try{h.value=await fn(),d.value=await yn(),e.releaseBussyState()}catch(i){e.pushError(i),e.closeDialog()}}));const p=()=>{a.value.disabled=!n.value.checked,r.value.disabled=!s.value.checked},m=()=>{const t=i.value.value;if(!d.value.hasEngine(t))return void e.pushError("エンジンを選択してください。");const o=d.value.getEngine(t),c={usi:o,startCriteria:{enableNumber:n.value.checked,number:gr(a.value)},endCriteria:{enableNumber:s.value.checked,number:gr(r.value)},perMoveCriteria:{maxSeconds:gr(l.value)},commentBehavior:u.value.value};e.startAnalysis(c)},g=()=>{e.closeDialog()},_=(0,o.Fl)((()=>d.value.engineList)),v=(0,o.Fl)((()=>({engineURI:h.value.usi?h.value.usi.uri:"",enableStartNumber:h.value.startCriteria.enableNumber,startNumber:h.value.startCriteria.number,enableEndNumber:h.value.endCriteria.enableNumber,endNumber:h.value.endCriteria.number,maxSecondsPerMove:h.value.perMoveCriteria.maxSeconds,commentBehavior:h.value.commentBehavior})));return{dialog:t,enableStartNumber:n,engineSelect:i,startNumber:a,enableEndNumber:s,endNumber:r,maxSecondsPerMove:l,commentBehavior:u,engines:_,defaultValues:v,updateToggle:p,onStart:m,onCancel:g}}});const Uh=(0,Oi.Z)(Fh,[["render",Wh],["__scopeId","data-v-4b01faaf"]]);var qh=Uh,Vh=(0,o.aZ)({name:"App",components:{StandardLayout:Is,GameDialog:Sr,ResearchDialog:kr,USIEngineManagementDialog:Al,AppSettingDialog:nu,PasteDialog:fu,BussyMessage:Ru,ConfirmDialog:Du,InfoMessage:qu,ErrorMessage:th,AnalysisDialog:qh},setup(){const e=_o(),t=(0,o.Fl)((()=>({game:e.appState===Qn.GAME_DIALOG,research:e.appState===Qn.RESEARCH_DIALOG,analysis:e.appState===Qn.ANALYSIS_DIALOG,usiEngineSetting:e.appState===Qn.USI_ENGINE_SETTING_DIALOG,appSetting:e.displayAppSetting,paste:e.appState===Qn.PASTE_DIALOG,bussy:e.isBussy,confirm:void 0!==e.confirmation}))),i=(0,o.Fl)((()=>e.hasMessage)),n=(0,o.Fl)((()=>e.hasError));return(0,o.bv)((()=>{const t=document.getElementsByTagName("body")[0];t.addEventListener("copy",(t=>{e.copyRecordKIF(),t.preventDefault()})),t.addEventListener("paste",(t=>{e.showPasteDialog(),t.preventDefault()})),t.addEventListener("dragover",(e=>{e.preventDefault()})),t.addEventListener("drop",(t=>{if(t.dataTransfer&&t.dataTransfer.files[0]){const i=t.dataTransfer.files[0].path;e.openRecord(i)}t.preventDefault()})),oh({onArrowUp(){const t=e.record.current.number;e.changeMoveNumber(t-1)},onArrowDown(){const t=e.record.current.number;e.changeMoveNumber(t+1)},onArrowLeft(){e.changeMoveNumber(0)},onArrowRight(){e.changeMoveNumber(Number.MAX_SAFE_INTEGER)}})})),{dialogVisibilities:t,hasMessage:i,hasErrors:n}}});const Zh=(0,Oi.Z)(Vh,[["render",a]]);var zh=Zh;Ln(qi.INFO,"start renderer process"),is.kL.register(...is.zX),Dn();const jh=_o();Promise.allSettled([_n().then((e=>{jh.updateAppSetting(e)})).catch((e=>{jh.pushError(new Error("アプリ設定の読み込み中にエラーが発生しました :"+e))})),async function(){const e=await un();e&&jh.openRecord(e)}()]).finally((()=>{Ln(qi.INFO,"mount app"),(0,n.ri)(zh).mount("#app")}))},5832:function(){}},t={};function i(n){var o=t[n];if(void 0!==o)return o.exports;var a=t[n]={exports:{}};return e[n](a,a.exports,i),a.exports}i.m=e,function(){var e=[];i.O=function(t,n,o,a){if(!n){var s=1/0;for(u=0;u<e.length;u++){n=e[u][0],o=e[u][1],a=e[u][2];for(var r=!0,l=0;l<n.length;l++)(!1&a||s>=a)&&Object.keys(i.O).every((function(e){return i.O[e](n[l])}))?n.splice(l--,1):(r=!1,a<s&&(s=a));if(r){e.splice(u--,1);var c=o();void 0!==c&&(t=c)}}return t}a=a||0;for(var u=e.length;u>0&&e[u-1][2]>a;u--)e[u]=e[u-1];e[u]=[n,o,a]}}(),function(){i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,{a:t}),t}}(),function(){i.d=function(e,t){for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}}(),function(){i.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={826:0};i.O.j=function(t){return 0===e[t]};var t=function(t,n){var o,a,s=n[0],r=n[1],l=n[2],c=0;if(s.some((function(t){return 0!==e[t]}))){for(o in r)i.o(r,o)&&(i.m[o]=r[o]);if(l)var u=l(i)}for(t&&t(n);c<s.length;c++)a=s[c],i.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return i.O(u)},n=self["webpackChunkelectron_shogi"]=self["webpackChunkelectron_shogi"]||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))}();var n=i.O(void 0,[998],(function(){return i(3525)}));n=i.O(n)})();
//# sourceMappingURL=index.0a3cffe8.js.map