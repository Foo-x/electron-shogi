(function(){var e={2508:function(e,t,i){"use strict";i(1703);var n=i(9963),o=i(6252);function a(e,t,i,n,a,s){const r=(0,o.up)("StandardLayout"),c=(0,o.up)("GameDialog"),l=(0,o.up)("ResearchDialog"),u=(0,o.up)("USIEngineManagementDialog"),d=(0,o.up)("AppSettingDialog"),h=(0,o.up)("PasteDialog"),p=(0,o.up)("BussyMessage"),m=(0,o.up)("InfoMessage"),_=(0,o.up)("ErrorMessage");return(0,o.wg)(),(0,o.iD)(o.HY,null,[(0,o.Wm)(r,{class:"main"}),e.dialogVisibilities.game?((0,o.wg)(),(0,o.j4)(c,{key:0})):(0,o.kq)("",!0),e.dialogVisibilities.research?((0,o.wg)(),(0,o.j4)(l,{key:1})):(0,o.kq)("",!0),e.dialogVisibilities.usiEngineSetting?((0,o.wg)(),(0,o.j4)(u,{key:2})):(0,o.kq)("",!0),e.dialogVisibilities.appSetting?((0,o.wg)(),(0,o.j4)(d,{key:3})):(0,o.kq)("",!0),e.dialogVisibilities.paste?((0,o.wg)(),(0,o.j4)(h,{key:4})):(0,o.kq)("",!0),e.dialogVisibilities.processing?((0,o.wg)(),(0,o.j4)(p,{key:5})):(0,o.kq)("",!0),e.hasMessage?((0,o.wg)(),(0,o.j4)(m,{key:6})):(0,o.kq)("",!0),e.hasErrors?((0,o.wg)(),(0,o.j4)(_,{key:7})):(0,o.kq)("",!0)],64)}const s={class:"main"},r={ref:"topPane",class:"top-pane"};function c(e,t,i,n,a,c){const l=(0,o.up)("BoardPane"),u=(0,o.up)("RecordPane"),d=(0,o.up)("InformationPane");return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("div",s,[(0,o._)("div",r,[(0,o.Wm)(l,{class:"top-left-pane","max-size":e.boardPaneMaxSize},null,8,["max-size"]),(0,o.Wm)(u,{class:"top-right-pane"})],512),(0,o.Wm)(d,{class:"bottom-pane",size:e.bottomPaneSize},null,8,["size"])])])}var l=i(2262);const u={class:"control top"},d=(0,o.Uk)(" 対局 "),h=(0,o.Uk)(" 中断 "),p=(0,o.Uk)(" 投了 "),m=(0,o.Uk)(" 検討 "),_=(0,o.Uk)(" 検討終了 "),g=(0,o.Uk)(" 局面編集 "),E=(0,o.Uk)(" 局面編集終了 "),S=(0,o.Uk)(" 手番変更 "),v={class:"control bottom"},f=["disabled"],I=(0,o.Uk)(" アプリ設定 "),w=["disabled"],T=(0,o.Uk)(" エンジン設定 "),O=(0,o.Uk)(" 盤面反転 "),A=["disabled"],N=(0,o.Uk)(" 棋譜貼り付け "),R=(0,o.Uk)(" 棋譜コピー "),P=(0,o.Uk)(" 指し手削除 ");function y(e,t,i,n,a,s){const r=(0,o.up)("ButtonIcon"),c=(0,o.up)("BoardView");return(0,o.wg)(),(0,o.iD)("div",null,[(0,o.Wm)(c,{"layout-type":e.layout,"max-size":e.maxSize,position:e.position,"last-move":e.lastMove,flip:e.flip,"allow-move":e.allowMove,"allow-edit":e.allowEdit,"black-player-name":e.blackPlayerName,"white-player-name":e.whitePlayerName,"black-player-time-ms":e.blackPlayerTimeMs,"black-player-byoyomi":e.blackPlayerByoyomi,"white-player-time-ms":e.whitePlayerTimeMs,"white-player-byoyomi":e.whitePlayerByoyomi,onMove:e.onMove,onEdit:e.onEdit},{"right-control":(0,o.w5)((()=>[(0,o._)("div",u,[e.controlStates.game?((0,o.wg)(),(0,o.iD)("button",{key:0,onClick:t[0]||(t[0]=(...t)=>e.onGame&&e.onGame(...t))},[(0,o.Wm)(r,{class:"icon",icon:"game"}),d])):(0,o.kq)("",!0),e.controlStates.stop?((0,o.wg)(),(0,o.iD)("button",{key:1,onClick:t[1]||(t[1]=(...t)=>e.onStop&&e.onStop(...t))},[(0,o.Wm)(r,{class:"icon",icon:"stop"}),h])):(0,o.kq)("",!0),e.controlStates.resign?((0,o.wg)(),(0,o.iD)("button",{key:2,onClick:t[2]||(t[2]=(...t)=>e.onResign&&e.onResign(...t))},[(0,o.Wm)(r,{class:"icon",icon:"resign"}),p])):(0,o.kq)("",!0),e.controlStates.research?((0,o.wg)(),(0,o.iD)("button",{key:3,onClick:t[3]||(t[3]=(...t)=>e.onResearch&&e.onResearch(...t))},[(0,o.Wm)(r,{class:"icon",icon:"research"}),m])):(0,o.kq)("",!0),e.controlStates.endResearch?((0,o.wg)(),(0,o.iD)("button",{key:4,onClick:t[4]||(t[4]=(...t)=>e.onEndResearch&&e.onEndResearch(...t))},[(0,o.Wm)(r,{class:"icon",icon:"end"}),_])):(0,o.kq)("",!0),e.controlStates.startEditPosition?((0,o.wg)(),(0,o.iD)("button",{key:5,onClick:t[5]||(t[5]=(...t)=>e.onStartEditPosition&&e.onStartEditPosition(...t))},[(0,o.Wm)(r,{class:"icon",icon:"edit"}),g])):(0,o.kq)("",!0),e.controlStates.endEditPosition?((0,o.wg)(),(0,o.iD)("button",{key:6,onClick:t[6]||(t[6]=(...t)=>e.onEndEditPosition&&e.onEndEditPosition(...t))},[(0,o.Wm)(r,{class:"icon",icon:"check"}),E])):(0,o.kq)("",!0),e.controlStates.initPosition?((0,o.wg)(),(0,o.iD)("button",{key:7,onClick:t[7]||(t[7]=(...t)=>e.onChangeTurn&&e.onChangeTurn(...t))},[(0,o.Wm)(r,{class:"icon",icon:"swap"}),S])):(0,o.kq)("",!0),e.controlStates.initPosition?((0,o.wg)(),(0,o.iD)("button",{key:8,onClick:t[8]||(t[8]=(...t)=>e.onInitPositionStandard&&e.onInitPositionStandard(...t))}," 平手 ")):(0,o.kq)("",!0),e.controlStates.initPosition?((0,o.wg)(),(0,o.iD)("button",{key:9,onClick:t[9]||(t[9]=(...t)=>e.onInitPositionTsumeShogi&&e.onInitPositionTsumeShogi(...t))}," 詰将棋 ")):(0,o.kq)("",!0)])])),"left-control":(0,o.w5)((()=>[(0,o._)("div",v,[(0,o._)("button",{disabled:!e.controlStates.appSettings,onClick:t[10]||(t[10]=(...t)=>e.onOpenAppSettings&&e.onOpenAppSettings(...t))},[(0,o.Wm)(r,{class:"icon",icon:"settings"}),I],8,f),(0,o._)("button",{disabled:!e.controlStates.engineSettings,onClick:t[11]||(t[11]=(...t)=>e.onOpenEngineSettings&&e.onOpenEngineSettings(...t))},[(0,o.Wm)(r,{class:"icon",icon:"engineSettings"}),T],8,w),(0,o._)("button",{onClick:t[12]||(t[12]=(...t)=>e.onFlip&&e.onFlip(...t))},[(0,o.Wm)(r,{class:"icon",icon:"flip"}),O]),(0,o._)("button",{disabled:!e.controlStates.paste,onClick:t[13]||(t[13]=(...t)=>e.onPaste&&e.onPaste(...t))},[(0,o.Wm)(r,{class:"icon",icon:"paste"}),N],8,A),(0,o._)("button",{onClick:t[14]||(t[14]=(...t)=>e.onCopy&&e.onCopy(...t))},[(0,o.Wm)(r,{class:"icon",icon:"copy"}),R]),(0,o._)("button",{onClick:t[15]||(t[15]=(...t)=>e.onRemoveAfter&&e.onRemoveAfter(...t))},[(0,o.Wm)(r,{class:"icon",icon:"delete"}),P])])])),_:1},8,["layout-type","max-size","position","last-move","flip","allow-move","allow-edit","black-player-name","white-player-name","black-player-time-ms","black-player-byoyomi","white-player-time-ms","white-player-byoyomi","onMove","onEdit"])])}var b=i(3577);const H=["src"],k={class:"player-name-text"},C={class:"clock-text"},D={class:"player-name-text"},L={class:"clock-text"},M=["src"],G=["onClick","onContextmenu"],B=["src"],x=["onClick"],U=["src"],K=["onClick"],W=["src"],q=["src"];function F(e,t,i,n,a,s){return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("div",{class:"frame",style:(0,b.j5)(e.layout.frame.style),onClick:t[2]||(t[2]=t=>e.clickFrame())},[(0,o._)("div",{class:"board",style:(0,b.j5)(e.layout.board.style)},[(0,o._)("img",{class:"board-image",src:e.layout.board.imagePath},null,8,H)],4),(0,o._)("div",{class:(0,b.C_)(["player-name",{active:"black"==e.position.color}]),style:(0,b.j5)(e.layout.blackPlayerName.style)},[(0,o._)("span",k,"▲"+(0,b.zw)(e.blackPlayerName),1)],6),(0,o._)("div",{class:(0,b.C_)(["clock",e.blackPlayerTimeSeverity]),style:(0,b.j5)(e.layout.blackClock.style)},[(0,o._)("span",C,(0,b.zw)(e.blackPlayerTimeText),1)],6),(0,o._)("div",{class:(0,b.C_)(["player-name",{active:"white"==e.position.color}]),style:(0,b.j5)(e.layout.whitePlayerName.style)},[(0,o._)("span",D,"△"+(0,b.zw)(e.whitePlayerName),1)],6),(0,o._)("div",{class:(0,b.C_)(["clock",e.whitePlayerTimeSeverity]),style:(0,b.j5)(e.layout.whiteClock.style)},[(0,o._)("span",L,(0,b.zw)(e.whitePlayerTimeText),1)],6),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.layout.square,(e=>((0,o.wg)(),(0,o.iD)("div",{key:e.id,class:"square",style:(0,b.j5)(e.backgroundStyle)},null,4)))),128)),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.layout.piece,(e=>((0,o.wg)(),(0,o.iD)("div",{key:e.id,class:"piece",style:(0,b.j5)(e.style)},[(0,o._)("img",{class:"piece-image",src:e.imagePath},null,8,M)],4)))),128)),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.layout.square,(t=>((0,o.wg)(),(0,o.iD)("div",{key:t.id,class:"square",style:(0,b.j5)(t.style),onClick:i=>e.clickSquare(i,t.file,t.rank),onContextmenu:i=>e.clickSquareR(i,t.file,t.rank)},null,44,G)))),128)),(0,o._)("div",{class:"hand",style:(0,b.j5)(e.layout.blackHand.style)},[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.layout.blackHand.pointers,(e=>((0,o.wg)(),(0,o.iD)("div",{key:e.id,class:"hand-pointer",style:(0,b.j5)(e.backgroundStyle)},null,4)))),128)),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.layout.blackHand.pieces,(e=>((0,o.wg)(),(0,o.iD)("div",{key:e.id,class:"piece",style:(0,b.j5)(e.style)},[(0,o._)("img",{class:"piece-image",src:e.imagePath},null,8,B)],4)))),128)),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.layout.blackHand.pointers,(t=>((0,o.wg)(),(0,o.iD)("div",{key:t.id,class:"hand-pointer",style:(0,b.j5)(t.style),onClick:i=>e.clickHand(i,"black",t.type)},null,12,x)))),128))],4),(0,o._)("div",{class:"hand",style:(0,b.j5)(e.layout.whiteHand.style)},[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.layout.whiteHand.pointers,(e=>((0,o.wg)(),(0,o.iD)("div",{key:e.id,class:"hand-pointer",style:(0,b.j5)(e.backgroundStyle)},null,4)))),128)),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.layout.whiteHand.pieces,(e=>((0,o.wg)(),(0,o.iD)("div",{key:e.id,class:"piece",style:(0,b.j5)(e.style)},[(0,o._)("img",{class:"piece-image",src:e.imagePath},null,8,U)],4)))),128)),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.layout.whiteHand.pointers,(t=>((0,o.wg)(),(0,o.iD)("div",{key:t.id,class:"hand-pointer",style:(0,b.j5)(t.style),onClick:i=>e.clickHand(i,"white",t.type)},null,12,K)))),128))],4),e.layout.promotion?((0,o.wg)(),(0,o.iD)("div",{key:0,class:"promotion-selector",style:(0,b.j5)(e.layout.promotion.style)},[(0,o._)("div",{class:"select-button promote",onClick:t[0]||(t[0]=t=>e.clickPromote(t))},[(0,o._)("img",{class:"piece-image",src:e.layout.promotion.promoteImagePath},null,8,W)]),(0,o._)("div",{class:"select-button not-promote",onClick:t[1]||(t[1]=t=>e.clickNotPromote(t))},[(0,o._)("img",{class:"piece-image",src:e.layout.promotion.notPromoteImagePath},null,8,q)])],4)):(0,o.kq)("",!0),(0,o._)("div",{class:"turn",style:(0,b.j5)(e.layout.turn.style)},"手番",4),(0,o._)("div",{style:(0,b.j5)(e.layout.control.left.style)},[(0,o.WI)(e.$slots,"left-control",{},void 0,!0)],4),(0,o._)("div",{style:(0,b.j5)(e.layout.control.right.style)},[(0,o.WI)(e.$slots,"right-control",{},void 0,!0)],4)],4)])}i(7686),i(4506);var V,j,Y=i(2482);function Z(e){return e===V.BLACK?V.WHITE:V.BLACK}function z(e){return e===V.BLACK?"b":"w"}function J(e){return"b"===e||"w"===e}function $(e){return"b"===e?V.BLACK:V.WHITE}(function(e){e["BLACK"]="black",e["WHITE"]="white"})(V||(V={})),function(e){e["PAWN"]="pawn",e["LANCE"]="lance",e["KNIGHT"]="knight",e["SILVER"]="silver",e["GOLD"]="gold",e["BISHOP"]="bishop",e["ROOK"]="rook",e["KING"]="king",e["PROM_PAWN"]="promPawn",e["PROM_LANCE"]="promLance",e["PROM_KNIGHT"]="promKnight",e["PROM_SILVER"]="promSilver",e["HORSE"]="horse",e["DRAGON"]="dragon"}(j||(j={}));const X={pawn:"歩",lance:"香",knight:"桂",silver:"銀",gold:"金",bishop:"角",rook:"飛",king:"玉",promPawn:"と",promLance:"成香",promKnight:"成桂",promSilver:"成銀",horse:"馬",dragon:"竜"};function Q(e){const t=X[e];return t||""}j.PAWN,j.LANCE,j.KNIGHT,j.SILVER,j.GOLD,j.BISHOP,j.ROOK,j.KING,j.PROM_PAWN,j.PROM_LANCE,j.PROM_KNIGHT,j.PROM_SILVER,j.HORSE,j.DRAGON;const ee=[j.PAWN,j.LANCE,j.KNIGHT,j.SILVER,j.GOLD,j.BISHOP,j.ROOK],te={pawn:!0,lance:!0,knight:!0,silver:!0,gold:!1,bishop:!0,rook:!0,king:!1,promPawn:!1,promLance:!1,promKnight:!1,promSilver:!1,horse:!1,dragon:!1},ie={pawn:j.PROM_PAWN,lance:j.PROM_LANCE,knight:j.PROM_KNIGHT,silver:j.PROM_SILVER,bishop:j.HORSE,rook:j.DRAGON},ne={promPawn:j.PAWN,promLance:j.LANCE,promKnight:j.KNIGHT,promSilver:j.SILVER,horse:j.BISHOP,dragon:j.ROOK},oe={pawn:"P",lance:"L",knight:"N",silver:"S",gold:"G",bishop:"B",rook:"R",king:"K",promPawn:"+P",promLance:"+L",promKnight:"+N",promSilver:"+S",horse:"+B",dragon:"+R"};function ae(e){return oe[e]}const se={pawn:"p",lance:"l",knight:"n",silver:"s",gold:"g",bishop:"b",rook:"r",king:"k",promPawn:"+p",promLance:"+l",promKnight:"+n",promSilver:"+s",horse:"+b",dragon:"+r"},re={P:j.PAWN,L:j.LANCE,N:j.KNIGHT,S:j.SILVER,G:j.GOLD,B:j.BISHOP,R:j.ROOK,K:j.KING,"+P":j.PROM_PAWN,"+L":j.PROM_LANCE,"+N":j.PROM_KNIGHT,"+S":j.PROM_SILVER,"+B":j.HORSE,"+R":j.DRAGON,p:j.PAWN,l:j.LANCE,n:j.KNIGHT,s:j.SILVER,g:j.GOLD,b:j.BISHOP,r:j.ROOK,k:j.KING,"+p":j.PROM_PAWN,"+l":j.PROM_LANCE,"+n":j.PROM_KNIGHT,"+s":j.PROM_SILVER,"+b":j.HORSE,"+r":j.DRAGON},ce={P:V.BLACK,L:V.BLACK,N:V.BLACK,S:V.BLACK,G:V.BLACK,B:V.BLACK,R:V.BLACK,K:V.BLACK,"+P":V.BLACK,"+L":V.BLACK,"+N":V.BLACK,"+S":V.BLACK,"+B":V.BLACK,"+R":V.BLACK,p:V.WHITE,l:V.WHITE,n:V.WHITE,s:V.WHITE,g:V.WHITE,b:V.WHITE,r:V.WHITE,k:V.WHITE,"+p":V.WHITE,"+l":V.WHITE,"+n":V.WHITE,"+s":V.WHITE,"+b":V.WHITE,"+r":V.WHITE},le=new Map;le.set(j.PAWN,{type:j.PROM_PAWN,reverseColor:!1}),le.set(j.LANCE,{type:j.PROM_LANCE,reverseColor:!1}),le.set(j.KNIGHT,{type:j.PROM_KNIGHT,reverseColor:!1}),le.set(j.SILVER,{type:j.PROM_SILVER,reverseColor:!1}),le.set(j.GOLD,{type:j.GOLD,reverseColor:!0}),le.set(j.BISHOP,{type:j.HORSE,reverseColor:!1}),le.set(j.ROOK,{type:j.DRAGON,reverseColor:!1}),le.set(j.KING,{type:j.KING,reverseColor:!0}),le.set(j.PROM_PAWN,{type:j.PAWN,reverseColor:!0}),le.set(j.PROM_LANCE,{type:j.LANCE,reverseColor:!0}),le.set(j.PROM_KNIGHT,{type:j.KNIGHT,reverseColor:!0}),le.set(j.PROM_SILVER,{type:j.SILVER,reverseColor:!0}),le.set(j.HORSE,{type:j.BISHOP,reverseColor:!0}),le.set(j.DRAGON,{type:j.ROOK,reverseColor:!0});class ue{constructor(e,t){(0,Y.Z)(this,"color",void 0),(0,Y.Z)(this,"type",void 0),this.type=t,this.color=e}black(){return this.withColor(V.BLACK)}white(){return this.withColor(V.WHITE)}withColor(e){return new ue(e,this.type)}equals(e){return this.type===e.type&&this.color===e.color}promoted(){const e=ie[this.type];return new ue(this.color,e||this.type)}unpromoted(){const e=ne[this.type];return new ue(this.color,e||this.type)}isPromotable(){return!!te[this.type]}rotate(){const e=le.get(this.type),t=new ue(this.color,e?e.type:this.type);return e&&e.reverseColor&&(t.color=Z(this.color)),t}get id(){return this.color+"_"+this.type}get sfen(){switch(this.color){default:case V.BLACK:return oe[this.type];case V.WHITE:return se[this.type]}}static isValidSFEN(e){return!!re[e]}static newBySFEN(e){const t=re[e];if(!t)return null;const i=ce[e];return i?new ue(i,t):null}}var de;(function(e){e["UP"]="up",e["DOWN"]="down",e["LEFT"]="left",e["RIGHT"]="right",e["LEFT_UP"]="left_up",e["RIGHT_UP"]="right_up",e["LEFT_DOWN"]="left_down",e["RIGHT_DOWN"]="right_down",e["LEFT_UP_KNIGHT"]="left_up_knight",e["RIGHT_UP_KNIGHT"]="right_up_knight",e["LEFT_DOWN_KNIGHT"]="left_down_knight",e["RIGHT_DOWN_KNIGHT"]="right_down_knight"})(de||(de={}));const he={up:de.DOWN,down:de.UP,left:de.RIGHT,right:de.LEFT,left_up:de.RIGHT_DOWN,right_up:de.LEFT_DOWN,left_down:de.RIGHT_UP,right_down:de.LEFT_UP,left_up_knight:de.RIGHT_DOWN_KNIGHT,right_up_knight:de.LEFT_DOWN_KNIGHT,left_down_knight:de.RIGHT_UP_KNIGHT,right_down_knight:de.LEFT_UP_KNIGHT};function pe(e){return he[e]}const me=[de.UP,de.DOWN,de.LEFT,de.RIGHT,de.LEFT_UP,de.RIGHT_UP,de.LEFT_DOWN,de.RIGHT_DOWN,de.LEFT_UP_KNIGHT,de.RIGHT_UP_KNIGHT,de.LEFT_DOWN_KNIGHT,de.RIGHT_DOWN_KNIGHT];var _e;(function(e){e["SHORT"]="short",e["LONG"]="long"})(_e||(_e={}));const ge={black:{pawn:{up:_e.SHORT},lance:{up:_e.LONG},knight:{left_up_knight:_e.SHORT,right_up_knight:_e.SHORT},silver:{left_up:_e.SHORT,up:_e.SHORT,right_up:_e.SHORT,left_down:_e.SHORT,right_down:_e.SHORT},gold:{left_up:_e.SHORT,up:_e.SHORT,right_up:_e.SHORT,left:_e.SHORT,right:_e.SHORT,down:_e.SHORT},bishop:{left_up:_e.LONG,right_up:_e.LONG,left_down:_e.LONG,right_down:_e.LONG},rook:{up:_e.LONG,left:_e.LONG,right:_e.LONG,down:_e.LONG},king:{left_down:_e.SHORT,right_down:_e.SHORT,left_up:_e.SHORT,right_up:_e.SHORT,down:_e.SHORT,left:_e.SHORT,right:_e.SHORT,up:_e.SHORT},promPawn:{left_up:_e.SHORT,up:_e.SHORT,right_up:_e.SHORT,left:_e.SHORT,right:_e.SHORT,down:_e.SHORT},promLance:{left_up:_e.SHORT,up:_e.SHORT,right_up:_e.SHORT,left:_e.SHORT,right:_e.SHORT,down:_e.SHORT},promKnight:{left_up:_e.SHORT,up:_e.SHORT,right_up:_e.SHORT,left:_e.SHORT,right:_e.SHORT,down:_e.SHORT},promSilver:{left_up:_e.SHORT,up:_e.SHORT,right_up:_e.SHORT,left:_e.SHORT,right:_e.SHORT,down:_e.SHORT},horse:{left_up:_e.LONG,right_up:_e.LONG,left_down:_e.LONG,right_down:_e.LONG,up:_e.SHORT,left:_e.SHORT,right:_e.SHORT,down:_e.SHORT},dragon:{up:_e.LONG,left:_e.LONG,right:_e.LONG,down:_e.LONG,left_up:_e.SHORT,right_up:_e.SHORT,left_down:_e.SHORT,right_down:_e.SHORT}},white:{pawn:{down:_e.SHORT},lance:{down:_e.LONG},knight:{left_down_knight:_e.SHORT,right_down_knight:_e.SHORT},silver:{left_down:_e.SHORT,down:_e.SHORT,right_down:_e.SHORT,left_up:_e.SHORT,right_up:_e.SHORT},gold:{left_down:_e.SHORT,down:_e.SHORT,right_down:_e.SHORT,left:_e.SHORT,right:_e.SHORT,up:_e.SHORT},bishop:{left_down:_e.LONG,right_down:_e.LONG,left_up:_e.LONG,right_up:_e.LONG},rook:{down:_e.LONG,left:_e.LONG,right:_e.LONG,up:_e.LONG},king:{left_down:_e.SHORT,right_down:_e.SHORT,left_up:_e.SHORT,right_up:_e.SHORT,down:_e.SHORT,left:_e.SHORT,right:_e.SHORT,up:_e.SHORT},promPawn:{left_down:_e.SHORT,down:_e.SHORT,right_down:_e.SHORT,left:_e.SHORT,right:_e.SHORT,up:_e.SHORT},promLance:{left_down:_e.SHORT,down:_e.SHORT,right_down:_e.SHORT,left:_e.SHORT,right:_e.SHORT,up:_e.SHORT},promKnight:{left_down:_e.SHORT,down:_e.SHORT,right_down:_e.SHORT,left:_e.SHORT,right:_e.SHORT,up:_e.SHORT},promSilver:{left_down:_e.SHORT,down:_e.SHORT,right_down:_e.SHORT,left:_e.SHORT,right:_e.SHORT,up:_e.SHORT},horse:{left_down:_e.LONG,right_down:_e.LONG,left_up:_e.LONG,right_up:_e.LONG,down:_e.SHORT,left:_e.SHORT,right:_e.SHORT,up:_e.SHORT},dragon:{down:_e.LONG,left:_e.LONG,right:_e.LONG,up:_e.LONG,left_down:_e.SHORT,right_down:_e.SHORT,left_up:_e.SHORT,right_up:_e.SHORT}}};function Ee(e){return Object.keys(ge[e.color][e.type])}function Se(e,t){return ge[e.color][e.type][t]}const ve={up:{x:0,y:-1},down:{x:0,y:1},left:{x:-1,y:0},right:{x:1,y:0},left_up:{x:-1,y:-1},right_up:{x:1,y:-1},left_down:{x:-1,y:1},right_down:{x:1,y:1},left_up_knight:{x:-1,y:-2},right_up_knight:{x:1,y:-2},left_down_knight:{x:-1,y:2},right_down_knight:{x:1,y:2}};function fe(e,t){if(1===e&&-2===t)return{direction:de.RIGHT_UP_KNIGHT,distance:1,ok:!0};if(-1===e&&-2===t)return{direction:de.LEFT_UP_KNIGHT,distance:1,ok:!0};if(1===e&&2===t)return{direction:de.RIGHT_DOWN_KNIGHT,distance:1,ok:!0};if(-1===e&&2===t)return{direction:de.LEFT_DOWN_KNIGHT,distance:1,ok:!0};if(0!==e&&0!==t&&Math.abs(e)!==Math.abs(t))return{direction:"",distance:0,ok:!1};let i=e,n=t,o=0;return 0!==i&&(o=Math.abs(i),i/=o),0!==n&&(o=Math.abs(n),n/=o),-1===i&&-1===n?{direction:de.LEFT_UP,distance:o,ok:!0}:0===i&&-1===n?{direction:de.UP,distance:o,ok:!0}:1===i&&-1===n?{direction:de.RIGHT_UP,distance:o,ok:!0}:-1===i&&0===n?{direction:de.LEFT,distance:o,ok:!0}:1===i&&0===n?{direction:de.RIGHT,distance:o,ok:!0}:-1===i&&1===n?{direction:de.LEFT_DOWN,distance:o,ok:!0}:0===i&&1===n?{direction:de.DOWN,distance:o,ok:!0}:1===i&&1===n?{direction:de.RIGHT_DOWN,distance:o,ok:!0}:{direction:"",distance:0,ok:!1}}function Ie(e){switch(e){case"1":return 1;case"2":return 2;case"3":return 3;case"4":return 4;case"5":return 5;case"6":return 6;case"7":return 7;case"8":return 8;case"9":return 9;default:return null}}function we(e){switch(e){case"a":return 1;case"b":return 2;case"c":return 3;case"d":return 4;case"e":return 5;case"f":return 6;case"g":return 7;case"h":return 8;case"i":return 9;default:return null}}const Te=["a","b","c","d","e","f","g","h","i"];class Oe{constructor(e,t){(0,Y.Z)(this,"file",void 0),(0,Y.Z)(this,"rank",void 0),this.file=e,this.rank=t}get x(){return 9-this.file}get y(){return this.rank-1}get index(){return 9*this.y+this.x}get opposite(){return new Oe(10-this.file,10-this.rank)}neighbor(e,t){switch(e){case de.UP:return new Oe(this.file,this.rank-1);case de.DOWN:return new Oe(this.file,this.rank+1);case de.LEFT:return new Oe(this.file+1,this.rank);case de.RIGHT:return new Oe(this.file-1,this.rank);case de.LEFT_UP:return new Oe(this.file+1,this.rank-1);case de.RIGHT_UP:return new Oe(this.file-1,this.rank-1);case de.LEFT_DOWN:return new Oe(this.file+1,this.rank+1);case de.RIGHT_DOWN:return new Oe(this.file-1,this.rank+1);case de.LEFT_UP_KNIGHT:return new Oe(this.file+1,this.rank-2);case de.RIGHT_UP_KNIGHT:return new Oe(this.file-1,this.rank-2);case de.LEFT_DOWN_KNIGHT:return new Oe(this.file+1,this.rank+2);case de.RIGHT_DOWN_KNIGHT:return new Oe(this.file-1,this.rank+2)}const i=e,n=t;return new Oe(this.file-i,this.rank+n)}get valid(){return this.file>=1&&this.file<=9&&this.rank>=1&&this.rank<=9}equals(e){return!!e&&this.file===e.file&&this.rank===e.rank}static newByXY(e,t){return new Oe(9-e,t+1)}static newByIndex(e){return new Oe(9-e%9,Math.trunc(e/9)+1)}get sfen(){return this.file+Te[this.rank-1]}static parseSFENSquare(e){const t=Ie(e[0]),i=we(e[1]);return t&&i?new Oe(t,i):null}}(0,Y.Z)(Oe,"all",[]);for(let Pc=0;Pc<81;Pc+=1)Oe.all.push(Oe.newByIndex(Pc));const Ae=["１","２","３","４","５","６","７","８","９"],Ne=["一","二","三","四","五","六","七","八","九"];class Re{constructor(e,t,i,n,o,a){(0,Y.Z)(this,"from",void 0),(0,Y.Z)(this,"to",void 0),(0,Y.Z)(this,"promote",void 0),(0,Y.Z)(this,"color",void 0),(0,Y.Z)(this,"pieceType",void 0),(0,Y.Z)(this,"capturedPieceType",void 0),this.from=e,this.to=t,this.promote=i,this.color=n,this.pieceType=o,this.capturedPieceType=a}equals(e){return!!e&&((this.from instanceof Oe&&e.from instanceof Oe&&this.from.equals(e.from)||!(this.from instanceof Oe)&&!(e.from instanceof Oe)&&this.from===e.from)&&this.to.equals(e.to)&&this.promote===e.promote&&this.color===e.color&&this.pieceType===e.pieceType&&this.capturedPieceType===e.capturedPieceType)}withPromote(){return new Re(this.from,this.to,!0,this.color,this.pieceType,this.capturedPieceType)}getDisplayText(e){let t="";if(t+=this.color===V.BLACK?"▲":"△",e&&e.to.equals(this.to)?t+="同":(t+=Ae[this.to.file-1],t+=Ne[this.to.rank-1]),t+=Q(this.pieceType),this.promote&&(t+="成"),this.from instanceof Oe){const e=this.from;t+=` (${e.file}${e.rank})`}else t+="打";return t}get sfen(){let e="";return this.from instanceof Oe?e+=this.from.sfen:e+=ae(this.from)+"*",e+=this.to.sfen,this.promote&&(e+="+"),e}}function Pe(e){let t;if("*"===e[1]){const i=ue.newBySFEN(e[0]);if(!i)return null;t=i.type}else{const i=Oe.parseSFENSquare(e);if(!i)return null;t=i}const i=Oe.parseSFENSquare(e.substring(2));if(!i)return null;const n=e.length>=5&&"+"===e[4];return{from:t,to:i,promote:n}}var ye;function be(e){switch(e){case"1":return 1;case"2":return 2;case"3":return 3;case"4":return 4;case"5":return 5;case"6":return 6;case"7":return 7;case"8":return 8;case"9":return 9;default:return null}}(function(e){e["STANDARD"]="standard",e["EMPTY"]="empty",e["HANDICAP_LANCE"]="handicapLance",e["HANDICAP_RIGHT_LANCE"]="handicapRightLance",e["HANDICAP_BISHOP"]="handicapBishop",e["HANDICAP_ROOK"]="handicapRook",e["HANDICAP_ROOK_LANCE"]="handicapRookLance",e["HANDICAP_2PIECES"]="handicap2Pieces",e["HANDICAP_4PIECES"]="handicap4Pieces",e["HANDICAP_6PIECES"]="handicap6Pieces",e["HANDICAP_8PIECES"]="handicap8Pieces",e["TSUME_SHOGI"]="tsumeShogi"})(ye||(ye={}));class He{constructor(){(0,Y.Z)(this,"squares",void 0),this.squares=new Array;for(let e=0;e<81;e+=1)this.squares.push(null);this.reset(ye.STANDARD)}at(e){return this.squares[e.index]}set(e,t){this.squares[e.index]=t}swap(e,t){const i=this.squares[e.index];this.squares[e.index]=this.squares[t.index],this.squares[t.index]=i}remove(e){const t=this.squares[e.index];return this.squares[e.index]=null,t}listNonEmptySquares(){const e=new Array;return Oe.all.forEach((t=>{this.squares[t.index]&&e.push(t)})),e}listSquaresByColor(e){const t=new Array;return Oe.all.forEach((i=>{const n=this.squares[i.index];n&&n.color===e&&t.push(i)})),t}clear(){Oe.all.forEach((e=>{this.squares[e.index]=null}))}reset(e){if(this.clear(),e!==ye.EMPTY&&(this.squares[new Oe(5,1).index]=new ue(V.WHITE,j.KING),e!==ye.TSUME_SHOGI))switch(this.squares[new Oe(5,9).index]=new ue(V.BLACK,j.KING),this.squares[new Oe(2,8).index]=new ue(V.BLACK,j.ROOK),this.squares[new Oe(8,2).index]=new ue(V.WHITE,j.ROOK),this.squares[new Oe(8,8).index]=new ue(V.BLACK,j.BISHOP),this.squares[new Oe(2,2).index]=new ue(V.WHITE,j.BISHOP),this.squares[new Oe(4,9).index]=new ue(V.BLACK,j.GOLD),this.squares[new Oe(6,9).index]=new ue(V.BLACK,j.GOLD),this.squares[new Oe(6,1).index]=new ue(V.WHITE,j.GOLD),this.squares[new Oe(4,1).index]=new ue(V.WHITE,j.GOLD),this.squares[new Oe(3,9).index]=new ue(V.BLACK,j.SILVER),this.squares[new Oe(7,9).index]=new ue(V.BLACK,j.SILVER),this.squares[new Oe(7,1).index]=new ue(V.WHITE,j.SILVER),this.squares[new Oe(3,1).index]=new ue(V.WHITE,j.SILVER),this.squares[new Oe(2,9).index]=new ue(V.BLACK,j.KNIGHT),this.squares[new Oe(8,9).index]=new ue(V.BLACK,j.KNIGHT),this.squares[new Oe(8,1).index]=new ue(V.WHITE,j.KNIGHT),this.squares[new Oe(2,1).index]=new ue(V.WHITE,j.KNIGHT),this.squares[new Oe(1,9).index]=new ue(V.BLACK,j.LANCE),this.squares[new Oe(9,9).index]=new ue(V.BLACK,j.LANCE),this.squares[new Oe(9,1).index]=new ue(V.WHITE,j.LANCE),this.squares[new Oe(1,1).index]=new ue(V.WHITE,j.LANCE),this.squares[new Oe(1,7).index]=new ue(V.BLACK,j.PAWN),this.squares[new Oe(2,7).index]=new ue(V.BLACK,j.PAWN),this.squares[new Oe(3,7).index]=new ue(V.BLACK,j.PAWN),this.squares[new Oe(4,7).index]=new ue(V.BLACK,j.PAWN),this.squares[new Oe(5,7).index]=new ue(V.BLACK,j.PAWN),this.squares[new Oe(6,7).index]=new ue(V.BLACK,j.PAWN),this.squares[new Oe(7,7).index]=new ue(V.BLACK,j.PAWN),this.squares[new Oe(8,7).index]=new ue(V.BLACK,j.PAWN),this.squares[new Oe(9,7).index]=new ue(V.BLACK,j.PAWN),this.squares[new Oe(1,3).index]=new ue(V.WHITE,j.PAWN),this.squares[new Oe(2,3).index]=new ue(V.WHITE,j.PAWN),this.squares[new Oe(3,3).index]=new ue(V.WHITE,j.PAWN),this.squares[new Oe(4,3).index]=new ue(V.WHITE,j.PAWN),this.squares[new Oe(5,3).index]=new ue(V.WHITE,j.PAWN),this.squares[new Oe(6,3).index]=new ue(V.WHITE,j.PAWN),this.squares[new Oe(7,3).index]=new ue(V.WHITE,j.PAWN),this.squares[new Oe(8,3).index]=new ue(V.WHITE,j.PAWN),this.squares[new Oe(9,3).index]=new ue(V.WHITE,j.PAWN),e){default:case ye.STANDARD:return;case ye.HANDICAP_LANCE:return void(this.squares[new Oe(1,1).index]=null);case ye.HANDICAP_RIGHT_LANCE:return void(this.squares[new Oe(9,1).index]=null);case ye.HANDICAP_BISHOP:return void(this.squares[new Oe(2,2).index]=null);case ye.HANDICAP_ROOK:return void(this.squares[new Oe(8,2).index]=null);case ye.HANDICAP_ROOK_LANCE:return this.squares[new Oe(8,2).index]=null,void(this.squares[new Oe(1,1).index]=null);case ye.HANDICAP_2PIECES:return this.squares[new Oe(8,2).index]=null,void(this.squares[new Oe(2,2).index]=null);case ye.HANDICAP_4PIECES:return this.squares[new Oe(8,2).index]=null,this.squares[new Oe(2,2).index]=null,this.squares[new Oe(1,1).index]=null,void(this.squares[new Oe(9,1).index]=null);case ye.HANDICAP_6PIECES:return this.squares[new Oe(8,2).index]=null,this.squares[new Oe(2,2).index]=null,this.squares[new Oe(1,1).index]=null,this.squares[new Oe(2,1).index]=null,this.squares[new Oe(8,1).index]=null,void(this.squares[new Oe(9,1).index]=null);case ye.HANDICAP_8PIECES:return this.squares[new Oe(8,2).index]=null,this.squares[new Oe(2,2).index]=null,this.squares[new Oe(1,1).index]=null,this.squares[new Oe(2,1).index]=null,this.squares[new Oe(3,1).index]=null,this.squares[new Oe(7,1).index]=null,this.squares[new Oe(8,1).index]=null,void(this.squares[new Oe(9,1).index]=null)}}get sfen(){let e="",t=0;for(let i=0;i<9;i+=1){for(let n=0;n<9;n+=1){const o=this.at(Oe.newByXY(n,i));o?(t&&(e+=t,t=0),e+=o.sfen):t+=1}t&&(e+=t,t=0),8!==i&&(e+="/")}return e}resetBySFEN(e){if(!He.isValidSFEN(e))return!1;this.clear();const t=e.split("/");for(let i=0;i<9;i+=1){let e=0;for(let n=0;n<t[i].length;n+=1){let o=t[i][n];"+"===o&&(n+=1,o+=t[i][n]);const a=be(o);a?e+=a:(this.set(Oe.newByXY(e,i),ue.newBySFEN(o)),e+=1)}}return!0}findKing(e){const t=new ue(e,j.KING);return Oe.all.find((e=>{const i=this.at(e);if(i&&t.equals(i))return!0}))}hasPower(e,t,i){return!!me.find((n=>{let o=0;for(let a=e.neighbor(n);a.valid;a=a.neighbor(n)){if(o+=1,i&&i.filled&&a.equals(i.filled))break;if(i&&i.ignore&&a.equals(i.ignore))continue;const e=this.at(a);if(e){if(e.color!==t)return!1;const i=pe(n),a=Se(e,i);return a===_e.LONG||a===_e.SHORT&&1===o}}return!1}))}isCheck(e,t){const i=this.findKing(e);return!!i&&this.hasPower(i,Z(e),{filled:t&&t.filled,ignore:t&&t.ignore})}static isValidSFEN(e){const t=e.split("/");if(9!==t.length)return!1;for(let i=0;i<9;i+=1){let e=0;for(let n=0;n<t[i].length;n+=1){let o=t[i][n];"+"===o&&(n+=1,o+=t[i][n]);const a=be(o);if(a)e+=a;else{if(!ue.isValidSFEN(o))return!1;e+=1}}if(9!==e)return!1}return!0}copyFrom(e){Oe.all.forEach((t=>{this.squares[t.index]=e.at(t)}))}}function ke(e,t){return 0===e?"":(1!==e?e:"")+t.sfen}class Ce{constructor(){(0,Y.Z)(this,"pieces",void 0),this.pieces=new Map,this.pieces.set(j.PAWN,0),this.pieces.set(j.LANCE,0),this.pieces.set(j.KNIGHT,0),this.pieces.set(j.SILVER,0),this.pieces.set(j.GOLD,0),this.pieces.set(j.BISHOP,0),this.pieces.set(j.ROOK,0)}count(e){return this.pieces.get(e)}set(e,t){this.pieces.set(e,t)}add(e,t){let i=this.pieces.get(e);return i+=t,this.pieces.set(e,i),i}reduce(e,t){let i=this.pieces.get(e);return i-=t,this.pieces.set(e,i),i}forEach(e){e(j.PAWN,this.pieces.get(j.PAWN)),e(j.LANCE,this.pieces.get(j.LANCE)),e(j.KNIGHT,this.pieces.get(j.KNIGHT)),e(j.SILVER,this.pieces.get(j.SILVER)),e(j.GOLD,this.pieces.get(j.GOLD)),e(j.BISHOP,this.pieces.get(j.BISHOP)),e(j.ROOK,this.pieces.get(j.ROOK))}get sfenBlack(){return this.formatSFEN(V.BLACK)}get sfenWhite(){return this.formatSFEN(V.WHITE)}formatSFEN(e){let t="";return t+=ke(this.count(j.ROOK),new ue(e,j.ROOK)),t+=ke(this.count(j.BISHOP),new ue(e,j.BISHOP)),t+=ke(this.count(j.GOLD),new ue(e,j.GOLD)),t+=ke(this.count(j.SILVER),new ue(e,j.SILVER)),t+=ke(this.count(j.KNIGHT),new ue(e,j.KNIGHT)),t+=ke(this.count(j.LANCE),new ue(e,j.LANCE)),t+=ke(this.count(j.PAWN),new ue(e,j.PAWN)),""===t?"-":t}static formatSFEN(e,t){const i=e.sfenBlack,n=t.sfenWhite;return"-"===i&&"-"===n?"-":"-"===n?i:"-"===i?n:i+n}static isValidSFEN(e){return"-"===e||!!e.match(/^(?:[0-9]*[PLNSGBRplnsgbr])*$/)}static parseSFEN(e){if("-"===e)return{black:new Ce,white:new Ce};if(!e.match(/^(?:[0-9]*[PLNSGBRplnsgbr])*$/))return null;const t=e.match(/([0-9]*[PLNSGBRplnsgbr])/g),i=new Ce,n=new Ce;for(let o=0;o<t.length;o+=1){const e=t[o];let a=1;e.length>=2&&(a=Number(e.substring(0,e.length-1)));const s=ue.newBySFEN(e[e.length-1]);s.color===V.BLACK?i.add(s.type,a):n.add(s.type,a)}return{black:i,white:n}}copyFrom(e){e.pieces.forEach(((e,t)=>{this.pieces.set(t,e)}))}}const De={black:{pawn:{1:!0},lance:{1:!0},knight:{1:!0,2:!0}},white:{pawn:{9:!0},lance:{9:!0},knight:{9:!0,8:!0}}};function Le(e,t,i){const n=De[e][t];return!!n&&n[i]}function Me(e,t){return e===V.BLACK?t<=3:t>=7}function Ge(e,t,i){for(let n=1;n<=9;n+=1){const o=t.at(new Oe(i,n));if(o&&o.type===j.PAWN&&o.color===e)return!0}return!1}class Be{constructor(){(0,Y.Z)(this,"_board",void 0),(0,Y.Z)(this,"_color",void 0),(0,Y.Z)(this,"_blackHand",void 0),(0,Y.Z)(this,"_whiteHand",void 0),this._board=new He,this._color=V.BLACK,this._blackHand=new Ce,this._whiteHand=new Ce}get board(){return this._board}get color(){return this._color}get blackHand(){return this._blackHand}get whiteHand(){return this._whiteHand}reset(e){switch(this._board.reset(e),this._blackHand=new Ce,this._whiteHand=new Ce,e){case ye.STANDARD:case ye.EMPTY:case ye.TSUME_SHOGI:this._color=V.BLACK;break;case ye.HANDICAP_LANCE:case ye.HANDICAP_RIGHT_LANCE:case ye.HANDICAP_BISHOP:case ye.HANDICAP_ROOK:case ye.HANDICAP_ROOK_LANCE:case ye.HANDICAP_2PIECES:case ye.HANDICAP_4PIECES:case ye.HANDICAP_6PIECES:case ye.HANDICAP_8PIECES:this._color=V.WHITE;break}e===ye.TSUME_SHOGI&&(this._whiteHand.set(j.PAWN,18),this._whiteHand.set(j.LANCE,4),this._whiteHand.set(j.KNIGHT,4),this._whiteHand.set(j.SILVER,4),this._whiteHand.set(j.GOLD,4),this._whiteHand.set(j.BISHOP,2),this._whiteHand.set(j.ROOK,2))}hand(e){return this._hand(e)}_hand(e){return e===V.BLACK?this._blackHand:this._whiteHand}createMove(e,t){let i;if(e instanceof Oe){const t=this._board.at(e);if(!t)return null;i=t.type}else i=e;const n=this._board.at(t);return new Re(e,t,!1,this.color,i,n?n.type:null)}createMoveBySFEN(e){const t=Pe(e);if(!t)return null;let i=this.createMove(t.from,t.to);return i?(t.promote&&(i=i.withPromote()),i):null}isPawnDropMate(e){if(e.from instanceof Oe)return!1;if(e.pieceType!==j.PAWN)return!1;const t=e.to.neighbor(e.color===V.BLACK?de.UP:de.DOWN),i=this.board.at(t);if(!i||i.type!==j.KING||i.color===e.color)return!1;const n=Ee(i).find((n=>{const o=t.neighbor(n);if(!o.valid)return!1;const a=this.board.at(o);return(!a||a.color!=i.color)&&!this.board.hasPower(o,e.color)}));return!n&&!this.board.listSquaresByColor(i.color).find((n=>!n.equals(t)&&this.isMovable(n,e.to)&&!this.board.isCheck(i.color,{filled:e.to,ignore:n})))}isValidMove(e){if(e.from instanceof Oe){const t=this._board.at(e.from);if(!t||t.color!==this.color)return!1;if(!this.isMovable(e.from,e.to))return!1;const i=this._board.at(e.to);if(i&&i.color===this.color)return!1;if(e.promote){if(!t.isPromotable())return!1;if(!Me(this.color,e.from.rank)&&!Me(this.color,e.to.rank))return!1}else if(Le(this.color,t.type,e.to.rank))return!1;if(e.pieceType!==j.KING?this._board.isCheck(this.color,{filled:e.to,ignore:e.from}):this._board.hasPower(e.to,Z(this.color),{ignore:e.from}))return!1}else{if(e.promote)return!1;if(e.color!==this.color)return!1;if(0===this.hand(this.color).count(e.from))return!1;if(this._board.at(e.to))return!1;if(Le(this.color,e.from,e.to.rank))return!1;if(e.from===j.PAWN&&Ge(this.color,this._board,e.to.file))return!1;if(this._board.isCheck(this.color,{filled:e.to}))return!1;if(this.isPawnDropMate(e))return!1}return!0}doMove(e,t){if((!t||!t.ignoreValidation)&&!this.isValidMove(e))return!1;if(e.from instanceof Oe){const t=this._board.at(e.from),i=this._board.at(e.to);this._board.remove(e.from),this._board.set(e.to,e.promote?t.promoted():t),i&&i.type!==j.KING&&this._hand(this.color).add(i.unpromoted().type,1)}else this._hand(this.color).reduce(e.from,1),this._board.set(e.to,new ue(this.color,e.from));return this._color=Z(this.color),!0}undoMove(e){if(this._color=Z(this.color),e.from instanceof Oe)if(this._board.set(e.from,new ue(this.color,e.pieceType)),e.capturedPieceType){const t=new ue(Z(this.color),e.capturedPieceType);this._board.set(e.to,t),t.type!==j.KING&&this._hand(this.color).reduce(t.unpromoted().type,1)}else this._board.remove(e.to);else this._hand(this.color).add(e.from,1),this._board.remove(e.to)}isValidEditing(e,t){if(e instanceof Oe){const i=this._board.at(e);if(!i)return!1;if(t instanceof Oe){if(e.equals(t))return!1}else if(i.type===j.KING)return!1}else{if(!e.color)return!1;if(0===this.hand(e.color).count(e.type))return!1;if(t instanceof Oe){if(this._board.at(t))return!1}else if(e.color===t)return!1}return!0}edit(e){if(e.move){if(!this.isValidEditing(e.move.from,e.move.to))return!1;if(e.move.from instanceof Oe)if(e.move.to instanceof Oe)this._board.swap(e.move.from,e.move.to);else{const t=this._board.remove(e.move.from);this._hand(e.move.to).add(t.unpromoted().type,1)}else this._hand(e.move.from.color).reduce(e.move.from.type,1),e.move.to instanceof Oe?this._board.set(e.move.to,e.move.from):this._hand(e.move.to).add(e.move.from.type,1)}if(e.rotate){const t=this._board.at(e.rotate);t&&this._board.set(e.rotate,t.rotate())}return!0}get sfen(){return this.getSfen(1)}getSfen(e){let t=`sfen ${this._board.sfen} ${z(this.color)} `;return t+=Ce.formatSFEN(this._blackHand,this._whiteHand),t+=" "+e,t}resetBySFEN(e){if(!Be.isValidSFEN(e))return!1;const t=e.split(" ");this._board.resetBySFEN(t[1]),this._color=$(t[2]);const i=Ce.parseSFEN(t[3]);return this._blackHand=i.black,this._whiteHand=i.white,!0}setColor(e){this._color=e}static isValidSFEN(e){const t=e.split(" ");return!(t.length<5)&&("sfen"===t[0]&&(!!He.isValidSFEN(t[1])&&(!!J(t[2])&&!!Ce.isValidSFEN(t[3]))))}static newBySFEN(e){const t=new Be;return t.resetBySFEN(e)?t:null}isMovable(e,t){const i=t.x-e.x,n=t.y-e.y,{direction:o,distance:a,ok:s}=fe(i,n);if(!s)return!1;const r=this._board.at(e);if(!r)return!1;switch(Se(r,o)){default:return!1;case _e.SHORT:return 1===a;case _e.LONG:{const i=ve[o];for(let n=e.neighbor(i.x,i.y);n.valid;n=n.neighbor(i.x,i.y)){if(n.equals(t))return!0;if(this._board.at(n))return!1}return!1}}}copyFrom(e){this._board.copyFrom(e._board),this._color=e.color,this._blackHand.copyFrom(e._blackHand),this._whiteHand.copyFrom(e._whiteHand)}clone(){const e=new Be;return e.copyFrom(this),e}}function xe(e){return Ke(Math.floor(e/1e3))}function Ue(e){return We(Math.floor(e/1e3))}function Ke(e){const t=Math.floor(e/3600),i=Math.floor((e-3600*t)/60),n=e%60;return t+":"+String(i).padStart(2,"0")+":"+String(n).padStart(2,"0")}function We(e){const t=Math.floor(e/60),i=e%60;return String(t).padStart(2," ")+":"+String(i).padStart(2,"0")}var qe,Fe;(function(e){e["BLACK_NAME"]="blackName",e["WHITE_NAME"]="whiteName",e["START_DATETIME"]="startDatetime",e["END_DATETIME"]="endDatetime",e["DATE"]="date",e["TOURNAMENT"]="tournament",e["STRATEGY"]="strategy",e["TITLE"]="title",e["TIME_LIMIT"]="timeLimit",e["TIME_SPENT"]="timeSpent",e["PLACE"]="place",e["POSTED_ON"]="postedOn",e["NOTE"]="note",e["BLACK_SHORT_NAME"]="blackShortName",e["WHITE_SHORT_NAME"]="whiteShortName",e["OPUS_NO"]="opusNo",e["OPUS_NAME"]="opusName",e["AUTHOR"]="author",e["PUBLISHED_ON"]="publishedOn",e["PUBLISHED_AT"]="publishedAt",e["SOURCE"]="source",e["LENGTH"]="length",e["INTEGRITY"]="integrity",e["CATEGORY"]="category",e["AWARD"]="award"})(qe||(qe={}));class Ve{constructor(){(0,Y.Z)(this,"metadata",void 0),(0,Y.Z)(this,"customMetadata",void 0),this.metadata=new Map,this.customMetadata=new Map}get standardMetadataKeys(){return this.metadata.keys()}getStandardMetadata(e){return this.metadata.get(e)}setStandardMetadata(e,t){this.metadata.set(e,t)}get customMetadataKeys(){return this.customMetadata.keys()}getCustomMetadata(e){return this.customMetadata.get(e)}setCustomMetadata(e,t){this.customMetadata.set(e,t)}}(function(e){e["START"]="start",e["INTERRUPT"]="interrupt",e["RESIGN"]="resign",e["DRAW"]="draw",e["REPETITION_DRAW"]="repetitionDraw",e["MATE"]="mate",e["TIMEOUT"]="timeout",e["FOUL_WIN"]="foulWin",e["FOUL_LOSE"]="foulLose",e["ENTERING_OF_KING"]="enteringOfKing",e["WIN_BY_DEFAULT"]="winByDefault",e["LOSS_BY_DEFAULT"]="lossByDefault"})(Fe||(Fe={}));const je={start:"開始局面",resign:"投了",interrupt:"中断",draw:"持将棋",repetitionDraw:"千日手",mate:"詰み",timeout:"切れ負け",foulWin:"反則勝ち",foulLose:"反則負け",enteringOfKing:"入玉",winByDefault:"不戦勝",lossByDefault:"不戦敗"};function Ye(e){return je[e]}class Ze{constructor(e,t,i,n,o){(0,Y.Z)(this,"number",void 0),(0,Y.Z)(this,"prev",void 0),(0,Y.Z)(this,"branchIndex",void 0),(0,Y.Z)(this,"activeBranch",void 0),(0,Y.Z)(this,"move",void 0),(0,Y.Z)(this,"next",void 0),(0,Y.Z)(this,"branch",void 0),(0,Y.Z)(this,"comment",void 0),(0,Y.Z)(this,"customData",void 0),(0,Y.Z)(this,"elapsedMs",void 0),(0,Y.Z)(this,"totalElapsedMs",void 0),this.number=e,this.prev=t,this.branchIndex=i,this.activeBranch=n,this.move=o,this.next=null,this.branch=null,this.comment="",this.elapsedMs=0,this.totalElapsedMs=0}get displayMoveText(){const e=this.prev&&this.prev.move instanceof Re?this.prev.move:null;return this.move instanceof Re?this.move.getDisplayText(e):Ye(this.move)}get displayText(){let e=this.displayMoveText;if(0!==this.number){const t=Ue(this.elapsedMs),i=xe(this.totalElapsedMs);e+=` (${t} / ${i})`}return e}get hasBranch(){return!!this.prev&&!!this.prev.next&&!!this.prev.next.branch}get isFirstBranch(){return!this.prev||this.prev.next===this}updateTotalElapsedMs(){this.totalElapsedMs=this.elapsedMs,this.prev&&this.prev.prev&&(this.totalElapsedMs+=this.prev.prev.totalElapsedMs)}setElapsedMs(e){this.elapsedMs=e,this.updateTotalElapsedMs();let t=this.next;const i=[];while(t)t.updateTotalElapsedMs(),t.branch&&i.push(t.branch),t=t.next?t.next:i.pop()||null}}class ze{constructor(e){(0,Y.Z)(this,"_metadata",void 0),(0,Y.Z)(this,"_initialPosition",void 0),(0,Y.Z)(this,"_position",void 0),(0,Y.Z)(this,"_first",void 0),(0,Y.Z)(this,"_current",void 0),this._metadata=new Ve,this._initialPosition=e?e.clone():new Be,this._position=this.initialPosition.clone(),this._first=new Ze(0,null,0,!0,Fe.START),this._current=this._first}get metadata(){return this._metadata}get initialPosition(){return this._initialPosition}get position(){return this._position}get first(){return this._first}get current(){return this._current}get moves(){const e=this.movesBefore;for(let t=this._current.next;t;t=t.next){while(!t.activeBranch)t=t.branch;e.push(t)}return e}get movesBefore(){return this._movesBefore}get _movesBefore(){const e=new Array;e.unshift(this._current);for(let t=this._current.prev;t;t=t.prev)e.unshift(t);return e}get length(){let e=this._current.number;for(let t=this._current.next;t;t=t.next){while(!t.activeBranch)t=t.branch;e=t.number}return e}get branchBegin(){return this._current.prev?this._current.prev.next:null}clear(e){e&&(this._initialPosition=e.clone()),this._position=this.initialPosition.clone(),this._first.next=null,this._current=this._first}goBack(){return!!this._current.prev&&(this._current.move instanceof Re&&this._position.undoMove(this._current.move),this._current=this._current.prev,!0)}goForward(){if(this._current.next){this._current=this._current.next;while(!this._current.activeBranch)this._current=this._current.branch;return this._current.move instanceof Re&&this._position.doMove(this._current.move,{ignoreValidation:!0}),!0}return!1}goto(e){while(e<this._current.number)if(!this.goBack())break;while(e>this._current.number)if(!this.goForward())break}resetAllBranchSelection(){this._forEach((e=>{e.activeBranch=e.isFirstBranch}))}switchBranchByIndex(e){if(!this._current.prev)return!1;let t=!1;for(let i=this._current.prev.next;i;i=i.branch)i.branchIndex===e?(i.activeBranch=!0,this._current.move instanceof Re&&this._position.undoMove(this._current.move),this._current=i,this._current.move instanceof Re&&this._position.doMove(this._current.move,{ignoreValidation:!0}),t=!0):i.activeBranch=!1;return t}append(e,t){if(e instanceof Re&&!this._position.doMove(e,t))return!1;if(this._current===this.first||this._current.move instanceof Re||this.goBack(),!this._current.next)return this._current.next=new Ze(this._current.number+1,this._current,0,!0,e),this._current=this._current.next,!0;let i;for(i=this._current.next;i;i=i.branch)i.activeBranch=!1;let n=this._current.next;for(i=this._current.next;i;i=i.branch){if(i.move instanceof Re&&e instanceof Re&&e.equals(i.move)||e===i.move)return this._current=i,this._current.activeBranch=!0,!0;n=i}return this._current=new Ze(this._current.number+1,this._current,n.branchIndex+1,!0,e),n.branch=this._current,!0}removeAfter(){const e=this._current;if(!this.goBack())return void(this._current.next=null);if(this._current.next===e)this._current.next=e.branch;else for(let i=this._current.next;i;i=i.branch)if(i.branch===e){i.branch=e.branch;break}let t=0;for(let i=this._current.next;i;i=i.branch)i.branchIndex=t,t+=1;this._current.next&&(this._current.next.activeBranch=!0)}get usi(){let e="position "+this.initialPosition.sfen+" moves";return this._movesBefore.forEach((t=>{t.move instanceof Re&&(e+=" "+t.move.sfen)})),e}get sfen(){return"position "+this.position.getSfen(this._current.number+1)}forEach(e){this._forEach(e)}_forEach(e){let t=this._first;const i=[];while(t)e(t),t.branch&&i.push(t.branch),t=t.next?t.next:i.pop()||null}}const Je={"先手":qe.BLACK_NAME,"後手":qe.WHITE_NAME,"開始日時":qe.START_DATETIME,"終了日時":qe.END_DATETIME,"対局日":qe.DATE,"棋戦":qe.TOURNAMENT,"戦型":qe.STRATEGY,"表題":qe.TITLE,"持ち時間":qe.TIME_LIMIT,"消費時間":qe.TIME_SPENT,"場所":qe.PLACE,"掲載":qe.POSTED_ON,"備考":qe.NOTE,"先手省略名":qe.BLACK_SHORT_NAME,"後手省略名":qe.WHITE_SHORT_NAME,"作品番号":qe.OPUS_NO,"作品名":qe.OPUS_NAME,"作者":qe.AUTHOR,"発表誌":qe.PUBLISHED_ON,"発表年月":qe.PUBLISHED_AT,"出典":qe.SOURCE,"手数":qe.LENGTH,"完全性":qe.INTEGRITY,"分類":qe.CATEGORY,"受賞":qe.AWARD},$e={blackName:"先手",whiteName:"後手",startDatetime:"開始日時",endDatetime:"終了日時",date:"対局日",tournament:"棋戦",strategy:"戦型",title:"表題",timeLimit:"持ち時間",timeSpent:"消費時間",place:"場所",postedOn:"掲載",note:"備考",blackShortName:"先手省略名",whiteShortName:"後手省略名",opusNo:"作品番号",opusName:"作品名",author:"作者",publishedOn:"発表誌",publishedAt:"発表年月",source:"出典",length:"手数",integrity:"完全性",category:"分類",award:"受賞"};var Xe;(function(e){e[e["METADATA"]=0]="METADATA",e[e["HANDICAP"]=1]="HANDICAP",e[e["BLACK_HAND"]=2]="BLACK_HAND",e[e["WHITE_HAND"]=3]="WHITE_HAND",e[e["BOARD"]=4]="BOARD",e[e["BLACK_TURN"]=5]="BLACK_TURN",e[e["WHITE_TURN"]=6]="WHITE_TURN",e[e["MOVE"]=7]="MOVE",e[e["COMMENT"]=8]="COMMENT",e[e["UNKNOWN"]=9]="UNKNOWN"})(Xe||(Xe={}));const Qe=[{prefix:/^手合割：/,type:Xe.HANDICAP,removePrefix:!0,isPosition:!0},{prefix:/^先手の持駒：/,type:Xe.BLACK_HAND,removePrefix:!0,isPosition:!0},{prefix:/^後手の持駒：/,type:Xe.WHITE_HAND,removePrefix:!0,isPosition:!0},{prefix:/^\|/,type:Xe.BOARD,removePrefix:!1,isPosition:!0},{prefix:/^先手番/,type:Xe.BLACK_TURN,removePrefix:!1,isPosition:!0},{prefix:/^後手番/,type:Xe.WHITE_TURN,removePrefix:!1,isPosition:!0},{prefix:/^ *[0-9]+ +/,type:Xe.MOVE,removePrefix:!1,isPosition:!1},{prefix:/^\*/,type:Xe.COMMENT,removePrefix:!0,isPosition:!1}];function et(e){let t=e.indexOf("#");-1===t&&(t=e.length);for(let n=0;n<Qe.length;n++){const i=Qe[n],o=e.match(i.prefix);if(o){const n=i.removePrefix?o[0].length:0;return{type:i.type,data:e.substring(n,t),isPosition:i.isPosition,metadataKey:""}}}const i=e.match(/^[^ ]+：/);if(i){const n=i[0];return{type:Xe.METADATA,data:e.substring(n.length,t),isPosition:!1,metadataKey:n.substring(0,n.length-1)}}return{type:Xe.UNKNOWN,data:e.substring(0,t),isPosition:!1,metadataKey:""}}function tt(e,t){switch(t.trim()){case"平手":return void e.reset(ye.STANDARD);case"香落ち":return void e.reset(ye.HANDICAP_LANCE);case"右香落ち":return void e.reset(ye.HANDICAP_RIGHT_LANCE);case"角落ち":return void e.reset(ye.HANDICAP_BISHOP);case"飛車落ち":return void e.reset(ye.HANDICAP_ROOK);case"飛香落ち":return void e.reset(ye.HANDICAP_ROOK_LANCE);case"二枚落ち":return void e.reset(ye.HANDICAP_2PIECES);case"四枚落ち":return void e.reset(ye.HANDICAP_4PIECES);case"六枚落ち":return void e.reset(ye.HANDICAP_6PIECES);case"八枚落ち":return void e.reset(ye.HANDICAP_8PIECES);case"その他":return void e.reset(ye.EMPTY)}return new Error("不正なデータ:"+t)}const it={"１":1,"２":2,"３":3,"４":4,"５":5,"６":6,"７":7,"８":8,"９":9},nt={"一":1,"二":2,"三":3,"四":4,"五":5,"六":6,"七":7,"八":8,"九":9},ot={"一":1,"二":2,"三":3,"四":4,"五":5,"六":6,"七":7,"八":8,"九":9,"十":10,"十一":11,"十二":12,"十三":13,"十四":14,"十五":15,"十六":16,"十七":17,"十八":18},at={1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9},st={"王":j.KING,"玉":j.KING,"飛":j.ROOK,"龍":j.DRAGON,"竜":j.DRAGON,"角":j.BISHOP,"馬":j.HORSE,"金":j.GOLD,"銀":j.SILVER,"成銀":j.PROM_SILVER,"全":j.PROM_SILVER,"桂":j.KNIGHT,"成桂":j.PROM_KNIGHT,"圭":j.PROM_KNIGHT,"香":j.LANCE,"成香":j.PROM_LANCE,"杏":j.PROM_LANCE,"歩":j.PAWN,"と":j.PROM_PAWN},rt={"中断":Fe.INTERRUPT,"投了":Fe.RESIGN,"持将棋":Fe.DRAW,"千日手":Fe.REPETITION_DRAW,"詰み":Fe.MATE,"切れ負け":Fe.TIMEOUT,"反則勝ち":Fe.FOUL_WIN,"反則負け":Fe.FOUL_LOSE,"入玉勝ち":Fe.ENTERING_OF_KING,"不戦勝":Fe.WIN_BY_DEFAULT,"不戦敗":Fe.LOSS_BY_DEFAULT},ct=/^ *([0-9]+) +[▲△]?([１２３４５６７８９][一二三四五六七八九]|同\u3000)(玉|飛|龍|竜|角|馬|金|銀|成銀|全|桂|成桂|圭|香|成香|杏|歩|と)(成?)(打|\([1-9][1-9]\)) *(.*)$/,lt=/\( *([0-9]+):([0-9]+)\/[0-9: ]*\)/,ut=/^ *([0-9]+) +(中断|投了|持将棋|千日手|詰み|切れ負け|反則勝ち|反則負け|入玉勝ち|不戦勝|不戦敗) *(.*)$/;function dt(e,t){if(t.length<21)return new Error("不正な盤面:"+t);const i=t[20],n=nt[i];if(!n)return new Error("不正な盤面:"+t);for(let o=0;o<9;o+=1){const i=9-o,a=new Oe(i,n),s=2*o+1,r=t[s+1],c=st[r];if(!c){e.remove(a);continue}const l="v"!==t[s]?V.BLACK:V.WHITE;e.set(a,new ue(l,c))}}function ht(e,t){const i=t.split(/[ 　]/);for(const n of i){if(!n||"なし"===n)continue;const t=n[0],i=n.substring(1),o=st[t],a=ot[i]||1;if(!o)return new Error("不正な持ち駒: "+n);e.add(o,a)}}function pt(e,t){const i=lt.exec(t);if(i){const t=i[1],n=i[2],o=60*Number.parseInt(t)+Number.parseInt(n);e.current.setElapsedMs(1e3*o)}}function mt(e,t){let i=ut.exec(t);if(i){const t=Number(i[1]),n=rt[i[2]],o=i[3];return e.goto(t-1),e.append(n,{ignoreValidation:!0}),void pt(e,o)}if(i=ct.exec(t),!i)return new Error("不正な指し手形式:"+t);const n=Number(i[1]),o=i[2],a=i[3],s=i[4],r=i[5],c=i[6];if(0===n)return new Error("不正な手数:"+t);let l,u;if(e.goto(n-1),"同　"===o){if(!(e.current.move instanceof Re))return new Error("不明な移動先: "+t);l=e.current.move.to}else{const e=it[o[0]],t=nt[o[1]];l=new Oe(e,t)}if("打"===r)u=st[a];else{const e=at[r[1]],t=at[r[2]];u=new Oe(e,t)}let d=e.position.createMove(u,l);if(!d)return new Error("不正な指し手: "+t);"成"===s&&(d=d.withPromote()),e.append(d,{ignoreValidation:!0}),pt(e,c)}function _t(e){const t=new ze,i=e.split(/\r?\n/),n=new Be;let o=!1;for(const a of i){if(""===a)continue;const e=et(a);if(o&&e.isPosition)return new Error("不正なデータ: "+a);let i;switch(e.type){case Xe.METADATA:{const i=Je[e.metadataKey];i?t.metadata.setStandardMetadata(i,e.data):t.metadata.setCustomMetadata(e.metadataKey,e.data);break}case Xe.HANDICAP:i=tt(n,e.data);break;case Xe.BLACK_HAND:i=ht(n.blackHand,e.data);break;case Xe.WHITE_HAND:i=ht(n.whiteHand,e.data);break;case Xe.BOARD:i=dt(n.board,e.data);break;case Xe.BLACK_TURN:n.setColor(V.BLACK);break;case Xe.WHITE_TURN:n.setColor(V.WHITE);break;case Xe.MOVE:o||(t.clear(n),o=!0),i=mt(t,e.data);break;case Xe.COMMENT:t.current.comment+=(0!==t.current.comment.length?"\n":"")+e.data;break;case Xe.UNKNOWN:console.log("skip",a);break}if(i)return i}return o||t.clear(n),t.goto(0),t.resetAllBranchSelection(),t}const gt=["一","二","三","四","五","六","七","八","九","十","十一","十二","十三","十四","十五","十六","十七","十八"],Et=["１","２","３","４","５","６","７","８","９"],St=gt,vt={king:"玉",rook:"飛",dragon:"龍",bishop:"角",horse:"馬",gold:"金",silver:"銀",promSilver:"成銀",knight:"桂",promKnight:"成桂",lance:"香",promLance:"成香",pawn:"歩",promPawn:"と"},ft={king:"玉",rook:"飛",dragon:"龍",bishop:"角",horse:"馬",gold:"金",silver:"銀",promSilver:"全",knight:"桂",promKnight:"圭",lance:"香",promLance:"杏",pawn:"歩",promPawn:"と"},It={start:"",resign:"投了",interrupt:"中断",draw:"持将棋",repetitionDraw:"千日手",mate:"詰み",timeout:"切れ負け",foulWin:"反則勝ち",foulLose:"反則負け",enteringOfKing:"入玉勝ち",winByDefault:"不戦勝",lossByDefault:"不戦敗"};function wt(e,t){let i="";const n=t.returnCode?t.returnCode:"\n";for(const o of e.standardMetadataKeys)i+=$e[o]+"："+e.getStandardMetadata(o)+n;for(const o of e.customMetadataKeys)i+=o+"："+e.getCustomMetadata(o)+n;return i}function Tt(e,t){let i="";const n=t.returnCode?t.returnCode:"\n";i+="後手の持駒："+At(e.whiteHand)+n,i+="  ９ ８ ７ ６ ５ ４ ３ ２ １"+n,i+="+---------------------------+"+n;for(let o=0;o<9;o++){i+="|";for(let t=0;t<9;t++){const n=Oe.newByXY(t,o),a=e.board.at(n);a?a.color===V.BLACK?i+=" "+ft[a.type]:i+="v"+ft[a.type]:i+=" ・"}i+="|"+St[o]+n}return i+="+---------------------------+"+n,i+="先手の持駒："+At(e.blackHand)+n,e.color===V.BLACK?i+="先手番"+n:i+="後手番"+n,i}function Ot(e){let t="";return t+=Et[e.to.file-1],t+=St[e.to.rank-1],t+=vt[e.pieceType],e.promote&&(t+="成"),e.from instanceof Oe?t+="("+e.from.file+e.from.rank+")":t+="打",t}function At(e){let t="";return e.forEach(((e,i)=>{i>=1&&(t+=ft[e],i>=2&&(t+=gt[i-1]),t+="　")})),t}function Nt(e,t){let i="";const n=t.returnCode?t.returnCode:"\n";return i+="# KIF形式棋譜ファイル Generated by Electron Shogi"+n,i+=wt(e.metadata,t),i+=Tt(e.initialPosition,t),i+="手数----指手---------消費時間--"+n,e.forEach((e=>{if(e.move){e.isFirstBranch||(i+=n,i+="変化："+e.number+"手"+n),e.move instanceof Re?i+=e.number+" "+Ot(e.move):i+=It[e.move];const t=Ue(e.elapsedMs),o=xe(e.totalElapsedMs);i+=` (${t}/${o})`,e.isFirstBranch&&e.hasBranch&&(i+="+"),i+=n}0!==e.comment.length&&(i+="*"+e.comment.replaceAll("\n",n+"*")+n)})),i}const Rt={};function Pt(e){if(Rt[e])return;const t=document.createElement("img");t.src=e,Rt[e]=t}var yt;(function(e){e["HITOMOJI"]="hitomoji",e["HITOMOJI_GOTHIC"]="hitomojiGothic"})(yt||(yt={}));const bt={frame:{width:1471,height:959},board:{x:296.5,y:0,width:878,height:960,squreWidth:94.8,squreHeight:104,leftSquarePadding:12,topSquarePadding:12.2,leftPiecePadding:17.5,topPiecePadding:18.5,highlight:{selected:{"background-color":"#ff4800",opacity:"0.7"},lastMove:{"background-color":"#00ddff",opacity:"0.5"}}},piece:{width:88,height:93},hand:{color:"#8b4513",black:{x:1184,y:600},white:{x:0,y:0},width:288,height:360,highlight:{selected:{"background-color":"#ff4800",opacity:"0.7"}}},turn:{black:{x:1184,y:425},white:{x:0,y:492},width:288,height:45,fontSize:32},playerName:{black:{x:1184,y:480},white:{x:0,y:370},width:288,height:45,fontSize:25},clock:{black:{x:1184,y:535},white:{x:0,y:425},width:288,height:55,fontSize:40},control:{left:{x:0,y:547,width:288,height:412,fontSize:26},right:{x:1184,y:0,width:288,height:412,fontSize:26}}},Ht={hitomoji:{...bt,images:{board:"./board/default.png",black:{pawn:"./piece/hitomoji/black_pawn.png",lance:"./piece/hitomoji/black_lance.png",knight:"./piece/hitomoji/black_knight.png",silver:"./piece/hitomoji/black_silver.png",gold:"./piece/hitomoji/black_gold.png",bishop:"./piece/hitomoji/black_bishop.png",rook:"./piece/hitomoji/black_rook.png",king:"./piece/hitomoji/black_king.png",king2:"./piece/hitomoji/black_king2.png",promPawn:"./piece/hitomoji/black_prom_pawn.png",promLance:"./piece/hitomoji/black_prom_lance.png",promKnight:"./piece/hitomoji/black_prom_knight.png",promSilver:"./piece/hitomoji/black_prom_silver.png",horse:"./piece/hitomoji/black_horse.png",dragon:"./piece/hitomoji/black_dragon.png"},white:{pawn:"./piece/hitomoji/white_pawn.png",lance:"./piece/hitomoji/white_lance.png",knight:"./piece/hitomoji/white_knight.png",silver:"./piece/hitomoji/white_silver.png",gold:"./piece/hitomoji/white_gold.png",bishop:"./piece/hitomoji/white_bishop.png",rook:"./piece/hitomoji/white_rook.png",king:"./piece/hitomoji/white_king.png",king2:"./piece/hitomoji/white_king2.png",promPawn:"./piece/hitomoji/white_prom_pawn.png",promLance:"./piece/hitomoji/white_prom_lance.png",promKnight:"./piece/hitomoji/white_prom_knight.png",promSilver:"./piece/hitomoji/white_prom_silver.png",horse:"./piece/hitomoji/white_horse.png",dragon:"./piece/hitomoji/white_dragon.png"}}},hitomojiGothic:{...bt,images:{board:"./board/default.png",black:{pawn:"./piece/hitomoji_gothic/black_pawn.png",lance:"./piece/hitomoji_gothic/black_lance.png",knight:"./piece/hitomoji_gothic/black_knight.png",silver:"./piece/hitomoji_gothic/black_silver.png",gold:"./piece/hitomoji_gothic/black_gold.png",bishop:"./piece/hitomoji_gothic/black_bishop.png",rook:"./piece/hitomoji_gothic/black_rook.png",king:"./piece/hitomoji_gothic/black_king.png",king2:"./piece/hitomoji_gothic/black_king2.png",promPawn:"./piece/hitomoji_gothic/black_prom_pawn.png",promLance:"./piece/hitomoji_gothic/black_prom_lance.png",promKnight:"./piece/hitomoji_gothic/black_prom_knight.png",promSilver:"./piece/hitomoji_gothic/black_prom_silver.png",horse:"./piece/hitomoji_gothic/black_horse.png",dragon:"./piece/hitomoji_gothic/black_dragon.png"},white:{pawn:"./piece/hitomoji_gothic/white_pawn.png",lance:"./piece/hitomoji_gothic/white_lance.png",knight:"./piece/hitomoji_gothic/white_knight.png",silver:"./piece/hitomoji_gothic/white_silver.png",gold:"./piece/hitomoji_gothic/white_gold.png",bishop:"./piece/hitomoji_gothic/white_bishop.png",rook:"./piece/hitomoji_gothic/white_rook.png",king:"./piece/hitomoji_gothic/white_king.png",king2:"./piece/hitomoji_gothic/white_king2.png",promPawn:"./piece/hitomoji_gothic/white_prom_pawn.png",promLance:"./piece/hitomoji_gothic/white_prom_lance.png",promKnight:"./piece/hitomoji_gothic/white_prom_knight.png",promSilver:"./piece/hitomoji_gothic/white_prom_silver.png",horse:"./piece/hitomoji_gothic/white_horse.png",dragon:"./piece/hitomoji_gothic/white_dragon.png"}}}},kt={black:{pawn:{row:3,column:0,width:2},lance:{row:2,column:0,width:1},knight:{row:2,column:1,width:1},silver:{row:1,column:0,width:1},gold:{row:1,column:1,width:1},bishop:{row:0,column:0,width:1},rook:{row:0,column:1,width:1},king:{row:0,column:0,width:0},promPawn:{row:0,column:0,width:0},promLance:{row:0,column:0,width:0},promKnight:{row:0,column:0,width:0},promSilver:{row:0,column:0,width:0},horse:{row:0,column:0,width:0},dragon:{row:0,column:0,width:0}},white:{pawn:{row:0,column:0,width:2},lance:{row:1,column:1,width:1},knight:{row:1,column:0,width:1},silver:{row:2,column:1,width:1},gold:{row:2,column:0,width:1},bishop:{row:3,column:1,width:1},rook:{row:3,column:0,width:1},king:{row:0,column:0,width:0},promPawn:{row:0,column:0,width:0},promLance:{row:0,column:0,width:0},promKnight:{row:0,column:0,width:0},promSilver:{row:0,column:0,width:0},horse:{row:0,column:0,width:0},dragon:{row:0,column:0,width:0}}};class Ct{constructor(e){(0,Y.Z)(this,"template",void 0),this.template=Ht[e]||Ht[yt.HITOMOJI]}preload(){Pt(this.template.images.board),Object.values(this.template.images.black).forEach(Pt),Object.values(this.template.images.white).forEach(Pt)}build(e,t,i,n,o,a){let s=e.width/this.template.frame.width;this.template.frame.height*s>e.height&&(s=e.height/this.template.frame.height);const r=()=>({style:{height:this.template.frame.height*s+"px",width:this.template.frame.width*s+"px"}}),c=()=>{const e=this.template.images.board,t=this.template.board.x*s,i=this.template.board.y*s,n=this.template.board.width*s,o=this.template.board.height*s,a={left:t+"px",top:i+"px",height:o+"px",width:n+"px"};return{imagePath:e,x:t,y:i,style:a}},l=e=>{const i=[];return t.board.listNonEmptySquares().forEach((n=>{const o=t.board.at(n),r=o.id+n.index,c=a?Z(o.color):o.color,l=o.type==j.KING&&o.color==V.BLACK?"king2":o.type,u=this.template.images[c][l],d=e.x+(this.template.board.leftPiecePadding+this.template.board.squreWidth*(a?n.opposite:n).x)*s,h=e.y+(this.template.board.topPiecePadding+this.template.board.squreHeight*(a?n.opposite:n).y)*s,p=this.template.piece.width*s,m=this.template.piece.height*s;i.push({id:r,imagePath:u,style:{left:d+"px",top:h+"px",width:p+"px",height:m+"px"}})})),i},u=e=>{const t=[];return Oe.all.forEach((o=>{const r=o.index,{file:c}=o,{rank:l}=o,u=e.x+(this.template.board.leftSquarePadding+this.template.board.squreWidth*(a?o.opposite:o).x)*s,d=e.y+(this.template.board.topSquarePadding+this.template.board.squreHeight*(a?o.opposite:o).y)*s,h=this.template.board.squreWidth*s,p=this.template.board.squreHeight*s,m={left:u+"px",top:d+"px",width:h+"px",height:p+"px"};let _=m;i&&o.equals(i.to)&&(_={..._,...this.template.board.highlight.lastMove}),n instanceof Oe&&n.equals(o)&&(_={..._,...this.template.board.highlight.selected}),t.push({id:r,file:c,rank:l,style:m,backgroundStyle:_})})),t},d=(e,t)=>{const i=a?Z(e):e,o=this.template.hand[i].x*s,r=this.template.hand[i].y*s,c=this.template.hand.width*s,l=this.template.hand.height*s,u={"background-color":this.template.hand.color,left:o+"px",top:r+"px",width:c+"px",height:l+"px"},d=[],h=[];return ee.forEach((o=>{const a=t.count(o),r=kt[i][o],c=this.template.hand.width/2*r.width*s,l=this.template.hand.height/4*s,u=c*r.column,p=l*r.row,m=this.template.piece.width*s,_=this.template.piece.height*s,g=Math.max(c-m*a,0)/(2*a),E=(c-m-2*g)/Math.max(a-1,1);for(let e=a-1;e>=0;e-=1){const t=o+e,n=this.template.images[i][o],a=u+g+E*e,s=p;d.push({id:t,imagePath:n,style:{left:a+"px",top:s+"px",width:m+"px",height:_+"px"}})}const S=o,v={left:u+"px",top:p+"px",width:c+"px",height:l+"px"};let f=v;n&&n instanceof ue&&n.color===e&&n.type===o&&(f={...f,...this.template.hand.highlight.selected}),h.push({id:S,type:o,style:v,backgroundStyle:f})})),{style:u,pieces:d,pointers:h}},h=(e,t)=>{if(!t)return null;const i=a?Z(t.color):t.color,n=a?t.to.opposite:t.to,o=new ue(i,t.pieceType),r=o.promoted(),c=o.unpromoted(),l=this.template.images[i][r.type],u=this.template.images[i][c.type],d=e.x+(this.template.board.leftSquarePadding+this.template.board.squreWidth*(n.x-.5))*s,h=e.y+(this.template.board.topSquarePadding+this.template.board.squreHeight*n.y)*s,p=2*this.template.board.squreWidth*s,m=this.template.board.squreHeight*s,_={left:d+"px",top:h+"px",width:p+"px",height:m+"px","font-size":m/4+"px"};return{promoteImagePath:l,notPromoteImagePath:u,style:_}},p=()=>{const e=t.color,i=a?Z(e):e,n=2;return{style:{left:this.template.turn[i].x*s-n+"px",top:this.template.turn[i].y*s-n+"px",width:this.template.turn.width*s-n+"px",height:this.template.turn.height*s-n+"px","font-size":this.template.turn.fontSize*s+"px","border-radius":this.template.turn.height*s*.4+"px","border-width":n+"px","border-style":"solid"}}},m=e=>{const t=a?Z(e):e;return{style:{left:this.template.playerName[t].x*s+"px",top:this.template.playerName[t].y*s+"px",width:this.template.playerName.width*s+"px",height:this.template.playerName.height*s+"px","font-size":this.template.playerName.fontSize*s+"px"}}},_=e=>{const t=a?Z(e):e;return{style:{left:this.template.clock[t].x*s+"px",top:this.template.clock[t].y*s+"px",width:this.template.clock.width*s+"px",height:this.template.clock.height*s+"px","font-size":this.template.clock.fontSize*s+"px"}}},g=()=>({left:{style:{left:this.template.control.left.x*s+"px",top:this.template.control.left.y*s+"px",width:this.template.control.left.width*s+"px",height:this.template.control.left.height*s+"px","font-size":this.template.control.left.fontSize*s+"px"}},right:{style:{left:this.template.control.right.x*s+"px",top:this.template.control.right.y*s+"px",width:this.template.control.right.width*s+"px",height:this.template.control.right.height*s+"px","font-size":this.template.control.right.fontSize*s+"px"}}}),E=r(),S=c(),v=l(S),f=u(S),I=d(V.BLACK,t.hand(V.BLACK)),w=d(V.WHITE,t.hand(V.WHITE)),T=h(S,o),O=p(),A=m(V.BLACK),N=m(V.WHITE),R=_(V.BLACK),P=_(V.WHITE),y=g();return{frame:E,board:S,piece:v,square:f,blackHand:I,whiteHand:w,promotion:T,turn:O,blackPlayerName:A,whitePlayerName:N,blackClock:R,whiteClock:P,control:y}}}class Dt{constructor(e,t){(0,Y.Z)(this,"width",void 0),(0,Y.Z)(this,"height",void 0),this.width=e,this.height=t}add(e){return new Dt(this.width+e.width,this.height+e.height)}reduce(e){return new Dt(this.width-e.width,this.height-e.height)}}var Lt=(0,o.aZ)({name:"BoardView",props:{layoutType:{type:String,required:!0},maxSize:{type:Dt,required:!0},position:{type:Object,required:!0},lastMove:{type:Re,required:!1,default:null},flip:{type:Boolean,required:!1},allowEdit:{type:Boolean,required:!1},allowMove:{type:Boolean,required:!1},blackPlayerName:{type:String,required:!1,default:"先手"},whitePlayerName:{type:String,required:!1,default:"後手"},blackPlayerTimeMs:{type:Number,required:!1,default:void 0},blackPlayerByoyomi:{type:Number,required:!1,default:void 0},whitePlayerTimeMs:{type:Number,required:!1,default:void 0},whitePlayerByoyomi:{type:Number,required:!1,default:void 0}},emits:["move","edit"],setup(e,t){const i=(0,l.qj)({pointer:null,reservedMove:null}),n=()=>{i.pointer=null,i.reservedMove=null};(0,o.YP)([()=>e.position,()=>e.allowEdit,()=>e.allowMove],(()=>{n()}));const a=()=>{n()},s=(o,a,s)=>{const r=i.pointer;if(n(),!(o instanceof Oe&&r instanceof Oe&&o.equals(r))&&!(o instanceof ue&&r instanceof ue&&o.equals(r))){if(r){const n=r,a=o instanceof Oe?o:o.color;if(e.allowEdit&&e.position.isValidEditing(n,a))return void t.emit("edit",{move:{from:r,to:a}});if(e.allowMove&&o instanceof Oe){const n=r instanceof Oe?r:r.type,a=o,s=e.position.createMove(n,a);if(!s)return;const c=e.position.isValidMove(s),l=e.position.isValidMove(s.withPromote());if(c&&l)return void(i.reservedMove=s);if(c)return void t.emit("move",s);if(l)return void t.emit("move",s.withPromote())}}!e.allowMove&&!e.allowEdit||a||(e.allowEdit||s===e.position.color)&&(i.pointer=o)}},r=(t,i,n)=>{t.stopPropagation(),t.preventDefault();const o=new Oe(i,n),a=e.position.board.at(o),r=!a;s(o,r,a?.color)},c=(t,i,n)=>{t.stopPropagation(),t.preventDefault();const o=0===e.position.hand(i).count(n);s(new ue(i,n),o,i)},u=(i,o,a)=>{i.stopPropagation(),i.preventDefault(),n();const s=new Oe(o,a);e.allowEdit&&e.position.board.at(s)&&t.emit("edit",{rotate:s})},d=o=>{o.stopPropagation(),o.preventDefault();const a=i.reservedMove;n(),a&&e.position.isValidMove(a.withPromote())&&t.emit("move",a.withPromote())},h=o=>{o.stopPropagation(),o.preventDefault();const a=i.reservedMove;n(),a&&e.position.isValidMove(a)&&t.emit("move",a)},p=(0,o.Fl)((()=>{const t=new Ct(e.layoutType);return t.preload(),t})),m=(0,o.Fl)((()=>p.value.build(e.maxSize.reduce(new Dt(20,20)),e.position,e.lastMove,i.pointer,i.reservedMove,e.flip))),_=(e,t)=>e?Ke(Math.ceil(e/1e3)):void 0!==t?""+t:"0:00:00",g=(e,t)=>{if(!e&&!t)return"normal";const i=(e||0)/1e3+(t||0);return i<=5?"danger":i<=10?"warning":"normal"},E=(0,o.Fl)((()=>_(e.blackPlayerTimeMs,e.blackPlayerByoyomi))),S=(0,o.Fl)((()=>g(e.blackPlayerTimeMs,e.blackPlayerByoyomi))),v=(0,o.Fl)((()=>_(e.whitePlayerTimeMs,e.whitePlayerByoyomi))),f=(0,o.Fl)((()=>g(e.whitePlayerTimeMs,e.whitePlayerByoyomi)));return{clickFrame:a,clickSquare:r,clickHand:c,clickSquareR:u,clickPromote:d,clickNotPromote:h,layout:m,blackPlayerTimeText:E,blackPlayerTimeSeverity:S,whitePlayerTimeText:v,whitePlayerTimeSeverity:f}}}),Mt=i(3744);const Gt=(0,Mt.Z)(Lt,[["render",F],["__scopeId","data-v-3b874c02"]]);var Bt,xt,Ut,Kt=Gt;function Wt(e){return void 0!==e.value?e.value:void 0!==e.default?"string"===e.type&&"<empty>"===e.default?"":e.default:void 0}function qt(e,t){e.uri=t.uri,e.name=t.name,Object.keys(t.options).forEach((i=>{e.options[i]&&(e.options[i].value=t.options[i].value)}))}class Ft{constructor(e){if((0,Y.Z)(this,"engines",void 0),this.engines={},e){const t=JSON.parse(e);t.engines instanceof Object&&(this.engines=t.engines)}}hasEngine(e){return!!this.engines[e]}addEngine(e){this.engines[e.uri]=e}updateEngine(e){return!!this.engines[e.uri]&&(this.engines[e.uri]=e,!0)}removeEngine(e){return!!this.engines[e]&&(delete this.engines[e],!0)}getEngine(e){return this.engines[e]}get engineList(){return Object.values(this.engines).sort(((e,t)=>e.name>t.name?1:-1))}get json(){return JSON.stringify(this)}get jsonWithIndent(){return JSON.stringify(this,void 0,2)}}function Vt(e){return{boardLayout:yt.HITOMOJI,pieceVolume:30,clockVolume:30,clockPitch:500,clockSoundTarget:Ut.ONLY_USER,boardFlipping:!1,informationTab:xt.COMMENT,returnCode:e||"\r\n"}}(function(e){e["NEW_RECORD"]="newRecord",e["OPEN_RECORD"]="openRecord",e["SAVE_RECORD"]="saveRecord",e["SAVE_RECORD_AS"]="saveRecordAs",e["COPY_RECORD"]="copyRecord",e["PASTE_RECORD"]="pasteRecord",e["REMOVE_RECORD_AFTER"]="remvoeRecordAfter",e["START_POSITION_EDITING"]="startPositionEditing",e["END_POSITION_EDITING"]="endPositionEditing",e["CHANGE_TURN"]="changeTurn",e["INIT_POSITION_STANDARD"]="initPositionStandard",e["INIT_POSITION_HANDICAP_LANCE"]="initPositionHandicapLance",e["INIT_POSITION_HANDICAP_RIGHT_LANCE"]="initPositionHandicapRightLance",e["INIT_POSITION_HANDICAP_BISHOP"]="initPositionHandicapBishop",e["INIT_POSITION_HANDICAP_ROOK"]="initPositionHandicapRook",e["INIT_POSITION_HANDICAP_ROOK_LANCE"]="initPositionHandicapRookLance",e["INIT_POSITION_HANDICAP_2PIECES"]="initPositionHandicap2Pieces",e["INIT_POSITION_HANDICAP_4PIECES"]="initPositionHandicap4Pieces",e["INIT_POSITION_HANDICAP_6PIECES"]="initPositionHandicap6Pieces",e["INIT_POSITION_HANDICAP_8PIECES"]="initPositionHandicap8Pieces",e["INIT_POSITION_TSUME_SHOGI"]="initPositionTsumeShogi",e["START_RESEARCH"]="startResearch",e["STOP_RESEARCH"]="stopResearch",e["START_GAME"]="startGame",e["STOP_GAME"]="stopGame",e["RESIGN"]="resign",e["FLIP_BOARD"]="flipBoard",e["APP_SETTING_DIALOG"]="appSetting",e["USI_ENGINE_SETTING_DIALOG"]="usiEngineSetting"})(Bt||(Bt={})),function(e){e["COMMENT"]="comment",e["SEARCH"]="search",e["CHART"]="chart",e["INVISIBLE"]="invisible"}(xt||(xt={})),function(e){e["ALL"]="all",e["ONLY_USER"]="onlyUser"}(Ut||(Ut={}));const jt="es://human",Yt="es://usi-engine/";function Zt(e){return e.startsWith(Yt)}function zt(){return{black:{name:"人",uri:jt},white:{name:"人",uri:jt},timeLimit:{timeSeconds:0,byoyomi:30,increment:0},enableEngineTimeout:!1,humanIsFront:!0}}function Jt(e){return 0===e.timeLimit.timeSeconds&&0===e.timeLimit.byoyomi?new Error("持ち時間と秒読みが両方とも0です。"):0!==e.timeLimit.byoyomi&&0!==e.timeLimit.increment?new Error("秒読みとフィッシャールールは併用できません。"):void 0}function $t(){return{}}var Xt;(function(e){e["APP_SETTING"]="appSetting",e["RESEARCH_SETTING"]="researchSetting",e["GAME_SETTING"]="gameSetting"})(Xt||(Xt={}));const Qt={async getRecordPathFromProcArg(){return""},updateMenuState(){},async showOpenRecordDialog(){throw"Web版では利用できない機能です。"},async openRecord(){throw"Web版では利用できない機能です。"},async showSaveRecordDialog(){throw"Web版では利用できない機能です。"},async saveRecord(){throw"Web版では利用できない機能です。"},async showSelectFileDialog(){throw"Web版では利用できない機能です。"},async loadAppSetting(){const e=localStorage.getItem(Xt.APP_SETTING);return e?JSON.stringify({...Vt(),...JSON.parse(e)}):JSON.stringify(Vt())},async saveAppSetting(e){localStorage.setItem(Xt.APP_SETTING,e)},async loadResearchSetting(){const e=localStorage.getItem(Xt.RESEARCH_SETTING);return e?JSON.stringify({...$t(),...JSON.parse(e)}):JSON.stringify($t())},async saveResearchSetting(e){localStorage.setItem(Xt.RESEARCH_SETTING,e)},async loadGameSetting(){const e=localStorage.getItem(Xt.GAME_SETTING);return e?JSON.stringify({...zt(),...JSON.parse(e)}):JSON.stringify(zt())},async saveGameSetting(e){localStorage.setItem(Xt.GAME_SETTING,e)},async loadUSIEngineSetting(){return(new Ft).json},async saveUSIEngineSetting(){},async showSelectUSIEngineDialog(){throw"Web版では利用できない機能です。"},async getUSIEngineInfo(){throw"Web版では利用できない機能です。"},async startResearch(){throw"Web版では利用できない機能です。"},async endResearch(){throw"Web版では利用できない機能です。"},async startGame(){},async endGame(){},async updateUSIPosition(){},async stopUSI(){},async sendUSISetOption(){},onSendError(){},onMenuEvent(){},onUSIBestMove(){},onUSIInfo(){}};function ei(){return window}function ti(){return!!ei().electronShogiAPI}function ii(){return ei().electronShogiAPI||Qt}async function ni(){return await ii().getRecordPathFromProcArg()}async function oi(){return await ii().showOpenRecordDialog()}async function ai(e){return await ii().openRecord(e)}async function si(e){return await ii().showSaveRecordDialog(e)}async function ri(e,t){await ii().saveRecord(e,t)}async function ci(){return await ii().showSelectFileDialog()}async function li(){return JSON.parse(await ii().loadAppSetting())}async function ui(e){await ii().saveAppSetting(JSON.stringify(e))}async function di(){return JSON.parse(await ii().loadResearchSetting())}async function hi(e){await ii().saveResearchSetting(JSON.stringify(e))}async function pi(){return JSON.parse(await ii().loadGameSetting())}async function mi(e){await ii().saveGameSetting(JSON.stringify(e))}async function _i(){return new Ft(await ii().loadUSIEngineSetting())}async function gi(e){await ii().saveUSIEngineSetting(e.jsonWithIndent)}async function Ei(){return await ii().showSelectUSIEngineDialog()}async function Si(e){return JSON.parse(await ii().getUSIEngineInfo(e))}async function vi(e,t){await ii().startResearch(JSON.stringify(e),t)}async function fi(){await ii().endResearch()}async function Ii(e,t){await ii().startGame(JSON.stringify(e),t)}async function wi(e,t){await ii().endGame(e,t)}async function Ti(e,t,i,n){await ii().updateUSIPosition(e,JSON.stringify(t),i,n)}async function Oi(e){await ii().stopUSI(e)}async function Ai(e,t){await ii().sendUSISetOption(e,t)}function Ni(e){const t=ii();t.onSendError((t=>{e.commit(Wi.PUSH_ERROR,t)})),t.onMenuEvent((t=>{if(!e.getters.isBussy)switch(t){case Bt.NEW_RECORD:e.commit(Wi.NEW_RECORD);break;case Bt.OPEN_RECORD:e.dispatch(qi.OPEN_RECORD);break;case Bt.SAVE_RECORD:e.dispatch(qi.SAVE_RECORD,{overwrite:!0});break;case Bt.SAVE_RECORD_AS:e.dispatch(qi.SAVE_RECORD);break;case Bt.COPY_RECORD:e.dispatch(qi.COPY_RECORD);break;case Bt.PASTE_RECORD:e.commit(Wi.SHOW_PASTE_DIALOG);break;case Bt.REMOVE_RECORD_AFTER:e.commit(Wi.REMOVE_RECORD_AFTER);break;case Bt.START_POSITION_EDITING:e.dispatch(qi.START_POSITION_EDITING);break;case Bt.END_POSITION_EDITING:e.dispatch(qi.END_POSITION_EDITING);break;case Bt.CHANGE_TURN:e.commit(Wi.CHANGE_TURN);break;case Bt.INIT_POSITION_STANDARD:e.commit(Wi.INITIALIZE_POSITION,ye.STANDARD);break;case Bt.INIT_POSITION_HANDICAP_LANCE:e.commit(Wi.INITIALIZE_POSITION,ye.HANDICAP_LANCE);break;case Bt.INIT_POSITION_HANDICAP_RIGHT_LANCE:e.commit(Wi.INITIALIZE_POSITION,ye.HANDICAP_RIGHT_LANCE);break;case Bt.INIT_POSITION_HANDICAP_BISHOP:e.commit(Wi.INITIALIZE_POSITION,ye.HANDICAP_BISHOP);break;case Bt.INIT_POSITION_HANDICAP_ROOK:e.commit(Wi.INITIALIZE_POSITION,ye.HANDICAP_ROOK);break;case Bt.INIT_POSITION_HANDICAP_ROOK_LANCE:e.commit(Wi.INITIALIZE_POSITION,ye.HANDICAP_ROOK_LANCE);break;case Bt.INIT_POSITION_HANDICAP_2PIECES:e.commit(Wi.INITIALIZE_POSITION,ye.HANDICAP_2PIECES);break;case Bt.INIT_POSITION_HANDICAP_4PIECES:e.commit(Wi.INITIALIZE_POSITION,ye.HANDICAP_4PIECES);break;case Bt.INIT_POSITION_HANDICAP_6PIECES:e.commit(Wi.INITIALIZE_POSITION,ye.HANDICAP_6PIECES);break;case Bt.INIT_POSITION_HANDICAP_8PIECES:e.commit(Wi.INITIALIZE_POSITION,ye.HANDICAP_8PIECES);break;case Bt.INIT_POSITION_TSUME_SHOGI:e.commit(Wi.INITIALIZE_POSITION,ye.TSUME_SHOGI);break;case Bt.START_GAME:e.commit(Wi.SHOW_GAME_DIALOG);break;case Bt.STOP_GAME:e.dispatch(qi.STOP_GAME);break;case Bt.RESIGN:e.dispatch(qi.RESIGN_BY_USER);break;case Bt.START_RESEARCH:e.commit(Wi.SHOW_RESEARCH_DIALOG);break;case Bt.STOP_RESEARCH:e.dispatch(qi.STOP_RESEARCH);break;case Bt.FLIP_BOARD:e.commit(Wi.FLIP_BOARD);break;case Bt.APP_SETTING_DIALOG:e.commit(Wi.OPEN_APP_SETTING_DIALOG);break;case Bt.USI_ENGINE_SETTING_DIALOG:e.commit(Wi.OPEN_USI_ENGINE_MANAGEMENT_DIALOG);break}})),t.onUSIBestMove(((t,i,n,o)=>{e.dispatch(qi.DO_MOVE_BY_USI_ENGINE,{sessionID:t,usi:i,color:n,sfen:o})})),t.onUSIInfo(((t,i,n,o,a)=>{e.dispatch(qi.UPDATE_USI_INFO,{sessionID:t,usi:i,sender:n,name:o,info:JSON.parse(a)})})),(0,o.YP)((()=>[e.state.mode,e.getters.isBussy]),(([e,i])=>{t.updateMenuState(e,i)})),t.updateMenuState(e.state.mode,e.getters.isBussy)}var Ri=i(3907),Pi=i(4914),yi=i.n(Pi);function bi(e){const t=e?.type||"sine",i=e?.frequency||440,n=e?.volume||2,o=new AudioContext,a=o.createOscillator(),s=o.createGain();return a.connect(s),s.connect(o.destination),a.type=t,a.frequency.value=i,s.gain.value=.005*n,a.onended=()=>{s.disconnect(o.destination),a.disconnect(s)},a.start(o.currentTime),e?.time&&a.stop(o.currentTime+e.time),{stop:()=>{e?.time||a.stop()}}}function Hi(e){bi({type:"sine",frequency:e.frequency,time:.1,volume:e.volume})}function ki(e){return bi({type:"sine",frequency:e.frequency,volume:e.volume})}let Ci;function Di(e){const t=Date.now();if(Ci&&t<Ci+200)return;const i=new Audio("sound/piece.mp3");i.volume=.01*e,i.play(),Ci=t}var Li;function Mi(e){switch(e){case Li.BLACK_PLAYER:return"先手";case Li.WHITE_PLAYER:return"後手";case Li.RESEARCHER:return"検討"}}(function(e){e["BLACK_PLAYER"]="blackPlayer",e["WHITE_PLAYER"]="whitePlayer",e["RESEARCHER"]="researcher"})(Li||(Li={}));const Gi=2e3,Bi=-Gi;class xi{constructor(e){if((0,Y.Z)(this,"evaluation",void 0),e){const t=JSON.parse(e);this.evaluation=t.evaluation}}updateScore(e,t,i){switch(this.evaluation||(this.evaluation={}),t){case Li.BLACK_PLAYER:this.evaluation[Li.BLACK_PLAYER]=i;break;case Li.WHITE_PLAYER:this.evaluation[Li.WHITE_PLAYER]=-i;break;case Li.RESEARCHER:this.evaluation[Li.RESEARCHER]=e===V.BLACK?i:-i;break}}updateUSIInfo(e,t,i){i.scoreCP?this.updateScore(e,t,Math.min(Math.max(i.scoreCP,Bi),Gi)):i.scoreMate&&this.updateScore(e,t,i.scoreMate>=0?Gi:Bi)}stringify(){return JSON.stringify(this)}}class Ui{constructor(){(0,Y.Z)(this,"black",void 0),(0,Y.Z)(this,"white",void 0),(0,Y.Z)(this,"timerHandle",void 0),(0,Y.Z)(this,"timerStart",void 0),(0,Y.Z)(this,"lastTimeMs",void 0),(0,Y.Z)(this,"_elapsedMs",void 0),(0,Y.Z)(this,"_setting",void 0),this.black={timeMs:0,byoyomi:0},this.white={timeMs:0,byoyomi:0},this.timerHandle=0,this.timerStart=new Date,this.lastTimeMs=0,this._elapsedMs=0,this._setting=zt()}get blackTimeMs(){return this.black.timeMs}get blackByoyomi(){return this.black.byoyomi}get whiteTimeMs(){return this.white.timeMs}get whiteByoyomi(){return this.white.byoyomi}get elapsedMs(){return this._elapsedMs}get setting(){return this._setting}setup(e){this.black.timeMs=1e3*e.timeLimit.timeSeconds,this.black.byoyomi=e.timeLimit.byoyomi,this.white.timeMs=1e3*e.timeLimit.timeSeconds,this.white.byoyomi=e.timeLimit.byoyomi,this._setting=e}getPlayerState(e){switch(e){case V.BLACK:return this.black;case V.WHITE:return this.white}}startTimer(e,t){const i=this.getPlayerState(e);this.timerStart=new Date,this.lastTimeMs=i.timeMs,i.byoyomi=this.setting.timeLimit.byoyomi,this.timerHandle=window.setInterval((()=>{const e=i.timeMs,n=i.byoyomi,o=new Date;this._elapsedMs=o.getTime()-this.timerStart.getTime();const a=this.lastTimeMs-this._elapsedMs;if(a>=0?i.timeMs=a:(i.timeMs=0,i.byoyomi=Math.max(Math.ceil(this.setting.timeLimit.byoyomi+a/1e3),0)),0===i.timeMs&&0===i.byoyomi)return void t.timeout();const s=Math.ceil(e/1e3),r=Math.ceil(i.timeMs/1e3),c=i.byoyomi;0===r&&(e>0||c!==n)?c<=5?t.onBeepUnlimited():(c<=10||c%10===0)&&t.onBeepShort():this.setting.timeLimit.byoyomi||r===s||(r<=5?t.onBeepUnlimited():(r<=10||20===r||30===r||60===r)&&t.onBeepShort())}),100)}increment(e){this.getPlayerState(e).timeMs+=1e3*this.setting.timeLimit.increment}clearTimer(){this.timerHandle&&(window.clearInterval(this.timerHandle),this.timerHandle=0),this._elapsedMs=0}}function Ki(e){const t=e.metadata.getStandardMetadata(qe.DATE);return t?t.trim().replaceAll(" ","_").replaceAll("/","").replaceAll(":","")+".kif":(new Date).toLocaleDateString(void 0,{year:"numeric",month:"2-digit",day:"2-digit"}).replaceAll("/","")+".kif"}var Wi,qi;(function(e){e["UPDATE_APP_SETTING"]="updateAppSetting",e["FLIP_BOARD"]="flipBoard",e["SHOW_PASTE_DIALOG"]="showPasteDialog",e["CLOSE_PASTE_DIALOG"]="closePasteDialog",e["SHOW_GAME_DIALOG"]="showGameDialog",e["SHOW_RESEARCH_DIALOG"]="showResearchDialog",e["OPEN_APP_SETTING_DIALOG"]="openAppSettingDialog",e["OPEN_USI_ENGINE_MANAGEMENT_DIALOG"]="openUSIEngineManagementDialog",e["CLOSE_DIALOG"]="closeDialog",e["NEW_RECORD"]="newRecord",e["UPDATE_RECORD_COMMENT"]="updateRecordComment",e["CHANGE_TURN"]="changeTurn",e["INITIALIZE_POSITION"]="initializePosition",e["EDIT_POSITION"]="editPosition",e["CHANGE_MOVE_NUMBER"]="changeMoveNumber",e["CHANGE_BRANCH"]="changeBranch",e["REMOVE_RECORD_AFTER"]="removeRecordAfter",e["DO_MOVE"]="move",e["CLEAR_GAME_TIMER"]="clearGameTimer",e["UPDATE_USI_INFO"]="updateUSIInfo",e["PUSH_MESSAGE"]="pushMessage",e["SHIFT_MESSAGE"]="shiftMessage",e["PUSH_ERROR"]="pushError",e["CLEAR_ERRORS"]="clearErrors",e["RETAIN_BUSSY_STATE"]="retainBussyState",e["RELEASE_BUSSY_STATE"]="releaseBussyState"})(Wi||(Wi={})),function(e){e["UPDATE_APP_SETTING"]="updateAppSetting",e["OPEN_RECORD"]="openRecord",e["SAVE_RECORD"]="saveRecord",e["COPY_RECORD"]="copyRecord",e["PASTE_RECORD"]="pasteRecord",e["START_POSITION_EDITING"]="startPositionEditing",e["END_POSITION_EDITING"]="endPositionEditing",e["UPDATE_USI_INFO"]="updateUsiInfo",e["START_RESEARCH"]="startResearch",e["STOP_RESEARCH"]="stopResearch",e["START_GAME"]="startGame",e["STOP_GAME"]="stopGame",e["RESIGN_BY_USER"]="resign",e["DO_MOVE_BY_USER"]="doMoveByUser",e["DO_MOVE_BY_USI_ENGINE"]="doMoveByUSIEngine",e["RESET_GAME_TIMER"]="resetGameTimer",e["BEEP_UNLIMITED"]="beepUnlimited",e["BEEP_SHORT"]="beepShort"}(qi||(qi={}));const Fi={state:{count:0},getters:{isBussy(e){return 0!==e.count}},mutations:{[Wi.RETAIN_BUSSY_STATE](e){e.count+=1},[Wi.RELEASE_BUSSY_STATE](e){e.count-=1}}};function Vi(e,t){const i=e.clone();let n,o="";for(const a of t){const e=i.createMoveBySFEN(a);if(!e)break;i.doMove(e,{ignoreValidation:!0}),o+=e.getDisplayText(n),n=e}return o}class ji{constructor(e){(0,Y.Z)(this,"name",void 0),(0,Y.Z)(this,"nodes",void 0),(0,Y.Z)(this,"nps",void 0),(0,Y.Z)(this,"iterates",void 0),(0,Y.Z)(this,"hashfull",void 0),(0,Y.Z)(this,"currentMove",void 0),(0,Y.Z)(this,"currentMoveText",void 0),this.name=e,this.iterates=[]}update(e,t){const i={};if(void 0!==t.depth&&(i.depth=t.depth),void 0!==t.seldepth&&(i.selectiveDepth=t.seldepth),void 0!==t.timeMs&&(i.timeMs=t.timeMs),void 0!==t.nodes&&(this.nodes=t.nodes),t.pv&&(i.pv=t.pv,i.text=Vi(e,t.pv)),void 0!==t.multipv&&(i.multiPV=t.multipv),void 0!==t.scoreCP&&(i.score=t.scoreCP),void 0!==t.scoreMate&&(i.scoreMate=t.scoreMate),void 0!==t.lowerbound&&(i.lowerBound=t.lowerbound),void 0!==t.upperbound&&(i.upperBound=t.upperbound),void 0!==t.currmove){this.currentMove=t.currmove;const i=e.createMoveBySFEN(t.currmove);i&&(this.currentMoveText=i.getDisplayText())}void 0!==t.hashfullPerMill&&(this.hashfull=t.hashfullPerMill/1e3),void 0!==t.nps&&(this.nps=t.nps),t.string&&(i.text=t.string),0!==Object.keys(i).length&&this.iterates.unshift(i)}}const Yi={mutations:{[Wi.UPDATE_USI_INFO](e,t){switch(e.sessionID!=t.sessionID&&(e.blackPlayer=void 0,e.whitePlayer=void 0,e.researcher=void 0,e.sessionID=t.sessionID),t.sender){case Li.BLACK_PLAYER:e.blackPlayer&&e.blackPosition===t.position.sfen||(e.blackPlayer=new ji(t.name),e.blackPosition=t.position.sfen),e.blackPlayer.update(t.position,t.info);break;case Li.WHITE_PLAYER:e.whitePlayer&&e.whitePosition===t.position.sfen||(e.whitePlayer=new ji(t.name),e.whitePosition=t.position.sfen),e.whitePlayer.update(t.position,t.info);break;case Li.RESEARCHER:e.researcher&&e.researchPosition===t.position.sfen||(e.researcher=new ji(t.name),e.researchPosition=t.position.sfen),e.researcher.update(t.position,t.info);break}}}};var Zi;(function(e){e["NORMAL"]="normal",e["PASTE_DIALOG"]="pasteDialog",e["POSITION_EDITING"]="positionEditing",e["GAME"]="game",e["GAME_DIALOG"]="gameDialog",e["RESEARCH"]="research",e["RESEARCH_DIALOG"]="researchDialog",e["USI_ENGINE_SETTING_DIALOG"]="usiEngineSettingDialog",e["APP_SETTING_DIALOG"]="appSettingDialog"})(Zi||(Zi={}));const zi={state:{queue:[]},getters:{hasMessage(e){return 0!==e.queue.length},message(e){return e.queue[0]}},mutations:{[Wi.PUSH_MESSAGE](e,t){e.queue.push(t)},[Wi.SHIFT_MESSAGE](e){e.queue.shift()}}},Ji={state:{queue:[]},getters:{hasError(e){return 0!==e.queue.length}},mutations:{[Wi.PUSH_ERROR](e,t){t instanceof Error?e.queue.push(t):e.queue.push(new Error(t))},[Wi.CLEAR_ERRORS](e){e.queue=[]}}},$i=Symbol();function Xi(){return(0,Ri.oR)($i)}const Qi=(0,Ri.MT)({state:{appSetting:Vt(),record:new ze,mode:Zi.NORMAL,usiSessionID:0,game:new Ui},modules:{usi:Yi,message:zi,error:Ji,bussy:Fi},getters:{isMovableByUser(e){switch(e.mode){case Zi.NORMAL:case Zi.RESEARCH:return!0;case Zi.GAME:return(e.record.position.color===V.BLACK?e.game.setting.black.uri:e.game.setting.white.uri)===jt}return!1}},mutations:{[Wi.UPDATE_APP_SETTING](e,t){e.appSetting={...e.appSetting,...t}},[Wi.FLIP_BOARD](e){e.appSetting.boardFlipping=!e.appSetting.boardFlipping,ui(e.appSetting)},[Wi.SHOW_PASTE_DIALOG](e){e.mode===Zi.NORMAL&&(e.mode=Zi.PASTE_DIALOG)},[Wi.CLOSE_PASTE_DIALOG](e){e.mode===Zi.PASTE_DIALOG&&(e.mode=Zi.NORMAL)},[Wi.SHOW_GAME_DIALOG](e){e.mode===Zi.NORMAL&&(e.mode=Zi.GAME_DIALOG)},[Wi.SHOW_RESEARCH_DIALOG](e){e.mode===Zi.NORMAL&&(e.mode=Zi.RESEARCH_DIALOG)},[Wi.OPEN_APP_SETTING_DIALOG](e){e.mode===Zi.NORMAL&&(e.mode=Zi.APP_SETTING_DIALOG)},[Wi.OPEN_USI_ENGINE_MANAGEMENT_DIALOG](e){e.mode===Zi.NORMAL&&(e.mode=Zi.USI_ENGINE_SETTING_DIALOG)},[Wi.CLOSE_DIALOG](e){e.mode!==Zi.USI_ENGINE_SETTING_DIALOG&&e.mode!==Zi.APP_SETTING_DIALOG&&e.mode!==Zi.GAME_DIALOG&&e.mode!==Zi.RESEARCH_DIALOG||(e.mode=Zi.NORMAL)},[Wi.NEW_RECORD](e){e.mode==Zi.NORMAL&&(e.record.clear(new Be),e.recordFilePath=void 0)},[Wi.UPDATE_RECORD_COMMENT](e,t){e.record.current.comment=t},[Wi.CHANGE_TURN](e){if(e.mode!=Zi.POSITION_EDITING)return;const t=e.record.position.clone();t.setColor(Z(t.color)),e.record.clear(t)},[Wi.INITIALIZE_POSITION](e,t){if(e.mode!=Zi.POSITION_EDITING)return;const i=new Be;i.reset(t),e.record.clear(i)},[Wi.EDIT_POSITION](e,t){if(e.mode===Zi.POSITION_EDITING){const i=e.record.position.clone();i.edit(t),e.record.clear(i)}},[Wi.CHANGE_MOVE_NUMBER](e,t){e.mode!==Zi.NORMAL&&e.mode!==Zi.RESEARCH||e.record.goto(t)},[Wi.CHANGE_BRANCH](e,t){e.mode!==Zi.NORMAL&&e.mode!==Zi.RESEARCH||e.record.current.branchIndex!==t&&e.record.switchBranchByIndex(t)},[Wi.REMOVE_RECORD_AFTER](e){e.mode!==Zi.NORMAL&&e.mode!==Zi.RESEARCH||e.record.removeAfter()},[Wi.DO_MOVE](e,t){e.record.append(t,{ignoreValidation:!0}),e.record.current.setElapsedMs(e.game.elapsedMs),Di(e.appSetting.pieceVolume)},[Wi.CLEAR_GAME_TIMER](e){e.game.clearTimer(),e.beep5sHandler&&(e.beep5sHandler.stop(),e.beep5sHandler=void 0)}},actions:{async[qi.UPDATE_APP_SETTING]({commit:e,state:t},i){await ui({...t.appSetting,...i}),e(Wi.UPDATE_APP_SETTING,i)},async[qi.OPEN_RECORD]({commit:e,state:t},i){if(t.mode!==Zi.NORMAL)return!1;e(Wi.RETAIN_BUSSY_STATE);try{if(!i&&(i=await oi(),!i))return!1;const n=await ai(i);if(i.match(/\.kif$/)||i.match(/\.kifu$/)){const o=i.match(/\.kif$/)?yi().decode(n,"Shift_JIS"):n.toString(),a=_t(o);return a instanceof ze?(t.recordFilePath=i,t.record=a):e(Wi.PUSH_ERROR,a),!0}return e(Wi.PUSH_ERROR,"不明なファイル形式: "+i),!1}catch(n){return e(Wi.PUSH_ERROR,"棋譜の読み込み中にエラーが出ました: "+n),!1}finally{e(Wi.RELEASE_BUSSY_STATE)}},async[qi.SAVE_RECORD]({commit:e,state:t},i){if(t.mode!==Zi.NORMAL)return!1;e(Wi.RETAIN_BUSSY_STATE);try{let n=t.recordFilePath;if(!i?.overwrite||!n){const e=Ki(t.record);if(n=await si(e),!n)return!1}if(n.match(/\.kif$/)||n.match(/\.kifu$/)){const e=Nt(t.record,{returnCode:t.appSetting.returnCode}),i=n.match(/\.kif$/)?yi().encode(e,"Shift_JIS"):Buffer.from(e);return await ri(n,i),t.recordFilePath=n,!0}return e(Wi.PUSH_ERROR,"不明なファイル形式: "+n),!1}catch(n){return e(Wi.PUSH_ERROR,"棋譜の保存中にエラーが出ました: "+n),!1}finally{e(Wi.RELEASE_BUSSY_STATE)}},[qi.COPY_RECORD]({state:e}){const t=Nt(e.record,{returnCode:e.appSetting.returnCode});navigator.clipboard.writeText(t)},[qi.PASTE_RECORD]({state:e,commit:t},i){if(e.mode!==Zi.NORMAL)return;const n=_t(i);n instanceof ze?(e.recordFilePath=void 0,e.record=n):t(Wi.PUSH_ERROR,n)},[qi.START_POSITION_EDITING]({state:e}){e.mode===Zi.NORMAL&&(e.mode=Zi.POSITION_EDITING,e.record.clear(e.record.position),e.recordFilePath=void 0)},[qi.END_POSITION_EDITING]({state:e}){e.mode===Zi.POSITION_EDITING&&(e.mode=Zi.NORMAL)},[qi.UPDATE_USI_INFO]({state:e,commit:t},i){if(e.usiSessionID!==i.sessionID||e.record.usi!=i.usi)return;t(Wi.UPDATE_USI_INFO,{sessionID:i.sessionID,position:e.record.position,sender:i.sender,name:i.name,info:i.info});const n=new xi(e.record.current.customData);n.updateUSIInfo(e.record.position.color,i.sender,i.info),e.record.current.customData=n.stringify()},async[qi.START_RESEARCH]({commit:e,state:t},i){if(t.mode!==Zi.RESEARCH_DIALOG)return!1;e(Wi.RETAIN_BUSSY_STATE);try{return await hi(i),t.usiSessionID+=1,await vi(i,t.usiSessionID),t.mode=Zi.RESEARCH,!0}catch(n){return e(Wi.PUSH_ERROR,"検討の初期化中にエラーが出ました: "+n),!1}finally{e(Wi.RELEASE_BUSSY_STATE)}},async[qi.STOP_RESEARCH]({commit:e,state:t}){if(t.mode!==Zi.RESEARCH)return!1;e(Wi.RETAIN_BUSSY_STATE);try{return await fi(),t.mode=Zi.NORMAL,!0}catch(i){return e(Wi.PUSH_ERROR,"検討の終了中にエラーが出ました: "+i),!1}finally{e(Wi.RELEASE_BUSSY_STATE)}},async[qi.START_GAME]({commit:e,state:t},i){if(t.mode!==Zi.GAME_DIALOG)return!1;e(Wi.RETAIN_BUSSY_STATE);try{if(await mi(i),i.startPosition){const e=new Be;e.reset(i.startPosition),t.record.clear(e),t.recordFilePath=void 0}if(t.usiSessionID+=1,await Ii(i,t.usiSessionID),t.game.setup(i),t.mode=Zi.GAME,t.record.metadata.setStandardMetadata(qe.BLACK_NAME,i.black.name),t.record.metadata.setStandardMetadata(qe.WHITE_NAME,i.white.name),i.humanIsFront){let n=t.appSetting.boardFlipping;i.black.uri===jt&&i.white.uri!==jt?n=!1:i.black.uri!==jt&&i.white.uri===jt&&(n=!0),n!==t.appSetting.boardFlipping&&e(Wi.FLIP_BOARD)}return!0}catch(n){return e(Wi.PUSH_ERROR,"対局の初期化中にエラーが出ました: "+n),!1}finally{e(Wi.RELEASE_BUSSY_STATE)}},async[qi.STOP_GAME]({commit:e,state:t},i){if(t.mode!==Zi.GAME)return!1;i&&e(Wi.PUSH_MESSAGE,`対局終了（${Ye(i)})`),e(Wi.RETAIN_BUSSY_STATE);try{return await wi(t.record.usi,i),t.record.append(i||Fe.INTERRUPT),t.record.current.setElapsedMs(t.game.elapsedMs),t.mode=Zi.NORMAL,!0}catch(n){return e(Wi.PUSH_ERROR,"対局の終了中にエラーが出ました: "+n),!1}finally{e(Wi.RELEASE_BUSSY_STATE)}},[qi.RESIGN_BY_USER]({state:e,getters:t,dispatch:i}){return e.mode===Zi.GAME&&(t.isMovableByUser?i(qi.STOP_GAME,Fe.RESIGN):void 0)},[qi.DO_MOVE_BY_USER]({commit:e,state:t,getters:i},n){return!!i.isMovableByUser&&(t.mode===Zi.GAME&&t.game.increment(t.record.position.color),e(Wi.DO_MOVE,n),!0)},[qi.DO_MOVE_BY_USI_ENGINE]({commit:e,dispatch:t,state:i},n){if(i.mode!==Zi.GAME)return!1;if(i.usiSessionID!==n.sessionID)return!1;if(i.record.usi!==n.usi)return!1;if(n.color!==i.record.position.color)return e(Wi.PUSH_ERROR,"手番ではないエンジンから指し手を受信しました:"+n.sfen),t(qi.STOP_GAME,Fe.FOUL_LOSE),!1;if("resign"===n.sfen)return t(qi.STOP_GAME,Fe.RESIGN),!0;if("win"===n.sfen)return t(qi.STOP_GAME,Fe.ENTERING_OF_KING),!0;const o=i.record.position.createMoveBySFEN(n.sfen);return o&&i.record.position.isValidMove(o)?(i.game.increment(i.record.position.color),e(Wi.DO_MOVE,o),!0):(e(Wi.PUSH_ERROR,"エンジンから不明な指し手を受信しました:"+n.sfen),t(qi.STOP_GAME,Fe.FOUL_LOSE),!1)},[qi.RESET_GAME_TIMER]({dispatch:e,getters:t,state:i}){const n=i.record.position.color;i.game.startTimer(n,{timeout:()=>{t.isMovableByUser||i.game.setting.enableEngineTimeout?e(qi.STOP_GAME,Fe.TIMEOUT):Oi(n)},onBeepShort:()=>{e(qi.BEEP_SHORT)},onBeepUnlimited:()=>{e(qi.BEEP_UNLIMITED)}})},[qi.BEEP_UNLIMITED]({state:e,getters:t}){(e.appSetting.clockSoundTarget!==Ut.ONLY_USER||t.isMovableByUser)&&(e.beep5sHandler||(e.beep5sHandler=ki({frequency:e.appSetting.clockPitch,volume:e.appSetting.clockVolume})))},[qi.BEEP_SHORT]({state:e,getters:t}){(e.appSetting.clockSoundTarget!==Ut.ONLY_USER||t.isMovableByUser)&&(e.beep5sHandler||Hi({frequency:e.appSetting.clockPitch,volume:e.appSetting.clockVolume}))}}});(0,o.YP)([()=>Qi.state.mode,()=>Qi.state.record.position],(()=>{Qi.commit(Wi.CLEAR_GAME_TIMER),Qi.state.mode===Zi.GAME&&Qi.dispatch(qi.RESET_GAME_TIMER),Qi.state.mode!==Zi.GAME&&Qi.state.mode!==Zi.RESEARCH||Ti(Qi.state.record.usi,Qi.state.game.setting,Qi.state.game.blackTimeMs,Qi.state.game.whiteTimeMs)}),{deep:!0});const en=["src"];function tn(e,t,i,n,a,s){return(0,o.wg)(),(0,o.iD)("img",{class:"icon",src:e.source},null,8,en)}var nn;(function(e){e["BUSSY"]="bussy",e["ERROR"]="error",e["INFO"]="info",e["GAME"]="game",e["STOP"]="stop",e["RESIGN"]="resign",e["RESEARCH"]="research",e["END"]="end",e["EDIT"]="edit",e["CHECK"]="check",e["SWAP"]="swap",e["SWAP_H"]="swap_h",e["SETTINGS"]="settings",e["ENGINE_SETTINGS"]="engineSettings",e["FLIP"]="flip",e["PASTE"]="paste",e["COPY"]="copy",e["DELETE"]="delete",e["COMMENT"]="comment",e["BRAIN"]="brain",e["CHART"]="chart",e["ARROW_DROP"]="arrowDrop",e["FIRST"]="first",e["BACK"]="back",e["NEXT"]="next",e["LAST"]="last"})(nn||(nn={}));const on={[nn.BUSSY]:"icon/hourglass_empty_white_24dp.svg",[nn.ERROR]:"icon/error_outline_white_24dp.svg",[nn.INFO]:"icon/info_white_24dp.svg",[nn.GAME]:"icon/sports_esports_white_24dp.svg",[nn.STOP]:"icon/block_white_24dp.svg",[nn.RESIGN]:"icon/flag_white_24dp.svg",[nn.RESEARCH]:"icon/science_white_24dp.svg",[nn.END]:"icon/do_disturb_on_white_24dp.svg",[nn.EDIT]:"icon/app_registration_white_24dp.svg",[nn.CHECK]:"icon/check_circle_white_24dp.svg",[nn.SWAP]:"icon/swap_vert_white_24dp.svg",[nn.SWAP_H]:"icon/swap_horiz_white_24dp.svg",[nn.SETTINGS]:"icon/settings_white_24dp.svg",[nn.ENGINE_SETTINGS]:"icon/settings_input_component_white_24dp.svg",[nn.FLIP]:"icon/flip_camera_android_white_24dp.svg",[nn.PASTE]:"icon/content_paste_white_24dp.svg",[nn.COPY]:"icon/content_copy_white_24dp.svg",[nn.DELETE]:"icon/backspace_white_24dp.svg",[nn.COMMENT]:"icon/edit_note_white_24dp.svg",[nn.BRAIN]:"icon/psychology_white_24dp.svg",[nn.CHART]:"icon/show_chart_white_24dp.svg",[nn.ARROW_DROP]:"icon/arrow_drop_down_white_24dp.svg",[nn.FIRST]:"icon/first_page_white_24dp.svg",[nn.BACK]:"icon/chevron_left_white_24dp.svg",[nn.NEXT]:"icon/chevron_right_white_24dp.svg",[nn.LAST]:"icon/last_page_white_24dp.svg"};Object.values(on).forEach((e=>{Pt(e)}));var an=(0,o.aZ)({name:"ButtonIcon",props:{icon:{type:String,required:!0}},setup(e){return{source:on[e.icon]}}});const sn=(0,Mt.Z)(an,[["render",tn]]);var rn=sn,cn=(0,o.aZ)({name:"BoardPane",components:{BoardView:Kt,ButtonIcon:rn},props:{maxSize:{type:Dt,required:!0}},setup(){const e=Xi(),t=t=>{e.dispatch(qi.DO_MOVE_BY_USER,t)},i=t=>{e.commit(Wi.EDIT_POSITION,t)},n=()=>{e.commit(Wi.SHOW_GAME_DIALOG)},a=()=>{e.dispatch(qi.STOP_GAME)},s=()=>{e.dispatch(qi.RESIGN_BY_USER)},r=()=>{e.commit(Wi.SHOW_RESEARCH_DIALOG)},c=()=>{e.dispatch(qi.STOP_RESEARCH)},l=()=>{e.dispatch(qi.START_POSITION_EDITING)},u=()=>{e.dispatch(qi.END_POSITION_EDITING)},d=()=>{e.commit(Wi.INITIALIZE_POSITION,ye.STANDARD)},h=()=>{e.commit(Wi.INITIALIZE_POSITION,ye.TSUME_SHOGI)},p=()=>{e.commit(Wi.CHANGE_TURN)},m=()=>{e.commit(Wi.OPEN_APP_SETTING_DIALOG)},_=()=>{e.commit(Wi.OPEN_USI_ENGINE_MANAGEMENT_DIALOG)},g=()=>{e.commit(Wi.FLIP_BOARD)},E=()=>{e.commit(Wi.SHOW_PASTE_DIALOG)},S=()=>{e.dispatch(qi.COPY_RECORD)},v=()=>{e.commit(Wi.REMOVE_RECORD_AFTER)},f=(0,o.Fl)((()=>e.state.mode===Zi.POSITION_EDITING)),I=(0,o.Fl)((()=>e.getters.isMovableByUser)),w=(0,o.Fl)((()=>e.state.record.position)),T=(0,o.Fl)((()=>{const t=e.state.record.current.move;return t instanceof Re?t:null})),O=(0,o.Fl)((()=>e.state.appSetting.boardLayout)),A=(0,o.Fl)((()=>e.state.appSetting.boardFlipping)),N=(0,o.Fl)((()=>e.state.record.metadata.getStandardMetadata(qe.BLACK_NAME))),R=(0,o.Fl)((()=>e.state.record.metadata.getStandardMetadata(qe.WHITE_NAME))),P=(0,o.Fl)((()=>e.state.mode===Zi.GAME?e.state.game.blackTimeMs:void 0)),y=(0,o.Fl)((()=>e.state.mode===Zi.GAME?e.state.game.blackByoyomi:void 0)),b=(0,o.Fl)((()=>e.state.mode===Zi.GAME?e.state.game.whiteTimeMs:void 0)),H=(0,o.Fl)((()=>e.state.mode===Zi.GAME?e.state.game.whiteByoyomi:void 0)),k=(0,o.Fl)((()=>({game:e.state.mode===Zi.NORMAL,stop:e.state.mode===Zi.GAME,resign:e.state.mode===Zi.GAME&&e.getters.isMovableByUser,research:e.state.mode===Zi.NORMAL,endResearch:e.state.mode===Zi.RESEARCH,startEditPosition:e.state.mode===Zi.NORMAL,endEditPosition:e.state.mode===Zi.POSITION_EDITING,initPosition:e.state.mode===Zi.POSITION_EDITING,paste:e.state.mode===Zi.NORMAL,appSettings:e.state.mode===Zi.NORMAL,engineSettings:e.state.mode===Zi.NORMAL})));return{layout:O,position:w,lastMove:T,flip:A,blackPlayerName:N,whitePlayerName:R,blackPlayerTimeMs:P,blackPlayerByoyomi:y,whitePlayerTimeMs:b,whitePlayerByoyomi:H,controlStates:k,onMove:t,onEdit:i,onGame:n,onStop:a,onResign:s,onResearch:r,onEndResearch:c,onStartEditPosition:l,onEndEditPosition:u,onInitPositionStandard:d,onInitPositionTsumeShogi:h,onChangeTurn:p,onOpenAppSettings:m,onOpenEngineSettings:_,onFlip:g,onPaste:E,onCopy:S,onRemoveAfter:v,allowEdit:f,allowMove:I}}});const ln=(0,Mt.Z)(cn,[["render",y],["__scopeId","data-v-50b0e606"]]);var un=ln;function dn(e,t,i,n,a,s){const r=(0,o.up)("RecordView");return(0,o.wg)(),(0,o.iD)("div",null,[(0,o.Wm)(r,{class:"record",record:e.record,operational:e.isRecordOperational,onGoBegin:e.goBegin,onGoBack:e.goBack,onGoForward:e.goForward,onGoEnd:e.goEnd,onSelectMove:e.selectMove,onSelectBranch:e.selectBranch},null,8,["record","operational","onGoBegin","onGoBack","onGoForward","onGoEnd","onSelectMove","onSelectBranch"])])}const hn={class:"frame"},pn={class:"controller"},mn=["disabled"],_n=["disabled"],gn=["disabled"],En=["disabled"],Sn=["disabled"],vn=["selected","value"],fn=["disabled"],In=["selected","value"];function wn(e,t,i,n,a,s){const r=(0,o.up)("ButtonIcon");return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("div",hn,[(0,o._)("div",pn,[(0,o._)("button",{class:"control-button",disabled:!e.operational,onClick:t[0]||(t[0]=t=>e.goBegin())},[(0,o.Wm)(r,{class:"icon",icon:"first"})],8,mn),(0,o._)("button",{class:"control-button",disabled:!e.operational,onClick:t[1]||(t[1]=t=>e.goBack())},[(0,o.Wm)(r,{class:"icon",icon:"back"})],8,_n),(0,o._)("button",{class:"control-button",disabled:!e.operational,onClick:t[2]||(t[2]=t=>e.goForward())},[(0,o.Wm)(r,{class:"icon",icon:"next"})],8,gn),(0,o._)("button",{class:"control-button",disabled:!e.operational,onClick:t[3]||(t[3]=t=>e.goEnd())},[(0,o.Wm)(r,{class:"icon",icon:"last"})],8,En)]),(0,o._)("select",{ref:"moveList",class:"move-list",size:"2",disabled:!e.operational,onChange:t[4]||(t[4]=t=>e.changeNumber())},[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.moves,(e=>((0,o.wg)(),(0,o.iD)("option",{key:e.number,selected:e.selected,value:e.number},(0,b.zw)(0!==e.number?e.number+" ":"")+" "+(0,b.zw)(e.text)+" "+(0,b.zw)(e.hasBranch?" 分岐":""),9,vn)))),128))],40,Sn),(0,o._)("select",{ref:"branchList",class:"branch-list",size:"2",disabled:!e.operational,onChange:t[5]||(t[5]=t=>e.changeBranch())},[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.branches,(e=>((0,o.wg)(),(0,o.iD)("option",{key:e.index,selected:e.selected,value:e.index},(0,b.zw)(e.text),9,In)))),128))],40,fn)])])}var Tn=(0,o.aZ)({name:"RecordView",components:{ButtonIcon:rn},props:{record:{type:ze,required:!0},operational:{type:Boolean,required:!1}},emits:["goBegin","goBack","goForward","goEnd","selectMove","selectBranch"],setup(e,t){const i=(0,l.iH)(null),n=(0,l.iH)(null),a=()=>{t.emit("goBegin")},s=()=>{t.emit("goBack")},r=()=>{t.emit("goForward")},c=()=>{t.emit("goEnd")},u=()=>{t.emit("selectMove",Number(i.value.value))},d=()=>{t.emit("selectBranch",Number(n.value.value))},h=(0,o.Fl)((()=>0===e.record.current.number)),p=(0,o.Fl)((()=>{const t=[];return e.record.moves.forEach((i=>{t.push({number:i.number,text:i.displayText,hasBranch:i.hasBranch,selected:i===e.record.current})})),t})),m=(0,o.Fl)((()=>{if(!e.record.branchBegin?.branch)return null;const t=[];let i;for(i=e.record.branchBegin;i&&i.move;i=i.branch)t.push({index:t.length,text:i.displayMoveText,selected:i.activeBranch});return t}));return{beginPosSelected:h,moves:p,branches:m,moveList:i,branchList:n,goBegin:a,goBack:s,goForward:r,goEnd:c,changeNumber:u,changeBranch:d}}});const On=(0,Mt.Z)(Tn,[["render",wn],["__scopeId","data-v-77f25fc0"]]);var An=On;const Nn=200;var Rn=(0,o.aZ)({name:"RecordPane",components:{RecordView:An},setup(){const e=Xi(),t=t=>{e.commit(Wi.CHANGE_MOVE_NUMBER,t)},i=()=>{t(0)},n=()=>{t(e.state.record.current.number-1)},a=()=>{t(e.state.record.current.number+1)},s=()=>{t(Number.MAX_SAFE_INTEGER)},r=e=>{t(e)},c=t=>{e.commit(Wi.CHANGE_BRANCH,t)},l=(0,o.Fl)((()=>e.state.mode===Zi.NORMAL||e.state.mode===Zi.RESEARCH)),u=(0,o.Fl)((()=>e.state.record));return{isRecordOperational:l,record:u,goBegin:i,goBack:n,goForward:a,goEnd:s,selectMove:r,selectBranch:c}}});const Pn=(0,Mt.Z)(Rn,[["render",dn],["__scopeId","data-v-6a2b9b67"]]);var yn=Pn;const bn=e=>((0,o.dD)("data-v-deb9d856"),e=e(),(0,o.Cn)(),e),Hn={class:"root"},kn={class:"tabs"},Cn=(0,o.Uk)(" 棋譜コメント "),Dn=(0,o.Uk)(" 思考 "),Ln=(0,o.Uk)(" 形勢グラフ "),Mn=(0,o.Uk)(" 最小化 "),Gn=bn((()=>(0,o._)("div",{class:"tab-border"},null,-1))),Bn={class:"tab-contents"};function xn(e,t,i,n,a,s){const r=(0,o.up)("ButtonIcon"),c=(0,o.up)("RecordComment"),l=(0,o.up)("EngineAnalytics"),u=(0,o.up)("EvaluationChart");return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("div",Hn,[(0,o._)("div",{class:(0,b.C_)(["minimize-padding",{enabled:"invisible"===e.activeTab}])},null,2),(0,o._)("div",kn,[(0,o._)("span",{class:(0,b.C_)(["tab",{selected:"comment"===e.activeTab}]),onClick:t[0]||(t[0]=t=>e.changeSelect("comment"))},[(0,o.Wm)(r,{class:"icon",icon:"comment"}),Cn],2),(0,o._)("span",{class:(0,b.C_)(["tab",{selected:"search"===e.activeTab}]),onClick:t[1]||(t[1]=t=>e.changeSelect("search"))},[(0,o.Wm)(r,{class:"icon",icon:"brain"}),Dn],2),(0,o._)("span",{class:(0,b.C_)(["tab",{selected:"chart"===e.activeTab}]),onClick:t[2]||(t[2]=t=>e.changeSelect("chart"))},[(0,o.Wm)(r,{class:"icon",icon:"chart"}),Ln],2),(0,o._)("span",{class:(0,b.C_)(["tab",{selected:"invisible"===e.activeTab}]),onClick:t[3]||(t[3]=t=>e.changeSelect("invisible"))},[(0,o.Wm)(r,{class:"icon",icon:"arrowDrop"}),Mn],2)]),Gn,(0,o._)("div",Bn,[(0,o.Wm)(c,{class:(0,b.C_)(["tab-content",{selected:"comment"===e.activeTab}])},null,8,["class"]),(0,o.Wm)(l,{class:(0,b.C_)(["tab-content",{selected:"search"===e.activeTab}]),size:e.contentSize},null,8,["class","size"]),(0,o.Wm)(u,{class:(0,b.C_)(["tab-content",{selected:"chart"===e.activeTab}]),size:e.contentSize},null,8,["class","size"])])])])}const Un={class:"root"},Kn=["value","readonly"];function Wn(e,t,i,n,a,s){return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("div",Un,[(0,o._)("textarea",{ref:"textarea",class:"text",value:e.comment,readonly:!!e.readonly,onChange:t[0]||(t[0]=(...t)=>e.change&&e.change(...t))},null,40,Kn)])])}var qn=(0,o.aZ)({name:"RecordComment",setup(){const e=Xi(),t=(0,o.Fl)((()=>e.state.record.current.comment)),i=(0,o.Fl)((()=>e.state.mode!=Zi.NORMAL)),n=(0,l.iH)(null),a=t=>{const i=t.target.value;e.commit(Wi.UPDATE_RECORD_COMMENT,i)};return(0,o.bv)((()=>{n.value.addEventListener("copy",(e=>{e.stopPropagation()})),n.value.addEventListener("paste",(e=>{e.stopPropagation()}))})),{textarea:n,comment:t,readonly:i,change:a}}});const Fn=(0,Mt.Z)(qn,[["render",Wn],["__scopeId","data-v-37121ece"]]);var Vn=Fn;const jn={class:"root"};function Yn(e,t,i,n,a,s){const r=(0,o.up)("EngineAnalyticsElement");return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("div",jn,[e.infos.blackPlayer?((0,o.wg)(),(0,o.j4)(r,{key:0,name:e.infos.blackPlayer.name,info:e.infos.blackPlayer,height:e.elementHeight},null,8,["name","info","height"])):(0,o.kq)("",!0),e.infos.whitePlayer?((0,o.wg)(),(0,o.j4)(r,{key:1,name:e.infos.whitePlayer.name,info:e.infos.whitePlayer,height:e.elementHeight},null,8,["name","info","height"])):(0,o.kq)("",!0),e.infos.researcher?((0,o.wg)(),(0,o.j4)(r,{key:2,name:e.infos.researcher.name,info:e.infos.researcher,height:e.elementHeight},null,8,["name","info","height"])):(0,o.kq)("",!0)])])}const Zn=e=>((0,o.dD)("data-v-a0197d80"),e=e(),(0,o.Cn)(),e),zn={class:"root"},Jn={class:"headers"},$n={class:"header"},Xn=Zn((()=>(0,o._)("span",{class:"label"},"エンジン名: ",-1))),Qn={class:"value"},eo={class:"header"},to=Zn((()=>(0,o._)("span",{class:"label"},"最善手: ",-1))),io={class:"value"},no={class:"header"},oo=Zn((()=>(0,o._)("span",{class:"label"},"秒間探索ノード(NPS): ",-1))),ao={class:"value"},so={class:"header"},ro=Zn((()=>(0,o._)("span",{class:"label"},"探索ノード数: ",-1))),co={class:"value"},lo={class:"header"},uo=Zn((()=>(0,o._)("span",{class:"label"},"ハッシュ使用率: ",-1))),ho={class:"value"},po=(0,o.uE)('<div class="list-header" data-v-a0197d80><div class="list-column time" data-v-a0197d80>経過時間</div><div class="list-column multipv-index" data-v-a0197d80>順位</div><div class="list-column depth" data-v-a0197d80>深さ</div><div class="list-column score" data-v-a0197d80>評価値</div></div>',1),mo={class:"list-column time"},_o={class:"list-column multipv-index"},go={class:"list-column depth"},Eo={class:"list-column score"},So={class:"list-column score-flag"},vo={class:"list-column text"};function fo(e,t,i,n,a,s){return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("div",zn,[(0,o._)("div",Jn,[(0,o._)("div",$n,[Xn,(0,o._)("span",Qn,(0,b.zw)(e.name),1)]),(0,o._)("div",eo,[to,(0,o._)("span",io,(0,b.zw)(e.info.currentMoveText||"---"),1)]),(0,o._)("div",no,[oo,(0,o._)("span",ao,(0,b.zw)(e.info.nps||"---"),1)]),(0,o._)("div",so,[ro,(0,o._)("span",co,(0,b.zw)(e.info.nodes||"---"),1)]),(0,o._)("div",lo,[uo,(0,o._)("span",ho,(0,b.zw)(e.info.hashfull?(100*e.info.hashfull).toFixed(1):"---")+" % ",1)])]),po,(0,o._)("div",{class:"list",style:(0,b.j5)(`height:${e.height-36}px`)},[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.info.iterates,((e,t)=>((0,o.wg)(),(0,o.iD)("div",{key:t,class:"list-item"},[(0,o._)("div",mo,(0,b.zw)(e.timeMs?(e.timeMs/1e3).toFixed(1)+"s":""),1),(0,o._)("div",_o,(0,b.zw)(e.multiPV||""),1),(0,o._)("div",go,(0,b.zw)(e.depth)+(0,b.zw)(e.selectiveDepth&&e.depth?"/":"")+(0,b.zw)(e.selectiveDepth),1),(0,o._)("div",Eo,(0,b.zw)(e.score)+" "+(0,b.zw)(e.scoreMate?e.scoreMate:""),1),(0,o._)("div",So,(0,b.zw)(e.lowerBound?"++":"")+" "+(0,b.zw)(e.upperBound?"--":"")+" "+(0,b.zw)(e.scoreMate?"詰":""),1),(0,o._)("div",vo,(0,b.zw)(e.text),1)])))),128))],4)])])}var Io=(0,o.aZ)({name:"EngineAnalyticsElement",props:{name:{type:String,required:!0},info:{type:ji,required:!0},height:{type:Number,required:!0}}});const wo=(0,Mt.Z)(Io,[["render",fo],["__scopeId","data-v-a0197d80"]]);var To=wo,Oo=(0,o.aZ)({name:"EngineAnalytics",components:{EngineAnalyticsElement:To},props:{size:{type:Dt,required:!0}},setup(e){const t=Xi(),i=(0,o.Fl)((()=>t.state.usi)),n=(0,o.Fl)((()=>{const i=(t.state.usi.blackPlayer?1:0)+(t.state.usi.whitePlayer?1:0)+(t.state.usi.researcher?1:0);return 0!==i?e.size.height/i:0}));return{infos:i,elementHeight:n}}});const Ao=(0,Mt.Z)(Oo,[["render",Yn],["__scopeId","data-v-dbaf3902"]]);var No=Ao;const Ro={class:"root"},Po=["width","height"];function yo(e,t,i,n,a,s){return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("div",Ro,[(0,o._)("canvas",{ref:"canvas",width:e.size.width.toFixed(0),height:e.size.height.toFixed(0)},null,8,Po)])])}var bo=i(2728),Ho=(0,o.aZ)({name:"EvaluationChart",props:{size:{type:Dt,required:!0}},setup(e){const t=(0,l.iH)(null),i=Xi();let n;const a=(e,t,i)=>{const n=[];return i.moves.forEach((e=>{const i=new xi(e.customData),o=i.evaluation&&i.evaluation[t];o&&n.push({x:e.number,y:o})})),{label:Mi(t),borderColor:e,data:n,showLine:!0}},s=e=>({label:"現在の局面",borderColor:"red",data:[{x:e.current.number,y:Gi},{x:e.current.number,y:Bi}],showLine:!0,pointBorderWidth:0,pointRadius:0}),r=e=>[s(e),a("royalblue",Li.BLACK_PLAYER,e),a("darkorange",Li.WHITE_PLAYER,e),a("darkgreen",Li.RESEARCHER,e)],c=e=>({x:{min:0,max:e.length+10},y:{min:Bi,max:Gi}}),u=(e,t,n)=>{if(null===e.x)return;const o=n.scales.x.max-n.scales.x.min,a=n.scales.x.right-n.scales.x.left,s=(e.x-n.scales.x.left)/a*o+n.scales.x.min,r=Math.round(s);i.commit(Wi.CHANGE_MOVE_NUMBER,r)};return(0,o.bv)((()=>{const e=t.value,o=e.getContext("2d");n=new bo.kL(o,{type:"scatter",data:{datasets:r(i.state.record)},options:{color:"black",animation:{duration:0},maintainAspectRatio:!1,events:["click"],onClick:u}}),n.draw()})),(0,o.Ah)((()=>{n.destroy()})),(0,o.YP)((()=>[i.state.record]),(([e])=>{n.data.datasets=r(e),n.options.scales=c(e),n.update()}),{deep:!0}),(0,o.YP)((()=>[e.size]),(([e])=>{n.resize(e.width,e.height)}),{deep:!0}),{canvas:t}}});const ko=(0,Mt.Z)(Ho,[["render",yo],["__scopeId","data-v-4e9d2ad3"]]);var Co=ko;const Do=30,Lo=240+Do;var Mo=(0,o.aZ)({name:"InformationPane",components:{RecordComment:Vn,EngineAnalytics:No,EvaluationChart:Co,ButtonIcon:rn},props:{size:{type:Dt,required:!0}},setup(e){const t=Xi(),i=e=>{t.dispatch(qi.UPDATE_APP_SETTING,{informationTab:e})},n=(0,o.Fl)((()=>t.state.appSetting.informationTab)),a=(0,o.Fl)((()=>e.size.reduce(new Dt(0,Do))));return{activeTab:n,contentSize:a,changeSelect:i}}});const Go=(0,Mt.Z)(Mo,[["render",xn],["__scopeId","data-v-deb9d856"]]);var Bo=Go,xo=(0,o.aZ)({name:"StandardLayout",components:{BoardPane:un,RecordPane:yn,InformationPane:Bo},setup(){const e=Xi(),t=(0,l.qj)(new Dt(0,0)),i=(0,l.iH)(0),n=(0,l.iH)(null),a=()=>{t.width=window.innerWidth,t.height=window.innerHeight},s=new ResizeObserver((e=>{i.value=e[0].contentRect.height}));(0,o.bv)((()=>{a(),window.addEventListener("resize",a),s.observe(n.value)})),(0,o.Ah)((()=>{window.removeEventListener("resize",a),s.disconnect()}));const r=(0,o.Fl)((()=>{const i=e.state.appSetting.informationTab!==xt.INVISIBLE?Lo:Do;return new Dt(t.width-Nn,t.height-i)})),c=(0,o.Fl)((()=>new Dt(t.width,t.height-i.value)));return{topPane:n,boardPaneMaxSize:r,bottomPaneSize:c}}});const Uo=(0,Mt.Z)(xo,[["render",c],["__scopeId","data-v-8bad9680"]]);var Ko=Uo;const Wo=e=>((0,o.dD)("data-v-dfe3350c"),e=e(),(0,o.Cn)(),e),qo={ref:"dialog"},Fo=Wo((()=>(0,o._)("div",{class:"dialog-title"},"対局",-1))),Vo={class:"dialog-form-area"},jo={class:"players"},Yo={class:"player"},Zo=Wo((()=>(0,o._)("div",{class:"top-label"},"先手（下手）",-1))),zo=["value"],Jo=["value"],$o={class:"player"},Xo=Wo((()=>(0,o._)("div",{class:"top-label"},"後手（上手）",-1))),Qo=["value"],ea=["value"],ta={class:"players-control"},ia=(0,o.Uk)(" 先後入れ替え "),na={class:"dialog-form-areas-h"},oa={class:"dialog-form-area time-limit"},aa={class:"dialog-form-item"},sa=Wo((()=>(0,o._)("div",{class:"dialog-form-item-label"},"持ち時間",-1))),ra=["value"],ca=Wo((()=>(0,o._)("div",{class:"dialog-form-item-unit"},"時間",-1))),la=["value"],ua=Wo((()=>(0,o._)("div",{class:"dialog-form-item-unit"},"分",-1))),da={class:"dialog-form-item"},ha=Wo((()=>(0,o._)("div",{class:"dialog-form-item-label"},"秒読み",-1))),pa=["value"],ma=Wo((()=>(0,o._)("div",{class:"dialog-form-item-unit"},"秒",-1))),_a={class:"dialog-form-item"},ga=Wo((()=>(0,o._)("div",{class:"dialog-form-item-label"},"増加",-1))),Ea=["value"],Sa=Wo((()=>(0,o._)("div",{class:"dialog-form-item-unit"},"秒",-1))),va={class:"dialog-form-area flags"},fa={class:"dialog-form-item"},Ia=["value"],wa=(0,o.uE)('<option value="current" data-v-dfe3350c>現在の局面</option><option value="standard" data-v-dfe3350c>平手</option><option value="handicapLance" data-v-dfe3350c>香落ち</option><option value="handicapRightLance" data-v-dfe3350c>右香落ち</option><option value="handicapBishop" data-v-dfe3350c>角落ち</option><option value="handicapRook" data-v-dfe3350c>飛車落ち</option><option value="handicapRookLance" data-v-dfe3350c>飛車香落ち</option><option value="handicap2Pieces" data-v-dfe3350c>2枚落ち</option><option value="handicap4Pieces" data-v-dfe3350c>4枚落ち</option><option value="handicap6Pieces" data-v-dfe3350c>6枚落ち</option><option value="handicap8Pieces" data-v-dfe3350c>8枚落ち</option>',11),Ta=[wa],Oa={class:"dialog-form-item"},Aa=["checked"],Na=Wo((()=>(0,o._)("label",{for:"disable-engine-timeout"},"エンジンの時間切れあり",-1))),Ra={class:"dialog-form-item"},Pa=["checked"],ya=Wo((()=>(0,o._)("label",{for:"human-is-front"},"人を手前に表示する",-1))),ba={class:"dialog-main-buttons"};function Ha(e,t,i,n,a,s){const r=(0,o.up)("ButtonIcon");return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("dialog",qo,[Fo,(0,o._)("div",Vo,[(0,o._)("div",jo,[(0,o._)("div",Yo,[Zo,(0,o._)("select",{ref:"blackPlayerSelect",class:"player-select",size:"1",value:e.defaultValues.black.type},[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.players,(e=>((0,o.wg)(),(0,o.iD)("option",{key:e.uri,value:e.uri},(0,b.zw)(e.name),9,Jo)))),128))],8,zo)]),(0,o._)("div",$o,[Xo,(0,o._)("select",{ref:"whitePlayerSelect",class:"player-select",size:"1",value:e.defaultValues.white.type},[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.players,(e=>((0,o.wg)(),(0,o.iD)("option",{key:e.uri,value:e.uri},(0,b.zw)(e.name),9,ea)))),128))],8,Qo)])]),(0,o._)("div",ta,[(0,o._)("button",{onClick:t[0]||(t[0]=(...t)=>e.onSwapColor&&e.onSwapColor(...t))},[(0,o.Wm)(r,{class:"icon",icon:"swap_h"}),ia])])]),(0,o._)("div",na,[(0,o._)("div",oa,[(0,o._)("div",aa,[sa,(0,o._)("input",{ref:"hours",class:"time-input",type:"number",min:"0",max:"99",step:"1",value:e.defaultValues.timeLimit.hours},null,8,ra),ca,(0,o._)("input",{ref:"minutes",class:"time-input",type:"number",min:"0",max:"59",step:"1",value:e.defaultValues.timeLimit.minutes},null,8,la),ua]),(0,o._)("div",da,[ha,(0,o._)("input",{ref:"byoyomi",class:"time-input single",type:"number",min:"0",max:"60",step:"1",value:e.defaultValues.timeLimit.byoyomi},null,8,pa),ma]),(0,o._)("div",_a,[ga,(0,o._)("input",{ref:"increment",class:"time-input single",type:"number",min:"0",max:"99",step:"1",value:e.defaultValues.timeLimit.increment},null,8,Ea),Sa])]),(0,o._)("div",va,[(0,o._)("div",fa,[(0,o._)("select",{ref:"startPosition",value:e.defaultValues.startPosition},Ta,8,Ia)]),(0,o._)("div",Oa,[(0,o._)("input",{id:"disable-engine-timeout",ref:"enableEngineTimeout",type:"checkbox",checked:e.defaultValues.enableEngineTimeout},null,8,Aa),Na]),(0,o._)("div",Ra,[(0,o._)("input",{id:"human-is-front",ref:"humanIsFront",type:"checkbox",checked:e.defaultValues.humanIsFront},null,8,Pa),ya])])]),(0,o._)("div",ba,[(0,o._)("button",{class:"dialog-button",onClick:t[1]||(t[1]=t=>e.onStart())},"対局開始"),(0,o._)("button",{class:"dialog-button",onClick:t[2]||(t[2]=t=>e.onCancel())},"キャンセル")])],512)])}function ka(e){e.addEventListener("cancel",(e=>{e.preventDefault(),e.stopPropagation()})),e.addEventListener("copy",(e=>{e.stopPropagation()})),e.addEventListener("paste",(e=>{e.stopPropagation()})),e.showModal()}function Ca(e){return document.getElementById(e)}var Da=(0,o.aZ)({name:"GameDialog",components:{ButtonIcon:rn},setup(){const e=Xi(),t=(0,l.iH)(null),i=(0,l.iH)(null),n=(0,l.iH)(null),a=(0,l.iH)(null),s=(0,l.iH)(null),r=(0,l.iH)(null),c=(0,l.iH)(null),u=(0,l.iH)(null),d=(0,l.iH)(null),h=(0,l.iH)(null),p=(0,l.iH)(zt()),m=(0,l.iH)(new Ft);e.commit(Wi.RETAIN_BUSSY_STATE),(0,o.bv)((async()=>{ka(t.value);try{p.value=await pi(),m.value=await _i(),e.commit(Wi.RELEASE_BUSSY_STATE)}catch(i){e.commit(Wi.PUSH_ERROR,i),e.commit(Wi.CLOSE_DIALOG)}}));const _=e=>{if(Zt(e)){const t=m.value.getEngine(e);return{name:t.name,uri:e,usi:t}}return{name:"人",uri:jt}},g=()=>{const t={black:_(i.value.value),white:_(n.value.value),timeLimit:{timeSeconds:60*(60*a.value.value+s.value.value),byoyomi:Number(r.value.value),increment:Number(c.value.value)},startPosition:"current"!==u.value.value?u.value.value:void 0,enableEngineTimeout:d.value.checked,humanIsFront:h.value.checked},o=Jt(t);o?e.commit(Wi.PUSH_ERROR,o):e.dispatch(qi.START_GAME,t)},E=()=>{e.commit(Wi.CLOSE_DIALOG)},S=()=>{[i.value.value,n.value.value]=[n.value.value,i.value.value]},v=(0,o.Fl)((()=>({black:{type:p.value.black.uri},white:{type:p.value.white.uri},timeLimit:{hours:Math.floor(p.value.timeLimit.timeSeconds/3600),minutes:Math.floor(p.value.timeLimit.timeSeconds/60)%60,byoyomi:p.value.timeLimit.byoyomi,increment:p.value.timeLimit.increment},startPosition:void 0!==p.value.startPosition?p.value.startPosition:"current",enableEngineTimeout:p.value.enableEngineTimeout,humanIsFront:p.value.humanIsFront}))),f=(0,o.Fl)((()=>[{name:"人",uri:jt},...m.value.engineList]));return{dialog:t,blackPlayerSelect:i,whitePlayerSelect:n,hours:a,minutes:s,byoyomi:r,increment:c,startPosition:u,enableEngineTimeout:d,humanIsFront:h,defaultValues:v,players:f,onStart:g,onCancel:E,onSwapColor:S}}});const La=(0,Mt.Z)(Da,[["render",Ha],["__scopeId","data-v-dfe3350c"]]);var Ma=La;const Ga=e=>((0,o.dD)("data-v-35a19322"),e=e(),(0,o.Cn)(),e),Ba={ref:"dialog"},xa=Ga((()=>(0,o._)("div",{class:"dialog-title"},"検討",-1))),Ua={class:"dialog-form-area"},Ka={class:"dialog-form-item"},Wa=Ga((()=>(0,o._)("div",{class:"dialog-form-item-label"},"エンジン",-1))),qa={class:"dialog-form-item-unit"},Fa=["value"],Va=["value"],ja={class:"dialog-main-buttons"};function Ya(e,t,i,n,a,s){return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("dialog",Ba,[xa,(0,o._)("div",Ua,[(0,o._)("div",Ka,[Wa,(0,o._)("div",qa,[(0,o._)("select",{ref:"engineSelect",class:"engine-select",size:"1",value:e.defaultValue},[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.engines,(e=>((0,o.wg)(),(0,o.iD)("option",{key:e.uri,value:e.uri},(0,b.zw)(e.name),9,Va)))),128))],8,Fa)])])]),(0,o._)("div",ja,[(0,o._)("button",{class:"dialog-button",onClick:t[0]||(t[0]=t=>e.onStart())},"検討開始"),(0,o._)("button",{class:"dialog-button",onClick:t[1]||(t[1]=t=>e.onCancel())},"キャンセル")])],512)])}var Za=(0,o.aZ)({name:"ResearchDialog",setup(){const e=Xi(),t=(0,l.iH)(null),i=(0,l.iH)(null),n=(0,l.iH)($t()),a=(0,l.iH)(new Ft);e.commit(Wi.RETAIN_BUSSY_STATE),(0,o.bv)((async()=>{ka(t.value);try{n.value=await di(),a.value=await _i(),e.commit(Wi.RELEASE_BUSSY_STATE)}catch(i){e.commit(Wi.PUSH_ERROR,i),e.commit(Wi.CLOSE_DIALOG)}}));const s=()=>{const t=i.value.value;if(!a.value.hasEngine(t))return void e.commit(Wi.PUSH_ERROR,"エンジンを選択してください。");const n=a.value.getEngine(t),o={usi:n};e.dispatch(qi.START_RESEARCH,o)},r=()=>{e.commit(Wi.CLOSE_DIALOG)},c=(0,o.Fl)((()=>a.value.engineList)),u=(0,o.Fl)((()=>n.value.usi?n.value.usi.uri:""));return{dialog:t,engineSelect:i,engines:c,defaultValue:u,onStart:s,onCancel:r}}});const za=(0,Mt.Z)(Za,[["render",Ya],["__scopeId","data-v-35a19322"]]);var Ja=za;const $a=e=>((0,o.dD)("data-v-38652cd0"),e=e(),(0,o.Cn)(),e),Xa={ref:"dialog"},Qa=$a((()=>(0,o._)("div",{class:"dialog-title"},"エンジン管理",-1))),es={class:"dialog-form-area engine-list"},ts={key:0,class:"engine"},is=["value"],ns={class:"engine-name"},os=["onClick"],as=["onClick"],ss={class:"dialog-main-buttons"};function rs(e,t,i,n,a,s){const r=(0,o.up)("USIEngineOptionDialog");return(0,o.wg)(),(0,o.iD)(o.HY,null,[(0,o._)("div",null,[(0,o._)("dialog",Xa,[Qa,(0,o._)("div",es,[0===e.engines.length?((0,o.wg)(),(0,o.iD)("div",ts," エンジンが登録されていません。 ")):(0,o.kq)("",!0),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.engines,(t=>((0,o.wg)(),(0,o.iD)("div",{key:t.uri,class:"engine",value:t.uri},[(0,o._)("span",ns,(0,b.zw)(t.name),1),(0,o._)("button",{class:"dialog-button",onClick:i=>e.openOptions(t.uri)}," 設定 ",8,os),(0,o._)("button",{class:"dialog-button",onClick:i=>e.remove(t.uri)}," 削除 ",8,as)],8,is)))),128))]),(0,o._)("button",{class:"dialog-wide-button",onClick:t[0]||(t[0]=t=>e.add())},"追加"),(0,o._)("div",ss,[(0,o._)("button",{class:"dialog-button",onClick:t[1]||(t[1]=t=>e.saveAndClose())}," 保存して閉じる "),(0,o._)("button",{class:"dialog-button",onClick:t[2]||(t[2]=t=>e.cancel())},"キャンセル")])],512)]),e.optionDialog?((0,o.wg)(),(0,o.j4)(r,{key:0,"latest-engine-setting":e.optionDialog,onOk:e.optionOk,onCancel:e.optionCancel},null,8,["latest-engine-setting","onOk","onCancel"])):(0,o.kq)("",!0)],64)}const cs=e=>((0,o.dD)("data-v-38b92ec6"),e=e(),(0,o.Cn)(),e),ls={ref:"dialog"},us=cs((()=>(0,o._)("div",{class:"dialog-title"},"エンジン設定",-1))),ds={class:"dialog-form-area option-list"},hs={class:"option"},ps=cs((()=>(0,o._)("div",{class:"option-name"},"エンジン名",-1))),ms={class:"option-unchangeable"},_s={class:"option"},gs=cs((()=>(0,o._)("div",{class:"option-name"},"作者",-1))),Es={class:"option-unchangeable"},Ss={class:"option"},vs=cs((()=>(0,o._)("div",{class:"option-name"},"場所",-1))),fs={class:"option-unchangeable"},Is={class:"option"},ws=cs((()=>(0,o._)("div",{class:"option-name"},"表示名",-1))),Ts={ref:"engineNameInput",class:"option-value-text",type:"text",name:"ElectronShogiEngineName"},Os={class:"option-name"},As=["id","min","max","name"],Ns=["id","name"],Rs=["id","name"],Ps=["onClick"],ys=["id"],bs=cs((()=>(0,o._)("option",{value:""},"既定値",-1))),Hs=cs((()=>(0,o._)("option",{value:"true"},"ON",-1))),ks=cs((()=>(0,o._)("option",{value:"false"},"OFF",-1))),Cs=[bs,Hs,ks],Ds=["id"],Ls=cs((()=>(0,o._)("option",{value:""},"既定値",-1))),Ms=["value"],Gs=["onClick"],Bs={class:"dialog-main-buttons"};function xs(e,t,i,n,a,s){return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("dialog",ls,[us,(0,o._)("div",ds,[(0,o._)("div",hs,[ps,(0,o._)("div",ms,(0,b.zw)(e.engine.defaultName),1)]),(0,o._)("div",_s,[gs,(0,o._)("div",Es,(0,b.zw)(e.engine.author),1)]),(0,o._)("div",Ss,[vs,(0,o._)("div",fs,(0,b.zw)(e.engine.path),1)]),(0,o._)("div",Is,[ws,(0,o._)("input",Ts,null,512)]),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.options,(t=>((0,o.wg)(),(0,o.iD)("div",{key:t.name,class:"option"},[(0,o._)("div",Os,(0,b.zw)(t.name),1),"spin"===t.type?((0,o.wg)(),(0,o.iD)("input",{key:0,id:t.inputId,class:"option-value-number",type:"number",min:t.min,max:t.max,step:"1",name:t.name},null,8,As)):(0,o.kq)("",!0),"string"===t.type?((0,o.wg)(),(0,o.iD)("input",{key:1,id:t.inputId,class:"option-value-text",type:"text",name:t.name},null,8,Ns)):(0,o.kq)("",!0),"filename"===t.type?((0,o.wg)(),(0,o.iD)("input",{key:2,id:t.inputId,class:"option-value-filename",type:"text",name:t.name},null,8,Rs)):(0,o.kq)("",!0),"filename"===t.type?((0,o.wg)(),(0,o.iD)("button",{key:3,class:"dialog-button",onClick:i=>e.selectFile(t.inputId)}," 選択 ",8,Ps)):(0,o.kq)("",!0),"check"===t.type?((0,o.wg)(),(0,o.iD)("select",{key:4,id:t.inputId,class:"option-value-check"},Cs,8,ys)):(0,o.kq)("",!0),"combo"===t.type?((0,o.wg)(),(0,o.iD)("select",{key:5,id:t.inputId,class:"option-value-combo"},[Ls,((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(t.vars,(e=>((0,o.wg)(),(0,o.iD)("option",{key:e,value:e},(0,b.zw)(e),9,Ms)))),128))],8,Ds)):(0,o.kq)("",!0),"button"===t.type?((0,o.wg)(),(0,o.iD)("button",{key:6,class:"dialog-button",onClick:i=>e.sendOption(t.name)}," 実行 ",8,Gs)):(0,o.kq)("",!0)])))),128))]),(0,o._)("button",{class:"dialog-wide-button",onClick:t[0]||(t[0]=t=>e.reset())}," エンジンの既定値に戻す "),(0,o._)("div",Bs,[(0,o._)("button",{class:"dialog-button",onClick:t[1]||(t[1]=t=>e.ok())},"OK"),(0,o._)("button",{class:"dialog-button",onClick:t[2]||(t[2]=t=>e.cancel())},"キャンセル")])],512)])}var Us=(0,o.aZ)({name:"USIEngineOptionDialog",props:{latestEngineSetting:{type:Object,required:!0}},emits:["ok","cancel"],setup(e,t){const i=(0,l.iH)(null),n=(0,l.iH)(null),a=Xi(),s=e.latestEngineSetting;let r=(0,l.iH)(s);const c=(0,o.Fl)((()=>Object.values(r.value.options).sort(((e,t)=>{const i=e.name.startsWith("USI_"),n=t.name.startsWith("USI_");return i!==n?i?-1:1:e.name<t.name?-1:1})).map(((e,t)=>({...e,inputId:"usiEngineOptionDialogOption"+t,value:Wt(e)})))));a.commit(Wi.RETAIN_BUSSY_STATE),(0,o.bv)((async()=>{ka(i.value);try{r.value=await Si(s.path),qt(r.value,s),n.value.value=r.value.name;for(const e of c.value){const t=Ca(e.inputId);t&&void 0!==e.value&&(t.value=e.value+"")}}catch(e){a.commit(Wi.PUSH_ERROR,e)}finally{a.commit(Wi.RELEASE_BUSSY_STATE)}}));const u=async e=>{a.commit(Wi.RETAIN_BUSSY_STATE);try{const t=await ci(),i=Ca(e);t&&i&&(i.value=t)}catch(t){a.commit(Wi.PUSH_ERROR,t)}finally{a.commit(Wi.RELEASE_BUSSY_STATE)}},d=async e=>{a.commit(Wi.RETAIN_BUSSY_STATE);try{await Ai(r.value.path,e)}catch(t){a.commit(Wi.PUSH_ERROR,t)}finally{a.commit(Wi.RELEASE_BUSSY_STATE)}},h=()=>{n.value.value=r.value.defaultName;for(const e of c.value){const t=Ca(e.inputId);t&&(void 0!==r.value.options[e.name].default?t.value=r.value.options[e.name].default+"":t.value="")}},p=()=>{r.value.name=n.value.value;for(const e of c.value){const t=Ca(e.inputId);t&&(r.value.options[e.name].value=t.value?"spin"===e.type?Number(t.value):t.value:void 0)}t.emit("ok",r.value)},m=()=>{t.emit("cancel")};return{engine:r,dialog:i,engineNameInput:n,options:c,selectFile:u,sendOption:d,reset:h,ok:p,cancel:m}}});const Ks=(0,Mt.Z)(Us,[["render",xs],["__scopeId","data-v-38b92ec6"]]);var Ws=Ks,qs=(0,o.aZ)({name:"USIEngineManagementDialog",components:{USIEngineOptionDialog:Ws},setup(){const e=(0,l.iH)(null),t=(0,l.iH)(null),i=(0,l.iH)(new Ft),n=Xi();n.commit(Wi.RETAIN_BUSSY_STATE),(0,o.bv)((async()=>{ka(e.value);try{i.value=await _i(),n.commit(Wi.RELEASE_BUSSY_STATE)}catch(t){n.commit(Wi.PUSH_ERROR,t),n.commit(Wi.CLOSE_DIALOG)}}));const a=async()=>{try{n.commit(Wi.RETAIN_BUSSY_STATE);const e=await Ei();if(!e)return;i.value.addEngine(await Si(e))}catch(e){n.commit(Wi.PUSH_ERROR,e)}finally{n.commit(Wi.RELEASE_BUSSY_STATE)}},s=e=>{i.value.removeEngine(e)},r=e=>{t.value=i.value.getEngine(e)},c=async()=>{try{n.commit(Wi.RETAIN_BUSSY_STATE),await gi(i.value),n.commit(Wi.CLOSE_DIALOG)}catch(e){n.commit(Wi.PUSH_ERROR,e)}finally{n.commit(Wi.RELEASE_BUSSY_STATE)}},u=()=>{n.commit(Wi.CLOSE_DIALOG)},d=e=>{i.value.updateEngine(e),t.value=null},h=()=>{t.value=null},p=(0,o.Fl)((()=>i.value.engineList));return{optionDialog:t,dialog:e,engines:p,add:a,remove:s,openOptions:r,saveAndClose:c,cancel:u,optionOk:d,optionCancel:h}}});const Fs=(0,Mt.Z)(qs,[["render",rs],["__scopeId","data-v-38652cd0"]]);var Vs=Fs;const js=e=>((0,o.dD)("data-v-acb30814"),e=e(),(0,o.Cn)(),e),Ys={ref:"dialog"},Zs=js((()=>(0,o._)("div",{class:"dialog-title"},"アプリ設定",-1))),zs={class:"dialog-form-area settings"},Js={class:"dialog-form-item"},$s=js((()=>(0,o._)("div",{class:"dialog-form-item-label-wide"},"デザイン",-1))),Xs=["value"],Qs=["value"],er={class:"dialog-form-item"},tr=js((()=>(0,o._)("div",{class:"dialog-form-item-label-wide"},"駒音の大きさ",-1))),ir=["value"],nr=js((()=>(0,o._)("div",{class:"dialog-form-item-unit"},"%",-1))),or={class:"dialog-form-item"},ar=js((()=>(0,o._)("div",{class:"dialog-form-item-label-wide"},"時計音の大きさ",-1))),sr=["value"],rr=js((()=>(0,o._)("div",{class:"dialog-form-item-unit"},"%",-1))),cr={class:"dialog-form-item"},lr=js((()=>(0,o._)("div",{class:"dialog-form-item-label-wide"},"時計音の高さ",-1))),ur=["value"],dr=js((()=>(0,o._)("div",{class:"dialog-form-item-unit"},"Hz (220 ~ 880)",-1))),hr={class:"dialog-form-item"},pr=js((()=>(0,o._)("div",{class:"dialog-form-item-label-wide"},"時計音の対象",-1))),mr=["value"],_r=js((()=>(0,o._)("option",{value:"all"},"全ての手番",-1))),gr=js((()=>(0,o._)("option",{value:"onlyUser"},"人の手番のみ",-1))),Er=[_r,gr],Sr={class:"dialog-form-item"},vr=js((()=>(0,o._)("div",{class:"dialog-form-item-label-wide"},"改行文字",-1))),fr=["value"],Ir=js((()=>(0,o._)("option",{value:"crlf"},"CR + LF (Windows)",-1))),wr=js((()=>(0,o._)("option",{value:"lf"},"LF (UNIX/Mac)",-1))),Tr=js((()=>(0,o._)("option",{value:"cr"},"CR (90年代Mac)",-1))),Or=[Ir,wr,Tr],Ar={class:"dialog-main-buttons"};function Nr(e,t,i,n,a,s){return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("dialog",Ys,[Zs,(0,o._)("div",zs,[(0,o._)("div",Js,[$s,(0,o._)("select",{ref:"boardLayout",value:e.appSetting.boardLayout},[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.boardLayouts,(e=>((0,o.wg)(),(0,o.iD)("option",{key:e,value:e.value},(0,b.zw)(e.name),9,Qs)))),128))],8,Xs)]),(0,o._)("div",er,[tr,(0,o._)("input",{ref:"pieceVolume",value:e.appSetting.pieceVolume,type:"number",max:"100",min:"0"},null,8,ir),nr]),(0,o._)("div",or,[ar,(0,o._)("input",{ref:"clockVolume",value:e.appSetting.clockVolume,type:"number",max:"100",min:"0"},null,8,sr),rr]),(0,o._)("div",cr,[lr,(0,o._)("input",{ref:"clockPitch",value:e.appSetting.clockPitch,type:"number",max:"880",min:"220"},null,8,ur),dr]),(0,o._)("div",hr,[pr,(0,o._)("select",{ref:"clockSoundTarget",value:e.appSetting.clockSoundTarget},Er,8,mr)]),(0,o._)("div",Sr,[vr,(0,o._)("select",{ref:"returnCode",value:e.appSetting.returnCode},Or,8,fr)])]),(0,o._)("div",Ar,[(0,o._)("button",{class:"dialog-button",onClick:t[0]||(t[0]=t=>e.saveAndClose())}," 保存して閉じる "),(0,o._)("button",{class:"dialog-button",onClick:t[1]||(t[1]=t=>e.cancel())},"キャンセル")])],512)])}function Rr(e){const t=Number(e.value),i=Number(e.max),n=Number(e.min);return Math.min(Math.max(t,n),i)}const Pr={"\r\n":"crlf","\n":"lf","\r":"cr"},yr={crlf:"\r\n",lf:"\n",cr:"\r"};var br=(0,o.aZ)({name:"AppSettingDialog",setup(){const e=Xi(),t=(0,l.iH)(null),i=(0,l.iH)(null),n=(0,l.iH)(null),a=(0,l.iH)(null),s=(0,l.iH)(null),r=(0,l.iH)(null),c=(0,l.iH)(null);(0,o.bv)((()=>{ka(t.value)}));const u=async()=>{const t={boardLayout:i.value.value,pieceVolume:Rr(n.value),clockVolume:Rr(a.value),clockPitch:Rr(s.value),clockSoundTarget:r.value.value,returnCode:yr[c.value.value]};e.commit(Wi.RETAIN_BUSSY_STATE);try{await e.dispatch(qi.UPDATE_APP_SETTING,t),e.commit(Wi.CLOSE_DIALOG)}catch(o){e.commit(Wi.PUSH_ERROR,o)}finally{e.commit(Wi.RELEASE_BUSSY_STATE)}},d=()=>{e.commit(Wi.CLOSE_DIALOG)},h=(0,o.Fl)((()=>({...e.state.appSetting,returnCode:Pr[e.state.appSetting.returnCode]}))),p=[{name:"一文字駒",value:yt.HITOMOJI},{name:"一文字駒（ゴシック体）",value:yt.HITOMOJI_GOTHIC}];return{dialog:t,boardLayout:i,pieceVolume:n,clockVolume:a,clockPitch:s,clockSoundTarget:r,returnCode:c,appSetting:h,boardLayouts:p,saveAndClose:u,cancel:d}}});const Hr=(0,Mt.Z)(br,[["render",Nr],["__scopeId","data-v-acb30814"]]);var kr=Hr;const Cr=e=>((0,o.dD)("data-v-01a25e3a"),e=e(),(0,o.Cn)(),e),Dr={ref:"dialog"},Lr={ref:"content"},Mr={class:"dialog-form-area"},Gr=Cr((()=>(0,o._)("div",{class:"message"},"以下の棋譜を取り込みます。",-1))),Br={key:0,class:"message"},xr=(0,o.Uk)(" ※テキストエリアに棋譜を貼り付けてください。"),Ur=Cr((()=>(0,o._)("br",null,null,-1))),Kr=(0,o.Uk)(" ※インストールアプリ版では自動的に貼り付けられます。 "),Wr=[xr,Ur,Kr],qr={ref:"textarea"},Fr={class:"dialog-main-buttons"};function Vr(e,t,i,n,a,s){return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("dialog",Dr,[(0,o._)("div",Lr,[(0,o._)("div",Mr,[Gr,e.isNative?(0,o.kq)("",!0):((0,o.wg)(),(0,o.iD)("div",Br,Wr)),(0,o._)("textarea",qr,null,512)])],512),(0,o._)("div",Fr,[(0,o._)("button",{class:"dialog-button",onClick:t[0]||(t[0]=(...t)=>e.onOk&&e.onOk(...t))},"取り込む"),(0,o._)("button",{class:"dialog-button",onClick:t[1]||(t[1]=(...t)=>e.onCancel&&e.onCancel(...t))},"キャンセル")])],512)])}var jr=(0,o.aZ)({name:"PasteDialog",setup(){const e=Xi(),t=(0,l.iH)(null),i=(0,l.iH)(null);e.commit(Wi.RETAIN_BUSSY_STATE),(0,o.bv)((async()=>{try{ka(t.value),ti()&&(i.value.value=await navigator.clipboard.readText())}finally{e.commit(Wi.RELEASE_BUSSY_STATE)}}));const n=()=>{const t=i.value.value;e.commit(Wi.CLOSE_PASTE_DIALOG),t&&e.dispatch(qi.PASTE_RECORD,t)},a=()=>{e.commit(Wi.CLOSE_PASTE_DIALOG)};return{dialog:t,textarea:i,onOk:n,onCancel:a,isNative:ti()}}});const Yr=(0,Mt.Z)(jr,[["render",Vr],["__scopeId","data-v-01a25e3a"]]);var Zr=Yr;const zr=e=>((0,o.dD)("data-v-4939dcf2"),e=e(),(0,o.Cn)(),e),Jr={ref:"dialog",class:"bussy"},$r={class:"content"},Xr=zr((()=>(0,o._)("div",{class:"message"},"処理中です。お待ち下さい。",-1)));function Qr(e,t,i,n,a,s){const r=(0,o.up)("ButtonIcon");return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("dialog",Jr,[(0,o._)("div",$r,[(0,o.Wm)(r,{class:"icon",icon:"bussy"}),Xr])],512)])}var ec=(0,o.aZ)({name:"BussyMessage",components:{ButtonIcon:rn},setup(){const e=(0,l.iH)(null);return(0,o.bv)((()=>{ka(e.value)})),{dialog:e}}});const tc=(0,Mt.Z)(ec,[["render",Qr],["__scopeId","data-v-4939dcf2"]]);var ic=tc;const nc={ref:"dialog",class:"messagebox"},oc={class:"content"},ac={class:"message"},sc={class:"dialog-main-buttons"};function rc(e,t,i,n,a,s){const r=(0,o.up)("ButtonIcon");return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("dialog",nc,[(0,o._)("div",oc,[(0,o.Wm)(r,{class:"icon",icon:"info"}),(0,o._)("div",ac,(0,b.zw)(e.message),1)]),(0,o._)("div",sc,[(0,o._)("button",{onClick:t[0]||(t[0]=t=>e.onClose())},"閉じる")])],512)])}var cc=(0,o.aZ)({name:"InfoMessage",components:{ButtonIcon:rn},setup(){const e=Xi(),t=(0,l.iH)(null);(0,o.bv)((()=>{ka(t.value)}));const i=(0,o.Fl)((()=>e.getters.message)),n=()=>{e.commit(Wi.SHIFT_MESSAGE)};return{dialog:t,message:i,onClose:n}}});const lc=(0,Mt.Z)(cc,[["render",rc],["__scopeId","data-v-619a2b23"]]);var uc=lc;const dc={ref:"dialog",class:"error"},hc={class:"content"},pc={class:"items"},mc={class:"notice"},_c={class:"index"},gc={class:"message"},Ec={class:"dialog-main-buttons"};function Sc(e,t,i,n,a,s){const r=(0,o.up)("ButtonIcon");return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("dialog",dc,[(0,o._)("div",hc,[(0,o.Wm)(r,{class:"icon",icon:"error"}),(0,o._)("div",pc,[(0,o._)("div",mc,(0,b.zw)(e.errors.length)+" 件のエラーが発生しました。 ",1),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.errors,(e=>((0,o.wg)(),(0,o.iD)("div",{key:e.index,class:"item"},[(0,o._)("p",_c,(0,b.zw)(e.index+1)+" 件目",1),(0,o._)("p",gc,(0,b.zw)(e.message),1)])))),128))])]),(0,o._)("div",Ec,[(0,o._)("button",{onClick:t[0]||(t[0]=t=>e.onClose())},"閉じる")])],512)])}var vc=(0,o.aZ)({name:"ErrorMessage",components:{ButtonIcon:rn},setup(){const e=Xi(),t=(0,l.iH)(null);(0,o.bv)((()=>{ka(t.value)}));const i=(0,o.Fl)((()=>e.state.error.queue.map(((e,t)=>({message:e.message,index:t}))))),n=()=>{e.commit(Wi.CLEAR_ERRORS)};return{dialog:t,errors:i,onClose:n}}});const fc=(0,Mt.Z)(vc,[["render",Sc],["__scopeId","data-v-520b2a4a"]]);var Ic=fc;function wc(){const e=document.activeElement;return e instanceof HTMLTextAreaElement||e instanceof HTMLInputElement||e instanceof HTMLSelectElement}function Tc(e,t){if(!wc())switch(e){case"ArrowUp":return t.onArrowUp;case"ArrowDown":return t.onArrowDown;case"ArrowLeft":return t.onArrowLeft;case"ArrowRight":return t.onArrowRight}}function Oc(e){document.addEventListener("keydown",(t=>{const i=Tc(t.key,e);i&&(t.preventDefault(),i())}))}var Ac=(0,o.aZ)({name:"App",components:{StandardLayout:Ko,GameDialog:Ma,ResearchDialog:Ja,USIEngineManagementDialog:Vs,AppSettingDialog:kr,PasteDialog:Zr,BussyMessage:ic,InfoMessage:uc,ErrorMessage:Ic},setup(){const e=Xi(),t=(0,o.Fl)((()=>({game:e.state.mode===Zi.GAME_DIALOG,research:e.state.mode===Zi.RESEARCH_DIALOG,usiEngineSetting:e.state.mode===Zi.USI_ENGINE_SETTING_DIALOG,appSetting:e.state.mode===Zi.APP_SETTING_DIALOG,paste:e.state.mode===Zi.PASTE_DIALOG,processing:e.getters.isBussy}))),i=(0,o.Fl)((()=>e.getters.hasMessage)),n=(0,o.Fl)((()=>e.getters.hasError));return(0,o.bv)((()=>{const t=document.getElementsByTagName("body")[0];t.addEventListener("copy",(t=>{e.dispatch(qi.COPY_RECORD),t.preventDefault()})),t.addEventListener("paste",(t=>{e.commit(Wi.SHOW_PASTE_DIALOG),t.preventDefault()})),t.addEventListener("dragover",(e=>{e.preventDefault()})),t.addEventListener("drop",(t=>{if(t.dataTransfer&&t.dataTransfer.files[0]){const i=t.dataTransfer.files[0].path;e.dispatch(qi.OPEN_RECORD,i)}t.preventDefault()})),Oc({onArrowUp(){const t=e.state.record.current.number;e.commit(Wi.CHANGE_MOVE_NUMBER,t-1)},onArrowDown(){const t=e.state.record.current.number;e.commit(Wi.CHANGE_MOVE_NUMBER,t+1)},onArrowLeft(){e.commit(Wi.CHANGE_MOVE_NUMBER,0)},onArrowRight(){e.commit(Wi.CHANGE_MOVE_NUMBER,Number.MAX_SAFE_INTEGER)}})})),{dialogVisibilities:t,hasMessage:i,hasErrors:n}}});const Nc=(0,Mt.Z)(Ac,[["render",a]]);var Rc=Nc;bo.kL.register(...bo.zX),Ni(Qi),Promise.allSettled([li().then((e=>{Qi.commit(Wi.UPDATE_APP_SETTING,e)})).catch((e=>{Qi.commit(Wi.PUSH_ERROR,new Error("アプリ設定の読み込み中にエラーが発生しました :"+e))})),async function(){const e=await ni();e&&await Qi.dispatch(qi.OPEN_RECORD,e)}()]).finally((()=>{(0,n.ri)(Rc).use(Qi,$i).mount("#app")}))},5832:function(){}},t={};function i(n){var o=t[n];if(void 0!==o)return o.exports;var a=t[n]={exports:{}};return e[n](a,a.exports,i),a.exports}i.m=e,function(){var e=[];i.O=function(t,n,o,a){if(!n){var s=1/0;for(u=0;u<e.length;u++){n=e[u][0],o=e[u][1],a=e[u][2];for(var r=!0,c=0;c<n.length;c++)(!1&a||s>=a)&&Object.keys(i.O).every((function(e){return i.O[e](n[c])}))?n.splice(c--,1):(r=!1,a<s&&(s=a));if(r){e.splice(u--,1);var l=o();void 0!==l&&(t=l)}}return t}a=a||0;for(var u=e.length;u>0&&e[u-1][2]>a;u--)e[u]=e[u-1];e[u]=[n,o,a]}}(),function(){i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,{a:t}),t}}(),function(){i.d=function(e,t){for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}}(),function(){i.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={826:0};i.O.j=function(t){return 0===e[t]};var t=function(t,n){var o,a,s=n[0],r=n[1],c=n[2],l=0;if(s.some((function(t){return 0!==e[t]}))){for(o in r)i.o(r,o)&&(i.m[o]=r[o]);if(c)var u=c(i)}for(t&&t(n);l<s.length;l++)a=s[l],i.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return i.O(u)},n=self["webpackChunkelectron_shogi"]=self["webpackChunkelectron_shogi"]||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))}();var n=i.O(void 0,[998],(function(){return i(2508)}));n=i.O(n)})();
//# sourceMappingURL=index.254169a6.js.map