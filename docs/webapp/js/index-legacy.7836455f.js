(function(){var e={739:function(e,t,n){"use strict";var i=n(8534),r=n(9584),o=(n(6992),n(8674),n(9601),n(7727),n(5666),n(1539),n(7922),n(8783),n(3948),n(1703),n(9963)),a=n(6252),s=n(3577);function c(e,t,n,i,r,o){var c=(0,a.up)("StandardLayout"),u=(0,a.up)("GameDialog"),l=(0,a.up)("ResearchDialog"),h=(0,a.up)("AnalysisDialog"),d=(0,a.up)("USIEngineManagementDialog"),p=(0,a.up)("AppSettingDialog"),v=(0,a.up)("PasteDialog"),f=(0,a.up)("BussyMessage"),g=(0,a.up)("ConfirmDialog"),m=(0,a.up)("InfoMessage"),_=(0,a.up)("ErrorMessage");return(0,a.wg)(),(0,a.iD)("div",{class:(0,s.C_)(["root",e.thema])},[(0,a.Wm)(c,{class:"main"}),e.dialogVisibilities.game?((0,a.wg)(),(0,a.j4)(u,{key:0})):(0,a.kq)("",!0),e.dialogVisibilities.research?((0,a.wg)(),(0,a.j4)(l,{key:1})):(0,a.kq)("",!0),e.dialogVisibilities.analysis?((0,a.wg)(),(0,a.j4)(h,{key:2})):(0,a.kq)("",!0),e.dialogVisibilities.usiEngineSetting?((0,a.wg)(),(0,a.j4)(d,{key:3})):(0,a.kq)("",!0),e.dialogVisibilities.appSetting?((0,a.wg)(),(0,a.j4)(p,{key:4})):(0,a.kq)("",!0),e.dialogVisibilities.paste?((0,a.wg)(),(0,a.j4)(v,{key:5})):(0,a.kq)("",!0),e.dialogVisibilities.bussy?((0,a.wg)(),(0,a.j4)(f,{key:6})):(0,a.kq)("",!0),e.dialogVisibilities.confirm?((0,a.wg)(),(0,a.j4)(g,{key:7})):(0,a.kq)("",!0),e.hasMessage?((0,a.wg)(),(0,a.j4)(m,{key:8})):(0,a.kq)("",!0),e.hasErrors?((0,a.wg)(),(0,a.j4)(_,{key:9})):(0,a.kq)("",!0)],2)}n(4363),n(9653);var u={class:"main"},l={class:"top-pane"};function h(e,t,n,i,r,o){var c=(0,a.up)("BoardPane"),h=(0,a.up)("RecordPane"),d=(0,a.up)("TabPane");return(0,a.wg)(),(0,a.iD)("div",null,[(0,a._)("div",u,[(0,a._)("div",l,[(0,a.Wm)(c,{class:"top-left-pane","max-size":e.boardPaneMaxSize,onResize:e.onBoardPaneResize},null,8,["max-size","onResize"]),(0,a.Wm)(h,{class:"top-right-pane",style:(0,s.j5)(e.recordPaneStyle)},null,8,["style"])]),(0,a.Wm)(d,{class:"bottom-pane",size:e.bottomPaneSize},null,8,["size"])])])}var d=n(2262),p={class:"control top"},v=(0,a.Uk)(" 対局 "),f=(0,a.Uk)(" 対局中断 "),g=(0,a.Uk)(" 投了 "),m=(0,a.Uk)(" 検討 "),_=(0,a.Uk)(" 検討終了 "),y=(0,a.Uk)(" 解析 "),S=(0,a.Uk)(" 解析中断 "),w=(0,a.Uk)(" 局面編集 "),E=(0,a.Uk)(" 局面編集終了 "),k=(0,a.Uk)(" 手番変更 "),I={class:"control bottom"},b=(0,a.Uk)(" アプリ設定 "),T=["disabled"],R=(0,a.Uk)(" エンジン設定 "),A=(0,a.Uk)(" 盤面反転 "),N=(0,a.Uk)(" ファイル "),P=["disabled"],O=(0,a.Uk)(" 指し手削除 ");function C(e,t,n,i,r,o){var s=(0,a.up)("ButtonIcon"),c=(0,a.up)("BoardView"),u=(0,a.up)("FileMenu"),l=(0,a.up)("InitialPositionMenu");return(0,a.wg)(),(0,a.iD)("div",null,[(0,a.Wm)(c,{"piece-image-type":e.appSetting.pieceImage,"board-image-type":e.appSetting.boardImage,"board-label-type":e.appSetting.boardLabelType,"max-size":e.maxSize,position:e.position,"last-move":e.lastMove,flip:e.appSetting.boardFlipping,"allow-move":e.allowMove,"allow-edit":e.allowEdit,"black-player-name":e.blackPlayerName,"white-player-name":e.whitePlayerName,"black-player-time-ms":e.blackPlayerTimeMs,"black-player-byoyomi":e.blackPlayerByoyomi,"white-player-time-ms":e.whitePlayerTimeMs,"white-player-byoyomi":e.whitePlayerByoyomi,onResize:e.onResize,onMove:e.onMove,onEdit:e.onEdit},{"right-control":(0,a.w5)((function(){return[(0,a._)("div",p,[e.controlStates.game?((0,a.wg)(),(0,a.iD)("button",{key:0,class:"control-item",onClick:t[0]||(t[0]=function(){return e.onGame&&e.onGame.apply(e,arguments)})},[(0,a.Wm)(s,{class:"icon",icon:e.Icon.GAME},null,8,["icon"]),v])):(0,a.kq)("",!0),e.controlStates.stop?((0,a.wg)(),(0,a.iD)("button",{key:1,class:"control-item",onClick:t[1]||(t[1]=function(){return e.onStop&&e.onStop.apply(e,arguments)})},[(0,a.Wm)(s,{class:"icon",icon:e.Icon.STOP},null,8,["icon"]),f])):(0,a.kq)("",!0),e.controlStates.resign?((0,a.wg)(),(0,a.iD)("button",{key:2,class:"control-item",onClick:t[2]||(t[2]=function(){return e.onResign&&e.onResign.apply(e,arguments)})},[(0,a.Wm)(s,{class:"icon",icon:e.Icon.RESIGN},null,8,["icon"]),g])):(0,a.kq)("",!0),e.controlStates.research?((0,a.wg)(),(0,a.iD)("button",{key:3,class:"control-item",onClick:t[3]||(t[3]=function(){return e.onResearch&&e.onResearch.apply(e,arguments)})},[(0,a.Wm)(s,{class:"icon",icon:e.Icon.RESEARCH},null,8,["icon"]),m])):(0,a.kq)("",!0),e.controlStates.endResearch?((0,a.wg)(),(0,a.iD)("button",{key:4,class:"control-item",onClick:t[4]||(t[4]=function(){return e.onEndResearch&&e.onEndResearch.apply(e,arguments)})},[(0,a.Wm)(s,{class:"icon",icon:e.Icon.END},null,8,["icon"]),_])):(0,a.kq)("",!0),e.controlStates.analysis?((0,a.wg)(),(0,a.iD)("button",{key:5,class:"control-item",onClick:t[5]||(t[5]=function(){return e.onAnalysis&&e.onAnalysis.apply(e,arguments)})},[(0,a.Wm)(s,{class:"icon",icon:e.Icon.ANALYSIS},null,8,["icon"]),y])):(0,a.kq)("",!0),e.controlStates.endAnalysis?((0,a.wg)(),(0,a.iD)("button",{key:6,class:"control-item",onClick:t[6]||(t[6]=function(){return e.onEndAnalysis&&e.onEndAnalysis.apply(e,arguments)})},[(0,a.Wm)(s,{class:"icon",icon:e.Icon.STOP},null,8,["icon"]),S])):(0,a.kq)("",!0),e.controlStates.startEditPosition?((0,a.wg)(),(0,a.iD)("button",{key:7,class:"control-item",onClick:t[7]||(t[7]=function(){return e.onStartEditPosition&&e.onStartEditPosition.apply(e,arguments)})},[(0,a.Wm)(s,{class:"icon",icon:e.Icon.EDIT},null,8,["icon"]),w])):(0,a.kq)("",!0),e.controlStates.endEditPosition?((0,a.wg)(),(0,a.iD)("button",{key:8,class:"control-item",onClick:t[8]||(t[8]=function(){return e.onEndEditPosition&&e.onEndEditPosition.apply(e,arguments)})},[(0,a.Wm)(s,{class:"icon",icon:e.Icon.CHECK},null,8,["icon"]),E])):(0,a.kq)("",!0),e.controlStates.initPosition?((0,a.wg)(),(0,a.iD)("button",{key:9,class:"control-item",onClick:t[9]||(t[9]=function(){return e.onChangeTurn&&e.onChangeTurn.apply(e,arguments)})},[(0,a.Wm)(s,{class:"icon",icon:e.Icon.SWAP},null,8,["icon"]),k])):(0,a.kq)("",!0),e.controlStates.initPosition?((0,a.wg)(),(0,a.iD)("button",{key:10,class:"control-item",onClick:t[10]||(t[10]=function(){return e.onInitPosition&&e.onInitPosition.apply(e,arguments)})}," 局面の初期化 ")):(0,a.kq)("",!0)])]})),"left-control":(0,a.w5)((function(){return[(0,a._)("div",I,[(0,a._)("button",{class:"control-item",onClick:t[11]||(t[11]=function(){return e.onOpenAppSettings&&e.onOpenAppSettings.apply(e,arguments)})},[(0,a.Wm)(s,{class:"icon",icon:e.Icon.SETTINGS},null,8,["icon"]),b]),(0,a._)("button",{class:"control-item",disabled:!e.controlStates.engineSettings,onClick:t[12]||(t[12]=function(){return e.onOpenEngineSettings&&e.onOpenEngineSettings.apply(e,arguments)})},[(0,a.Wm)(s,{class:"icon",icon:e.Icon.ENGINE_SETTINGS},null,8,["icon"]),R],8,T),(0,a._)("button",{class:"control-item",onClick:t[13]||(t[13]=function(){return e.onFlip&&e.onFlip.apply(e,arguments)})},[(0,a.Wm)(s,{class:"icon",icon:e.Icon.FLIP},null,8,["icon"]),A]),(0,a._)("button",{class:"control-item",onClick:t[14]||(t[14]=function(){return e.onFileAction&&e.onFileAction.apply(e,arguments)})},[(0,a.Wm)(s,{class:"icon",icon:e.Icon.FILE},null,8,["icon"]),N]),(0,a._)("button",{class:"control-item",disabled:!e.controlStates.removeAfter,onClick:t[15]||(t[15]=function(){return e.onRemoveAfter&&e.onRemoveAfter.apply(e,arguments)})},[(0,a.Wm)(s,{class:"icon",icon:e.Icon.DELETE},null,8,["icon"]),O],8,P)])]})),_:1},8,["piece-image-type","board-image-type","board-label-type","max-size","position","last-move","flip","allow-move","allow-edit","black-player-name","white-player-name","black-player-time-ms","black-player-byoyomi","white-player-time-ms","white-player-byoyomi","onResize","onMove","onEdit"]),e.isFileMenuVisible?((0,a.wg)(),(0,a.j4)(u,{key:0,onClose:t[16]||(t[16]=function(t){return e.isFileMenuVisible=!1})})):(0,a.kq)("",!0),e.isInitialPositionMenuVisible?((0,a.wg)(),(0,a.j4)(l,{key:1,onClose:t[17]||(t[17]=function(t){return e.isInitialPositionMenuVisible=!1})})):(0,a.kq)("",!0)])}var H=["src"],M={class:"player-name-text"},L={class:"clock-text"},D={class:"player-name-text"},x={class:"clock-text"},B=["src"],G=["onClick","onContextmenu"],Z=["src"],W=["onClick"],U=["src"],K=["onClick"],F=["src"],q=["src"];function j(e,t,n,i,r,o){return(0,a.wg)(),(0,a.iD)("div",null,[(0,a._)("div",{class:"frame",style:(0,s.j5)(e.layout.frame.style),onClick:t[2]||(t[2]=function(t){return e.clickFrame()})},[(0,a._)("div",{class:"board",style:(0,s.j5)(e.layout.board.style)},[(0,a._)("img",{class:"board-image",src:e.layout.board.imagePath},null,8,H)],4),(0,a._)("div",{class:(0,s.C_)(["player-name",{active:"black"==e.position.color}]),style:(0,s.j5)(e.layout.blackPlayerName.style)},[(0,a._)("span",M,"▲"+(0,s.zw)(e.blackPlayerName),1)],6),(0,a._)("div",{class:(0,s.C_)(["clock",e.blackPlayerTimeSeverity]),style:(0,s.j5)(e.layout.blackClock.style)},[(0,a._)("span",L,(0,s.zw)(e.blackPlayerTimeText),1)],6),(0,a._)("div",{class:(0,s.C_)(["player-name",{active:"white"==e.position.color}]),style:(0,s.j5)(e.layout.whitePlayerName.style)},[(0,a._)("span",D,"△"+(0,s.zw)(e.whitePlayerName),1)],6),(0,a._)("div",{class:(0,s.C_)(["clock",e.whitePlayerTimeSeverity]),style:(0,s.j5)(e.layout.whiteClock.style)},[(0,a._)("span",x,(0,s.zw)(e.whitePlayerTimeText),1)],6),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.layout.square,(function(e){return(0,a.wg)(),(0,a.iD)("div",{key:e.id,class:"square",style:(0,s.j5)(e.backgroundStyle)},null,4)})),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.layout.piece,(function(e){return(0,a.wg)(),(0,a.iD)("div",{key:e.id,class:"piece",style:(0,s.j5)(e.style)},[(0,a._)("img",{class:"piece-image",src:e.imagePath},null,8,B)],4)})),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.layout.labels,(function(e){return(0,a.wg)(),(0,a.iD)("div",{key:e.id,class:"label",style:(0,s.j5)(e.style)},(0,s.zw)(e.character),5)})),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.layout.square,(function(t){return(0,a.wg)(),(0,a.iD)("div",{key:t.id,class:"square",style:(0,s.j5)(t.style),onClick:function(n){return e.clickSquare(n,t.file,t.rank)},onContextmenu:function(n){return e.clickSquareR(n,t.file,t.rank)}},null,44,G)})),128)),(0,a._)("div",{class:"hand",style:(0,s.j5)(e.layout.blackHand.style)},[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.layout.blackHand.pointers,(function(e){return(0,a.wg)(),(0,a.iD)("div",{key:e.id,class:"hand-pointer",style:(0,s.j5)(e.backgroundStyle)},null,4)})),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.layout.blackHand.pieces,(function(e){return(0,a.wg)(),(0,a.iD)("div",{key:e.id,class:"piece",style:(0,s.j5)(e.style)},[(0,a._)("img",{class:"piece-image",src:e.imagePath},null,8,Z)],4)})),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.layout.blackHand.pointers,(function(t){return(0,a.wg)(),(0,a.iD)("div",{key:t.id,class:"hand-pointer",style:(0,s.j5)(t.style),onClick:function(n){return e.clickHand(n,e.Color.BLACK,t.type)}},null,12,W)})),128))],4),(0,a._)("div",{class:"hand",style:(0,s.j5)(e.layout.whiteHand.style)},[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.layout.whiteHand.pointers,(function(e){return(0,a.wg)(),(0,a.iD)("div",{key:e.id,class:"hand-pointer",style:(0,s.j5)(e.backgroundStyle)},null,4)})),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.layout.whiteHand.pieces,(function(e){return(0,a.wg)(),(0,a.iD)("div",{key:e.id,class:"piece",style:(0,s.j5)(e.style)},[(0,a._)("img",{class:"piece-image",src:e.imagePath},null,8,U)],4)})),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.layout.whiteHand.pointers,(function(t){return(0,a.wg)(),(0,a.iD)("div",{key:t.id,class:"hand-pointer",style:(0,s.j5)(t.style),onClick:function(n){return e.clickHand(n,e.Color.WHITE,t.type)}},null,12,K)})),128))],4),e.layout.promotion?((0,a.wg)(),(0,a.iD)("div",{key:0,class:"promotion-selector",style:(0,s.j5)(e.layout.promotion.style)},[(0,a._)("div",{class:"select-button promote",onClick:t[0]||(t[0]=function(t){return e.clickPromote(t)})},[(0,a._)("img",{class:"piece-image",src:e.layout.promotion.promoteImagePath},null,8,F)]),(0,a._)("div",{class:"select-button not-promote",onClick:t[1]||(t[1]=function(t){return e.clickNotPromote(t)})},[(0,a._)("img",{class:"piece-image",src:e.layout.promotion.notPromoteImagePath},null,8,q)])],4)):(0,a.kq)("",!0),(0,a._)("div",{class:"turn",style:(0,s.j5)(e.layout.turn.style)},"手番",4),(0,a._)("div",{style:(0,s.j5)(e.layout.control.left.style)},[(0,a.WI)(e.$slots,"left-control",{},void 0,!0)],4),(0,a._)("div",{style:(0,s.j5)(e.layout.control.right.style)},[(0,a.WI)(e.$slots,"right-control",{},void 0,!0)],4)],4)])}n(7686),n(4506);var V,z,Y=n(3087),J=n(2833),$=n(2482);n(1532);function Q(e){return e===V.BLACK?V.WHITE:V.BLACK}function X(e){return e===V.BLACK?"b":"w"}function ee(e){return"b"===e||"w"===e}function te(e){return"b"===e?V.BLACK:V.WHITE}(function(e){e["BLACK"]="black",e["WHITE"]="white"})(V||(V={})),function(e){e["PAWN"]="pawn",e["LANCE"]="lance",e["KNIGHT"]="knight",e["SILVER"]="silver",e["GOLD"]="gold",e["BISHOP"]="bishop",e["ROOK"]="rook",e["KING"]="king",e["PROM_PAWN"]="promPawn",e["PROM_LANCE"]="promLance",e["PROM_KNIGHT"]="promKnight",e["PROM_SILVER"]="promSilver",e["HORSE"]="horse",e["DRAGON"]="dragon"}(z||(z={}));var ne={pawn:"歩",lance:"香",knight:"桂",silver:"銀",gold:"金",bishop:"角",rook:"飛",king:"玉",promPawn:"と",promLance:"成香",promKnight:"成桂",promSilver:"成銀",horse:"馬",dragon:"竜"};function ie(e){var t=ne[e];return t||""}z.PAWN,z.LANCE,z.KNIGHT,z.SILVER,z.GOLD,z.BISHOP,z.ROOK,z.KING,z.PROM_PAWN,z.PROM_LANCE,z.PROM_KNIGHT,z.PROM_SILVER,z.HORSE,z.DRAGON;var re=[z.PAWN,z.LANCE,z.KNIGHT,z.SILVER,z.GOLD,z.BISHOP,z.ROOK],oe={pawn:!0,lance:!0,knight:!0,silver:!0,gold:!1,bishop:!0,rook:!0,king:!1,promPawn:!1,promLance:!1,promKnight:!1,promSilver:!1,horse:!1,dragon:!1},ae={pawn:z.PROM_PAWN,lance:z.PROM_LANCE,knight:z.PROM_KNIGHT,silver:z.PROM_SILVER,bishop:z.HORSE,rook:z.DRAGON};function se(e){return ae[e]||e}var ce={promPawn:z.PAWN,promLance:z.LANCE,promKnight:z.KNIGHT,promSilver:z.SILVER,horse:z.BISHOP,dragon:z.ROOK};var ue={pawn:"P",lance:"L",knight:"N",silver:"S",gold:"G",bishop:"B",rook:"R",king:"K",promPawn:"+P",promLance:"+L",promKnight:"+N",promSilver:"+S",horse:"+B",dragon:"+R"};function le(e){return ue[e]}var he={pawn:"p",lance:"l",knight:"n",silver:"s",gold:"g",bishop:"b",rook:"r",king:"k",promPawn:"+p",promLance:"+l",promKnight:"+n",promSilver:"+s",horse:"+b",dragon:"+r"},de={P:z.PAWN,L:z.LANCE,N:z.KNIGHT,S:z.SILVER,G:z.GOLD,B:z.BISHOP,R:z.ROOK,K:z.KING,"+P":z.PROM_PAWN,"+L":z.PROM_LANCE,"+N":z.PROM_KNIGHT,"+S":z.PROM_SILVER,"+B":z.HORSE,"+R":z.DRAGON,p:z.PAWN,l:z.LANCE,n:z.KNIGHT,s:z.SILVER,g:z.GOLD,b:z.BISHOP,r:z.ROOK,k:z.KING,"+p":z.PROM_PAWN,"+l":z.PROM_LANCE,"+n":z.PROM_KNIGHT,"+s":z.PROM_SILVER,"+b":z.HORSE,"+r":z.DRAGON},pe={P:V.BLACK,L:V.BLACK,N:V.BLACK,S:V.BLACK,G:V.BLACK,B:V.BLACK,R:V.BLACK,K:V.BLACK,"+P":V.BLACK,"+L":V.BLACK,"+N":V.BLACK,"+S":V.BLACK,"+B":V.BLACK,"+R":V.BLACK,p:V.WHITE,l:V.WHITE,n:V.WHITE,s:V.WHITE,g:V.WHITE,b:V.WHITE,r:V.WHITE,k:V.WHITE,"+p":V.WHITE,"+l":V.WHITE,"+n":V.WHITE,"+s":V.WHITE,"+b":V.WHITE,"+r":V.WHITE},ve=new Map;ve.set(z.PAWN,{type:z.PROM_PAWN,reverseColor:!1}),ve.set(z.LANCE,{type:z.PROM_LANCE,reverseColor:!1}),ve.set(z.KNIGHT,{type:z.PROM_KNIGHT,reverseColor:!1}),ve.set(z.SILVER,{type:z.PROM_SILVER,reverseColor:!1}),ve.set(z.GOLD,{type:z.GOLD,reverseColor:!0}),ve.set(z.BISHOP,{type:z.HORSE,reverseColor:!1}),ve.set(z.ROOK,{type:z.DRAGON,reverseColor:!1}),ve.set(z.KING,{type:z.KING,reverseColor:!0}),ve.set(z.PROM_PAWN,{type:z.PAWN,reverseColor:!0}),ve.set(z.PROM_LANCE,{type:z.LANCE,reverseColor:!0}),ve.set(z.PROM_KNIGHT,{type:z.KNIGHT,reverseColor:!0}),ve.set(z.PROM_SILVER,{type:z.SILVER,reverseColor:!0}),ve.set(z.HORSE,{type:z.BISHOP,reverseColor:!0}),ve.set(z.DRAGON,{type:z.ROOK,reverseColor:!0});var fe,ge=function(){function e(t,n){(0,Y.Z)(this,e),(0,$.Z)(this,"color",void 0),(0,$.Z)(this,"type",void 0),this.type=n,this.color=t}return(0,J.Z)(e,[{key:"black",value:function(){return this.withColor(V.BLACK)}},{key:"white",value:function(){return this.withColor(V.WHITE)}},{key:"withColor",value:function(t){return new e(t,this.type)}},{key:"equals",value:function(e){return this.type===e.type&&this.color===e.color}},{key:"promoted",value:function(){var t=ae[this.type];return new e(this.color,t||this.type)}},{key:"unpromoted",value:function(){var t=ce[this.type];return new e(this.color,t||this.type)}},{key:"isPromotable",value:function(){return!!oe[this.type]}},{key:"rotate",value:function(){var t=ve.get(this.type),n=new e(this.color,t?t.type:this.type);return t&&t.reverseColor&&(n.color=Q(this.color)),n}},{key:"id",get:function(){return this.color+"_"+this.type}},{key:"sfen",get:function(){switch(this.color){default:case V.BLACK:return ue[this.type];case V.WHITE:return he[this.type]}}}],[{key:"isValidSFEN",value:function(e){return!!de[e]}},{key:"newBySFEN",value:function(t){var n=de[t];if(!n)return null;var i=pe[t];return i?new e(i,n):null}}]),e}();n(3689),n(7941);(function(e){e["UP"]="up",e["DOWN"]="down",e["LEFT"]="left",e["RIGHT"]="right",e["LEFT_UP"]="left_up",e["RIGHT_UP"]="right_up",e["LEFT_DOWN"]="left_down",e["RIGHT_DOWN"]="right_down",e["LEFT_UP_KNIGHT"]="left_up_knight",e["RIGHT_UP_KNIGHT"]="right_up_knight",e["LEFT_DOWN_KNIGHT"]="left_down_knight",e["RIGHT_DOWN_KNIGHT"]="right_down_knight"})(fe||(fe={}));var me={up:fe.DOWN,down:fe.UP,left:fe.RIGHT,right:fe.LEFT,left_up:fe.RIGHT_DOWN,right_up:fe.LEFT_DOWN,left_down:fe.RIGHT_UP,right_down:fe.LEFT_UP,left_up_knight:fe.RIGHT_DOWN_KNIGHT,right_up_knight:fe.LEFT_DOWN_KNIGHT,left_down_knight:fe.RIGHT_UP_KNIGHT,right_down_knight:fe.LEFT_UP_KNIGHT};function _e(e){return me[e]}var ye,Se=[fe.UP,fe.DOWN,fe.LEFT,fe.RIGHT,fe.LEFT_UP,fe.RIGHT_UP,fe.LEFT_DOWN,fe.RIGHT_DOWN,fe.LEFT_UP_KNIGHT,fe.RIGHT_UP_KNIGHT,fe.LEFT_DOWN_KNIGHT,fe.RIGHT_DOWN_KNIGHT];(function(e){e["SHORT"]="short",e["LONG"]="long"})(ye||(ye={}));var we={black:{pawn:{up:ye.SHORT},lance:{up:ye.LONG},knight:{left_up_knight:ye.SHORT,right_up_knight:ye.SHORT},silver:{left_up:ye.SHORT,up:ye.SHORT,right_up:ye.SHORT,left_down:ye.SHORT,right_down:ye.SHORT},gold:{left_up:ye.SHORT,up:ye.SHORT,right_up:ye.SHORT,left:ye.SHORT,right:ye.SHORT,down:ye.SHORT},bishop:{left_up:ye.LONG,right_up:ye.LONG,left_down:ye.LONG,right_down:ye.LONG},rook:{up:ye.LONG,left:ye.LONG,right:ye.LONG,down:ye.LONG},king:{left_down:ye.SHORT,right_down:ye.SHORT,left_up:ye.SHORT,right_up:ye.SHORT,down:ye.SHORT,left:ye.SHORT,right:ye.SHORT,up:ye.SHORT},promPawn:{left_up:ye.SHORT,up:ye.SHORT,right_up:ye.SHORT,left:ye.SHORT,right:ye.SHORT,down:ye.SHORT},promLance:{left_up:ye.SHORT,up:ye.SHORT,right_up:ye.SHORT,left:ye.SHORT,right:ye.SHORT,down:ye.SHORT},promKnight:{left_up:ye.SHORT,up:ye.SHORT,right_up:ye.SHORT,left:ye.SHORT,right:ye.SHORT,down:ye.SHORT},promSilver:{left_up:ye.SHORT,up:ye.SHORT,right_up:ye.SHORT,left:ye.SHORT,right:ye.SHORT,down:ye.SHORT},horse:{left_up:ye.LONG,right_up:ye.LONG,left_down:ye.LONG,right_down:ye.LONG,up:ye.SHORT,left:ye.SHORT,right:ye.SHORT,down:ye.SHORT},dragon:{up:ye.LONG,left:ye.LONG,right:ye.LONG,down:ye.LONG,left_up:ye.SHORT,right_up:ye.SHORT,left_down:ye.SHORT,right_down:ye.SHORT}},white:{pawn:{down:ye.SHORT},lance:{down:ye.LONG},knight:{left_down_knight:ye.SHORT,right_down_knight:ye.SHORT},silver:{left_down:ye.SHORT,down:ye.SHORT,right_down:ye.SHORT,left_up:ye.SHORT,right_up:ye.SHORT},gold:{left_down:ye.SHORT,down:ye.SHORT,right_down:ye.SHORT,left:ye.SHORT,right:ye.SHORT,up:ye.SHORT},bishop:{left_down:ye.LONG,right_down:ye.LONG,left_up:ye.LONG,right_up:ye.LONG},rook:{down:ye.LONG,left:ye.LONG,right:ye.LONG,up:ye.LONG},king:{left_down:ye.SHORT,right_down:ye.SHORT,left_up:ye.SHORT,right_up:ye.SHORT,down:ye.SHORT,left:ye.SHORT,right:ye.SHORT,up:ye.SHORT},promPawn:{left_down:ye.SHORT,down:ye.SHORT,right_down:ye.SHORT,left:ye.SHORT,right:ye.SHORT,up:ye.SHORT},promLance:{left_down:ye.SHORT,down:ye.SHORT,right_down:ye.SHORT,left:ye.SHORT,right:ye.SHORT,up:ye.SHORT},promKnight:{left_down:ye.SHORT,down:ye.SHORT,right_down:ye.SHORT,left:ye.SHORT,right:ye.SHORT,up:ye.SHORT},promSilver:{left_down:ye.SHORT,down:ye.SHORT,right_down:ye.SHORT,left:ye.SHORT,right:ye.SHORT,up:ye.SHORT},horse:{left_down:ye.LONG,right_down:ye.LONG,left_up:ye.LONG,right_up:ye.LONG,down:ye.SHORT,left:ye.SHORT,right:ye.SHORT,up:ye.SHORT},dragon:{down:ye.LONG,left:ye.LONG,right:ye.LONG,up:ye.LONG,left_down:ye.SHORT,right_down:ye.SHORT,left_up:ye.SHORT,right_up:ye.SHORT}}};function Ee(e){return Object.keys(we[e.color][e.type])}function ke(e,t){return we[e.color][e.type][t]}var Ie={up:{x:0,y:-1},down:{x:0,y:1},left:{x:-1,y:0},right:{x:1,y:0},left_up:{x:-1,y:-1},right_up:{x:1,y:-1},left_down:{x:-1,y:1},right_down:{x:1,y:1},left_up_knight:{x:-1,y:-2},right_up_knight:{x:1,y:-2},left_down_knight:{x:-1,y:2},right_down_knight:{x:1,y:2}};function be(e,t){if(1===e&&-2===t)return{direction:fe.RIGHT_UP_KNIGHT,distance:1,ok:!0};if(-1===e&&-2===t)return{direction:fe.LEFT_UP_KNIGHT,distance:1,ok:!0};if(1===e&&2===t)return{direction:fe.RIGHT_DOWN_KNIGHT,distance:1,ok:!0};if(-1===e&&2===t)return{direction:fe.LEFT_DOWN_KNIGHT,distance:1,ok:!0};if(0!==e&&0!==t&&Math.abs(e)!==Math.abs(t))return{direction:"",distance:0,ok:!1};var n=e,i=t,r=0;return 0!==n&&(r=Math.abs(n),n/=r),0!==i&&(r=Math.abs(i),i/=r),-1===n&&-1===i?{direction:fe.LEFT_UP,distance:r,ok:!0}:0===n&&-1===i?{direction:fe.UP,distance:r,ok:!0}:1===n&&-1===i?{direction:fe.RIGHT_UP,distance:r,ok:!0}:-1===n&&0===i?{direction:fe.LEFT,distance:r,ok:!0}:1===n&&0===i?{direction:fe.RIGHT,distance:r,ok:!0}:-1===n&&1===i?{direction:fe.LEFT_DOWN,distance:r,ok:!0}:0===n&&1===i?{direction:fe.DOWN,distance:r,ok:!0}:1===n&&1===i?{direction:fe.RIGHT_DOWN,distance:r,ok:!0}:{direction:"",distance:0,ok:!1}}function Te(e){switch(e){case"1":return 1;case"2":return 2;case"3":return 3;case"4":return 4;case"5":return 5;case"6":return 6;case"7":return 7;case"8":return 8;case"9":return 9;default:return null}}function Re(e){switch(e){case"a":return 1;case"b":return 2;case"c":return 3;case"d":return 4;case"e":return 5;case"f":return 6;case"g":return 7;case"h":return 8;case"i":return 9;default:return null}}var Ae=["a","b","c","d","e","f","g","h","i"],Ne=function(){function e(t,n){(0,Y.Z)(this,e),(0,$.Z)(this,"file",void 0),(0,$.Z)(this,"rank",void 0),this.file=t,this.rank=n}return(0,J.Z)(e,[{key:"x",get:function(){return 9-this.file}},{key:"y",get:function(){return this.rank-1}},{key:"index",get:function(){return 9*this.y+this.x}},{key:"opposite",get:function(){return new e(10-this.file,10-this.rank)}},{key:"neighbor",value:function(t,n){switch(t){case fe.UP:return new e(this.file,this.rank-1);case fe.DOWN:return new e(this.file,this.rank+1);case fe.LEFT:return new e(this.file+1,this.rank);case fe.RIGHT:return new e(this.file-1,this.rank);case fe.LEFT_UP:return new e(this.file+1,this.rank-1);case fe.RIGHT_UP:return new e(this.file-1,this.rank-1);case fe.LEFT_DOWN:return new e(this.file+1,this.rank+1);case fe.RIGHT_DOWN:return new e(this.file-1,this.rank+1);case fe.LEFT_UP_KNIGHT:return new e(this.file+1,this.rank-2);case fe.RIGHT_UP_KNIGHT:return new e(this.file-1,this.rank-2);case fe.LEFT_DOWN_KNIGHT:return new e(this.file+1,this.rank+2);case fe.RIGHT_DOWN_KNIGHT:return new e(this.file-1,this.rank+2)}var i=t,r=n;return new e(this.file-i,this.rank+r)}},{key:"valid",get:function(){return this.file>=1&&this.file<=9&&this.rank>=1&&this.rank<=9}},{key:"equals",value:function(e){return!!e&&this.file===e.file&&this.rank===e.rank}},{key:"sfen",get:function(){return this.file+Ae[this.rank-1]}}],[{key:"newByXY",value:function(t,n){return new e(9-t,n+1)}},{key:"newByIndex",value:function(t){return new e(9-t%9,Math.trunc(t/9)+1)}},{key:"parseSFENSquare",value:function(t){var n=Te(t[0]),i=Re(t[1]);return n&&i?new e(n,i):null}}]),e}();(0,$.Z)(Ne,"all",[]);for(var Pe=0;Pe<81;Pe+=1)Ne.all.push(Ne.newByIndex(Pe));n(2222);var Oe=["１","２","３","４","５","６","７","８","９"],Ce=["一","二","三","四","五","六","七","八","九"],He=function(){function e(t,n,i,r,o,a){(0,Y.Z)(this,e),(0,$.Z)(this,"from",void 0),(0,$.Z)(this,"to",void 0),(0,$.Z)(this,"promote",void 0),(0,$.Z)(this,"color",void 0),(0,$.Z)(this,"pieceType",void 0),(0,$.Z)(this,"capturedPieceType",void 0),this.from=t,this.to=n,this.promote=i,this.color=r,this.pieceType=o,this.capturedPieceType=a}return(0,J.Z)(e,[{key:"equals",value:function(e){return!!e&&((this.from instanceof Ne&&e.from instanceof Ne&&this.from.equals(e.from)||!(this.from instanceof Ne)&&!(e.from instanceof Ne)&&this.from===e.from)&&this.to.equals(e.to)&&this.promote===e.promote&&this.color===e.color&&this.pieceType===e.pieceType&&this.capturedPieceType===e.capturedPieceType)}},{key:"withPromote",value:function(){return new e(this.from,this.to,!0,this.color,this.pieceType,this.capturedPieceType)}},{key:"getDisplayText",value:function(e){var t="";if(t+=this.color===V.BLACK?"▲":"△",e&&e.to.equals(this.to)?t+="同　":(t+=Oe[this.to.file-1],t+=Ce[this.to.rank-1]),t+=ie(this.pieceType),this.promote&&(t+="成"),this.from instanceof Ne){var n=this.from;t+="(".concat(n.file).concat(n.rank,")")}else t+="打";return t}},{key:"sfen",get:function(){var e="";return this.from instanceof Ne?e+=this.from.sfen:e+=le(this.from)+"*",e+=this.to.sfen,this.promote&&(e+="+"),e}}]),e}();function Me(e){var t;if("*"===e[1]){var n=ge.newBySFEN(e[0]);if(!n)return null;t=n.type}else{var i=Ne.parseSFENSquare(e);if(!i)return null;t=i}var r=Ne.parseSFENSquare(e.substring(2));if(!r)return null;var o=e.length>=5&&"+"===e[4];return{from:t,to:r,promote:o}}var Le;n(4747),n(4916),n(3123),n(9826);function De(e){switch(e){case"1":return 1;case"2":return 2;case"3":return 3;case"4":return 4;case"5":return 5;case"6":return 6;case"7":return 7;case"8":return 8;case"9":return 9;default:return null}}(function(e){e["STANDARD"]="standard",e["EMPTY"]="empty",e["HANDICAP_LANCE"]="handicapLance",e["HANDICAP_RIGHT_LANCE"]="handicapRightLance",e["HANDICAP_BISHOP"]="handicapBishop",e["HANDICAP_ROOK"]="handicapRook",e["HANDICAP_ROOK_LANCE"]="handicapRookLance",e["HANDICAP_2PIECES"]="handicap2Pieces",e["HANDICAP_4PIECES"]="handicap4Pieces",e["HANDICAP_6PIECES"]="handicap6Pieces",e["HANDICAP_8PIECES"]="handicap8Pieces",e["TSUME_SHOGI"]="tsumeShogi",e["TSUME_SHOGI_2KINGS"]="tsumeShogi2Kings"})(Le||(Le={}));var xe=function(){function e(){(0,Y.Z)(this,e),(0,$.Z)(this,"squares",void 0),this.squares=new Array;for(var t=0;t<81;t+=1)this.squares.push(null);this.reset(Le.STANDARD)}return(0,J.Z)(e,[{key:"at",value:function(e){return this.squares[e.index]}},{key:"set",value:function(e,t){this.squares[e.index]=t}},{key:"swap",value:function(e,t){var n=this.squares[e.index];this.squares[e.index]=this.squares[t.index],this.squares[t.index]=n}},{key:"remove",value:function(e){var t=this.squares[e.index];return this.squares[e.index]=null,t}},{key:"listNonEmptySquares",value:function(){var e=this,t=new Array;return Ne.all.forEach((function(n){e.squares[n.index]&&t.push(n)})),t}},{key:"listSquaresByColor",value:function(e){var t=this,n=new Array;return Ne.all.forEach((function(i){var r=t.squares[i.index];r&&r.color===e&&n.push(i)})),n}},{key:"clear",value:function(){var e=this;Ne.all.forEach((function(t){e.squares[t.index]=null}))}},{key:"reset",value:function(e){if(this.clear(),e!==Le.EMPTY&&(this.squares[new Ne(5,1).index]=new ge(V.WHITE,z.KING),e!==Le.TSUME_SHOGI&&(this.squares[new Ne(5,9).index]=new ge(V.BLACK,z.KING),e!==Le.TSUME_SHOGI_2KINGS)))switch(this.squares[new Ne(2,8).index]=new ge(V.BLACK,z.ROOK),this.squares[new Ne(8,2).index]=new ge(V.WHITE,z.ROOK),this.squares[new Ne(8,8).index]=new ge(V.BLACK,z.BISHOP),this.squares[new Ne(2,2).index]=new ge(V.WHITE,z.BISHOP),this.squares[new Ne(4,9).index]=new ge(V.BLACK,z.GOLD),this.squares[new Ne(6,9).index]=new ge(V.BLACK,z.GOLD),this.squares[new Ne(6,1).index]=new ge(V.WHITE,z.GOLD),this.squares[new Ne(4,1).index]=new ge(V.WHITE,z.GOLD),this.squares[new Ne(3,9).index]=new ge(V.BLACK,z.SILVER),this.squares[new Ne(7,9).index]=new ge(V.BLACK,z.SILVER),this.squares[new Ne(7,1).index]=new ge(V.WHITE,z.SILVER),this.squares[new Ne(3,1).index]=new ge(V.WHITE,z.SILVER),this.squares[new Ne(2,9).index]=new ge(V.BLACK,z.KNIGHT),this.squares[new Ne(8,9).index]=new ge(V.BLACK,z.KNIGHT),this.squares[new Ne(8,1).index]=new ge(V.WHITE,z.KNIGHT),this.squares[new Ne(2,1).index]=new ge(V.WHITE,z.KNIGHT),this.squares[new Ne(1,9).index]=new ge(V.BLACK,z.LANCE),this.squares[new Ne(9,9).index]=new ge(V.BLACK,z.LANCE),this.squares[new Ne(9,1).index]=new ge(V.WHITE,z.LANCE),this.squares[new Ne(1,1).index]=new ge(V.WHITE,z.LANCE),this.squares[new Ne(1,7).index]=new ge(V.BLACK,z.PAWN),this.squares[new Ne(2,7).index]=new ge(V.BLACK,z.PAWN),this.squares[new Ne(3,7).index]=new ge(V.BLACK,z.PAWN),this.squares[new Ne(4,7).index]=new ge(V.BLACK,z.PAWN),this.squares[new Ne(5,7).index]=new ge(V.BLACK,z.PAWN),this.squares[new Ne(6,7).index]=new ge(V.BLACK,z.PAWN),this.squares[new Ne(7,7).index]=new ge(V.BLACK,z.PAWN),this.squares[new Ne(8,7).index]=new ge(V.BLACK,z.PAWN),this.squares[new Ne(9,7).index]=new ge(V.BLACK,z.PAWN),this.squares[new Ne(1,3).index]=new ge(V.WHITE,z.PAWN),this.squares[new Ne(2,3).index]=new ge(V.WHITE,z.PAWN),this.squares[new Ne(3,3).index]=new ge(V.WHITE,z.PAWN),this.squares[new Ne(4,3).index]=new ge(V.WHITE,z.PAWN),this.squares[new Ne(5,3).index]=new ge(V.WHITE,z.PAWN),this.squares[new Ne(6,3).index]=new ge(V.WHITE,z.PAWN),this.squares[new Ne(7,3).index]=new ge(V.WHITE,z.PAWN),this.squares[new Ne(8,3).index]=new ge(V.WHITE,z.PAWN),this.squares[new Ne(9,3).index]=new ge(V.WHITE,z.PAWN),e){default:case Le.STANDARD:return;case Le.HANDICAP_LANCE:return void(this.squares[new Ne(1,1).index]=null);case Le.HANDICAP_RIGHT_LANCE:return void(this.squares[new Ne(9,1).index]=null);case Le.HANDICAP_BISHOP:return void(this.squares[new Ne(2,2).index]=null);case Le.HANDICAP_ROOK:return void(this.squares[new Ne(8,2).index]=null);case Le.HANDICAP_ROOK_LANCE:return this.squares[new Ne(8,2).index]=null,void(this.squares[new Ne(1,1).index]=null);case Le.HANDICAP_2PIECES:return this.squares[new Ne(8,2).index]=null,void(this.squares[new Ne(2,2).index]=null);case Le.HANDICAP_4PIECES:return this.squares[new Ne(8,2).index]=null,this.squares[new Ne(2,2).index]=null,this.squares[new Ne(1,1).index]=null,void(this.squares[new Ne(9,1).index]=null);case Le.HANDICAP_6PIECES:return this.squares[new Ne(8,2).index]=null,this.squares[new Ne(2,2).index]=null,this.squares[new Ne(1,1).index]=null,this.squares[new Ne(2,1).index]=null,this.squares[new Ne(8,1).index]=null,void(this.squares[new Ne(9,1).index]=null);case Le.HANDICAP_8PIECES:return this.squares[new Ne(8,2).index]=null,this.squares[new Ne(2,2).index]=null,this.squares[new Ne(1,1).index]=null,this.squares[new Ne(2,1).index]=null,this.squares[new Ne(3,1).index]=null,this.squares[new Ne(7,1).index]=null,this.squares[new Ne(8,1).index]=null,void(this.squares[new Ne(9,1).index]=null)}}},{key:"sfen",get:function(){for(var e="",t=0,n=0;n<9;n+=1){for(var i=0;i<9;i+=1){var r=this.at(Ne.newByXY(i,n));r?(t&&(e+=t,t=0),e+=r.sfen):t+=1}t&&(e+=t,t=0),8!==n&&(e+="/")}return e}},{key:"resetBySFEN",value:function(t){if(!e.isValidSFEN(t))return!1;this.clear();for(var n=t.split("/"),i=0;i<9;i+=1)for(var r=0,o=0;o<n[i].length;o+=1){var a=n[i][o];"+"===a&&(o+=1,a+=n[i][o]);var s=De(a);s?r+=s:(this.set(Ne.newByXY(r,i),ge.newBySFEN(a)),r+=1)}return!0}},{key:"findKing",value:function(e){var t=this,n=new ge(e,z.KING);return Ne.all.find((function(e){var i=t.at(e);if(i&&n.equals(i))return!0}))}},{key:"hasPower",value:function(e,t,n){var i=this;return!!Se.find((function(r){for(var o=0,a=e.neighbor(r);a.valid;a=a.neighbor(r)){if(o+=1,n&&n.filled&&a.equals(n.filled))break;if(!(n&&n.ignore&&a.equals(n.ignore))){var s=i.at(a);if(s){if(s.color!==t)return!1;var c=_e(r),u=ke(s,c);return u===ye.LONG||u===ye.SHORT&&1===o}}}return!1}))}},{key:"isChecked",value:function(e,t){var n=this.findKing(e);return!!n&&this.hasPower(n,Q(e),{filled:t&&t.filled,ignore:t&&t.ignore})}},{key:"copyFrom",value:function(e){var t=this;Ne.all.forEach((function(n){t.squares[n.index]=e.at(n)}))}}],[{key:"isValidSFEN",value:function(e){var t=e.split("/");if(9!==t.length)return!1;for(var n=0;n<9;n+=1){for(var i=0,r=0;r<t[n].length;r+=1){var o=t[n][r];"+"===o&&(r+=1,o+=t[n][r]);var a=De(o);if(a)i+=a;else{if(!ge.isValidSFEN(o))return!1;i+=1}}if(9!==i)return!1}return!0}}]),e}();n(4723);function Be(e,t){return 0===e?"":(1!==e?e:"")+t.sfen}var Ge=function(){function e(){(0,Y.Z)(this,e),(0,$.Z)(this,"pieces",void 0),this.pieces=new Map,this.pieces.set(z.PAWN,0),this.pieces.set(z.LANCE,0),this.pieces.set(z.KNIGHT,0),this.pieces.set(z.SILVER,0),this.pieces.set(z.GOLD,0),this.pieces.set(z.BISHOP,0),this.pieces.set(z.ROOK,0)}return(0,J.Z)(e,[{key:"count",value:function(e){return this.pieces.get(e)}},{key:"set",value:function(e,t){this.pieces.set(e,t)}},{key:"add",value:function(e,t){var n=this.pieces.get(e);return n+=t,this.pieces.set(e,n),n}},{key:"reduce",value:function(e,t){var n=this.pieces.get(e);return n-=t,this.pieces.set(e,n),n}},{key:"forEach",value:function(e){e(z.PAWN,this.pieces.get(z.PAWN)),e(z.LANCE,this.pieces.get(z.LANCE)),e(z.KNIGHT,this.pieces.get(z.KNIGHT)),e(z.SILVER,this.pieces.get(z.SILVER)),e(z.GOLD,this.pieces.get(z.GOLD)),e(z.BISHOP,this.pieces.get(z.BISHOP)),e(z.ROOK,this.pieces.get(z.ROOK))}},{key:"sfenBlack",get:function(){return this.formatSFEN(V.BLACK)}},{key:"sfenWhite",get:function(){return this.formatSFEN(V.WHITE)}},{key:"formatSFEN",value:function(e){var t="";return t+=Be(this.count(z.ROOK),new ge(e,z.ROOK)),t+=Be(this.count(z.BISHOP),new ge(e,z.BISHOP)),t+=Be(this.count(z.GOLD),new ge(e,z.GOLD)),t+=Be(this.count(z.SILVER),new ge(e,z.SILVER)),t+=Be(this.count(z.KNIGHT),new ge(e,z.KNIGHT)),t+=Be(this.count(z.LANCE),new ge(e,z.LANCE)),t+=Be(this.count(z.PAWN),new ge(e,z.PAWN)),""===t?"-":t}},{key:"copyFrom",value:function(e){var t=this;e.pieces.forEach((function(e,n){t.pieces.set(n,e)}))}}],[{key:"formatSFEN",value:function(e,t){var n=e.sfenBlack,i=t.sfenWhite;return"-"===n&&"-"===i?"-":"-"===i?n:"-"===n?i:n+i}},{key:"isValidSFEN",value:function(e){return"-"===e||!!e.match(/^(?:[0-9]*[PLNSGBRplnsgbr])*$/)}},{key:"parseSFEN",value:function(t){if("-"===t)return{black:new e,white:new e};if(!t.match(/^(?:[0-9]*[PLNSGBRplnsgbr])*$/))return null;for(var n=t.match(/([0-9]*[PLNSGBRplnsgbr])/g),i=new e,r=new e,o=0;o<n.length;o+=1){var a=n[o],s=1;a.length>=2&&(s=Number(a.substring(0,a.length-1)));var c=ge.newBySFEN(a[a.length-1]);c.color===V.BLACK?i.add(c.type,s):r.add(c.type,s)}return{black:i,white:r}}}]),e}(),Ze={black:{pawn:{1:!0},lance:{1:!0},knight:{1:!0,2:!0}},white:{pawn:{9:!0},lance:{9:!0},knight:{9:!0,8:!0}}};function We(e,t,n){var i=Ze[e][t];return!!i&&i[n]}function Ue(e,t){return e===V.BLACK?t<=3:t>=7}function Ke(e,t,n){for(var i=1;i<=9;i+=1){var r=t.at(new Ne(n,i));if(r&&r.type===z.PAWN&&r.color===e)return!0}return!1}var Fe=function(){function e(){(0,Y.Z)(this,e),(0,$.Z)(this,"_board",void 0),(0,$.Z)(this,"_color",void 0),(0,$.Z)(this,"_blackHand",void 0),(0,$.Z)(this,"_whiteHand",void 0),this._board=new xe,this._color=V.BLACK,this._blackHand=new Ge,this._whiteHand=new Ge}return(0,J.Z)(e,[{key:"board",get:function(){return this._board}},{key:"color",get:function(){return this._color}},{key:"blackHand",get:function(){return this._blackHand}},{key:"whiteHand",get:function(){return this._whiteHand}},{key:"reset",value:function(e){switch(this._board.reset(e),this._blackHand=new Ge,this._whiteHand=new Ge,e){case Le.STANDARD:case Le.EMPTY:case Le.TSUME_SHOGI:case Le.TSUME_SHOGI_2KINGS:this._color=V.BLACK;break;case Le.HANDICAP_LANCE:case Le.HANDICAP_RIGHT_LANCE:case Le.HANDICAP_BISHOP:case Le.HANDICAP_ROOK:case Le.HANDICAP_ROOK_LANCE:case Le.HANDICAP_2PIECES:case Le.HANDICAP_4PIECES:case Le.HANDICAP_6PIECES:case Le.HANDICAP_8PIECES:this._color=V.WHITE;break}e!==Le.TSUME_SHOGI&&e!==Le.TSUME_SHOGI_2KINGS||(this._whiteHand.set(z.PAWN,18),this._whiteHand.set(z.LANCE,4),this._whiteHand.set(z.KNIGHT,4),this._whiteHand.set(z.SILVER,4),this._whiteHand.set(z.GOLD,4),this._whiteHand.set(z.BISHOP,2),this._whiteHand.set(z.ROOK,2))}},{key:"hand",value:function(e){return this._hand(e)}},{key:"_hand",value:function(e){return e===V.BLACK?this._blackHand:this._whiteHand}},{key:"checked",get:function(){return this._board.isChecked(this.color)}},{key:"createMove",value:function(e,t){var n;if(e instanceof Ne){var i=this._board.at(e);if(!i)return null;n=i.type}else n=e;var r=this._board.at(t);return new He(e,t,!1,this.color,n,r?r.type:null)}},{key:"createMoveBySFEN",value:function(e){var t=Me(e);if(!t)return null;var n=this.createMove(t.from,t.to);return n?(t.promote&&(n=n.withPromote()),n):null}},{key:"isPawnDropMate",value:function(e){var t=this;if(e.from instanceof Ne)return!1;if(e.pieceType!==z.PAWN)return!1;var n=e.to.neighbor(e.color===V.BLACK?fe.UP:fe.DOWN),i=this.board.at(n);if(!i||i.type!==z.KING||i.color===e.color)return!1;var r=Ee(i).find((function(r){var o=n.neighbor(r);if(!o.valid)return!1;var a=t.board.at(o);return(!a||a.color!=i.color)&&!t.board.hasPower(o,e.color,{filled:e.to})}));return!r&&!this.board.listSquaresByColor(i.color).find((function(r){return!r.equals(n)&&t.isMovable(r,e.to)&&!t.board.isChecked(i.color,{filled:e.to,ignore:r})}))}},{key:"isValidMove",value:function(e){if(e.from instanceof Ne){var t=this._board.at(e.from);if(!t||t.color!==this.color)return!1;if(!this.isMovable(e.from,e.to))return!1;var n=this._board.at(e.to);if(n&&n.color===this.color)return!1;if(e.promote){if(!t.isPromotable())return!1;if(!Ue(this.color,e.from.rank)&&!Ue(this.color,e.to.rank))return!1}else if(We(this.color,t.type,e.to.rank))return!1;if(e.pieceType!==z.KING?this._board.isChecked(this.color,{filled:e.to,ignore:e.from}):this._board.hasPower(e.to,Q(this.color),{ignore:e.from}))return!1}else{if(e.promote)return!1;if(e.color!==this.color)return!1;if(0===this.hand(this.color).count(e.from))return!1;if(this._board.at(e.to))return!1;if(We(this.color,e.from,e.to.rank))return!1;if(e.from===z.PAWN&&Ke(this.color,this._board,e.to.file))return!1;if(this._board.isChecked(this.color,{filled:e.to}))return!1;if(this.isPawnDropMate(e))return!1}return!0}},{key:"doMove",value:function(e,t){if((!t||!t.ignoreValidation)&&!this.isValidMove(e))return!1;if(e.from instanceof Ne){var n=this._board.at(e.from),i=this._board.at(e.to);this._board.remove(e.from),this._board.set(e.to,e.promote?n.promoted():n),i&&i.type!==z.KING&&this._hand(this.color).add(i.unpromoted().type,1)}else this._hand(this.color).reduce(e.from,1),this._board.set(e.to,new ge(this.color,e.from));return this._color=Q(this.color),!0}},{key:"undoMove",value:function(e){if(this._color=Q(this.color),e.from instanceof Ne)if(this._board.set(e.from,new ge(this.color,e.pieceType)),e.capturedPieceType){var t=new ge(Q(this.color),e.capturedPieceType);this._board.set(e.to,t),t.type!==z.KING&&this._hand(this.color).reduce(t.unpromoted().type,1)}else this._board.remove(e.to);else this._hand(this.color).add(e.from,1),this._board.remove(e.to)}},{key:"isValidEditing",value:function(e,t){if(e instanceof Ne){var n=this._board.at(e);if(!n)return!1;if(t instanceof Ne){if(e.equals(t))return!1}else if(n.type===z.KING)return!1}else{if(!e.color)return!1;if(0===this.hand(e.color).count(e.type))return!1;if(t instanceof Ne){if(this._board.at(t))return!1}else if(e.color===t)return!1}return!0}},{key:"edit",value:function(e){if(e.move){if(!this.isValidEditing(e.move.from,e.move.to))return!1;if(e.move.from instanceof Ne)if(e.move.to instanceof Ne)this._board.swap(e.move.from,e.move.to);else{var t=this._board.remove(e.move.from);this._hand(e.move.to).add(t.unpromoted().type,1)}else this._hand(e.move.from.color).reduce(e.move.from.type,1),e.move.to instanceof Ne?this._board.set(e.move.to,e.move.from):this._hand(e.move.to).add(e.move.from.type,1)}if(e.rotate){var n=this._board.at(e.rotate);n&&this._board.set(e.rotate,n.rotate())}return!0}},{key:"sfen",get:function(){return this.getSFEN(1)}},{key:"getSFEN",value:function(e){var t="".concat(this._board.sfen," ").concat(X(this.color)," ");return t+=Ge.formatSFEN(this._blackHand,this._whiteHand),t+=" "+e,t}},{key:"resetBySFEN",value:function(t){if(!e.isValidSFEN(t))return!1;var n=t.split(" ");"sfen"===n[0]&&n.shift(),this._board.resetBySFEN(n[0]),this._color=te(n[1]);var i=Ge.parseSFEN(n[2]);return this._blackHand=i.black,this._whiteHand=i.white,!0}},{key:"setColor",value:function(e){this._color=e}},{key:"isMovable",value:function(e,t){var n=t.x-e.x,i=t.y-e.y,r=be(n,i),o=r.direction,a=r.distance,s=r.ok;if(!s)return!1;var c=this._board.at(e);if(!c)return!1;switch(ke(c,o)){default:return!1;case ye.SHORT:return 1===a;case ye.LONG:for(var u=Ie[o],l=e.neighbor(u.x,u.y);l.valid;l=l.neighbor(u.x,u.y)){if(l.equals(t))return!0;if(this._board.at(l))return!1}return!1}}},{key:"copyFrom",value:function(e){this._board.copyFrom(e._board),this._color=e.color,this._blackHand.copyFrom(e._blackHand),this._whiteHand.copyFrom(e._whiteHand)}},{key:"clone",value:function(){var t=new e;return t.copyFrom(this),t}}],[{key:"isValidSFEN",value:function(e){var t=e.split(" ");return 5===t.length&&"sfen"===t[0]&&t.shift(),4===t.length&&(!!xe.isValidSFEN(t[0])&&(!!ee(t[1])&&(!!Ge.isValidSFEN(t[2])&&!!t[3].match(/[0-9]+/))))}},{key:"newBySFEN",value:function(t){var n=new e;return n.resetBySFEN(t)?n:null}}]),e}();function qe(e){var t={pawn:0,lance:0,knight:0,silver:0,gold:0,bishop:0,rook:0,king:0,promPawn:0,promLance:0,promKnight:0,promSilver:0,horse:0,dragon:0};return Ne.all.forEach((function(n){var i=e.board.at(n);i&&(t[i.type]+=1)})),e.blackHand.forEach((function(e,n){t[e]+=n})),e.whiteHand.forEach((function(e,n){t[e]+=n})),t}function je(e){var t=qe(e);return{pawn:18-t.pawn-t.promPawn,lance:4-t.lance-t.promLance,knight:4-t.knight-t.promKnight,silver:4-t.silver-t.promSilver,gold:4-t.gold,bishop:2-t.bishop-t.horse,rook:2-t.rook-t.dragon,king:2-t.king,promPawn:0,promLance:0,promKnight:0,promSilver:0,horse:0,dragon:0}}var Ve;n(6755),n(7042),n(9600),n(3210),n(3112);function ze(e){return Je(Math.floor(e/1e3))}function Ye(e){return $e(Math.floor(e/1e3))}function Je(e){var t=Math.floor(e/3600),n=Math.floor((e-3600*t)/60),i=e%60;return t+":"+String(n).padStart(2,"0")+":"+String(i).padStart(2,"0")}function $e(e){var t=Math.floor(e/60),n=e%60;return String(t).padStart(2," ")+":"+String(n).padStart(2,"0")}function Qe(e){switch(e){case Ve.BLACK_NAME:return"先手";case Ve.WHITE_NAME:return"後手";case Ve.START_DATETIME:return"開始日時";case Ve.END_DATETIME:return"終了日時";case Ve.DATE:return"対局日";case Ve.TOURNAMENT:return"棋戦";case Ve.STRATEGY:return"戦型";case Ve.TITLE:return"表題";case Ve.TIME_LIMIT:return"持ち時間";case Ve.TIME_SPENT:return"消費時間";case Ve.PLACE:return"場所";case Ve.POSTED_ON:return"掲載";case Ve.NOTE:return"備考";case Ve.BLACK_SHORT_NAME:return"先手省略名";case Ve.WHITE_SHORT_NAME:return"後手省略名";case Ve.OPUS_NO:return"作品番号";case Ve.OPUS_NAME:return"作品名";case Ve.AUTHOR:return"作者";case Ve.PUBLISHED_ON:return"発表誌";case Ve.PUBLISHED_AT:return"発表年月";case Ve.SOURCE:return"出典";case Ve.LENGTH:return"手数";case Ve.INTEGRITY:return"完全性";case Ve.CATEGORY:return"分類";case Ve.AWARD:return"受賞"}}(function(e){e["BLACK_NAME"]="blackName",e["WHITE_NAME"]="whiteName",e["START_DATETIME"]="startDatetime",e["END_DATETIME"]="endDatetime",e["DATE"]="date",e["TOURNAMENT"]="tournament",e["STRATEGY"]="strategy",e["TITLE"]="title",e["TIME_LIMIT"]="timeLimit",e["TIME_SPENT"]="timeSpent",e["PLACE"]="place",e["POSTED_ON"]="postedOn",e["NOTE"]="note",e["BLACK_SHORT_NAME"]="blackShortName",e["WHITE_SHORT_NAME"]="whiteShortName",e["OPUS_NO"]="opusNo",e["OPUS_NAME"]="opusName",e["AUTHOR"]="author",e["PUBLISHED_ON"]="publishedOn",e["PUBLISHED_AT"]="publishedAt",e["SOURCE"]="source",e["LENGTH"]="length",e["INTEGRITY"]="integrity",e["CATEGORY"]="category",e["AWARD"]="award"})(Ve||(Ve={}));var Xe,et=function(){function e(){(0,Y.Z)(this,e),(0,$.Z)(this,"standard",void 0),(0,$.Z)(this,"custom",void 0),this.standard=new Map,this.custom=new Map}return(0,J.Z)(e,[{key:"standardMetadataKeys",get:function(){return this.standard.keys()}},{key:"getStandardMetadata",value:function(e){return this.standard.get(e)}},{key:"setStandardMetadata",value:function(e,t){t?this.standard.set(e,t):this.standard.delete(e)}},{key:"customMetadataKeys",get:function(){return this.custom.keys()}},{key:"getCustomMetadata",value:function(e){return this.custom.get(e)}},{key:"setCustomMetadata",value:function(e,t){t?this.custom.set(e,t):this.custom.delete(e)}}]),e}();(function(e){e["START"]="start",e["INTERRUPT"]="interrupt",e["RESIGN"]="resign",e["DRAW"]="draw",e["REPETITION_DRAW"]="repetitionDraw",e["MATE"]="mate",e["TIMEOUT"]="timeout",e["FOUL_WIN"]="foulWin",e["FOUL_LOSE"]="foulLose",e["ENTERING_OF_KING"]="enteringOfKing",e["WIN_BY_DEFAULT"]="winByDefault",e["LOSS_BY_DEFAULT"]="lossByDefault"})(Xe||(Xe={}));var tt={start:"開始局面",resign:"投了",interrupt:"中断",draw:"持将棋",repetitionDraw:"千日手",mate:"詰み",timeout:"切れ負け",foulWin:"反則勝ち",foulLose:"反則負け",enteringOfKing:"入玉",winByDefault:"不戦勝",lossByDefault:"不戦敗"};function nt(e){return tt[e]}var it=function(){function e(t,n,i,r,o,a){(0,Y.Z)(this,e),(0,$.Z)(this,"number",void 0),(0,$.Z)(this,"prev",void 0),(0,$.Z)(this,"branchIndex",void 0),(0,$.Z)(this,"activeBranch",void 0),(0,$.Z)(this,"move",void 0),(0,$.Z)(this,"isCheck",void 0),(0,$.Z)(this,"next",void 0),(0,$.Z)(this,"branch",void 0),(0,$.Z)(this,"comment",void 0),(0,$.Z)(this,"customData",void 0),(0,$.Z)(this,"elapsedMs",void 0),(0,$.Z)(this,"totalElapsedMs",void 0),this.number=t,this.prev=n,this.branchIndex=i,this.activeBranch=r,this.move=o,this.isCheck=a,this.next=null,this.branch=null,this.comment="",this.elapsedMs=0,this.totalElapsedMs=0}return(0,J.Z)(e,[{key:"displayText",get:function(){var e=this.prev&&this.prev.move instanceof He?this.prev.move:null;return this.move instanceof He?this.move.getDisplayText(e):nt(this.move)}},{key:"timeText",get:function(){var e=Ye(this.elapsedMs),t=ze(this.totalElapsedMs);return"".concat(e," / ").concat(t)}},{key:"hasBranch",get:function(){return!!this.prev&&!!this.prev.next&&!!this.prev.next.branch}},{key:"isFirstBranch",get:function(){return!this.prev||this.prev.next===this}},{key:"isLastMove",get:function(){if(!this.next)return!0;for(var e=this.next;e;e=e.branch)if(e.move instanceof He)return!1;return!0}},{key:"updateTotalElapsedMs",value:function(){this.totalElapsedMs=this.elapsedMs,this.prev&&this.prev.prev&&(this.totalElapsedMs+=this.prev.prev.totalElapsedMs)}},{key:"setElapsedMs",value:function(e){this.elapsedMs=e,this.updateTotalElapsedMs();var t=this.next,n=[];while(t)t.updateTotalElapsedMs(),t.branch&&n.push(t.branch),t=t.next?t.next:n.pop()||null}}],[{key:"newRootEntry",value:function(){return new e(0,null,0,!0,Xe.START,!1)}}]),e}(),rt=function(){function e(t){(0,Y.Z)(this,e),(0,$.Z)(this,"metadata",void 0),(0,$.Z)(this,"_initialPosition",void 0),(0,$.Z)(this,"_position",void 0),(0,$.Z)(this,"_first",void 0),(0,$.Z)(this,"_current",void 0),(0,$.Z)(this,"repetitionCounts",void 0),(0,$.Z)(this,"repetitionStart",void 0),this.metadata=new et,this._initialPosition=t?t.clone():new Fe,this._position=this.initialPosition.clone(),this._first=it.newRootEntry(),this._current=this._first,this.repetitionCounts={},this.repetitionStart={},this.incrementRepetition()}return(0,J.Z)(e,[{key:"initialPosition",get:function(){return this._initialPosition}},{key:"position",get:function(){return this._position}},{key:"first",get:function(){return this._first}},{key:"current",get:function(){return this._current}},{key:"moves",get:function(){for(var e=this.movesBefore,t=this._current.next;t;t=t.next){while(!t.activeBranch)t=t.branch;e.push(t)}return e}},{key:"movesBefore",get:function(){return this._movesBefore}},{key:"_movesBefore",get:function(){var e=new Array;e.unshift(this._current);for(var t=this._current.prev;t;t=t.prev)e.unshift(t);return e}},{key:"length",get:function(){for(var e=this._current.number,t=this._current.next;t;t=t.next){while(!t.activeBranch)t=t.branch;e=t.number}return e}},{key:"branchBegin",get:function(){return this._current.prev?this._current.prev.next:this._current}},{key:"clear",value:function(e){this.metadata=new et,e&&(this._initialPosition=e.clone()),this._position=this.initialPosition.clone(),this._first=it.newRootEntry(),this._current=this._first,this.repetitionCounts={},this.repetitionStart={},this.incrementRepetition()}},{key:"goBack",value:function(){return!!this._current.prev&&(this._current.move instanceof He&&(this.decrementRepetition(),this._position.undoMove(this._current.move)),this._current=this._current.prev,!0)}},{key:"goForward",value:function(){if(this._current.next){this._current=this._current.next;while(!this._current.activeBranch)this._current=this._current.branch;return this._current.move instanceof He&&(this._position.doMove(this._current.move,{ignoreValidation:!0}),this.incrementRepetition()),!0}return!1}},{key:"goto",value:function(e){while(e<this._current.number)if(!this.goBack())break;while(e>this._current.number)if(!this.goForward())break}},{key:"resetAllBranchSelection",value:function(){this._forEach((function(e){e.activeBranch=e.isFirstBranch}))}},{key:"switchBranchByIndex",value:function(e){if(!this._current.prev)return!1;for(var t=!1,n=this._current.prev.next;n;n=n.branch)n.branchIndex===e?(n.activeBranch=!0,this._current.move instanceof He&&(this.decrementRepetition(),this._position.undoMove(this._current.move)),this._current=n,this._current.move instanceof He&&(this._position.doMove(this._current.move,{ignoreValidation:!0}),this.incrementRepetition()),t=!0):n.activeBranch=!1;return t}},{key:"append",value:function(e,t){var n,i=!1;if(e instanceof He){if(!this._position.doMove(e,t))return!1;this.incrementRepetition(),i=this.position.checked}if(this._current===this.first||this._current.move instanceof He||this.goBack(),!this._current.next)return this._current.next=new it(this._current.number+1,this._current,0,!0,e,i),this._current=this._current.next,this._current.setElapsedMs(0),!0;for(n=this._current.next;n;n=n.branch)n.activeBranch=!1;var r=this._current.next;for(n=this._current.next;n;n=n.branch){if(n.move instanceof He&&e instanceof He&&e.equals(n.move)||e===n.move)return this._current=n,this._current.activeBranch=!0,!0;r=n}return this._current=new it(this._current.number+1,this._current,r.branchIndex+1,!0,e,i),this._current.setElapsedMs(0),r.branch=this._current,!0}},{key:"removeAfter",value:function(){var e=this._current;if(this.goBack()){if(this._current.next===e)this._current.next=e.branch;else for(var t=this._current.next;t;t=t.branch)if(t.branch===e){t.branch=e.branch;break}for(var n=0,i=this._current.next;i;i=i.branch)i.branchIndex=n,n+=1;this._current.next&&(this._current.next.activeBranch=!0)}else this._current.next=null}},{key:"incrementRepetition",value:function(){var e=this.position.sfen;this.repetitionCounts[e]?this.repetitionCounts[e]+=1:(this.repetitionCounts[e]=1,this.repetitionStart[e]=this.current.number)}},{key:"decrementRepetition",value:function(){var e=this.position.sfen;this.repetitionCounts[e]-=1,0===this.repetitionCounts[e]&&(delete this.repetitionCounts[e],delete this.repetitionStart[e])}},{key:"repetition",get:function(){return this.repetitionCounts[this.position.sfen]>=4}},{key:"perpetualCheck",get:function(){if(!this.repetition)return null;for(var e=this.position.sfen,t=this.repetitionStart[e],n=!0,i=!0,r=this.position.color,o=this.current;o.number>=t;o=o.prev)r=Q(r),o.isCheck||(r===V.BLACK?n=!1:i=!1);return n?V.BLACK:i?V.WHITE:null}},{key:"usi",get:function(){var e="position sfen "+this.initialPosition.sfen+" moves";return this.movesBefore.forEach((function(t){t.move instanceof He&&(e+=" "+t.move.sfen)})),e}},{key:"usiAll",get:function(){for(var e=this.usi,t=this._current.next;t;t=t.next){while(!t.activeBranch)t=t.branch;t.move instanceof He&&(e+=" "+t.move.sfen)}return e}},{key:"sfen",get:function(){return this.position.getSFEN(this._current.number+1)}},{key:"forEach",value:function(e){this._forEach(e)}},{key:"_forEach",value:function(e){var t=this._first,n=[];while(t)e(t),t.branch&&n.push(t.branch),t=t.next?t.next:n.pop()||null}}],[{key:"newByUSI",value:function(t){var n="position startpos ",i="position sfen ",r="startpos ",o="sfen ",a="moves ";return t.startsWith(n)?e.newByUSIFromMoves(new Fe,t.slice(n.length)):t.startsWith(i)?e.newByUSIFromSFENPosition(t.slice(i.length)):t.startsWith(r)?e.newByUSIFromMoves(new Fe,t.slice(r.length)):t.startsWith(o)?e.newByUSIFromSFENPosition(t.slice(o.length)):t.startsWith(a)?e.newByUSIFromMoves(new Fe,t):new Error("不正なUSI(1): "+t)}},{key:"newByUSIFromSFENPosition",value:function(t){var n=t.split(" ");if(n.length<4)return new Error("不正なUSI(2): "+t);var i=Fe.newBySFEN(n.slice(0,4).join(" "));return i?e.newByUSIFromMoves(i,n.slice(4).join(" ")):new Error("不正なUSI(3): "+t)}},{key:"newByUSIFromMoves",value:function(t,n){var i=new e(t);if(0===n.length)return i;var r=n.split(" ");if("moves"!==r[0])return new Error("不正なUSI(4): "+n);for(var o=1;o<r.length;o++){var a=Me(r[o]);if(!a)break;var s=i.position.createMove(a.from,a.to);if(!s)return new Error("不正な指し手: "+r[o]);a.promote&&(s=s.withPromote()),i.append(s,{ignoreValidation:!0})}return i}}]),e}();var ot=n(6347);n(9494),n(5306),n(8757),n(7852),n(8862);function at(e,t){return e+(!e||e.endsWith("\n")?"":"\n")+t}function st(e){return e instanceof Object?JSON.stringify(e):String(e)}var ct,ut={"先手":Ve.BLACK_NAME,"後手":Ve.WHITE_NAME,"開始日時":Ve.START_DATETIME,"終了日時":Ve.END_DATETIME,"対局日":Ve.DATE,"棋戦":Ve.TOURNAMENT,"戦型":Ve.STRATEGY,"表題":Ve.TITLE,"持ち時間":Ve.TIME_LIMIT,"消費時間":Ve.TIME_SPENT,"場所":Ve.PLACE,"掲載":Ve.POSTED_ON,"備考":Ve.NOTE,"先手省略名":Ve.BLACK_SHORT_NAME,"後手省略名":Ve.WHITE_SHORT_NAME,"作品番号":Ve.OPUS_NO,"作品名":Ve.OPUS_NAME,"作者":Ve.AUTHOR,"発表誌":Ve.PUBLISHED_ON,"発表年月":Ve.PUBLISHED_AT,"出典":Ve.SOURCE,"手数":Ve.LENGTH,"完全性":Ve.INTEGRITY,"分類":Ve.CATEGORY,"受賞":Ve.AWARD},lt={blackName:"先手",whiteName:"後手",startDatetime:"開始日時",endDatetime:"終了日時",date:"対局日",tournament:"棋戦",strategy:"戦型",title:"表題",timeLimit:"持ち時間",timeSpent:"消費時間",place:"場所",postedOn:"掲載",note:"備考",blackShortName:"先手省略名",whiteShortName:"後手省略名",opusNo:"作品番号",opusName:"作品名",author:"作者",publishedOn:"発表誌",publishedAt:"発表年月",source:"出典",length:"手数",integrity:"完全性",category:"分類",award:"受賞"};(function(e){e[e["PROGRAM_COMMENT"]=0]="PROGRAM_COMMENT",e[e["METADATA"]=1]="METADATA",e[e["HANDICAP"]=2]="HANDICAP",e[e["BLACK_HAND"]=3]="BLACK_HAND",e[e["WHITE_HAND"]=4]="WHITE_HAND",e[e["BOARD"]=5]="BOARD",e[e["BLACK_TURN"]=6]="BLACK_TURN",e[e["WHITE_TURN"]=7]="WHITE_TURN",e[e["MOVE"]=8]="MOVE",e[e["COMMENT"]=9]="COMMENT",e[e["UNKNOWN"]=10]="UNKNOWN"})(ct||(ct={}));var ht=[{prefix:/^#/,type:ct.PROGRAM_COMMENT,removePrefix:!1,isPosition:!1},{prefix:/^手合割：/,type:ct.HANDICAP,removePrefix:!0,isPosition:!0},{prefix:/^先手の持駒：/,type:ct.BLACK_HAND,removePrefix:!0,isPosition:!0},{prefix:/^後手の持駒：/,type:ct.WHITE_HAND,removePrefix:!0,isPosition:!0},{prefix:/^\|/,type:ct.BOARD,removePrefix:!1,isPosition:!0},{prefix:/^先手番/,type:ct.BLACK_TURN,removePrefix:!1,isPosition:!0},{prefix:/^後手番/,type:ct.WHITE_TURN,removePrefix:!1,isPosition:!0},{prefix:/^ *[0-9]+ +/,type:ct.MOVE,removePrefix:!1,isPosition:!1},{prefix:/^\*/,type:ct.COMMENT,removePrefix:!0,isPosition:!1}];function dt(e){for(var t=0;t<ht.length;t++){var n=ht[t],i=e.match(n.prefix);if(i){var r=n.removePrefix?i[0].length:0;return{type:n.type,data:e.substring(r),isPosition:n.isPosition,metadataKey:""}}}var o=e.match(/^[^ ]+：/);if(o){var a=o[0];return{type:ct.METADATA,data:e.substring(a.length),isPosition:!1,metadataKey:a.substring(0,a.length-1)}}return{type:ct.UNKNOWN,data:e,isPosition:!1,metadataKey:""}}function pt(e,t){switch(t.trim()){case"平手":return void e.reset(Le.STANDARD);case"香落ち":return void e.reset(Le.HANDICAP_LANCE);case"右香落ち":return void e.reset(Le.HANDICAP_RIGHT_LANCE);case"角落ち":return void e.reset(Le.HANDICAP_BISHOP);case"飛車落ち":return void e.reset(Le.HANDICAP_ROOK);case"飛香落ち":return void e.reset(Le.HANDICAP_ROOK_LANCE);case"二枚落ち":return void e.reset(Le.HANDICAP_2PIECES);case"四枚落ち":return void e.reset(Le.HANDICAP_4PIECES);case"六枚落ち":return void e.reset(Le.HANDICAP_6PIECES);case"八枚落ち":return void e.reset(Le.HANDICAP_8PIECES);case"その他":return void e.reset(Le.EMPTY)}return new Error("不正なデータ:"+t)}var vt={"１":1,"２":2,"３":3,"４":4,"５":5,"６":6,"７":7,"８":8,"９":9},ft={"一":1,"二":2,"三":3,"四":4,"五":5,"六":6,"七":7,"八":8,"九":9},gt={"一":1,"二":2,"三":3,"四":4,"五":5,"六":6,"七":7,"八":8,"九":9,"十":10,"十一":11,"十二":12,"十三":13,"十四":14,"十五":15,"十六":16,"十七":17,"十八":18},mt={1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9},_t={"王":z.KING,"玉":z.KING,"飛":z.ROOK,"龍":z.DRAGON,"竜":z.DRAGON,"角":z.BISHOP,"馬":z.HORSE,"金":z.GOLD,"銀":z.SILVER,"成銀":z.PROM_SILVER,"全":z.PROM_SILVER,"桂":z.KNIGHT,"成桂":z.PROM_KNIGHT,"圭":z.PROM_KNIGHT,"香":z.LANCE,"成香":z.PROM_LANCE,"杏":z.PROM_LANCE,"歩":z.PAWN,"と":z.PROM_PAWN},yt={"中断":Xe.INTERRUPT,"投了":Xe.RESIGN,"持将棋":Xe.DRAW,"千日手":Xe.REPETITION_DRAW,"詰み":Xe.MATE,"切れ負け":Xe.TIMEOUT,"反則勝ち":Xe.FOUL_WIN,"反則負け":Xe.FOUL_LOSE,"入玉勝ち":Xe.ENTERING_OF_KING,"不戦勝":Xe.WIN_BY_DEFAULT,"不戦敗":Xe.LOSS_BY_DEFAULT},St=/^ *([0-9]+) +[▲△]?([１２３４５６７８９][一二三四五六七八九]|同\u3000)(王|玉|飛|龍|竜|角|馬|金|銀|成銀|全|桂|成桂|圭|香|成香|杏|歩|と)(成?)(打|\([1-9][1-9]\)) *(.*)$/,wt=/\( *([0-9]+):([0-9]+)\/[0-9: ]*\)/,Et=/^ *([0-9]+) +(中断|投了|持将棋|千日手|詰み|切れ負け|反則勝ち|反則負け|入玉勝ち|不戦勝|不戦敗) *(.*)$/;function kt(e,t){if(t.length<21)return new Error("不正な盤面:"+t);var n=t[20],i=ft[n];if(!i)return new Error("不正な盤面:"+t);for(var r=0;r<9;r+=1){var o=9-r,a=new Ne(o,i),s=2*r+1,c=t[s+1],u=_t[c];if(u){var l="v"!==t[s]?V.BLACK:V.WHITE;e.set(a,new ge(l,u))}else e.remove(a)}}function It(e,t){var n,i=t.split(/[ 　]/),r=(0,ot.Z)(i);try{for(r.s();!(n=r.n()).done;){var o=n.value;if(o&&"なし"!==o){var a=o[0],s=o.substring(1),c=_t[a],u=gt[s]||1;if(!c)return new Error("不正な持ち駒: "+o);e.add(c,u)}}}catch(l){r.e(l)}finally{r.f()}}function bt(e,t){var n=wt.exec(t);if(n){var i=n[1],r=n[2],o=60*Number.parseInt(i)+Number.parseInt(r);e.current.setElapsedMs(1e3*o)}}function Tt(e,t){var n=Et.exec(t);if(n){var i=Number(n[1]),r=yt[n[2]],o=n[3];return e.goto(i-1),e.append(r,{ignoreValidation:!0}),void bt(e,o)}if(n=St.exec(t),!n)return new Error("不正な指し手形式:"+t);var a,s,c=Number(n[1]),u=n[2],l=n[3],h=n[4],d=n[5],p=n[6];if(0===c)return new Error("不正な手数:"+t);if(e.goto(c-1),"同　"===u){if(!(e.current.move instanceof He))return new Error("不明な移動先: "+t);a=e.current.move.to}else{var v=vt[u[0]],f=ft[u[1]];a=new Ne(v,f)}if("打"===d)s=_t[l];else{var g=mt[d[1]],m=mt[d[2]];s=new Ne(g,m)}var _=e.position.createMove(s,a);if(!_)return new Error("不正な指し手: "+t);"成"===h&&(_=_.withPromote()),e.append(_,{ignoreValidation:!0}),bt(e,p)}function Rt(e){var t,n=new et,i=new rt,r=e.split(/\r?\n/),o=new Fe,a="",s=!1,c=(0,ot.Z)(r);try{for(c.s();!(t=c.n()).done;){var u=t.value;if(""!==u){var l=dt(u);if(s&&l.isPosition)return new Error("不正なデータ: "+u);var h=void 0;switch(l.type){case ct.METADATA:var d=ut[l.metadataKey];d?n.setStandardMetadata(d,l.data):n.setCustomMetadata(l.metadataKey,l.data);break;case ct.HANDICAP:h=pt(o,l.data);break;case ct.BLACK_HAND:h=It(o.blackHand,l.data);break;case ct.WHITE_HAND:h=It(o.whiteHand,l.data);break;case ct.BOARD:h=kt(o.board,l.data);break;case ct.BLACK_TURN:o.setColor(V.BLACK);break;case ct.WHITE_TURN:o.setColor(V.WHITE);break;case ct.MOVE:s||(i.clear(o),i.first.comment=a,s=!0),h=Tt(i,l.data);break;case ct.COMMENT:s?i.current.comment=at(i.current.comment,l.data):a=at(a,l.data);break;case ct.PROGRAM_COMMENT:break;case ct.UNKNOWN:break}if(h)return h}}}catch(p){c.e(p)}finally{c.f()}return s||(i.clear(o),i.first.comment=a),i.goto(0),i.resetAllBranchSelection(),i.metadata=n,i}var At=["一","二","三","四","五","六","七","八","九","十","十一","十二","十三","十四","十五","十六","十七","十八"],Nt=["１","２","３","４","５","６","７","８","９"],Pt=At,Ot={king:"玉",rook:"飛",dragon:"龍",bishop:"角",horse:"馬",gold:"金",silver:"銀",promSilver:"成銀",knight:"桂",promKnight:"成桂",lance:"香",promLance:"成香",pawn:"歩",promPawn:"と"},Ct={king:"玉",rook:"飛",dragon:"龍",bishop:"角",horse:"馬",gold:"金",silver:"銀",promSilver:"全",knight:"桂",promKnight:"圭",lance:"香",promLance:"杏",pawn:"歩",promPawn:"と"},Ht={start:"",resign:"投了",interrupt:"中断",draw:"持将棋",repetitionDraw:"千日手",mate:"詰み",timeout:"切れ負け",foulWin:"反則勝ち",foulLose:"反則負け",enteringOfKing:"入玉勝ち",winByDefault:"不戦勝",lossByDefault:"不戦敗"};function Mt(e,t){var n,i="",r=t.returnCode?t.returnCode:"\n",o=(0,ot.Z)(e.standardMetadataKeys);try{for(o.s();!(n=o.n()).done;){var a=n.value;i+=lt[a]+"："+e.getStandardMetadata(a)+r}}catch(l){o.e(l)}finally{o.f()}var s,c=(0,ot.Z)(e.customMetadataKeys);try{for(c.s();!(s=c.n()).done;){var u=s.value;i+=u+"："+e.getCustomMetadata(u)+r}}catch(l){c.e(l)}finally{c.f()}return i}function Lt(e,t){var n="",i=t.returnCode?t.returnCode:"\n";n+="後手の持駒："+xt(e.whiteHand)+i,n+="  ９ ８ ７ ６ ５ ４ ３ ２ １"+i,n+="+---------------------------+"+i;for(var r=0;r<9;r++){n+="|";for(var o=0;o<9;o++){var a=Ne.newByXY(o,r),s=e.board.at(a);s?s.color===V.BLACK?n+=" "+Ct[s.type]:n+="v"+Ct[s.type]:n+=" ・"}n+="|"+Pt[r]+i}return n+="+---------------------------+"+i,n+="先手の持駒："+xt(e.blackHand)+i,e.color===V.BLACK?n+="先手番"+i:n+="後手番"+i,n}function Dt(e){var t="";return t+=Nt[e.to.file-1],t+=Pt[e.to.rank-1],t+=Ot[e.pieceType],e.promote&&(t+="成"),e.from instanceof Ne?t+="("+e.from.file+e.from.rank+")":t+="打",t}function xt(e){var t="";return e.forEach((function(e,n){n>=1&&(t+=Ct[e],n>=2&&(t+=At[n-1]),t+="　")})),t}function Bt(e,t){var n="",i=t.returnCode?t.returnCode:"\n";return n+="# KIF形式棋譜ファイル Generated by Electron Shogi"+i,n+=Mt(e.metadata,t),n+=Lt(e.initialPosition,t),n+="手数----指手---------消費時間--"+i,e.forEach((function(e){if(0!==e.number){e.isFirstBranch||(n+=i,n+="変化："+e.number+"手"+i),n+=e.number+" ",e.move instanceof He?n+=Dt(e.move):n+=Ht[e.move];var t=Ye(e.elapsedMs),r=ze(e.totalElapsedMs);n+=" (".concat(t,"/").concat(r,")"),e.isFirstBranch&&e.hasBranch&&(n+="+"),n+=i}0!==e.comment.length&&(n+="*"+e.comment.replaceAll("\n",i+"*")+i)})),n}var Gt,Zt,Wt=n(3336);(function(e){e[e["VERSION"]=0]="VERSION",e[e["COMMENT"]=1]="COMMENT",e[e["BLACK_NAME"]=2]="BLACK_NAME",e[e["WHITE_NAME"]=3]="WHITE_NAME",e[e["METADATA"]=4]="METADATA",e[e["POSITION"]=5]="POSITION",e[e["RANK"]=6]="RANK",e[e["PIECES"]=7]="PIECES",e[e["FIRST_TURN"]=8]="FIRST_TURN",e[e["MOVE"]=9]="MOVE",e[e["SPECIAL_MOVE"]=10]="SPECIAL_MOVE",e[e["ELAPSED"]=11]="ELAPSED"})(Gt||(Gt={})),function(e){e[e["HEADER"]=0]="HEADER",e[e["MOVE"]=1]="MOVE",e[e["NEUTRAL"]=2]="NEUTRAL"}(Zt||(Zt={}));var Ut=[{pattern:/^V/,type:Gt.VERSION,sectionType:Zt.HEADER},{pattern:/^'/,type:Gt.COMMENT,sectionType:Zt.NEUTRAL},{pattern:/^N\+(.+)$/,type:Gt.BLACK_NAME,sectionType:Zt.HEADER},{pattern:/^N-(.+)$/,type:Gt.WHITE_NAME,sectionType:Zt.HEADER},{pattern:/^\$([^:]+):(.+)$/,type:Gt.METADATA,sectionType:Zt.HEADER},{pattern:/^PI([1-9]{2}[A-Z]{2})*$/,type:Gt.POSITION,sectionType:Zt.HEADER},{pattern:/^P[1-9]( \* |[-+][A-Z][A-Z]){9}$/,type:Gt.RANK,sectionType:Zt.HEADER},{pattern:/^P[-+]([0-9]{2}[A-Z]{2})*/,type:Gt.PIECES,sectionType:Zt.HEADER},{pattern:/^[-+]$/,type:Gt.FIRST_TURN,sectionType:Zt.HEADER},{pattern:/^[-+][0-9]{4}[A-Z]{2}/,type:Gt.MOVE,sectionType:Zt.MOVE},{pattern:/^%[-+A-Z_]+/,type:Gt.SPECIAL_MOVE,sectionType:Zt.MOVE},{pattern:/^T([0-9]+)/,type:Gt.ELAPSED,sectionType:Zt.MOVE}];function Kt(e){var t,n=[],i=e.match(/^['N$]/)?[e]:e.split(","),r=(0,ot.Z)(i);try{for(r.s();!(t=r.n()).done;)for(var o=t.value,a=0;a<Ut.length;a++){var s=Ut[a].pattern.exec(o);s&&n.push({type:Ut[a].type,line:o,args:s.slice(1),sectionType:Ut[a].sectionType})}}catch(c){r.e(c)}finally{r.f()}return n}var Ft={EVENT:Ve.TITLE,SITE:Ve.PLACE,START_TIME:Ve.START_DATETIME,END_TIME:Ve.END_DATETIME,TIME_LIMIT:Ve.TIME_LIMIT,OPENING:Ve.STRATEGY},qt={FU:z.PAWN,KY:z.LANCE,KE:z.KNIGHT,GI:z.SILVER,KI:z.GOLD,KA:z.BISHOP,HI:z.ROOK,OU:z.KING,TO:z.PROM_PAWN,NY:z.PROM_LANCE,NK:z.PROM_KNIGHT,NG:z.PROM_SILVER,UM:z.HORSE,RY:z.DRAGON};function jt(e,t){t.reset(Le.STANDARD);for(var n=2;n+4<=e.length;n+=4){var i=Number(e[n]),r=Number(e[n+1]);t.board.remove(new Ne(i,r))}}function Vt(e,t){for(var n=Number(e[1]),i=0;i<9;i+=1){var r=9-i,o=3*i+2,a=e.slice(o,o+3);if(" "!==a[0]){var s="+"===a[0]?V.BLACK:V.WHITE,c=qt[a.slice(1)];if(!c)return new Error("不正な駒: "+a);t.board.set(new Ne(r,n),new ge(s,c))}}}function zt(e,t){for(var n="+"===e[1]?V.BLACK:V.WHITE,i=2;i+4<=e.length;i+=4){var r=e.slice(i,i+4);if("00AL"===r){var o=function(){var e=je(t);return n===V.BLACK?t.blackHand.forEach((function(n){t.blackHand.add(n,e[n])})):t.whiteHand.forEach((function(n){t.whiteHand.add(n,e[n])})),{v:void 0}}();if("object"===(0,Wt.Z)(o))return o.v}var a=Number(r[0]),s=Number(r[1]),c=qt[r.slice(2)];if(!c)return new Error("不正な駒: "+r);0!==a&&0!==s?t.board.set(new Ne(a,s),new ge(n,c)):n===V.BLACK?t.blackHand.add(c,1):t.whiteHand.add(c,1)}}function Yt(e,t){var n="+"===e[0]?V.BLACK:V.WHITE;if(n!=t.color)return new Error("不正な手番: "+e);var i=Number(e[1]),r=Number(e[2]),o=Number(e[3]),a=Number(e[4]),s=qt[e.slice(5,7)];if(!s)return new Error("不正な駒の種類: "+e);var c=0===i&&0===r?s:new Ne(i,r),u=new Ne(o,a),l=t.createMove(c,u);if(!l)return new Error("不正な指し手: "+e);if(c instanceof Ne){var h=t.board.at(c);if(!h)return new Error("存在しない駒: "+e);if(h.type!==s){if(h.promoted().type!==s)return new Error("存在しない駒: "+e);l=l.withPromote()}}return l}function Jt(e){switch(e){case"%TORYO":return Xe.RESIGN;case"%CHUDAN":return Xe.INTERRUPT;case"%SENNICHITE":return Xe.REPETITION_DRAW;case"%TIME_UP":return Xe.TIMEOUT;case"%ILLEGAL_MOVE":return Xe.FOUL_LOSE;case"%JISHOGI":return Xe.DRAW;case"%KACHI":return Xe.ENTERING_OF_KING;case"%HIKIWAKE":return Xe.DRAW;case"%TSUMI":return Xe.MATE}}function $t(e){var t=new et,n=new rt,i=new Fe;i.reset(Le.EMPTY);var r,o=!1,a=e.replace(/\r?\n\//,"").split(/\r?\n/),s=(0,ot.Z)(a);try{for(s.s();!(r=s.n()).done;){var c,u=r.value,l=(0,ot.Z)(Kt(u));try{for(l.s();!(c=l.n()).done;){var h=c.value;if(h.sectionType===Zt.HEADER&&o||h.sectionType===Zt.MOVE&&!o)return new Error("不正な行が検出されました: "+h.line);switch(h.type){case Gt.VERSION:break;case Gt.COMMENT:break;case Gt.BLACK_NAME:t.setStandardMetadata(Ve.BLACK_NAME,h.args[0]);break;case Gt.WHITE_NAME:t.setStandardMetadata(Ve.WHITE_NAME,h.args[0]);break;case Gt.METADATA:var d=Ft[h.args[0]];d?t.setStandardMetadata(d,h.args[1]):t.setCustomMetadata(h.args[0],h.args[1]);break;case Gt.POSITION:jt(h.line,i);break;case Gt.RANK:var p=Vt(h.line,i);if(p)return p;break;case Gt.PIECES:var v=zt(h.line,i);if(v)return v;break;case Gt.FIRST_TURN:"+"===h.line[0]?i.setColor(V.BLACK):i.setColor(V.WHITE),n.clear(i),o=!0;break;case Gt.MOVE:var f=Yt(h.line,n.position);if(f instanceof Error)return f;n.append(f,{ignoreValidation:!0});break;case Gt.SPECIAL_MOVE:var g=Jt(h.line);g&&n.append(g,{ignoreValidation:!0});break;case Gt.ELAPSED:n.current.setElapsedMs(1e3*Number(h.args[0]));break}}}catch(m){l.e(m)}finally{l.f()}}}catch(m){s.e(m)}finally{s.f()}return o||n.clear(i),n.goto(0),n.resetAllBranchSelection(),n.metadata=t,n}function Qt(e,t){var n="",i=t.returnCode?t.returnCode:"\n",r=e.getStandardMetadata(Ve.BLACK_NAME)||e.getStandardMetadata(Ve.BLACK_SHORT_NAME);r&&(n+="N+"+r+i);var o=e.getStandardMetadata(Ve.WHITE_NAME)||e.getStandardMetadata(Ve.WHITE_SHORT_NAME);o&&(n+="N-"+o+i);var a=e.getStandardMetadata(Ve.TOURNAMENT)||e.getStandardMetadata(Ve.TITLE)||e.getStandardMetadata(Ve.OPUS_NAME)||e.getStandardMetadata(Ve.PUBLISHED_ON);a&&(n+="$EVENT:"+a+i);var s=e.getStandardMetadata(Ve.PLACE);s&&(n+="$SITE:"+s+i);var c=e.getStandardMetadata(Ve.START_DATETIME)||e.getStandardMetadata(Ve.DATE);c&&(n+="$START_TIME:"+c.slice(10)+i);var u=e.getStandardMetadata(Ve.DATE);u&&(n+="$END_TIME:"+u.slice(10)+i);var l=e.getStandardMetadata(Ve.STRATEGY);return l&&(n+="$OPENING:"+l+i),n}var Xt,en={king:"OU",rook:"HI",dragon:"RY",bishop:"KA",horse:"UM",gold:"KI",silver:"GI",promSilver:"NG",knight:"KE",promKnight:"NK",lance:"KY",promLance:"NY",pawn:"FU",promPawn:"TO"};function tn(e){var t="";return e.forEach((function(e,n){for(var i=0;i<n;i++)t+="00"+en[e]})),t}function nn(e,t){for(var n="",i=t.returnCode?t.returnCode:"\n",r=1;r<=9;r+=1){n+="P"+r;for(var o=9;o>=1;o-=1){var a=e.board.at(new Ne(o,r));a?a.color===V.BLACK?n+="+"+en[a.type]:n+="-"+en[a.type]:n+=" * "}n+=i}return n+="P+"+tn(e.blackHand)+i,n+="P-"+tn(e.whiteHand)+i,n+=(e.color===V.BLACK?"+":"-")+i,n}function rn(e){return e instanceof Ne?"".concat(e.file).concat(e.rank):"00"}function on(e){return(e.color===V.BLACK?"+":"-")+rn(e.from)+rn(e.to)+en[e.promote?se(e.pieceType):e.pieceType]}function an(e){switch(e){case Xe.RESIGN:return"%TORYO";case Xe.INTERRUPT:return"%CHUDAN";case Xe.REPETITION_DRAW:return"%SENNICHITE";case Xe.TIMEOUT:return"%TIME_UP";case Xe.FOUL_LOSE:return"%ILLEGAL_MOVE";case Xe.DRAW:return"%JISHOGI";case Xe.ENTERING_OF_KING:return"%KACHI";case Xe.MATE:return"%TSUMI"}}function sn(e,t){var n="",i=t.returnCode?t.returnCode:"\n";return n+="' CSA形式棋譜ファイル Generated by Electron Shogi"+i,n+="V2.2"+i,n+=Qt(e.metadata,t),n+=nn(e.initialPosition,t),e.moves.forEach((function(e){var t;0!==e.number&&(t=e.move instanceof He?on(e.move):an(e.move),t&&(n+=t+i,n+="T"+Math.floor(e.elapsedMs/1e3)+i))})),n}function cn(e){if(e.startsWith("position sfen ")||e.startsWith("position startpos ")||e.startsWith("sfen ")||e.startsWith("startpos ")||e.startsWith("moves "))return Xt.USI;if(Fe.isValidSFEN(e))return Xt.SFEN;var t=/(^|\n)[#0-9開終棋手戦表持秒記消場掲備先後作発出完分受]/g,n=/(^|,|\n)[-+$%'VNPT]/g,i=e.match(t),r=e.match(n),o=i?i.length:0,a=r?r.length:0;return o>=a?Xt.KIF:Xt.CSA}(function(e){e[e["USI"]=0]="USI",e[e["SFEN"]=1]="SFEN",e[e["KIF"]=2]="KIF",e[e["CSA"]=3]="CSA"})(Xt||(Xt={}));var un=n(5082),ln=(n(2479),{});function hn(e){if(!ln[e]){var t=document.createElement("img");t.src=e,ln[e]=t}}var dn,pn,vn,fn,gn,mn,_n=function(){function e(t,n){(0,Y.Z)(this,e),(0,$.Z)(this,"width",void 0),(0,$.Z)(this,"height",void 0),this.width=t,this.height=n}return(0,J.Z)(e,[{key:"add",value:function(t){return new e(this.width+t.width,this.height+t.height)}},{key:"reduce",value:function(t){return new e(this.width-t.width,this.height-t.height)}}]),e}();(function(e){e["HITOMOJI"]="hitomoji",e["HITOMOJI_DARK"]="hitomojiDark",e["HITOMOJI_GOTHIC"]="hitomojiGothic",e["HITOMOJI_GOTHIC_DARK"]="hitomojiGothicDark"})(fn||(fn={})),function(e){e["LIGHT"]="light",e["WARM"]="warm",e["RESIN"]="resin",e["DARK"]="dark"}(gn||(gn={})),function(e){e["NONE"]="none",e["STANDARD"]="standard"}(mn||(mn={}));var yn={frame:{width:1471,height:959},board:{x:296.5,y:0,width:878,height:960,squreWidth:94.8,squreHeight:104,leftSquarePadding:12,topSquarePadding:12.2,leftPiecePadding:17.5,topPiecePadding:18.5,highlight:{selected:{"background-color":"#0088ff",opacity:"0.8"},lastMoveTo:{"background-color":"#44cc44",opacity:"0.8"},lastMoveFrom:{"background-color":"#44cc44",opacity:"0.4"}}},label:{fontSize:24},piece:{width:88,height:93},hand:{black:{x:1184,y:600},white:{x:0,y:0},width:288,height:360,highlight:{selected:{"background-color":"#ff4800",opacity:"0.7"}}},turn:{black:{x:1184,y:425},white:{x:0,y:492},width:288,height:45,fontSize:32},playerName:{black:{x:1184,y:480},white:{x:0,y:370},width:288,height:45,fontSize:25},clock:{black:{x:1184,y:535},white:{x:0,y:425},width:288,height:55,fontSize:40},control:{left:{x:0,y:547,width:288,height:412,fontSize:26},right:{x:1184,y:0,width:288,height:412,fontSize:26}}},Sn=(dn={},(0,$.Z)(dn,fn.HITOMOJI,{black:{pawn:"./piece/hitomoji/black_pawn.png",lance:"./piece/hitomoji/black_lance.png",knight:"./piece/hitomoji/black_knight.png",silver:"./piece/hitomoji/black_silver.png",gold:"./piece/hitomoji/black_gold.png",bishop:"./piece/hitomoji/black_bishop.png",rook:"./piece/hitomoji/black_rook.png",king:"./piece/hitomoji/black_king.png",king2:"./piece/hitomoji/black_king2.png",promPawn:"./piece/hitomoji/black_prom_pawn.png",promLance:"./piece/hitomoji/black_prom_lance.png",promKnight:"./piece/hitomoji/black_prom_knight.png",promSilver:"./piece/hitomoji/black_prom_silver.png",horse:"./piece/hitomoji/black_horse.png",dragon:"./piece/hitomoji/black_dragon.png"},white:{pawn:"./piece/hitomoji/white_pawn.png",lance:"./piece/hitomoji/white_lance.png",knight:"./piece/hitomoji/white_knight.png",silver:"./piece/hitomoji/white_silver.png",gold:"./piece/hitomoji/white_gold.png",bishop:"./piece/hitomoji/white_bishop.png",rook:"./piece/hitomoji/white_rook.png",king:"./piece/hitomoji/white_king.png",king2:"./piece/hitomoji/white_king2.png",promPawn:"./piece/hitomoji/white_prom_pawn.png",promLance:"./piece/hitomoji/white_prom_lance.png",promKnight:"./piece/hitomoji/white_prom_knight.png",promSilver:"./piece/hitomoji/white_prom_silver.png",horse:"./piece/hitomoji/white_horse.png",dragon:"./piece/hitomoji/white_dragon.png"}}),(0,$.Z)(dn,fn.HITOMOJI_DARK,{black:{pawn:"./piece/hitomoji_dark/black_pawn.png",lance:"./piece/hitomoji_dark/black_lance.png",knight:"./piece/hitomoji_dark/black_knight.png",silver:"./piece/hitomoji_dark/black_silver.png",gold:"./piece/hitomoji_dark/black_gold.png",bishop:"./piece/hitomoji_dark/black_bishop.png",rook:"./piece/hitomoji_dark/black_rook.png",king:"./piece/hitomoji_dark/black_king.png",king2:"./piece/hitomoji_dark/black_king2.png",promPawn:"./piece/hitomoji_dark/black_prom_pawn.png",promLance:"./piece/hitomoji_dark/black_prom_lance.png",promKnight:"./piece/hitomoji_dark/black_prom_knight.png",promSilver:"./piece/hitomoji_dark/black_prom_silver.png",horse:"./piece/hitomoji_dark/black_horse.png",dragon:"./piece/hitomoji_dark/black_dragon.png"},white:{pawn:"./piece/hitomoji_dark/white_pawn.png",lance:"./piece/hitomoji_dark/white_lance.png",knight:"./piece/hitomoji_dark/white_knight.png",silver:"./piece/hitomoji_dark/white_silver.png",gold:"./piece/hitomoji_dark/white_gold.png",bishop:"./piece/hitomoji_dark/white_bishop.png",rook:"./piece/hitomoji_dark/white_rook.png",king:"./piece/hitomoji_dark/white_king.png",king2:"./piece/hitomoji_dark/white_king2.png",promPawn:"./piece/hitomoji_dark/white_prom_pawn.png",promLance:"./piece/hitomoji_dark/white_prom_lance.png",promKnight:"./piece/hitomoji_dark/white_prom_knight.png",promSilver:"./piece/hitomoji_dark/white_prom_silver.png",horse:"./piece/hitomoji_dark/white_horse.png",dragon:"./piece/hitomoji_dark/white_dragon.png"}}),(0,$.Z)(dn,fn.HITOMOJI_GOTHIC,{black:{pawn:"./piece/hitomoji_gothic/black_pawn.png",lance:"./piece/hitomoji_gothic/black_lance.png",knight:"./piece/hitomoji_gothic/black_knight.png",silver:"./piece/hitomoji_gothic/black_silver.png",gold:"./piece/hitomoji_gothic/black_gold.png",bishop:"./piece/hitomoji_gothic/black_bishop.png",rook:"./piece/hitomoji_gothic/black_rook.png",king:"./piece/hitomoji_gothic/black_king.png",king2:"./piece/hitomoji_gothic/black_king2.png",promPawn:"./piece/hitomoji_gothic/black_prom_pawn.png",promLance:"./piece/hitomoji_gothic/black_prom_lance.png",promKnight:"./piece/hitomoji_gothic/black_prom_knight.png",promSilver:"./piece/hitomoji_gothic/black_prom_silver.png",horse:"./piece/hitomoji_gothic/black_horse.png",dragon:"./piece/hitomoji_gothic/black_dragon.png"},white:{pawn:"./piece/hitomoji_gothic/white_pawn.png",lance:"./piece/hitomoji_gothic/white_lance.png",knight:"./piece/hitomoji_gothic/white_knight.png",silver:"./piece/hitomoji_gothic/white_silver.png",gold:"./piece/hitomoji_gothic/white_gold.png",bishop:"./piece/hitomoji_gothic/white_bishop.png",rook:"./piece/hitomoji_gothic/white_rook.png",king:"./piece/hitomoji_gothic/white_king.png",king2:"./piece/hitomoji_gothic/white_king2.png",promPawn:"./piece/hitomoji_gothic/white_prom_pawn.png",promLance:"./piece/hitomoji_gothic/white_prom_lance.png",promKnight:"./piece/hitomoji_gothic/white_prom_knight.png",promSilver:"./piece/hitomoji_gothic/white_prom_silver.png",horse:"./piece/hitomoji_gothic/white_horse.png",dragon:"./piece/hitomoji_gothic/white_dragon.png"}}),(0,$.Z)(dn,fn.HITOMOJI_GOTHIC_DARK,{black:{pawn:"./piece/hitomoji_gothic_dark/black_pawn.png",lance:"./piece/hitomoji_gothic_dark/black_lance.png",knight:"./piece/hitomoji_gothic_dark/black_knight.png",silver:"./piece/hitomoji_gothic_dark/black_silver.png",gold:"./piece/hitomoji_gothic_dark/black_gold.png",bishop:"./piece/hitomoji_gothic_dark/black_bishop.png",rook:"./piece/hitomoji_gothic_dark/black_rook.png",king:"./piece/hitomoji_gothic_dark/black_king.png",king2:"./piece/hitomoji_gothic_dark/black_king2.png",promPawn:"./piece/hitomoji_gothic_dark/black_prom_pawn.png",promLance:"./piece/hitomoji_gothic_dark/black_prom_lance.png",promKnight:"./piece/hitomoji_gothic_dark/black_prom_knight.png",promSilver:"./piece/hitomoji_gothic_dark/black_prom_silver.png",horse:"./piece/hitomoji_gothic_dark/black_horse.png",dragon:"./piece/hitomoji_gothic_dark/black_dragon.png"},white:{pawn:"./piece/hitomoji_gothic_dark/white_pawn.png",lance:"./piece/hitomoji_gothic_dark/white_lance.png",knight:"./piece/hitomoji_gothic_dark/white_knight.png",silver:"./piece/hitomoji_gothic_dark/white_silver.png",gold:"./piece/hitomoji_gothic_dark/white_gold.png",bishop:"./piece/hitomoji_gothic_dark/white_bishop.png",rook:"./piece/hitomoji_gothic_dark/white_rook.png",king:"./piece/hitomoji_gothic_dark/white_king.png",king2:"./piece/hitomoji_gothic_dark/white_king2.png",promPawn:"./piece/hitomoji_gothic_dark/white_prom_pawn.png",promLance:"./piece/hitomoji_gothic_dark/white_prom_lance.png",promKnight:"./piece/hitomoji_gothic_dark/white_prom_knight.png",promSilver:"./piece/hitomoji_gothic_dark/white_prom_silver.png",horse:"./piece/hitomoji_gothic_dark/white_horse.png",dragon:"./piece/hitomoji_gothic_dark/white_dragon.png"}}),dn),wn=(pn={},(0,$.Z)(pn,gn.LIGHT,"./board/light.png"),(0,$.Z)(pn,gn.WARM,"./board/warm.png"),(0,$.Z)(pn,gn.RESIN,"./board/resin.png"),(0,$.Z)(pn,gn.DARK,"./board/dark.png"),pn),En=(vn={},(0,$.Z)(vn,gn.LIGHT,"#8b4513"),(0,$.Z)(vn,gn.WARM,"#8b4513"),(0,$.Z)(vn,gn.RESIN,"#8b4513"),(0,$.Z)(vn,gn.DARK,"#333333"),vn),kn={black:{pawn:{row:3,column:0,width:2},lance:{row:2,column:0,width:1},knight:{row:2,column:1,width:1},silver:{row:1,column:0,width:1},gold:{row:1,column:1,width:1},bishop:{row:0,column:0,width:1},rook:{row:0,column:1,width:1},king:{row:0,column:0,width:0},promPawn:{row:0,column:0,width:0},promLance:{row:0,column:0,width:0},promKnight:{row:0,column:0,width:0},promSilver:{row:0,column:0,width:0},horse:{row:0,column:0,width:0},dragon:{row:0,column:0,width:0}},white:{pawn:{row:0,column:0,width:2},lance:{row:1,column:1,width:1},knight:{row:1,column:0,width:1},silver:{row:2,column:1,width:1},gold:{row:2,column:0,width:1},bishop:{row:3,column:1,width:1},rook:{row:3,column:0,width:1},king:{row:0,column:0,width:0},promPawn:{row:0,column:0,width:0},promLance:{row:0,column:0,width:0},promKnight:{row:0,column:0,width:0},promSilver:{row:0,column:0,width:0},horse:{row:0,column:0,width:0},dragon:{row:0,column:0,width:0}}},In={1:"一",2:"二",3:"三",4:"四",5:"五",6:"六",7:"七",8:"八",9:"九"},bn=function(){function e(t,n,i){(0,Y.Z)(this,e),(0,$.Z)(this,"pieceImages",void 0),(0,$.Z)(this,"boardImage",void 0),(0,$.Z)(this,"handColor",void 0),(0,$.Z)(this,"boardLabelType",void 0),this.pieceImages=Sn[t]||Sn[fn.HITOMOJI],this.boardImage=wn[n],this.handColor=En[n],this.boardLabelType=i}return(0,J.Z)(e,[{key:"preload",value:function(){hn(this.boardImage),Object.values(this.pieceImages.black).forEach(hn),Object.values(this.pieceImages.white).forEach(hn)}},{key:"build",value:function(e,t,n,i,r,o){var a=this,s=e.width/yn.frame.width;yn.frame.height*s>e.height&&(s=e.height/yn.frame.height);var c=function(){var e=yn.frame.height*s,t=yn.frame.width*s;return{style:{height:e+"px",width:t+"px"},size:new _n(t,e)}},u=function(){var e=a.boardImage,t=yn.board.x*s,n=yn.board.y*s,i=yn.board.width*s,r=yn.board.height*s,o={left:t+"px",top:n+"px",height:r+"px",width:i+"px"};return{imagePath:e,x:t,y:n,style:o}},l=function(e){var t=[];if(a.boardLabelType==mn.NONE)return t;for(var n=yn.label.fontSize*s,i=.1*n,r={color:"black","font-size":n+"px","font-weight":"bold","text-shadow":"".concat(i,"px ").concat(i,"px  ").concat(i,"px white")},c=1;c<=9;c++){var u=e.x-.5*n+(o?0:yn.board.width)*s+.5*yn.board.leftPiecePadding*s*(o?1:-1),l=e.y-.5*n+(yn.board.topSquarePadding+((o?10-c:c)-.5)*yn.board.squreHeight)*s;t.push({id:"rank"+c,character:In[c],style:(0,un.Z)({left:u+"px",top:l+"px"},r)})}for(var h=1;h<=9;h++){var d=e.x-.5*n+(yn.board.leftPiecePadding+(9.5-(o?10-h:h))*yn.board.squreWidth)*s,p=e.y-.5*n+(o?yn.board.height:0)*s+.5*yn.board.topSquarePadding*s*(o?-1:1);t.push({id:"file"+h,character:String(h),style:(0,un.Z)({left:d+"px",top:p+"px"},r)})}return t},h=function(e){var n=[];return t.board.listNonEmptySquares().forEach((function(i){var r=t.board.at(i),c=r.id+i.index,u=o?Q(r.color):r.color,l=r.type==z.KING&&r.color==V.BLACK?"king2":r.type,h=a.pieceImages[u][l],d=e.x+(yn.board.leftPiecePadding+yn.board.squreWidth*(o?i.opposite:i).x)*s,p=e.y+(yn.board.topPiecePadding+yn.board.squreHeight*(o?i.opposite:i).y)*s,v=yn.piece.width*s,f=yn.piece.height*s;n.push({id:c,imagePath:h,style:{left:d+"px",top:p+"px",width:v+"px",height:f+"px"}})})),n},d=function(e){var t=[];return Ne.all.forEach((function(r){var a=r.index,c=r.file,u=r.rank,l=e.x+(yn.board.leftSquarePadding+yn.board.squreWidth*(o?r.opposite:r).x)*s,h=e.y+(yn.board.topSquarePadding+yn.board.squreHeight*(o?r.opposite:r).y)*s,d=yn.board.squreWidth*s,p=yn.board.squreHeight*s,v={left:l+"px",top:h+"px",width:d+"px",height:p+"px"},f=v;n&&r.equals(n.to)&&(f=(0,un.Z)((0,un.Z)({},f),yn.board.highlight.lastMoveTo)),n&&n.from instanceof Ne&&r.equals(n.from)&&(f=(0,un.Z)((0,un.Z)({},f),yn.board.highlight.lastMoveFrom)),i instanceof Ne&&i.equals(r)&&(f=(0,un.Z)((0,un.Z)({},f),yn.board.highlight.selected)),t.push({id:a,file:c,rank:u,style:v,backgroundStyle:f})})),t},p=function(e,t){var n=o?Q(e):e,r=yn.hand[n].x*s,c=yn.hand[n].y*s,u=yn.hand.width*s,l=yn.hand.height*s,h={"background-color":a.handColor,left:r+"px",top:c+"px",width:u+"px",height:l+"px"},d=[],p=[];return re.forEach((function(r){for(var o=t.count(r),c=kn[n][r],u=yn.hand.width/2*c.width*s,l=yn.hand.height/4*s,h=u*c.column,v=l*c.row,f=yn.piece.width*s,g=yn.piece.height*s,m=Math.max(u-f*o,0)/(2*o),_=(u-f-2*m)/Math.max(o-1,1),y=o-1;y>=0;y-=1){var S=r+y,w=a.pieceImages[n][r],E=h+m+_*y,k=v;d.push({id:S,imagePath:w,style:{left:E+"px",top:k+"px",width:f+"px",height:g+"px"}})}var I=r,b={left:h+"px",top:v+"px",width:u+"px",height:l+"px"},T=b;i&&i instanceof ge&&i.color===e&&i.type===r&&(T=(0,un.Z)((0,un.Z)({},T),yn.hand.highlight.selected)),p.push({id:I,type:r,style:b,backgroundStyle:T})})),{style:h,pieces:d,pointers:p}},v=function(e,t){if(!t)return null;var n=o?Q(t.color):t.color,i=o?t.to.opposite:t.to,r=new ge(n,t.pieceType),c=r.promoted(),u=r.unpromoted(),l=a.pieceImages[n][c.type],h=a.pieceImages[n][u.type],d=e.x+(yn.board.leftSquarePadding+yn.board.squreWidth*(0===i.x?0:8===i.x?7:i.x-.5))*s,p=e.y+(yn.board.topSquarePadding+yn.board.squreHeight*i.y)*s,v=2*yn.board.squreWidth*s,f=yn.board.squreHeight*s,g={left:d+"px",top:p+"px",width:v+"px",height:f+"px","font-size":f/4+"px"};return{promoteImagePath:l,notPromoteImagePath:h,style:g}},f=function(){var e=t.color,n=o?Q(e):e,i=2;return{style:{left:yn.turn[n].x*s-i+"px",top:yn.turn[n].y*s-i+"px",width:yn.turn.width*s-i+"px",height:yn.turn.height*s-i+"px","font-size":yn.turn.fontSize*s+"px","border-radius":yn.turn.height*s*.4+"px","border-width":i+"px","border-style":"solid"}}},g=function(e){var t=o?Q(e):e;return{style:{left:yn.playerName[t].x*s+"px",top:yn.playerName[t].y*s+"px",width:yn.playerName.width*s+"px",height:yn.playerName.height*s+"px","font-size":yn.playerName.fontSize*s+"px"}}},m=function(e){var t=o?Q(e):e;return{style:{left:yn.clock[t].x*s+"px",top:yn.clock[t].y*s+"px",width:yn.clock.width*s+"px",height:yn.clock.height*s+"px","font-size":yn.clock.fontSize*s+"px"}}},_=function(){return{left:{style:{left:yn.control.left.x*s+"px",top:yn.control.left.y*s+"px",width:yn.control.left.width*s+"px",height:yn.control.left.height*s+"px","font-size":yn.control.left.fontSize*s+"px"}},right:{style:{left:yn.control.right.x*s+"px",top:yn.control.right.y*s+"px",width:yn.control.right.width*s+"px",height:yn.control.right.height*s+"px","font-size":yn.control.right.fontSize*s+"px"}}}},y=c(),S=u(),w=l(S),E=h(S),k=d(S),I=p(V.BLACK,t.hand(V.BLACK)),b=p(V.WHITE,t.hand(V.WHITE)),T=v(S,r),R=f(),A=g(V.BLACK),N=g(V.WHITE),P=m(V.BLACK),O=m(V.WHITE),C=_();return{frame:y,board:S,labels:w,piece:E,square:k,blackHand:I,whiteHand:b,promotion:T,turn:R,blackPlayerName:A,whitePlayerName:N,blackClock:P,whiteClock:O,control:C}}}]),e}(),Tn=(0,a.aZ)({name:"BoardView",props:{pieceImageType:{type:String,required:!0},boardImageType:{type:String,required:!0},boardLabelType:{type:String,required:!0},maxSize:{type:_n,required:!0},position:{type:Object,required:!0},lastMove:{type:Object,required:!1,default:null},flip:{type:Boolean,required:!1},allowEdit:{type:Boolean,required:!1},allowMove:{type:Boolean,required:!1},blackPlayerName:{type:String,required:!1,default:"先手"},whitePlayerName:{type:String,required:!1,default:"後手"},blackPlayerTimeMs:{type:Number,required:!1,default:void 0},blackPlayerByoyomi:{type:Number,required:!1,default:void 0},whitePlayerTimeMs:{type:Number,required:!1,default:void 0},whitePlayerByoyomi:{type:Number,required:!1,default:void 0}},emits:["resize","move","edit"],setup:function(e,t){var n=(0,d.qj)({pointer:null,reservedMove:null}),i=function(){n.pointer=null,n.reservedMove=null};(0,a.YP)([function(){return e.position},function(){return e.allowEdit},function(){return e.allowMove}],(function(){i()}));var r=function(){i()},o=function(r,o,a){var s=n.pointer;if(i(),!(r instanceof Ne&&s instanceof Ne&&r.equals(s))&&!(r instanceof ge&&s instanceof ge&&r.equals(s))){if(s){var c=s,u=r instanceof Ne?r:r.color;if(e.allowEdit&&e.position.isValidEditing(c,u))return void t.emit("edit",{move:{from:s,to:u}});if(e.allowMove&&r instanceof Ne){var l=s instanceof Ne?s:s.type,h=r,d=e.position.createMove(l,h);if(!d)return;var p=e.position.isValidMove(d),v=e.position.isValidMove(d.withPromote());if(p&&v)return void(n.reservedMove=d);if(p)return void t.emit("move",d);if(v)return void t.emit("move",d.withPromote())}}!e.allowMove&&!e.allowEdit||o||(e.allowEdit||a===e.position.color)&&(n.pointer=r)}},s=function(t,n,i){t.stopPropagation(),t.preventDefault();var r=new Ne(n,i),a=e.position.board.at(r),s=!a;o(r,s,null===a||void 0===a?void 0:a.color)},c=function(t,n,i){t.stopPropagation(),t.preventDefault();var r=0===e.position.hand(n).count(i);o(new ge(n,i),r,n)},u=function(n,r,o){n.stopPropagation(),n.preventDefault(),i();var a=new Ne(r,o);e.allowEdit&&e.position.board.at(a)&&t.emit("edit",{rotate:a})},l=function(r){r.stopPropagation(),r.preventDefault();var o=n.reservedMove;i(),o&&e.position.isValidMove(o.withPromote())&&t.emit("move",o.withPromote())},h=function(r){r.stopPropagation(),r.preventDefault();var o=n.reservedMove;i(),o&&e.position.isValidMove(o)&&t.emit("move",o)},p=(0,a.Fl)((function(){var t=new bn(e.pieceImageType,e.boardImageType,e.boardLabelType);return t.preload(),t})),v=(0,a.Fl)((function(){var i=new _n(20,20),r=p.value.build(e.maxSize.reduce(i),e.position,e.lastMove,n.pointer,n.reservedMove,e.flip);return t.emit("resize",r.frame.size.add(i)),r})),f=function(e,t){return e?Je(Math.ceil(e/1e3)):void 0!==t?""+t:"0:00:00"},g=function(e,t){if(!e&&!t)return"normal";var n=(e||0)/1e3+(t||0);return n<=5?"danger":n<=10?"warning":"normal"},m=(0,a.Fl)((function(){return f(e.blackPlayerTimeMs,e.blackPlayerByoyomi)})),_=(0,a.Fl)((function(){return g(e.blackPlayerTimeMs,e.blackPlayerByoyomi)})),y=(0,a.Fl)((function(){return f(e.whitePlayerTimeMs,e.whitePlayerByoyomi)})),S=(0,a.Fl)((function(){return g(e.whitePlayerTimeMs,e.whitePlayerByoyomi)}));return{clickFrame:r,clickSquare:s,clickHand:c,clickSquareR:u,clickPromote:l,clickNotPromote:h,layout:v,blackPlayerTimeText:m,blackPlayerTimeSeverity:_,whitePlayerTimeText:y,whitePlayerTimeSeverity:S,Color:V}}}),Rn=n(3744);const An=(0,Rn.Z)(Tn,[["render",j],["__scopeId","data-v-7b1939f2"]]);var Nn=An,Pn=(n(8309),n(2707),n(9714),"es://human"),On="es://usi-engine/";function Cn(e){return e.startsWith(On)}function Hn(){var e=Date.now(),t=Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16);return On+"".concat(e,"/").concat(t)}var Mn="USI_Ponder",Ln="USI_MultiPV",Dn="Threads",xn="NumberOfThreads",Bn="MultiPV";function Gn(e){if(e)return void 0!==e.value?e.value:void 0!==e.default?"string"===e.type&&"<empty>"===e.default?"":e.default:void 0}function Zn(e){var t=JSON.parse(JSON.stringify(e));return t.uri=Hn(),t.name+=" のコピー",t}function Wn(e,t){e.uri=t.uri,e.name=t.name,Object.keys(t.options).forEach((function(n){e.options[n]&&(e.options[n].value=t.options[n].value)}))}var Un,Kn,Fn,qn,jn,Vn,zn=function(){function e(t){if((0,Y.Z)(this,e),(0,$.Z)(this,"engines",void 0),this.engines={},t){var n=JSON.parse(t);n.engines instanceof Object&&(this.engines=n.engines)}}return(0,J.Z)(e,[{key:"hasEngine",value:function(e){return!!this.engines[e]}},{key:"addEngine",value:function(e){this.engines[e.uri]=e}},{key:"updateEngine",value:function(e){return!!this.engines[e.uri]&&(this.engines[e.uri]=e,!0)}},{key:"removeEngine",value:function(e){return!!this.engines[e]&&(delete this.engines[e],!0)}},{key:"getEngine",value:function(e){return this.engines[e]}},{key:"engineList",get:function(){return Object.values(this.engines).sort((function(e,t){return e.name!==t.name?e.name>t.name?1:-1:e.defaultName!==t.defaultName?e.defaultName>t.defaultName?1:-1:e.uri>t.uri?1:-1}))}},{key:"json",get:function(){return JSON.stringify(this)}},{key:"jsonWithIndent",get:function(){return JSON.stringify(this,void 0,2)}}]),e}();function Yn(){return{startCriteria:{enableNumber:!1,number:20},endCriteria:{enableNumber:!1,number:100},perMoveCriteria:{maxSeconds:5},commentBehavior:Un.INSERT}}function Jn(e){return{thema:Kn.STANDARD,pieceImage:fn.HITOMOJI,boardImage:gn.LIGHT,boardLabelType:mn.STANDARD,pieceVolume:30,clockVolume:30,clockPitch:500,clockSoundTarget:qn.ONLY_USER,boardFlipping:!1,tab:Fn.RECORD_INFO,returnCode:e||"\r\n",coefficientInSigmoid:600,badMoveLevelThreshold1:5,badMoveLevelThreshold2:10,badMoveLevelThreshold3:20,badMoveLevelThreshold4:50,showElapsedTimeInRecordView:!0,showCommentInRecordView:!0,enableAppLog:!1,enableUSILog:!1}}function $n(e){return e.pieceVolume<0||e.pieceVolume>100?new Error("駒音の大きさには0%～100%の値を指定してください。"):e.clockVolume<0||e.clockVolume>100?new Error("時計音の大きさには0%～100%の値を指定してください。"):e.clockPitch<220||e.clockPitch>880?new Error("時計音の高さには220Hz～880Hzの値を指定してください。"):e.coefficientInSigmoid<=0?new Error("勝率換算係数には0より大きい値を指定してください。"):e.badMoveLevelThreshold1<1||e.badMoveLevelThreshold1>100?new Error("緩手には1%～100%の値を指定してください。"):e.badMoveLevelThreshold2<1||e.badMoveLevelThreshold2>100?new Error("疑問手には1%～100%の値を指定してください。"):e.badMoveLevelThreshold3<1||e.badMoveLevelThreshold3>100?new Error("悪手には1%～100%の閾値を指定してください。"):e.badMoveLevelThreshold4<1||e.badMoveLevelThreshold4>100?new Error("大悪手には1%～100%の値を指定してください。"):e.badMoveLevelThreshold1>=e.badMoveLevelThreshold2?new Error("緩手には疑問手より小さい値を指定してください。"):e.badMoveLevelThreshold2>=e.badMoveLevelThreshold3?new Error("疑問手には悪手より小さい値を指定してください。"):e.badMoveLevelThreshold3>=e.badMoveLevelThreshold4?new Error("悪手には大悪手より小さい値を指定してください。"):void 0}function Qn(){return{black:{name:"人",uri:Pn},white:{name:"人",uri:Pn},timeLimit:{timeSeconds:0,byoyomi:30,increment:0},enableEngineTimeout:!1,humanIsFront:!0}}function Xn(e){return 0===e.timeLimit.timeSeconds&&0===e.timeLimit.byoyomi?new Error("持ち時間と秒読みが両方とも0です。"):0!==e.timeLimit.byoyomi&&0!==e.timeLimit.increment?new Error("秒読みとフィッシャールールは併用できません。"):void 0}function ei(){return{}}(function(e){e["NONE"]="none",e["INSERT"]="insert",e["APPEND"]="append",e["OVERWRITE"]="overwrite"})(Un||(Un={})),function(e){e["STANDARD"]="standard",e["CHERRY_BLOSSOM"]="cherry-blossom",e["DARK"]="dark"}(Kn||(Kn={})),function(e){e["RECORD_INFO"]="recordInfo",e["COMMENT"]="comment",e["SEARCH"]="search",e["PV"]="pv",e["CHART"]="chart",e["PERCENTAGE_CHART"]="percentageChart",e["INVISIBLE"]="invisible"}(Fn||(Fn={})),function(e){e["ALL"]="all",e["ONLY_USER"]="onlyUser"}(qn||(qn={})),function(e){e["INFO"]="info",e["WARN"]="warn",e["ERROR"]="error"}(jn||(jn={})),function(e){e["APP_SETTING"]="appSetting",e["RESEARCH_SETTING"]="researchSetting",e["ANALYSIS_SETTING"]="analysisSetting",e["GAME_SETTING"]="gameSetting"}(Vn||(Vn={}));var ti={getRecordPathFromProcArg:function(){return(0,i.Z)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return","");case 1:case"end":return e.stop()}}),e)})))()},updateMenuState:function(){},showOpenRecordDialog:function(){return(0,i.Z)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:throw"Web版では利用できない機能です。";case 1:case"end":return e.stop()}}),e)})))()},openRecord:function(){return(0,i.Z)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:throw"Web版では利用できない機能です。";case 1:case"end":return e.stop()}}),e)})))()},showSaveRecordDialog:function(){return(0,i.Z)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:throw"Web版では利用できない機能です。";case 1:case"end":return e.stop()}}),e)})))()},saveRecord:function(){return(0,i.Z)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:throw"Web版では利用できない機能です。";case 1:case"end":return e.stop()}}),e)})))()},showSelectFileDialog:function(){return(0,i.Z)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:throw"Web版では利用できない機能です。";case 1:case"end":return e.stop()}}),e)})))()},loadAppSetting:function(){return(0,i.Z)(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t=localStorage.getItem(Vn.APP_SETTING),t){e.next=3;break}return e.abrupt("return",JSON.stringify(Jn()));case 3:return e.abrupt("return",JSON.stringify((0,un.Z)((0,un.Z)({},Jn()),JSON.parse(t))));case 4:case"end":return e.stop()}}),e)})))()},saveAppSetting:function(e){return(0,i.Z)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:localStorage.setItem(Vn.APP_SETTING,e);case 1:case"end":return t.stop()}}),t)})))()},loadResearchSetting:function(){return(0,i.Z)(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t=localStorage.getItem(Vn.RESEARCH_SETTING),t){e.next=3;break}return e.abrupt("return",JSON.stringify(ei()));case 3:return e.abrupt("return",JSON.stringify((0,un.Z)((0,un.Z)({},ei()),JSON.parse(t))));case 4:case"end":return e.stop()}}),e)})))()},saveResearchSetting:function(e){return(0,i.Z)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:localStorage.setItem(Vn.RESEARCH_SETTING,e);case 1:case"end":return t.stop()}}),t)})))()},loadAnalysisSetting:function(){return(0,i.Z)(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t=localStorage.getItem(Vn.ANALYSIS_SETTING),t){e.next=3;break}return e.abrupt("return",JSON.stringify(Yn()));case 3:return e.abrupt("return",JSON.stringify((0,un.Z)((0,un.Z)({},Yn()),JSON.parse(t))));case 4:case"end":return e.stop()}}),e)})))()},saveAnalysisSetting:function(e){return(0,i.Z)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:localStorage.setItem(Vn.ANALYSIS_SETTING,e);case 1:case"end":return t.stop()}}),t)})))()},loadGameSetting:function(){return(0,i.Z)(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t=localStorage.getItem(Vn.GAME_SETTING),t){e.next=3;break}return e.abrupt("return",JSON.stringify(Qn()));case 3:return e.abrupt("return",JSON.stringify((0,un.Z)((0,un.Z)({},Qn()),JSON.parse(t))));case 4:case"end":return e.stop()}}),e)})))()},saveGameSetting:function(e){return(0,i.Z)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:localStorage.setItem(Vn.GAME_SETTING,e);case 1:case"end":return t.stop()}}),t)})))()},loadUSIEngineSetting:function(){return(0,i.Z)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",(new zn).json);case 1:case"end":return e.stop()}}),e)})))()},saveUSIEngineSetting:function(){return(0,i.Z)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))()},showSelectUSIEngineDialog:function(){return(0,i.Z)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:throw"Web版では利用できない機能です。";case 1:case"end":return e.stop()}}),e)})))()},getUSIEngineInfo:function(){return(0,i.Z)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:throw"Web版では利用できない機能です。";case 1:case"end":return e.stop()}}),e)})))()},sendUSISetOption:function(){return(0,i.Z)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))()},usiLaunch:function(){return(0,i.Z)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:throw"Web版では利用できない機能です。";case 1:case"end":return e.stop()}}),e)})))()},usiGo:function(){return(0,i.Z)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))()},usiGoPonder:function(){return(0,i.Z)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))()},usiPonderHit:function(){return(0,i.Z)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))()},usiGoInfinite:function(){return(0,i.Z)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))()},usiStop:function(){return(0,i.Z)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))()},usiGameover:function(){return(0,i.Z)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))()},usiQuit:function(){return(0,i.Z)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))()},log:function(e,t){switch(e){case jn.INFO:console.log(t);break;case jn.WARN:console.warn(t);break;case jn.ERROR:console.error(t);break}},onSendError:function(){},onMenuEvent:function(){},onUSIBestMove:function(){},onUSIInfo:function(){},onUSIPonderInfo:function(){}};function ni(){return window}var ii=ni().electronShogiAPI||ti,ri=(0,un.Z)((0,un.Z)({},ii),{},{loadAppSetting:function(){return(0,i.Z)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.t0=JSON,e.next=3,ii.loadAppSetting();case 3:return e.t1=e.sent,e.abrupt("return",e.t0.parse.call(e.t0,e.t1));case 5:case"end":return e.stop()}}),e)})))()},saveAppSetting:function(e){return ii.saveAppSetting(JSON.stringify(e))},loadResearchSetting:function(){return(0,i.Z)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.t0=JSON,e.next=3,ii.loadResearchSetting();case 3:return e.t1=e.sent,e.abrupt("return",e.t0.parse.call(e.t0,e.t1));case 5:case"end":return e.stop()}}),e)})))()},saveResearchSetting:function(e){return ii.saveResearchSetting(JSON.stringify(e))},loadAnalysisSetting:function(){return(0,i.Z)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.t0=JSON,e.next=3,ii.loadAnalysisSetting();case 3:return e.t1=e.sent,e.abrupt("return",e.t0.parse.call(e.t0,e.t1));case 5:case"end":return e.stop()}}),e)})))()},saveAnalysisSetting:function(e){return ii.saveAnalysisSetting(JSON.stringify(e))},loadGameSetting:function(){return(0,i.Z)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.t0=JSON,e.next=3,ii.loadGameSetting();case 3:return e.t1=e.sent,e.abrupt("return",e.t0.parse.call(e.t0,e.t1));case 5:case"end":return e.stop()}}),e)})))()},saveGameSetting:function(e){return ii.saveGameSetting(JSON.stringify(e))},loadUSIEngineSetting:function(){return(0,i.Z)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.t0=zn,e.next=3,ii.loadUSIEngineSetting();case 3:return e.t1=e.sent,e.abrupt("return",new e.t0(e.t1));case 5:case"end":return e.stop()}}),e)})))()},saveUSIEngineSetting:function(e){return ii.saveUSIEngineSetting(e.json)},getUSIEngineInfo:function(e){return(0,i.Z)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.t0=JSON,t.next=3,ii.getUSIEngineInfo(e);case 3:return t.t1=t.sent,t.abrupt("return",t.t0.parse.call(t.t0,t.t1));case 5:case"end":return t.stop()}}),t)})))()},usiLaunch:function(e){return ii.usiLaunch(JSON.stringify(e))},usiGo:function(e,t,n,i,r){return ii.usiGo(e,t,JSON.stringify(n),i,r)},usiGoPonder:function(e,t,n,i,r){return ii.usiGoPonder(e,t,JSON.stringify(n),i,r)}}),oi=ri;function ai(){return!!ni().electronShogiAPI}var si,ci=n(4914),ui=n.n(ci);function li(e){var t=(null===e||void 0===e?void 0:e.type)||"sine",n=(null===e||void 0===e?void 0:e.frequency)||440,i=(null===e||void 0===e?void 0:e.volume)||2,r=new AudioContext,o=r.createOscillator(),a=r.createGain();return o.connect(a),a.connect(r.destination),o.type=t,o.frequency.value=n,a.gain.value=.005*i,o.onended=function(){a.disconnect(r.destination),o.disconnect(a)},o.start(r.currentTime),null!==e&&void 0!==e&&e.time&&o.stop(r.currentTime+e.time),{stop:function(){null!==e&&void 0!==e&&e.time||o.stop()}}}function hi(e){li({type:"sine",frequency:e.frequency,time:.1,volume:e.volume})}function di(e){return li({type:"sine",frequency:e.frequency,volume:e.volume})}function pi(e){var t=Date.now();if(!(si&&t<si+200)){var n=new Audio("sound/piece.mp3");n.volume=.01*e,n.play(),si=t}}var vi;n(189);function fi(e){switch(e){case vi.BLACK_PLAYER:return"先手";case vi.WHITE_PLAYER:return"後手";case vi.RESEARCHER:return"検討"}}function gi(e,t){var n,i,r=e.clone(),o="",a=(0,ot.Z)(t);try{for(a.s();!(i=a.n()).done;){var s=i.value,c=r.createMoveBySFEN(s);if(!c)break;r.doMove(c,{ignoreValidation:!0}),o+=c.getDisplayText(n),n=c}}catch(u){a.e(u)}finally{a.f()}return o}(function(e){e["BLACK_PLAYER"]="blackPlayer",e["WHITE_PLAYER"]="whitePlayer",e["RESEARCHER"]="researcher"})(vi||(vi={}));var mi,_i=function(){function e(t,n,i){(0,Y.Z)(this,e),(0,$.Z)(this,"sessionID",void 0),(0,$.Z)(this,"name",void 0),(0,$.Z)(this,"sfen",void 0),(0,$.Z)(this,"nodes",void 0),(0,$.Z)(this,"nps",void 0),(0,$.Z)(this,"iterates",void 0),(0,$.Z)(this,"hashfull",void 0),(0,$.Z)(this,"currentMove",void 0),(0,$.Z)(this,"currentMoveText",void 0),(0,$.Z)(this,"ponderMove",void 0),this.sessionID=t,this.name=n,this.sfen=i,this.iterates=[]}return(0,J.Z)(e,[{key:"latestIteration",get:function(){var e,t=[],n=new Set,i=new Set,r=(0,ot.Z)(this.iterates);try{for(r.s();!(e=r.n()).done;){var o=e.value,a=o.pv?o.pv[0]:void 0;n.has(o.multiPV)||i.has(a)||(t.push(o),n.add(o.multiPV),i.add(a))}}catch(s){r.e(s)}finally{r.f()}return t.sort((function(e,t){return(e.multiPV||1)-(t.multiPV||1)}))}},{key:"update",value:function(e,t,n){var i=Fe.newBySFEN(e),r={position:e};if(void 0!==t.depth&&(r.depth=t.depth),void 0!==t.seldepth&&(r.selectiveDepth=t.seldepth),void 0!==t.timeMs&&(r.timeMs=t.timeMs),void 0!==t.nodes&&(this.nodes=t.nodes),t.pv&&(r.pv=t.pv,r.text=i?gi(i,t.pv):""),void 0!==t.multipv&&(r.multiPV=t.multipv),void 0!==t.scoreCP&&(r.score=t.scoreCP),void 0!==t.scoreMate&&(r.scoreMate=t.scoreMate),void 0!==t.lowerbound&&(r.lowerBound=t.lowerbound),void 0!==t.upperbound&&(r.upperBound=t.upperbound),void 0!==t.currmove){this.currentMove=t.currmove;var o=i&&i.createMoveBySFEN(t.currmove);o&&(this.currentMoveText=o.getDisplayText())}void 0!==t.hashfullPerMill&&(this.hashfull=t.hashfullPerMill/1e3),void 0!==t.nps&&(this.nps=t.nps),t.string&&(r.text=t.string),0!==Object.keys(r).length&&(void 0!==t.nodes&&(r.nodes=t.nodes),this.iterates.unshift(r)),this.ponderMove=null===n||void 0===n?void 0:n.getDisplayText()}}]),e}(),yi=function(){function e(){(0,Y.Z)(this,e),(0,$.Z)(this,"_blackPlayer",void 0),(0,$.Z)(this,"_whitePlayer",void 0),(0,$.Z)(this,"_researcher",void 0),(0,$.Z)(this,"updateQueue",void 0),(0,$.Z)(this,"timeoutHandle",void 0),this.updateQueue=[]}return(0,J.Z)(e,[{key:"blackPlayer",get:function(){return this._blackPlayer}},{key:"whitePlayer",get:function(){return this._whitePlayer}},{key:"researcher",get:function(){return this._researcher}},{key:"update",value:function(e,t,n,i,r,o){var a=this;this.updateQueue.push({sessionID:e,sfen:t.sfen,sender:n,name:i,info:r,ponderMove:o}),this.timeoutHandle||(this.timeoutHandle=window.setTimeout((function(){a.dequeue()}),100))}},{key:"dequeue",value:function(){var e,t=(0,ot.Z)(this.updateQueue);try{for(t.s();!(e=t.n()).done;){var n=e.value;this._update(n)}}catch(i){t.e(i)}finally{t.f()}this.updateQueue=[],this.timeoutHandle=void 0}},{key:"_update",value:function(e){switch(e.sender){case vi.BLACK_PLAYER:this._blackPlayer&&this._blackPlayer.sessionID===e.sessionID&&this._blackPlayer.sfen===e.sfen||(this._blackPlayer=new _i(e.sessionID,e.name,e.sfen)),this._blackPlayer.update(e.sfen,e.info,e.ponderMove),this._researcher=void 0;break;case vi.WHITE_PLAYER:this._whitePlayer&&this._whitePlayer.sessionID===e.sessionID&&this._whitePlayer.sfen===e.sfen||(this._whitePlayer=new _i(e.sessionID,e.name,e.sfen)),this._whitePlayer.update(e.sfen,e.info,e.ponderMove),this._researcher=void 0;break;case vi.RESEARCHER:this._researcher&&this._researcher.sessionID===e.sessionID&&this._researcher.sfen===e.sfen||(this._researcher=new _i(e.sessionID,e.name,e.sfen)),this._researcher.update(e.sfen,e.info),this._blackPlayer=void 0,this._whitePlayer=void 0;break}}}]),e}(),Si=3e4,wi=function(){function e(t){if((0,Y.Z)(this,e),(0,$.Z)(this,"evaluation",void 0),t){var n=JSON.parse(t);this.evaluation=n.evaluation}}return(0,J.Z)(e,[{key:"updateScore",value:function(e,t,n){switch(this.evaluation||(this.evaluation={}),t){case vi.BLACK_PLAYER:this.evaluation[vi.BLACK_PLAYER]=n;break;case vi.WHITE_PLAYER:this.evaluation[vi.WHITE_PLAYER]=-n;break;case vi.RESEARCHER:this.evaluation[vi.RESEARCHER]=e===V.BLACK?n:-n;break}}},{key:"updateUSIInfo",value:function(e,t,n){void 0!==n.multipv&&1!==n.multipv||(n.scoreCP?this.updateScore(e,t,n.scoreCP):n.scoreMate&&this.updateScore(e,t,n.scoreMate>=0?Si:-Si))}},{key:"stringify",value:function(){return JSON.stringify(this)}}]),e}();function Ei(e){return $e(e.timeSeconds)+"+"+String(e.byoyomi).padStart(2,"0")}(function(e){e["WIN"]="win",e["LOSE"]="lose",e["DRAW"]="draw"})(mi||(mi={}));var ki=function(){function e(){(0,Y.Z)(this,e),(0,$.Z)(this,"searchHandler",void 0)}return(0,J.Z)(e,[{key:"isEngine",value:function(){return!1}},{key:"startSearch",value:function(){var e=(0,i.Z)(regeneratorRuntime.mark((function e(t,n,i,r,o){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:this.searchHandler=o;case 1:case"end":return e.stop()}}),e,this)})));function t(t,n,i,r,o){return e.apply(this,arguments)}return t}()},{key:"startPonder",value:function(){var e=(0,i.Z)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));function t(){return e.apply(this,arguments)}return t}()},{key:"stop",value:function(){var e=(0,i.Z)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));function t(){return e.apply(this,arguments)}return t}()},{key:"gameover",value:function(){var e=(0,i.Z)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));function t(){return e.apply(this,arguments)}return t}()},{key:"close",value:function(){var e=(0,i.Z)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:this.searchHandler=void 0;case 1:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"doMove",value:function(e){var t=this.searchHandler;this.searchHandler=void 0,t&&t.onMove(e)}},{key:"resign",value:function(){var e=this.searchHandler;this.searchHandler=void 0,e&&e.onResign()}}]),e}(),Ii=new ki,bi=function(){function e(t){(0,Y.Z)(this,e),(0,$.Z)(this,"setting",void 0),(0,$.Z)(this,"sessionID",void 0),(0,$.Z)(this,"usi",void 0),(0,$.Z)(this,"position",void 0),(0,$.Z)(this,"searchHandler",void 0),(0,$.Z)(this,"ponder",void 0),(0,$.Z)(this,"inPonder",void 0),this.setting=t,this.sessionID=0,this.inPonder=!1}return(0,J.Z)(e,[{key:"launch",value:function(){var e=(0,i.Z)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,oi.usiLaunch(this.setting);case 2:this.sessionID=e.sent,Ti[this.sessionID]=this;case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"isEngine",value:function(){return!0}},{key:"startSearch",value:function(){var e=(0,i.Z)(regeneratorRuntime.mark((function e(t,n,i,r,o){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.searchHandler=o,this.usi=t.usi,this.position=t.position.clone(),!this.inPonder||this.ponder!==this.usi){e.next=7;break}oi.usiPonderHit(this.sessionID),e.next=9;break;case 7:return e.next=9,oi.usiGo(this.sessionID,this.usi,n,i,r);case 9:this.inPonder=!1,this.ponder=void 0;case 11:case"end":return e.stop()}}),e,this)})));function t(t,n,i,r,o){return e.apply(this,arguments)}return t}()},{key:"startPonder",value:function(){var e=(0,i.Z)(regeneratorRuntime.mark((function e(t,n,i,r){var o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.ponder&&this.ponder.startsWith(t.usi)){e.next=2;break}return e.abrupt("return");case 2:if(o=Gn(this.setting.options[Mn]),"true"===o){e.next=5;break}return e.abrupt("return");case 5:return this.inPonder=!0,e.next=8,oi.usiGoPonder(this.sessionID,this.ponder,n,i,r);case 8:case"end":return e.stop()}}),e,this)})));function t(t,n,i,r){return e.apply(this,arguments)}return t}()},{key:"startResearch",value:function(){var e=(0,i.Z)(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.searchHandler=void 0,this.usi=t.usi,e.next=4,oi.usiGoInfinite(this.sessionID,t.usi);case 4:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"stop",value:function(){var e=(0,i.Z)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,oi.usiStop(this.sessionID);case 2:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"gameover",value:function(){var e=(0,i.Z)(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,oi.usiGameover(this.sessionID,t);case 2:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"close",value:function(){var e=(0,i.Z)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.searchHandler=void 0,e.next=3,oi.usiQuit(this.sessionID);case 3:delete Ti[this.sessionID];case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"onBestMove",value:function(e,t,n){var i=this.searchHandler;if(this.searchHandler=void 0,i&&this.position&&e===this.usi)if("resign"!==t)if("win"!==t){var r=this.position.createMoveBySFEN(t);if(!r)return i.onError("エンジンから不明な指し手を受信しました:"+t),void i.onResign();this.ponder=n&&"".concat(e," ").concat(t," ").concat(n),i.onMove(r)}else i.onWin();else i.onResign()}}]),e}(),Ti={};function Ri(e,t,n,i){var r=Ti[e];r&&r.onBestMove(t,n,i)}var Ai,Ni={build:function(e){return(0,i.Z)(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.uri!==Pn){t.next=4;break}return t.abrupt("return",Ii);case 4:if(!Cn(e.uri)||!e.usi){t.next=9;break}return n=new bi(e.usi),t.next=8,n.launch();case 8:return t.abrupt("return",n);case 9:throw new Error("予期せぬプレイヤーURIです: "+e.uri);case 10:case"end":return t.stop()}}),t)})))()}};(function(e){e["IDLE"]="idle",e["ACTIVE"]="active",e["PENDING"]="pending",e["BUSSY"]="bussy"})(Ai||(Ai={}));var Pi=function(){function e(t,n){(0,Y.Z)(this,e),(0,$.Z)(this,"state",void 0),(0,$.Z)(this,"handlers",void 0),(0,$.Z)(this,"playerBuilder",void 0),(0,$.Z)(this,"blackState",void 0),(0,$.Z)(this,"whiteState",void 0),(0,$.Z)(this,"timerHandle",void 0),(0,$.Z)(this,"timerStart",void 0),(0,$.Z)(this,"lastTimeMs",void 0),(0,$.Z)(this,"_elapsedMs",void 0),(0,$.Z)(this,"_setting",void 0),(0,$.Z)(this,"blackPlayer",void 0),(0,$.Z)(this,"whitePlayer",void 0),(0,$.Z)(this,"lastEventID",void 0),(0,$.Z)(this,"record",void 0),this.state=Ai.IDLE,this.handlers=n,this.playerBuilder=t,this.blackState={timeMs:0,byoyomi:0},this.whiteState={timeMs:0,byoyomi:0},this.timerHandle=0,this.timerStart=new Date,this.lastTimeMs=0,this._elapsedMs=0,this._setting=Qn(),this.lastEventID=0,this.record=new rt}return(0,J.Z)(e,[{key:"blackTimeMs",get:function(){return this.blackState.timeMs}},{key:"blackByoyomi",get:function(){return this.blackState.byoyomi}},{key:"whiteTimeMs",get:function(){return this.whiteState.timeMs}},{key:"whiteByoyomi",get:function(){return this.whiteState.byoyomi}},{key:"elapsedMs",get:function(){return this._elapsedMs}},{key:"setting",get:function(){return this._setting}},{key:"startGame",value:function(){var e=(0,i.Z)(regeneratorRuntime.mark((function e(t,n){var i=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.state===Ai.IDLE){e.next=2;break}throw Error("前回の対局が正常に終了できていません。アプリを再起動してください。");case 2:return this.blackState.timeMs=1e3*t.timeLimit.timeSeconds,this.blackState.byoyomi=t.timeLimit.byoyomi,this.whiteState.timeMs=1e3*t.timeLimit.timeSeconds,this.whiteState.byoyomi=t.timeLimit.byoyomi,this._setting=t,this.record=n,e.prev=8,e.next=11,this.playerBuilder.build(t.black);case 11:return this.blackPlayer=e.sent,e.next=14,this.playerBuilder.build(t.white);case 14:this.whitePlayer=e.sent,e.next=28;break;case 17:return e.prev=17,e.t0=e["catch"](8),e.prev=19,e.next=22,this.closePlayers();case 22:e.next=27;break;case 24:e.prev=24,e.t1=e["catch"](19),this.handlers.onError(e.t1);case 27:throw e.t0;case 28:this.state=Ai.ACTIVE,setTimeout((function(){return i.next()}));case 30:case"end":return e.stop()}}),e,this,[[8,17],[19,24]])})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"next",value:function(){var e=this;if(this.state===Ai.ACTIVE){var t=this.record.position.color;this.startTimer(t);var n=this.getPlayer(t),i=this.getPlayer(Q(t));if(n&&i){var r=this.issueEventID();n.startSearch(this.record,this.setting,this.blackTimeMs,this.whiteTimeMs,{onMove:function(t){return e.onMove(r,t)},onResign:function(){return e.onResign(r)},onWin:function(){return e.onWin(r)},onError:function(t){return e.handlers.onError(t)}}).catch((function(t){e.handlers.onError(new Error("プレイヤーにコマンドを送信できませんでした: "+t))})),i.startPonder(this.record,this.setting,this.blackTimeMs,this.whiteTimeMs).catch((function(t){e.handlers.onError(new Error("プレイヤーにPonderコマンドを送信できませんでした: "+t))}))}else this.handlers.onError("致命的なエラーが発生しました: GameManager.next(): player is undefined")}else this.handlers.onError("予期せぬステータスです: GameManager.next(): "+this.state)}},{key:"onMove",value:function(e,t){if(e===this.lastEventID)if(this.state===Ai.ACTIVE){if(!this.record.position.isValidMove(t))return this.handlers.onError("反則手: "+t.getDisplayText()),void this.endGame(Xe.FOUL_LOSE);this.incrementTime(this.record.position.color),this.record=this.handlers.onMove(t);var n=this.record.perpetualCheck;if(n)return n===this.record.position.color?void this.endGame(Xe.FOUL_LOSE):void this.endGame(Xe.FOUL_WIN);this.record.repetition?this.endGame(Xe.REPETITION_DRAW):this.next()}else oi.log(jn.WARN,"指し手を受信しましたが既に対局中ではありません。");else oi.log(jn.WARN,"指し手を受信しましたが既にイベントは無効です。")}},{key:"onResign",value:function(e){e===this.lastEventID?this.state===Ai.ACTIVE?this.endGame(Xe.RESIGN):oi.log(jn.WARN,"投了を受信しましたが既に対局中ではありません。"):oi.log(jn.WARN,"投了を受信しましたが既にイベントは無効です。")}},{key:"onWin",value:function(e){e===this.lastEventID?this.state===Ai.ACTIVE?this.endGame(Xe.ENTERING_OF_KING):oi.log(jn.WARN,"勝ち宣言を受信しましたが既に対局中ではありません。"):oi.log(jn.WARN,"勝ち宣言を受信しましたが既にイベントは無効です。")}},{key:"onTimeout",value:function(){this.state===Ai.ACTIVE?this.endGame(Xe.TIMEOUT):this.handlers.onError("予期せぬステータスです: GameManager.onTimeout(): "+this.state)}},{key:"startTimer",value:function(e){var t=this;this.stopTimer();var n=this.getPlayerState(e);this.timerStart=new Date,this.lastTimeMs=n.timeMs,n.byoyomi=this.setting.timeLimit.byoyomi,this._elapsedMs=0,this.timerHandle=window.setInterval((function(){var i=n.timeMs,r=n.byoyomi,o=new Date;t._elapsedMs=o.getTime()-t.timerStart.getTime();var a=t.lastTimeMs-t._elapsedMs;if(a>=0?n.timeMs=a:(n.timeMs=0,n.byoyomi=Math.max(Math.ceil(t.setting.timeLimit.byoyomi+a/1e3),0)),0!==n.timeMs||0!==n.byoyomi){var s=Math.ceil(i/1e3),c=Math.ceil(n.timeMs/1e3),u=n.byoyomi;0===c&&(i>0||u!==r)?u<=5?t.handlers.onBeepUnlimited():(u<=10||u%10===0)&&t.handlers.onBeepShort():t.setting.timeLimit.byoyomi||c===s||(c<=5?t.handlers.onBeepUnlimited():(c<=10||20===c||30===c||60===c)&&t.handlers.onBeepShort())}else t.timeout(e)}),100)}},{key:"timeout",value:function(e){var t=this;this.stopTimer();var n=this.getPlayer(e);n&&n.isEngine()&&!this.setting.enableEngineTimeout?n.stop().catch((function(e){t.handlers.onError(new Error("プレイヤーにコマンドを送信できませんでした: "+e))})):this.onTimeout()}},{key:"endGame",value:function(e){var t=this;this.state!==Ai.ACTIVE&&this.state!==Ai.PENDING||(this.state=Ai.BUSSY,this.stopTimer(),this.endGameAsync(e).then((function(){t.state=Ai.IDLE})).catch((function(e){t.handlers.onError(e),t.state=Ai.PENDING})))}},{key:"endGameAsync",value:function(){var e=(0,i.Z)(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!t){e.next=4;break}return n=this.record.position.color,e.next=4,this.sendGameResults(n,t);case 4:return e.next=6,this.closePlayers();case 6:this.handlers.onEndGame(t);case 7:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"sendGameResults",value:function(){var e=(0,i.Z)(regeneratorRuntime.mark((function e(t,n){var i,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!this.blackPlayer){e.next=5;break}if(i=this.getGameResult(t,V.BLACK,n),!i){e.next=5;break}return e.next=5,this.blackPlayer.gameover(i);case 5:if(!this.whitePlayer){e.next=10;break}if(r=this.getGameResult(t,V.WHITE,n),!r){e.next=10;break}return e.next=10,this.whitePlayer.gameover(r);case 10:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"getGameResult",value:function(e,t,n){switch(n){case Xe.FOUL_WIN:case Xe.ENTERING_OF_KING:return e==t?mi.WIN:mi.LOSE;case Xe.RESIGN:case Xe.MATE:case Xe.TIMEOUT:case Xe.FOUL_LOSE:return e==t?mi.LOSE:mi.WIN;case Xe.DRAW:case Xe.REPETITION_DRAW:return mi.DRAW}return null}},{key:"stopTimer",value:function(){this.handlers.onStopBeep(),this.timerHandle&&(window.clearInterval(this.timerHandle),this.timerHandle=0)}},{key:"incrementTime",value:function(e){this.getPlayerState(e).timeMs+=1e3*this.setting.timeLimit.increment}},{key:"closePlayers",value:function(){var e=(0,i.Z)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!this.blackPlayer){e.next=4;break}return e.next=3,this.blackPlayer.close();case 3:this.blackPlayer=void 0;case 4:if(!this.whitePlayer){e.next=8;break}return e.next=7,this.whitePlayer.close();case 7:this.whitePlayer=void 0;case 8:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"getPlayer",value:function(e){switch(e){case V.BLACK:return this.blackPlayer;case V.WHITE:return this.whitePlayer}}},{key:"getPlayerState",value:function(e){switch(e){case V.BLACK:return this.blackState;case V.WHITE:return this.whiteState}}},{key:"issueEventID",value:function(){return this.lastEventID+=1,this.lastEventID}}]),e}();function Oi(e){var t=Ci(e),n=e.getStandardMetadata(Ve.TITLE)||e.getStandardMetadata(Ve.TOURNAMENT)||e.getStandardMetadata(Ve.OPUS_NAME)||e.getStandardMetadata(Ve.OPUS_NO)||e.getStandardMetadata(Ve.PLACE)||e.getStandardMetadata(Ve.POSTED_ON)||e.getStandardMetadata(Ve.AUTHOR);n&&(t+="_"+n);var i=e.getStandardMetadata(Ve.BLACK_NAME)||e.getStandardMetadata(Ve.BLACK_SHORT_NAME);i&&(t+="_"+i);var r=e.getStandardMetadata(Ve.WHITE_NAME)||e.getStandardMetadata(Ve.WHITE_SHORT_NAME);return r&&(t+="_"+r),t+".kif"}function Ci(e){var t=e.getStandardMetadata(Ve.DATE);return t?t.trim().replaceAll(" ","_").replaceAll("/","").replaceAll(":",""):(new Date).toLocaleDateString(void 0,{year:"numeric",month:"2-digit",day:"2-digit"}).replaceAll("/","")}var Hi,Mi=function(){function e(){(0,Y.Z)(this,e),(0,$.Z)(this,"count",void 0),this.count=0}return(0,J.Z)(e,[{key:"isBussy",get:function(){return 0!==this.count}},{key:"retain",value:function(){this.count+=1}},{key:"release",value:function(){this.count-=1}}]),e}();(function(e){e["NORMAL"]="normal",e["PASTE_DIALOG"]="pasteDialog",e["POSITION_EDITING"]="positionEditing",e["GAME"]="game",e["GAME_DIALOG"]="gameDialog",e["RESEARCH"]="research",e["RESEARCH_DIALOG"]="researchDialog",e["ANALYSIS"]="analysis",e["ANALYSIS_DIALOG"]="analysisDialog",e["USI_ENGINE_SETTING_DIALOG"]="usiEngineSettingDialog",e["TEMPORARY"]="temporary"})(Hi||(Hi={}));var Li=function(){function e(){(0,Y.Z)(this,e),(0,$.Z)(this,"_queue",void 0),this._queue=[]}return(0,J.Z)(e,[{key:"message",get:function(){return this._queue[0]}},{key:"hasMessage",get:function(){return 0!==this._queue.length}},{key:"enqueue",value:function(e){this._queue.push(e)}},{key:"dequeue",value:function(){this._queue.shift()}}]),e}(),Di=function(){function e(){(0,Y.Z)(this,e),(0,$.Z)(this,"_queue",void 0),this._queue=[]}return(0,J.Z)(e,[{key:"errors",get:function(){return this._queue}},{key:"hasError",get:function(){return 0!==this._queue.length}},{key:"push",value:function(e){e instanceof Error?this._queue.push(e):this._queue.push(new Error(""+e))}},{key:"clear",value:function(){this._queue=[]}}]),e}();function xi(e){return(e||new Date).toLocaleDateString(void 0,{year:"numeric",month:"2-digit",day:"2-digit"})}function Bi(e){return(e||new Date).toLocaleTimeString(void 0,{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1})}function Gi(e){return e>=1500?"先手勝勢":e>=600?"先手優勢":e>=400?"先手有利":e>=200?"先手有望":e>=-200?"互角":e>=-400?"後手有望":e>=-600?"後手有利":e>=-1500?"後手優勢":"後手勝勢"}function Zi(e,t){return 100/(1+Math.exp(-e/t.coefficientInSigmoid))}function Wi(e,t,n){var i=Zi(e,n)-Zi(t,n);return i>=n.badMoveLevelThreshold4?"大悪手":i>=n.badMoveLevelThreshold3?"悪手":i>=n.badMoveLevelThreshold2?"疑問手":i>=n.badMoveLevelThreshold1?"緩手":null}var Ui=function(){function e(t,n){if((0,Y.Z)(this,e),(0,$.Z)(this,"handler",void 0),(0,$.Z)(this,"researcher",void 0),(0,$.Z)(this,"_setting",void 0),(0,$.Z)(this,"number",void 0),(0,$.Z)(this,"actualMove",void 0),(0,$.Z)(this,"color",void 0),(0,$.Z)(this,"lastScore",void 0),(0,$.Z)(this,"score",void 0),(0,$.Z)(this,"mate",void 0),(0,$.Z)(this,"lastPV",void 0),(0,$.Z)(this,"pv",void 0),(0,$.Z)(this,"timerHandle",void 0),!t.usi)throw new Error("エンジンが設定されていません。");this._setting=t,this.handler=n,this.color=V.BLACK}return(0,J.Z)(e,[{key:"setting",get:function(){return this._setting}},{key:"start",value:function(){var e=(0,i.Z)(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.setupEngine(this.setting.usi);case 2:setTimeout((function(){return t.next()}));case 3:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"setupEngine",value:function(){var e=(0,i.Z)(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.closeEngine();case 2:return n=new bi(t),e.next=5,n.launch();case 5:this.researcher=n;case 6:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"finish",value:function(){this.handler.onFinish(),this.close()}},{key:"close",value:function(){var e=this;this.clearTimer(),this.closeEngine().catch((function(t){e.handler.onError(t)}))}},{key:"next",value:function(){var e=this;if(this.clearTimer(),this.onResult(),this.actualMove=void 0,this.lastScore=this.score,this.score=void 0,this.mate=void 0,this.lastPV=this.pv,this.pv=void 0,this.number=void 0!==this.number?this.number+1:this.setting.startCriteria.enableNumber?this.setting.startCriteria.number-1:0,this.setting.endCriteria.enableNumber&&this.number>=this.setting.endCriteria.number)this.finish();else{var t=this.handler.onNext(this.number);t&&(t.current.next||t.current.move instanceof He)?(this.actualMove=t.current.move instanceof He?t.current.move:void 0,this.color=Q(t.position.color),this.timerHandle=window.setTimeout((function(){return e.next()}),1e3*this.setting.perMoveCriteria.maxSeconds),this.goAsync(t).catch((function(t){e.handler.onError(t)}))):this.finish()}}},{key:"clearTimer",value:function(){this.timerHandle&&(clearTimeout(this.timerHandle),this.timerHandle=void 0)}},{key:"onResult",value:function(){void 0!==this.number&&this.handler.onResult({number:this.number,score:this.score,negaScore:this.score?this.color===V.BLACK?this.score:-this.score:void 0,scoreDelta:void 0!==this.score&&void 0!==this.lastScore?this.color===V.BLACK?this.score-this.lastScore:-(this.score-this.lastScore):void 0,mate:this.mate,pv:this.pv,isBestMove:this.actualMove&&this.lastPV?this.actualMove.equals(this.lastPV[0]):void 0})}},{key:"goAsync",value:function(){var e=(0,i.Z)(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!this.researcher){e.next=3;break}return e.next=3,this.researcher.startResearch(t);case 3:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"closeEngine",value:function(){var e=(0,i.Z)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:this.researcher&&(this.researcher.close(),this.researcher=void 0);case 1:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"updateUSIInfo",value:function(e,t){if(void 0===t.multipv||1===t.multipv)if(void 0!==t.scoreCP&&(this.score=e.color===V.BLACK?t.scoreCP:-t.scoreCP),t.scoreMate&&(this.mate=Math.abs(t.scoreMate)),t.pv&&0!==t.pv.length){this.pv=[];var n,i=e.clone(),r=(0,ot.Z)(t.pv);try{for(r.s();!(n=r.n()).done;){var o=n.value,a=i.createMoveBySFEN(o);if(!a||!i.doMove(a))break;this.pv.push(a)}}catch(c){r.e(c)}finally{r.f()}}else if(t.currmove){var s=e.createMoveBySFEN(t.currmove);s&&(this.pv=[s])}}}]),e}();function Ki(e,t){var n="";if(e.mate&&(n+="".concat(e.mate,"手詰\n")),void 0!==e.scoreDelta&&void 0!==e.negaScore&&!e.isBestMove){var i=Wi(e.negaScore-e.scoreDelta,e.negaScore,t);i&&(n+="【".concat(i,"】\n"))}if(void 0!==e.score&&(n+="#評価値=".concat(e.score,"\n"),n+=Gi(e.score)+"\n"),e.pv&&0!==e.pv.length){var r,o=(0,ot.Z)(e.pv);try{for(o.s();!(r=o.n()).done;){var a=r.value;n+="".concat(a.getDisplayText())}}catch(s){o.e(s)}finally{o.f()}n+="\n"}return n}function Fi(e){var t,n=e.split("\n"),i=(0,ot.Z)(n);try{for(i.s();!(t=i.n()).done;){var r=t.value,o=/^#評価値=([+-.0-9]+)/.exec(r);if(o)return Number(o[1])}}catch(a){i.e(a)}finally{i.f()}}function qi(e,t,n){var i=e?"\n":"";switch(n){case Un.NONE:return e;case Un.INSERT:return t+i+e;case Un.APPEND:return e+i+t;case Un.OVERWRITE:return t}}var ji=function(){function e(){(0,Y.Z)(this,e),(0,$.Z)(this,"_bussy",void 0),(0,$.Z)(this,"_message",void 0),(0,$.Z)(this,"_error",void 0),(0,$.Z)(this,"_appSetting",void 0),(0,$.Z)(this,"_appState",void 0),(0,$.Z)(this,"lastAppState",void 0),(0,$.Z)(this,"_isAppSettingDialogVisible",void 0),(0,$.Z)(this,"_confirmation",void 0),(0,$.Z)(this,"_usi",void 0),(0,$.Z)(this,"game",void 0),(0,$.Z)(this,"researcher",void 0),(0,$.Z)(this,"analysis",void 0),(0,$.Z)(this,"unlimitedBeepHandler",void 0),(0,$.Z)(this,"_recordFilePath",void 0),(0,$.Z)(this,"_record",void 0),this._bussy=new Mi,this._message=new Li,this._error=new Di,this._appSetting=Jn(),this._appState=Hi.NORMAL,this._isAppSettingDialogVisible=!1,this._usi=new yi,this.game=new Pi(Ni,this),this._record=new rt}return(0,J.Z)(e,[{key:"isBussy",get:function(){return this._bussy.isBussy}},{key:"retainBussyState",value:function(){return this._bussy.retain()}},{key:"releaseBussyState",value:function(){return this._bussy.release()}},{key:"message",get:function(){return this._message.message}},{key:"hasMessage",get:function(){return this._message.hasMessage}},{key:"enqueueMessage",value:function(e){this._message.enqueue(e)}},{key:"dequeueMessage",value:function(){this._message.dequeue()}},{key:"errors",get:function(){return this._error.errors}},{key:"hasError",get:function(){return this._error.hasError}},{key:"pushError",value:function(e){oi.log(jn.ERROR,st(e)),this._error.push(e)}},{key:"clearErrors",value:function(){this._error.clear()}},{key:"appSetting",get:function(){return this._appSetting}},{key:"updateAppSetting",value:function(){var e=(0,i.Z)(regeneratorRuntime.mark((function e(t){var n,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=(0,un.Z)((0,un.Z)({},this.appSetting),t),i=$n(n),!i){e.next=4;break}throw i;case 4:return e.next=6,oi.saveAppSetting(n);case 6:this._appSetting=n;case 7:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"flipBoard",value:function(){this._appSetting.boardFlipping=!this.appSetting.boardFlipping,oi.saveAppSetting(this.appSetting)}},{key:"appState",get:function(){return this._appState}},{key:"confirmation",get:function(){var e;return null===(e=this._confirmation)||void 0===e?void 0:e.message}},{key:"showConfirmation",value:function(e){this.appState!=Hi.TEMPORARY?(this._confirmation=e,this.lastAppState=this.appState,this._appState=Hi.TEMPORARY):oi.log(jn.ERROR,"確認ダイアログを多重に表示しようとしました。"+" lastAppState=".concat(this.lastAppState)+(this._confirmation?" currentMessage=".concat(this._confirmation.message):"")+" newMessage=".concat(e.message))}},{key:"confirmationOk",value:function(){var e,t=null===(e=this._confirmation)||void 0===e?void 0:e.onOk;this._confirmation=void 0,this.lastAppState&&(this._appState=this.lastAppState,this.lastAppState=void 0),t&&t()}},{key:"confirmationCancel",value:function(){var e,t=null===(e=this._confirmation)||void 0===e?void 0:e.onCancel;this._confirmation=void 0,this.lastAppState&&(this._appState=this.lastAppState,this.lastAppState=void 0),t&&t()}},{key:"showPasteDialog",value:function(){this.appState===Hi.NORMAL&&(this._appState=Hi.PASTE_DIALOG)}},{key:"showGameDialog",value:function(){this.appState===Hi.NORMAL&&(this._appState=Hi.GAME_DIALOG)}},{key:"showResearchDialog",value:function(){this.appState===Hi.NORMAL&&(this._appState=Hi.RESEARCH_DIALOG)}},{key:"showAnalysisDialog",value:function(){this.appState===Hi.NORMAL&&(this._appState=Hi.ANALYSIS_DIALOG)}},{key:"showUsiEngineManagementDialog",value:function(){this.appState===Hi.NORMAL&&(this._appState=Hi.USI_ENGINE_SETTING_DIALOG)}},{key:"closeModalDialog",value:function(){this.appState!==Hi.PASTE_DIALOG&&this.appState!==Hi.GAME_DIALOG&&this.appState!==Hi.RESEARCH_DIALOG&&this.appState!==Hi.ANALYSIS_DIALOG&&this.appState!==Hi.USI_ENGINE_SETTING_DIALOG||(this._appState=Hi.NORMAL)}},{key:"isAppSettingDialogVisible",get:function(){return this._isAppSettingDialogVisible}},{key:"showAppSettingDialog",value:function(){this._isAppSettingDialogVisible=!0}},{key:"closeAppSettingDialog",value:function(){this._isAppSettingDialogVisible=!1}},{key:"usiBlackPlayerMonitor",get:function(){return this._usi.blackPlayer}},{key:"usiWhitePlayerMonitor",get:function(){return this._usi.whitePlayer}},{key:"usiResearcherMonitor",get:function(){return this._usi.researcher}},{key:"updateUSIInfo",value:function(e,t,n,i,r){if(this.record.usi===t){this._usi.update(e,this.record.position,n,i,r);var o=new wi(this.record.current.customData);o.updateUSIInfo(this.record.position.color,n,r),this.record.current.customData=o.stringify(),this.analysis&&this.analysis.updateUSIInfo(this.record.position,r)}}},{key:"updateUSIPonderInfo",value:function(e,t,n,i,r){var o=rt.newByUSI(t);if(o instanceof Error)oi.log(jn.ERROR,"invalid USI: ".concat(t," (updateUSIPonderInfo)"));else{var a=o.current.move;a instanceof He&&this._usi.update(e,o.position,n,i,r,a)}}},{key:"gameSetting",get:function(){return this.game.setting}},{key:"blackTimeMs",get:function(){return this.game.blackTimeMs}},{key:"blackByoyomi",get:function(){return this.game.blackByoyomi}},{key:"whiteTimeMs",get:function(){return this.game.whiteTimeMs}},{key:"whiteByoyomi",get:function(){return this.game.whiteByoyomi}},{key:"elapsedMs",get:function(){return this.game.elapsedMs}},{key:"startGame",value:function(e){var t=this;this.startGameAsync(e).catch((function(e){t.pushError("対局の初期化中にエラーが出ました: "+e)}))}},{key:"startGameAsync",value:function(){var e=(0,i.Z)(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.appState===Hi.GAME_DIALOG){e.next=2;break}return e.abrupt("return");case 2:return this.retainBussyState(),e.prev=3,e.next=6,oi.saveGameSetting(t);case 6:return this.initializeRecordForGame(t),this.initializeDisplaySettingForGame(t),e.next=10,this.game.startGame(t,this.record);case 10:this._appState=Hi.GAME;case 11:return e.prev=11,this.releaseBussyState(),e.finish(11);case 14:case"end":return e.stop()}}),e,this,[[3,,11,14]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"initializeRecordForGame",value:function(e){if(e.startPosition){var t=new Fe;t.reset(e.startPosition),this._record.clear(t),this.onUpdatePosition(),this.clearRecordFilePath()}this._record.metadata.setStandardMetadata(Ve.BLACK_NAME,e.black.name),this._record.metadata.setStandardMetadata(Ve.WHITE_NAME,e.white.name),this._record.metadata.setStandardMetadata(Ve.DATE,xi()),this._record.metadata.setStandardMetadata(Ve.START_DATETIME,Bi()),this._record.metadata.setStandardMetadata(Ve.TIME_LIMIT,Ei(e.timeLimit))}},{key:"initializeDisplaySettingForGame",value:function(e){if(e.humanIsFront){var t=this.appSetting.boardFlipping;e.black.uri===Pn&&e.white.uri!==Pn?t=!1:e.black.uri!==Pn&&e.white.uri===Pn&&(t=!0),t!==this.appSetting.boardFlipping&&this.flipBoard()}}},{key:"stopGame",value:function(){this.appState===Hi.GAME&&this.game.endGame(Xe.INTERRUPT)}},{key:"onMove",value:function(e){return this.appState===Hi.GAME&&(this._record.append(e,{ignoreValidation:!0}),this.onUpdatePosition(),this.record.current.setElapsedMs(this.elapsedMs),pi(this.appSetting.pieceVolume)),this.record}},{key:"onEndGame",value:function(e){this.appState===Hi.GAME&&(e&&this.enqueueMessage("対局終了（".concat(nt(e),")")),this._record.append(e||Xe.INTERRUPT),this.onUpdatePosition(),this._record.current.setElapsedMs(this.elapsedMs),this._record.metadata.setStandardMetadata(Ve.END_DATETIME,Bi()),this._appState=Hi.NORMAL)}},{key:"onBeepShort",value:function(){(this.appSetting.clockSoundTarget!==qn.ONLY_USER||this.isMovableByUser)&&(this.unlimitedBeepHandler||hi({frequency:this.appSetting.clockPitch,volume:this.appSetting.clockVolume}))}},{key:"onBeepUnlimited",value:function(){(this.appSetting.clockSoundTarget!==qn.ONLY_USER||this.isMovableByUser)&&(this.unlimitedBeepHandler||(this.unlimitedBeepHandler=di({frequency:this.appSetting.clockPitch,volume:this.appSetting.clockVolume})))}},{key:"onStopBeep",value:function(){this.unlimitedBeepHandler&&(this.unlimitedBeepHandler.stop(),this.unlimitedBeepHandler=void 0)}},{key:"doMove",value:function(e){this.appState!==Hi.NORMAL&&this.appState!==Hi.RESEARCH||(this._record.append(e),this.onUpdatePosition(),pi(this.appSetting.pieceVolume))}},{key:"onNext",value:function(e){return this.appState===Hi.ANALYSIS?(this._record.goto(e),this.record.current.number===e?this.record:null):null}},{key:"onResult",value:function(e){if(this.appState===Hi.ANALYSIS&&this.analysis){var t=Ki(e,this.appSetting);t&&(this._record.current.comment=qi(this._record.current.comment,t,this.analysis.setting.commentBehavior))}}},{key:"onFinish",value:function(){this.appState===Hi.ANALYSIS&&(this._message.enqueue("棋譜解析が終了しました。"),this._appState=Hi.NORMAL)}},{key:"onError",value:function(e){this.pushError(e)}},{key:"startResearch",value:function(e){var t=this;this.startResearchAsync(e).then((function(){t.onUpdatePosition()})).catch((function(e){t.pushError("検討の初期化中にエラーが出ました: "+e)}))}},{key:"startResearchAsync",value:function(){var e=(0,i.Z)(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.appState===Hi.RESEARCH_DIALOG){e.next=2;break}return e.abrupt("return");case 2:return this.retainBussyState(),e.prev=3,e.next=6,oi.saveResearchSetting(t);case 6:if(t.usi){e.next=8;break}throw new Error("エンジンが設定されていません。");case 8:return n=new bi(t.usi),e.next=11,n.launch();case 11:this.researcher=n,this._appState=Hi.RESEARCH;case 13:return e.prev=13,this.releaseBussyState(),e.finish(13);case 16:case"end":return e.stop()}}),e,this,[[3,,13,16]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"stopResearch",value:function(){this.appState===Hi.RESEARCH&&(this.researcher&&(this.researcher.close(),this.researcher=void 0),this._appState=Hi.NORMAL)}},{key:"startAnalysis",value:function(e){var t=this;this.startAnalysisAsync(e).catch((function(e){t.pushError("検討の初期化中にエラーが出ました: "+e)}))}},{key:"startAnalysisAsync",value:function(){var e=(0,i.Z)(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.appState===Hi.ANALYSIS_DIALOG){e.next=2;break}return e.abrupt("return");case 2:return this.retainBussyState(),e.prev=3,e.next=6,oi.saveAnalysisSetting(t);case 6:return n=new Ui(t,this),e.next=9,n.start();case 9:this.analysis=n,this._appState=Hi.ANALYSIS;case 11:return e.prev=11,this.releaseBussyState(),e.finish(11);case 14:case"end":return e.stop()}}),e,this,[[3,,11,14]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"stopAnalysis",value:function(){this.appState===Hi.ANALYSIS&&(this.analysis&&(this.analysis.close(),this.analysis=void 0),this._appState=Hi.NORMAL)}},{key:"onUpdatePosition",value:function(){this.researcher&&this.researcher.startResearch(this.record)}},{key:"recordFilePath",get:function(){return this._recordFilePath}},{key:"updateRecordFilePath",value:function(e){this._recordFilePath=e}},{key:"clearRecordFilePath",value:function(){this._recordFilePath=void 0}},{key:"record",get:function(){return this._record}},{key:"newRecord",value:function(){var e=this;this.appState==Hi.NORMAL&&this.showConfirmation({message:"現在の棋譜は削除されます。よろしいですか？",onOk:function(){e._record.clear(),e.onUpdatePosition(),e.clearRecordFilePath()}})}},{key:"updateRecordComment",value:function(e){this.record.current.comment=e}},{key:"updateStandardRecordMetadata",value:function(e){this._record.metadata.setStandardMetadata(e.key,e.value)}},{key:"insertSpecialMove",value:function(e){this.appState!==Hi.NORMAL&&this.appState!==Hi.RESEARCH||(this._record.append(e),this.onUpdatePosition())}},{key:"startPositionEditing",value:function(){var e=this;this.appState===Hi.NORMAL&&this.showConfirmation({message:"現在の棋譜は削除されます。よろしいですか？",onOk:function(){e._appState=Hi.POSITION_EDITING,e._record.clear(e.record.position),e.onUpdatePosition(),e.clearRecordFilePath()}})}},{key:"endPositionEditing",value:function(){this.appState===Hi.POSITION_EDITING&&(this._appState=Hi.NORMAL)}},{key:"initializePosition",value:function(e){var t=this;this.appState==Hi.POSITION_EDITING&&this.showConfirmation({message:"現在の局面は破棄されます。よろしいですか？",onOk:function(){var n=new Fe;n.reset(e),t._record.clear(n),t.onUpdatePosition(),t.clearRecordFilePath()}})}},{key:"changeTurn",value:function(){if(this.appState==Hi.POSITION_EDITING){var e=this.record.position.clone();e.setColor(Q(e.color)),this._record.clear(e),this.onUpdatePosition(),this.clearRecordFilePath()}}},{key:"editPosition",value:function(e){if(this.appState===Hi.POSITION_EDITING){var t=this.record.position.clone();t.edit(e),this._record.clear(t),this.onUpdatePosition(),this.clearRecordFilePath()}}},{key:"changeMoveNumber",value:function(e){this.appState!==Hi.NORMAL&&this.appState!==Hi.RESEARCH||(this._record.goto(e),this.onUpdatePosition())}},{key:"changeBranch",value:function(e){this.appState!==Hi.NORMAL&&this.appState!==Hi.RESEARCH||this.record.current.branchIndex!==e&&(this._record.switchBranchByIndex(e),this.onUpdatePosition())}},{key:"removeRecordAfter",value:function(){var e=this;if(this.appState===Hi.NORMAL||this.appState===Hi.RESEARCH)return this.record.current.isLastMove?(this._record.removeAfter(),void this.onUpdatePosition()):void this.showConfirmation({message:"".concat(this.record.current.number,"手目以降を削除します。よろしいですか？"),onOk:function(){e._record.removeAfter(),e.onUpdatePosition()}})}},{key:"copyRecordKIF",value:function(){var e=Bt(this._record,{returnCode:this.appSetting.returnCode});navigator.clipboard.writeText(e)}},{key:"copyRecordCSA",value:function(){var e=sn(this._record,{returnCode:this.appSetting.returnCode});navigator.clipboard.writeText(e)}},{key:"copyRecordUSIBefore",value:function(){var e=this._record.usi;navigator.clipboard.writeText(e)}},{key:"copyRecordUSIAll",value:function(){var e=this._record.usiAll;navigator.clipboard.writeText(e)}},{key:"copyBoardSFEN",value:function(){var e=this._record.sfen;navigator.clipboard.writeText(e)}},{key:"pasteRecord",value:function(e){if(this.appState===Hi.NORMAL){var t;switch(cn(e)){case Xt.SFEN:var n=Fe.newBySFEN(e);t=n?new rt(n):new Error("局面を読み込めませんでした。");break;case Xt.USI:t=rt.newByUSI(e)||new Error("棋譜を読み込めませんでした。");break;case Xt.KIF:t=Rt(e);break;case Xt.CSA:t=$t(e);break;default:t=new Error("棋譜フォーマットの検出ができませんでした。");break}t instanceof Error?this.pushError(t):(this.clearRecordFilePath(),this._record=t,this.restoreCustomData(),this.onUpdatePosition())}}},{key:"openRecord",value:function(e){var t=this;this.openRecordAsync(e).catch((function(e){t.pushError("棋譜の読み込み中にエラーが出ました: "+e)}))}},{key:"openRecordAsync",value:function(){var e=(0,i.Z)(regeneratorRuntime.mark((function e(t){var n,i,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.appState===Hi.NORMAL){e.next=2;break}return e.abrupt("return");case 2:if(this.retainBussyState(),e.prev=3,t){e.next=10;break}return e.next=7,oi.showOpenRecordDialog();case 7:if(t=e.sent,t){e.next=10;break}return e.abrupt("return");case 10:return e.next=12,oi.openRecord(t);case 12:if(n=e.sent,t.match(/\.kif$/)||t.match(/\.kifu$/)?(r=t.match(/\.kif$/)?ui().decode(n,"Shift_JIS"):(new TextDecoder).decode(n),i=Rt(r)):i=t.match(/\.csa$/)?$t((new TextDecoder).decode(n)):new Error("不明なファイル形式: "+t),!(i instanceof Error)){e.next=16;break}throw i;case 16:this.updateRecordFilePath(t),this._record=i,this.restoreCustomData(),this.onUpdatePosition();case 20:return e.prev=20,this.releaseBussyState(),e.finish(20);case 23:case"end":return e.stop()}}),e,this,[[3,,20,23]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"restoreCustomData",value:function(){this._record.forEach((function(e){var t=Fi(e.comment);if(void 0!==t){var n=new wi(e.customData);n.updateScore(V.BLACK,vi.RESEARCHER,t),e.customData=n.stringify()}}))}},{key:"saveRecord",value:function(e){var t=this;this.saveRecordAsync(e).catch((function(e){t.pushError("棋譜の保存中にエラーが出ました: "+e)}))}},{key:"saveRecordAsync",value:function(){var e=(0,i.Z)(regeneratorRuntime.mark((function e(t){var n,i,r,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.appState===Hi.NORMAL){e.next=2;break}return e.abrupt("return");case 2:if(this.retainBussyState(),e.prev=3,n=this.recordFilePath,null!==t&&void 0!==t&&t.overwrite&&n){e.next=12;break}return i=Oi(this._record.metadata),e.next=9,oi.showSaveRecordDialog(i);case 9:if(n=e.sent,n){e.next=12;break}return e.abrupt("return");case 12:if(!n.match(/\.kif$/)&&!n.match(/\.kifu$/)){e.next=17;break}o=Bt(this.record,{returnCode:this.appSetting.returnCode}),r=n.match(/\.kif$/)?ui().encode(o,"Shift_JIS"):(new TextEncoder).encode(o),e.next=22;break;case 17:if(!n.match(/\.csa$/)){e.next=21;break}r=(new TextEncoder).encode(sn(this.record,{returnCode:this.appSetting.returnCode})),e.next=22;break;case 21:throw new Error("不明なファイル形式: "+n);case 22:return e.next=24,oi.saveRecord(n,r);case 24:this.updateRecordFilePath(n);case 25:return e.prev=25,this.releaseBussyState(),e.finish(25);case 28:case"end":return e.stop()}}),e,this,[[3,,25,28]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"isMovableByUser",get:function(){switch(this.appState){case Hi.NORMAL:case Hi.RESEARCH:return!0;case Hi.GAME:return(this.record.position.color===V.BLACK?this.gameSetting.black.uri:this.gameSetting.white.uri)===Pn}return!1}}]),e}(),Vi=(0,d.qj)(new ji);function zi(){return Vi}var Yi,Ji,$i=["src"];function Qi(e,t,n,i,r,o){return(0,a.wg)(),(0,a.iD)("img",{class:"icon",src:e.source,draggable:"false"},null,8,$i)}(function(e){e["BUSSY"]="bussy",e["ERROR"]="error",e["INFO"]="info",e["GAME"]="game",e["STOP"]="stop",e["RESIGN"]="resign",e["RESEARCH"]="research",e["END"]="end",e["QUIZ"]="quiz",e["EDIT"]="edit",e["CHECK"]="check",e["SWAP"]="swap",e["SWAP_H"]="swap_h",e["SETTINGS"]="settings",e["ENGINE_SETTINGS"]="engineSettings",e["FLIP"]="flip",e["FILE"]="file",e["OPEN"]="open",e["SAVE"]="save",e["SAVE_AS"]="saveAs",e["PASTE"]="paste",e["COPY"]="copy",e["DELETE"]="delete",e["COMMENT"]="comment",e["BRAIN"]="brain",e["PV"]="pv",e["CHART"]="chart",e["PERCENT"]="percent",e["ARROW_DROP"]="arrowDrop",e["FIRST"]="first",e["BACK"]="back",e["NEXT"]="next",e["LAST"]="last",e["QUESTION"]="question",e["ANALYSIS"]="analysis",e["DESCRIPTION"]="description",e["PLAY"]="play",e["CLOSE"]="close"})(Ji||(Ji={}));var Xi=(Yi={},(0,$.Z)(Yi,Ji.BUSSY,"icon/hourglass_empty_white_24dp.svg"),(0,$.Z)(Yi,Ji.ERROR,"icon/error_outline_white_24dp.svg"),(0,$.Z)(Yi,Ji.INFO,"icon/info_white_24dp.svg"),(0,$.Z)(Yi,Ji.GAME,"icon/sports_esports_white_24dp.svg"),(0,$.Z)(Yi,Ji.STOP,"icon/block_white_24dp.svg"),(0,$.Z)(Yi,Ji.RESIGN,"icon/flag_white_24dp.svg"),(0,$.Z)(Yi,Ji.RESEARCH,"icon/science_white_24dp.svg"),(0,$.Z)(Yi,Ji.END,"icon/do_disturb_on_white_24dp.svg"),(0,$.Z)(Yi,Ji.QUIZ,"icon/quiz_FILL0_wght400_GRAD0_opsz48.svg"),(0,$.Z)(Yi,Ji.EDIT,"icon/app_registration_white_24dp.svg"),(0,$.Z)(Yi,Ji.CHECK,"icon/check_circle_white_24dp.svg"),(0,$.Z)(Yi,Ji.SWAP,"icon/swap_vert_white_24dp.svg"),(0,$.Z)(Yi,Ji.SWAP_H,"icon/swap_horiz_white_24dp.svg"),(0,$.Z)(Yi,Ji.SETTINGS,"icon/settings_white_24dp.svg"),(0,$.Z)(Yi,Ji.ENGINE_SETTINGS,"icon/settings_input_component_white_24dp.svg"),(0,$.Z)(Yi,Ji.FLIP,"icon/flip_camera_android_white_24dp.svg"),(0,$.Z)(Yi,Ji.FILE,"icon/draft_FILL0_wght400_GRAD0_opsz48.svg"),(0,$.Z)(Yi,Ji.OPEN,"icon/file_open_FILL0_wght400_GRAD0_opsz48.svg"),(0,$.Z)(Yi,Ji.SAVE,"icon/save_FILL0_wght400_GRAD0_opsz48.svg"),(0,$.Z)(Yi,Ji.SAVE_AS,"icon/save_as_FILL0_wght400_GRAD0_opsz48.svg"),(0,$.Z)(Yi,Ji.PASTE,"icon/content_paste_white_24dp.svg"),(0,$.Z)(Yi,Ji.COPY,"icon/content_copy_white_24dp.svg"),(0,$.Z)(Yi,Ji.DELETE,"icon/backspace_white_24dp.svg"),(0,$.Z)(Yi,Ji.COMMENT,"icon/edit_note_white_24dp.svg"),(0,$.Z)(Yi,Ji.BRAIN,"icon/psychology_white_24dp.svg"),(0,$.Z)(Yi,Ji.PV,"icon/manage_search_FILL0_wght400_GRAD0_opsz48.svg"),(0,$.Z)(Yi,Ji.CHART,"icon/show_chart_white_24dp.svg"),(0,$.Z)(Yi,Ji.PERCENT,"icon/percent_white_24dp.svg"),(0,$.Z)(Yi,Ji.ARROW_DROP,"icon/arrow_drop_down_white_24dp.svg"),(0,$.Z)(Yi,Ji.FIRST,"icon/first_page_white_24dp.svg"),(0,$.Z)(Yi,Ji.BACK,"icon/chevron_left_white_24dp.svg"),(0,$.Z)(Yi,Ji.NEXT,"icon/chevron_right_white_24dp.svg"),(0,$.Z)(Yi,Ji.LAST,"icon/last_page_white_24dp.svg"),(0,$.Z)(Yi,Ji.QUESTION,"icon/help_white_24dp.svg"),(0,$.Z)(Yi,Ji.ANALYSIS,"icon/query_stats_white_24dp.svg"),(0,$.Z)(Yi,Ji.DESCRIPTION,"icon/description_white_24dp.svg"),(0,$.Z)(Yi,Ji.PLAY,"icon/play_arrow_FILL1_wght400_GRAD0_opsz48.svg"),(0,$.Z)(Yi,Ji.CLOSE,"icon/close_FILL0_wght400_GRAD0_opsz48.svg"),Yi);Object.values(Xi).forEach((function(e){hn(e)}));var er=(0,a.aZ)({name:"ButtonIcon",props:{icon:{type:String,required:!0}},setup:function(e){return{source:Xi[e.icon]}}});const tr=(0,Rn.Z)(er,[["render",Qi]]);var nr=tr,ir=function(e){return(0,a.dD)("data-v-15a0289b"),e=e(),(0,a.Cn)(),e},rr={ref:"dialog",class:"background"},or={class:"groups"},ar={class:"group"},sr=ir((function(){return(0,a._)("div",{class:"label"},"戻る",-1)})),cr={class:"group"},ur=["disabled"],lr=ir((function(){return(0,a._)("div",{class:"label"},"初期化",-1)})),hr=["disabled"],dr=ir((function(){return(0,a._)("div",{class:"label"},"開く",-1)})),pr=["disabled"],vr=ir((function(){return(0,a._)("div",{class:"label"},"上書き保存",-1)})),fr=["disabled"],gr=ir((function(){return(0,a._)("div",{class:"label"},"保存",-1)})),mr={class:"group"},_r=ir((function(){return(0,a._)("div",{class:"label"},"コピー・KIF",-1)})),yr=ir((function(){return(0,a._)("div",{class:"label"},"コピー・CSA",-1)})),Sr=ir((function(){return(0,a._)("div",{class:"label"},"コピー・USI",-1)})),wr=ir((function(){return(0,a._)("div",{class:"label"},"コピー・SFEN",-1)})),Er=["disabled"],kr=ir((function(){return(0,a._)("div",{class:"label"},"貼り付け",-1)}));function Ir(e,t,n,i,r,o){var s=(0,a.up)("ButtonIcon");return(0,a.wg)(),(0,a.iD)("div",null,[(0,a._)("dialog",rr,[(0,a._)("div",or,[(0,a._)("div",ar,[(0,a._)("button",{class:"button",onClick:t[0]||(t[0]=function(){return e.onClose&&e.onClose.apply(e,arguments)})},[(0,a.Wm)(s,{class:"icon",icon:e.Icon.CLOSE},null,8,["icon"]),sr])]),(0,a._)("div",cr,[(0,a._)("button",{class:"button",disabled:!e.states.newFile,onClick:t[1]||(t[1]=function(){return e.onNewFile&&e.onNewFile.apply(e,arguments)})},[(0,a.Wm)(s,{class:"icon",icon:e.Icon.FILE},null,8,["icon"]),lr],8,ur),(0,a._)("button",{class:"button",disabled:!e.states.open,onClick:t[2]||(t[2]=function(){return e.onOpen&&e.onOpen.apply(e,arguments)})},[(0,a.Wm)(s,{class:"icon",icon:e.Icon.OPEN},null,8,["icon"]),dr],8,hr),(0,a._)("button",{class:"button",disabled:!e.states.saveAs,onClick:t[3]||(t[3]=function(){return e.onSave&&e.onSave.apply(e,arguments)})},[(0,a.Wm)(s,{class:"icon",icon:e.Icon.SAVE},null,8,["icon"]),vr],8,pr),(0,a._)("button",{class:"button",disabled:!e.states.save,onClick:t[4]||(t[4]=function(){return e.onSaveAs&&e.onSaveAs.apply(e,arguments)})},[(0,a.Wm)(s,{class:"icon",icon:e.Icon.SAVE_AS},null,8,["icon"]),gr],8,fr)]),(0,a._)("div",mr,[(0,a._)("button",{class:"button",onClick:t[5]||(t[5]=function(){return e.onCopyKIF&&e.onCopyKIF.apply(e,arguments)})},[(0,a.Wm)(s,{class:"icon",icon:e.Icon.COPY},null,8,["icon"]),_r]),(0,a._)("button",{class:"button",onClick:t[6]||(t[6]=function(){return e.onCopyCSA&&e.onCopyCSA.apply(e,arguments)})},[(0,a.Wm)(s,{class:"icon",icon:e.Icon.COPY},null,8,["icon"]),yr]),(0,a._)("button",{class:"button",onClick:t[7]||(t[7]=function(){return e.onCopyUSI&&e.onCopyUSI.apply(e,arguments)})},[(0,a.Wm)(s,{class:"icon",icon:e.Icon.COPY},null,8,["icon"]),Sr]),(0,a._)("button",{class:"button",onClick:t[8]||(t[8]=function(){return e.onCopySFEN&&e.onCopySFEN.apply(e,arguments)})},[(0,a.Wm)(s,{class:"icon",icon:e.Icon.COPY},null,8,["icon"]),wr]),(0,a._)("button",{class:"button",disabled:!e.states.paste,onClick:t[9]||(t[9]=function(){return e.onPaste&&e.onPaste.apply(e,arguments)})},[(0,a.Wm)(s,{class:"icon",icon:e.Icon.PASTE},null,8,["icon"]),kr],8,Er)])])],512)])}function br(e){e.addEventListener("cancel",(function(e){e.preventDefault(),e.stopPropagation()})),e.addEventListener("copy",(function(e){e.stopPropagation()})),e.addEventListener("paste",(function(e){e.stopPropagation()})),e.showModal()}function Tr(e){return document.getElementById(e)}var Rr=(0,a.aZ)({name:"FileMenu",components:{ButtonIcon:nr},emits:["close"],setup:function(e,t){var n=zi(),i=(0,d.iH)(null);(0,a.bv)((function(){br(i.value)}));var r=function(){t.emit("close")},o=function(){n.newRecord(),t.emit("close")},s=function(){n.openRecord(),t.emit("close")},c=function(){n.saveRecord({overwrite:!0}),t.emit("close")},u=function(){n.saveRecord(),t.emit("close")},l=function(){n.copyRecordKIF(),t.emit("close")},h=function(){n.copyRecordCSA(),t.emit("close")},p=function(){n.copyRecordUSIAll(),t.emit("close")},v=function(){n.copyBoardSFEN(),t.emit("close")},f=function(){n.showPasteDialog(),t.emit("close")},g=(0,a.Fl)((function(){return{newFile:n.appState===Hi.NORMAL,open:n.appState===Hi.NORMAL,save:n.appState===Hi.NORMAL,saveAs:n.appState===Hi.NORMAL,paste:n.appState===Hi.NORMAL}}));return{dialog:i,Icon:Ji,onClose:r,onNewFile:o,onOpen:s,onSave:c,onSaveAs:u,onCopyKIF:l,onCopyCSA:h,onCopyUSI:p,onCopySFEN:v,onPaste:f,states:g}}});const Ar=(0,Rn.Z)(Rr,[["render",Ir],["__scopeId","data-v-15a0289b"]]);var Nr=Ar,Pr=function(e){return(0,a.dD)("data-v-d7f89dd8"),e=e(),(0,a.Cn)(),e},Or={ref:"dialog",class:"background"},Cr={class:"groups"},Hr={class:"group"},Mr=Pr((function(){return(0,a._)("div",{class:"label"},"戻る",-1)})),Lr={class:"group"},Dr=Pr((function(){return(0,a._)("div",{class:"label"},"平手",-1)})),xr=Pr((function(){return(0,a._)("div",{class:"label"},"香落ち",-1)})),Br=Pr((function(){return(0,a._)("div",{class:"label"},"右香落ち",-1)})),Gr=Pr((function(){return(0,a._)("div",{class:"label"},"角落ち",-1)})),Zr=Pr((function(){return(0,a._)("div",{class:"label"},"飛車落ち",-1)})),Wr=Pr((function(){return(0,a._)("div",{class:"label"},"飛車香落ち",-1)})),Ur=Pr((function(){return(0,a._)("div",{class:"label"},"2枚落ち",-1)})),Kr=Pr((function(){return(0,a._)("div",{class:"label"},"4枚落ち",-1)})),Fr=Pr((function(){return(0,a._)("div",{class:"label"},"6枚落ち",-1)})),qr=Pr((function(){return(0,a._)("div",{class:"label"},"8枚落ち",-1)})),jr=Pr((function(){return(0,a._)("div",{class:"label"},"詰め将棋",-1)})),Vr=Pr((function(){return(0,a._)("div",{class:"label"},"双玉詰め将棋",-1)}));function zr(e,t,n,i,r,o){var s=(0,a.up)("ButtonIcon");return(0,a.wg)(),(0,a.iD)("div",null,[(0,a._)("dialog",Or,[(0,a._)("div",Cr,[(0,a._)("div",Hr,[(0,a._)("button",{class:"button",onClick:t[0]||(t[0]=function(){return e.onClose&&e.onClose.apply(e,arguments)})},[(0,a.Wm)(s,{class:"icon",icon:e.Icon.CLOSE},null,8,["icon"]),Mr])]),(0,a._)("div",Lr,[(0,a._)("button",{class:"button",onClick:t[1]||(t[1]=function(){return e.onStandard&&e.onStandard.apply(e,arguments)})},[(0,a.Wm)(s,{class:"icon",icon:e.Icon.GAME},null,8,["icon"]),Dr]),(0,a._)("button",{class:"button",onClick:t[2]||(t[2]=function(){return e.onHandicapLance&&e.onHandicapLance.apply(e,arguments)})},[(0,a.Wm)(s,{class:"icon",icon:e.Icon.GAME},null,8,["icon"]),xr]),(0,a._)("button",{class:"button",onClick:t[3]||(t[3]=function(){return e.onHandicapRightLance&&e.onHandicapRightLance.apply(e,arguments)})},[(0,a.Wm)(s,{class:"icon",icon:e.Icon.GAME},null,8,["icon"]),Br]),(0,a._)("button",{class:"button",onClick:t[4]||(t[4]=function(){return e.onHandicapBishop&&e.onHandicapBishop.apply(e,arguments)})},[(0,a.Wm)(s,{class:"icon",icon:e.Icon.GAME},null,8,["icon"]),Gr]),(0,a._)("button",{class:"button",onClick:t[5]||(t[5]=function(){return e.onHandicapRook&&e.onHandicapRook.apply(e,arguments)})},[(0,a.Wm)(s,{class:"icon",icon:e.Icon.GAME},null,8,["icon"]),Zr]),(0,a._)("button",{class:"button",onClick:t[6]||(t[6]=function(){return e.onHandicapRookLance&&e.onHandicapRookLance.apply(e,arguments)})},[(0,a.Wm)(s,{class:"icon",icon:e.Icon.GAME},null,8,["icon"]),Wr]),(0,a._)("button",{class:"button",onClick:t[7]||(t[7]=function(){return e.onHandicap2Pieces&&e.onHandicap2Pieces.apply(e,arguments)})},[(0,a.Wm)(s,{class:"icon",icon:e.Icon.GAME},null,8,["icon"]),Ur]),(0,a._)("button",{class:"button",onClick:t[8]||(t[8]=function(){return e.onHandicap4Pieces&&e.onHandicap4Pieces.apply(e,arguments)})},[(0,a.Wm)(s,{class:"icon",icon:e.Icon.GAME},null,8,["icon"]),Kr]),(0,a._)("button",{class:"button",onClick:t[9]||(t[9]=function(){return e.onHandicap6Pieces&&e.onHandicap6Pieces.apply(e,arguments)})},[(0,a.Wm)(s,{class:"icon",icon:e.Icon.GAME},null,8,["icon"]),Fr]),(0,a._)("button",{class:"button",onClick:t[10]||(t[10]=function(){return e.onHandicap8Pieces&&e.onHandicap8Pieces.apply(e,arguments)})},[(0,a.Wm)(s,{class:"icon",icon:e.Icon.GAME},null,8,["icon"]),qr]),(0,a._)("button",{class:"button",onClick:t[11]||(t[11]=function(){return e.onTsumeShogi&&e.onTsumeShogi.apply(e,arguments)})},[(0,a.Wm)(s,{class:"icon",icon:e.Icon.QUIZ},null,8,["icon"]),jr]),(0,a._)("button",{class:"button",onClick:t[12]||(t[12]=function(){return e.onTsumeShogi2Kings&&e.onTsumeShogi2Kings.apply(e,arguments)})},[(0,a.Wm)(s,{class:"icon",icon:e.Icon.QUIZ},null,8,["icon"]),Vr])])])],512)])}var Yr=(0,a.aZ)({name:"InitialPositionMenu",components:{ButtonIcon:nr},emits:["close"],setup:function(e,t){var n=zi(),i=(0,d.iH)(null);(0,a.bv)((function(){br(i.value)}));var r=function(){t.emit("close")},o=function(){n.initializePosition(Le.STANDARD),t.emit("close")},s=function(){n.initializePosition(Le.HANDICAP_LANCE),t.emit("close")},c=function(){n.initializePosition(Le.HANDICAP_RIGHT_LANCE),t.emit("close")},u=function(){n.initializePosition(Le.HANDICAP_BISHOP),t.emit("close")},l=function(){n.initializePosition(Le.HANDICAP_ROOK),t.emit("close")},h=function(){n.initializePosition(Le.HANDICAP_ROOK_LANCE),t.emit("close")},p=function(){n.initializePosition(Le.HANDICAP_2PIECES),t.emit("close")},v=function(){n.initializePosition(Le.HANDICAP_4PIECES),t.emit("close")},f=function(){n.initializePosition(Le.HANDICAP_6PIECES),t.emit("close")},g=function(){n.initializePosition(Le.HANDICAP_8PIECES),t.emit("close")},m=function(){n.initializePosition(Le.TSUME_SHOGI),t.emit("close")},_=function(){n.initializePosition(Le.TSUME_SHOGI_2KINGS),t.emit("close")};return{dialog:i,Icon:Ji,onClose:r,onStandard:o,onHandicapLance:s,onHandicapRightLance:c,onHandicapBishop:u,onHandicapRook:l,onHandicapRookLance:h,onHandicap2Pieces:p,onHandicap4Pieces:v,onHandicap6Pieces:f,onHandicap8Pieces:g,onTsumeShogi:m,onTsumeShogi2Kings:_}}});const Jr=(0,Rn.Z)(Yr,[["render",zr],["__scopeId","data-v-d7f89dd8"]]);var $r=Jr,Qr=(0,a.aZ)({name:"BoardPane",components:{BoardView:Nn,ButtonIcon:nr,FileMenu:Nr,InitialPositionMenu:$r},props:{maxSize:{type:_n,required:!0}},emits:["resize"],setup:function(e,t){var n=zi(),i=(0,d.iH)(!1),r=(0,d.iH)(!1),o=function(e){t.emit("resize",e)},s=function(e){n.appState===Hi.GAME?Ii.doMove(e):n.doMove(e)},c=function(e){n.editPosition(e)},u=function(){n.showGameDialog()},l=function(){n.stopGame()},h=function(){Ii.resign()},p=function(){n.showResearchDialog()},v=function(){n.stopResearch()},f=function(){n.showAnalysisDialog()},g=function(){n.stopAnalysis()},m=function(){n.startPositionEditing()},_=function(){n.endPositionEditing()},y=function(){r.value=!0},S=function(){n.changeTurn()},w=function(){n.showAppSettingDialog()},E=function(){n.showUsiEngineManagementDialog()},k=function(){zi().flipBoard()},I=function(){i.value=!0},b=function(){n.removeRecordAfter()},T=(0,a.Fl)((function(){return n.appState===Hi.POSITION_EDITING})),R=(0,a.Fl)((function(){return n.isMovableByUser})),A=(0,a.Fl)((function(){return n.appSetting})),N=(0,a.Fl)((function(){return n.record.position})),P=(0,a.Fl)((function(){var e=n.record.current.move;return e instanceof He?e:void 0})),O=(0,a.Fl)((function(){return n.record.metadata.getStandardMetadata(Ve.BLACK_NAME)})),C=(0,a.Fl)((function(){return n.record.metadata.getStandardMetadata(Ve.WHITE_NAME)})),H=(0,a.Fl)((function(){return n.appState===Hi.GAME?n.blackTimeMs:void 0})),M=(0,a.Fl)((function(){return n.appState===Hi.GAME?n.blackByoyomi:void 0})),L=(0,a.Fl)((function(){return n.appState===Hi.GAME?n.whiteTimeMs:void 0})),D=(0,a.Fl)((function(){return n.appState===Hi.GAME?n.whiteByoyomi:void 0})),x=(0,a.Fl)((function(){return{game:n.appState===Hi.NORMAL,stop:n.appState===Hi.GAME,resign:n.appState===Hi.GAME&&n.isMovableByUser,research:n.appState===Hi.NORMAL,endResearch:n.appState===Hi.RESEARCH,analysis:n.appState===Hi.NORMAL,endAnalysis:n.appState===Hi.ANALYSIS,startEditPosition:n.appState===Hi.NORMAL,endEditPosition:n.appState===Hi.POSITION_EDITING,initPosition:n.appState===Hi.POSITION_EDITING,removeAfter:n.appState===Hi.NORMAL||n.appState===Hi.RESEARCH,engineSettings:n.appState===Hi.NORMAL}}));return{isFileMenuVisible:i,isInitialPositionMenuVisible:r,appSetting:A,position:N,lastMove:P,blackPlayerName:O,whitePlayerName:C,blackPlayerTimeMs:H,blackPlayerByoyomi:M,whitePlayerTimeMs:L,whitePlayerByoyomi:D,controlStates:x,onResize:o,onMove:s,onEdit:c,onGame:u,onStop:l,onResign:h,onResearch:p,onEndResearch:v,onAnalysis:f,onEndAnalysis:g,onStartEditPosition:m,onEndEditPosition:_,onInitPosition:y,onChangeTurn:S,onOpenAppSettings:w,onOpenEngineSettings:E,onFlip:k,onFileAction:I,onRemoveAfter:b,allowEdit:T,allowMove:R,Icon:Ji}}});const Xr=(0,Rn.Z)(Qr,[["render",C],["__scopeId","data-v-9f2180b4"]]);var eo=Xr,to=function(e){return(0,a.dD)("data-v-2f3c443f"),e=e(),(0,a.Cn)(),e},no={class:"record-pane"},io={class:"record"},ro={class:"options"},oo={class:"option"},ao=["checked"],so=to((function(){return(0,a._)("label",{for:"show-elapsed-time"},"消費時間",-1)})),co={class:"option"},uo=["checked"],lo=to((function(){return(0,a._)("label",{for:"show-comment"},"コメント",-1)}));function ho(e,t,n,i,r,o){var s=(0,a.up)("RecordView");return(0,a.wg)(),(0,a.iD)("div",no,[(0,a._)("div",io,[(0,a.Wm)(s,{record:e.record,operational:e.isRecordOperational,"show-comment":e.showComment,"show-elapsed-time":e.showElapsedTime,onGoBegin:e.goBegin,onGoBack:e.goBack,onGoForward:e.goForward,onGoEnd:e.goEnd,onSelectMove:e.selectMove,onSelectBranch:e.selectBranch},null,8,["record","operational","show-comment","show-elapsed-time","onGoBegin","onGoBack","onGoForward","onGoEnd","onSelectMove","onSelectBranch"])]),(0,a._)("div",ro,[(0,a._)("div",oo,[(0,a._)("input",{id:"show-elapsed-time",type:"checkbox",checked:e.showElapsedTime,onChange:t[0]||(t[0]=function(){return e.onToggleElapsedTime&&e.onToggleElapsedTime.apply(e,arguments)})},null,40,ao),so]),(0,a._)("div",co,[(0,a._)("input",{id:"show-comment",type:"checkbox",checked:e.showComment,onChange:t[1]||(t[1]=function(){return e.onToggleComment&&e.onToggleComment.apply(e,arguments)})},null,40,uo),lo])])])}var po={class:"record-view"},vo={class:"controller"},fo=["disabled"],go=["disabled"],mo=["disabled"],_o=["disabled"],yo={ref:"moveList",class:"move-list"},So=["value","onClick"],wo={class:"move-number"},Eo={class:"move-text"},ko={key:0,class:"move-time"},Io={key:1,class:"move-comment"},bo={ref:"branchList",class:"branch-list"},To=["value","onClick"],Ro={class:"move-text"},Ao={key:0,class:"move-comment"};function No(e,t,n,i,r,o){var c=(0,a.up)("ButtonIcon");return(0,a.wg)(),(0,a.iD)("div",po,[(0,a._)("div",vo,[(0,a._)("button",{class:"control-button",disabled:!e.operational,onClick:t[0]||(t[0]=function(t){return e.goBegin()})},[(0,a.Wm)(c,{class:"icon",icon:e.Icon.FIRST},null,8,["icon"])],8,fo),(0,a._)("button",{class:"control-button",disabled:!e.operational,onClick:t[1]||(t[1]=function(t){return e.goBack()})},[(0,a.Wm)(c,{class:"icon",icon:e.Icon.BACK},null,8,["icon"])],8,go),(0,a._)("button",{class:"control-button",disabled:!e.operational,onClick:t[2]||(t[2]=function(t){return e.goForward()})},[(0,a.Wm)(c,{class:"icon",icon:e.Icon.NEXT},null,8,["icon"])],8,mo),(0,a._)("button",{class:"control-button",disabled:!e.operational,onClick:t[3]||(t[3]=function(t){return e.goEnd()})},[(0,a.Wm)(c,{class:"icon",icon:e.Icon.LAST},null,8,["icon"])],8,_o)]),(0,a._)("div",yo,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.moves,(function(t){return(0,a.wg)(),(0,a.iD)("div",{key:t.number,class:(0,s.C_)(["move-element",{"has-branch":t.hasBranch,selected:t.selected}]),value:t.number,onClick:function(n){return e.changeNumber(t.number)}},[(0,a._)("div",wo,(0,s.zw)(0!==t.number?t.number:""),1),(0,a._)("div",Eo,(0,s.zw)(t.text),1),e.showElapsedTime?((0,a.wg)(),(0,a.iD)("div",ko,(0,s.zw)(t.time),1)):(0,a.kq)("",!0),e.showComment?((0,a.wg)(),(0,a.iD)("div",Io,(0,s.zw)(t.comment),1)):(0,a.kq)("",!0)],10,So)})),128))],512),(0,a._)("div",bo,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.branches,(function(t){return(0,a.wg)(),(0,a.iD)("div",{key:t.index,class:(0,s.C_)(["move-element",{selected:t.selected}]),value:t.index,onClick:function(n){return e.changeBranch(t.index)}},[(0,a._)("div",Ro,(0,s.zw)(t.text),1),e.showComment?((0,a.wg)(),(0,a.iD)("div",Ao,(0,s.zw)(t.comment),1)):(0,a.kq)("",!0)],10,To)})),128))],512)])}var Po=(0,a.aZ)({name:"RecordView",components:{ButtonIcon:nr},props:{record:{type:Object,required:!0},operational:{type:Boolean,required:!1},showElapsedTime:{type:Boolean,required:!1},showComment:{type:Boolean,required:!1}},emits:["goBegin","goBack","goForward","goEnd","selectMove","selectBranch"],setup:function(e,t){var n=(0,d.iH)(null),i=(0,d.iH)(null),r=function(){e.operational&&t.emit("goBegin")},o=function(){e.operational&&t.emit("goBack")},s=function(){e.operational&&t.emit("goForward")},c=function(){e.operational&&t.emit("goEnd")},u=function(n){e.operational&&t.emit("selectMove",Number(n))},l=function(n){e.operational&&t.emit("selectBranch",Number(n))},h=(0,a.Fl)((function(){return 0===e.record.current.number})),p=(0,a.Fl)((function(){var t=[];return e.record.moves.forEach((function(n){t.push({number:n.number,text:n.displayText,time:0!=n.number?n.timeText:"",hasBranch:n.hasBranch,comment:n.comment,selected:n===e.record.current})})),t})),v=(0,a.Fl)((function(){if(!e.record.branchBegin.branch)return null;var t,n=[];for(t=e.record.branchBegin;t&&t.move;t=t.branch)n.push({index:n.length,text:t.displayText,comment:t.comment,selected:t.activeBranch});return n}));return(0,a.ic)((function(){var e=n.value;e.childNodes.forEach((function(e){e instanceof HTMLElement&&e.classList.contains("selected")&&e.scrollIntoView({behavior:"auto",block:"nearest"})}))})),{beginPosSelected:h,moves:p,branches:v,moveList:n,branchList:i,goBegin:r,goBack:o,goForward:s,goEnd:c,changeNumber:u,changeBranch:l,Icon:Ji}}});const Oo=(0,Rn.Z)(Po,[["render",No],["__scopeId","data-v-69eb6261"]]);var Co=Oo,Ho=200,Mo=(0,a.aZ)({name:"RecordPane",components:{RecordView:Co},setup:function(){var e=zi(),t=function(t){e.changeMoveNumber(t)},n=function(){t(0)},i=function(){t(e.record.current.number-1)},r=function(){t(e.record.current.number+1)},o=function(){t(Number.MAX_SAFE_INTEGER)},s=function(e){t(e)},c=function(t){e.changeBranch(t)},u=function(t){var n=t.target;e.updateAppSetting({showElapsedTimeInRecordView:n.checked})},l=function(t){var n=t.target;e.updateAppSetting({showCommentInRecordView:n.checked})},h=(0,a.Fl)((function(){return e.appState===Hi.NORMAL||e.appState===Hi.RESEARCH})),d=(0,a.Fl)((function(){return e.appSetting.showCommentInRecordView})),p=(0,a.Fl)((function(){return e.appSetting.showElapsedTimeInRecordView})),v=(0,a.Fl)((function(){return e.record}));return{isRecordOperational:h,showElapsedTime:p,showComment:d,record:v,goBegin:n,goBack:i,goForward:r,goEnd:o,selectMove:s,selectBranch:c,onToggleElapsedTime:u,onToggleComment:l}}});const Lo=(0,Rn.Z)(Mo,[["render",ho],["__scopeId","data-v-2f3c443f"]]);var Do=Lo,xo={class:"root"},Bo={class:"tabs"},Go=(0,a.Uk)(" 棋譜情報 "),Zo=(0,a.Uk)(" コメント "),Wo=(0,a.Uk)(" 思考 "),Uo=(0,a.Uk)(" 読み筋 "),Ko=(0,a.Uk)(" 評価値 "),Fo=(0,a.Uk)(" 期待勝率 "),qo=(0,a.Uk)(" 最小化 "),jo={class:"tab-contents"};function Vo(e,t,n,i,r,o){var c=(0,a.up)("ButtonIcon"),u=(0,a.up)("RecordInfo"),l=(0,a.up)("RecordComment"),h=(0,a.up)("EngineAnalytics"),d=(0,a.up)("EvaluationChart");return(0,a.wg)(),(0,a.iD)("div",null,[(0,a._)("div",xo,["invisible"===e.activeTab?((0,a.wg)(),(0,a.iD)("div",{key:0,style:(0,s.j5)("height: calc(100% - ".concat(e.headerHeight,"px);"))},null,4)):(0,a.kq)("",!0),(0,a._)("div",Bo,[(0,a._)("span",{class:(0,s.C_)(["tab",{selected:e.activeTab===e.Tab.RECORD_INFO}]),onClick:t[0]||(t[0]=function(t){return e.changeSelect(e.Tab.RECORD_INFO)})},[(0,a.Wm)(c,{class:"icon",icon:e.Icon.DESCRIPTION},null,8,["icon"]),Go],2),(0,a._)("span",{class:(0,s.C_)(["tab",{selected:e.activeTab===e.Tab.COMMENT}]),onClick:t[1]||(t[1]=function(t){return e.changeSelect(e.Tab.COMMENT)})},[(0,a.Wm)(c,{class:"icon",icon:e.Icon.COMMENT},null,8,["icon"]),Zo],2),(0,a._)("span",{class:(0,s.C_)(["tab",{selected:e.activeTab===e.Tab.SEARCH}]),onClick:t[2]||(t[2]=function(t){return e.changeSelect(e.Tab.SEARCH)})},[(0,a.Wm)(c,{class:"icon",icon:e.Icon.BRAIN},null,8,["icon"]),Wo],2),(0,a._)("span",{class:(0,s.C_)(["tab",{selected:e.activeTab===e.Tab.PV}]),onClick:t[3]||(t[3]=function(t){return e.changeSelect(e.Tab.PV)})},[(0,a.Wm)(c,{class:"icon",icon:e.Icon.PV},null,8,["icon"]),Uo],2),(0,a._)("span",{class:(0,s.C_)(["tab",{selected:e.activeTab===e.Tab.CHART}]),onClick:t[4]||(t[4]=function(t){return e.changeSelect(e.Tab.CHART)})},[(0,a.Wm)(c,{class:"icon",icon:e.Icon.CHART},null,8,["icon"]),Ko],2),(0,a._)("span",{class:(0,s.C_)(["tab",{selected:e.activeTab===e.Tab.PERCENTAGE_CHART}]),onClick:t[5]||(t[5]=function(t){return e.changeSelect(e.Tab.PERCENTAGE_CHART)})},[(0,a.Wm)(c,{class:"icon",icon:e.Icon.PERCENT},null,8,["icon"]),Fo],2),(0,a._)("span",{class:(0,s.C_)(["tab",{selected:e.activeTab===e.Tab.INVISIBLE}]),onClick:t[6]||(t[6]=function(t){return e.changeSelect(e.Tab.INVISIBLE)})},[(0,a.Wm)(c,{class:"icon",icon:e.Icon.ARROW_DROP},null,8,["icon"]),qo],2)]),(0,a._)("div",jo,[(0,a.Wm)(u,{class:(0,s.C_)(["tab-content",{selected:e.activeTab===e.Tab.RECORD_INFO}]),size:e.contentSize},null,8,["class","size"]),(0,a.Wm)(l,{class:(0,s.C_)(["tab-content",{selected:e.activeTab===e.Tab.COMMENT}])},null,8,["class"]),(0,a.Wm)(h,{class:(0,s.C_)(["tab-content",{selected:e.activeTab===e.Tab.SEARCH}]),size:e.contentSize,"history-mode":!0},null,8,["class","size"]),(0,a.Wm)(h,{class:(0,s.C_)(["tab-content",{selected:e.activeTab===e.Tab.PV}]),size:e.contentSize,"history-mode":!1},null,8,["class","size"]),(0,a.Wm)(d,{class:(0,s.C_)(["tab-content",{selected:e.activeTab===e.Tab.CHART}]),size:e.contentSize,type:e.EvaluationChartType.RAW},null,8,["class","size","type"]),(0,a.Wm)(d,{class:(0,s.C_)(["tab-content",{selected:e.activeTab===e.Tab.PERCENTAGE_CHART}]),size:e.contentSize,type:e.EvaluationChartType.WIN_RATE},null,8,["class","size","type"])])])])}var zo={class:"root"},Yo=["value","readonly"];function Jo(e,t,n,i,r,o){return(0,a.wg)(),(0,a.iD)("div",null,[(0,a._)("div",zo,[(0,a._)("textarea",{ref:"textarea",class:"text",value:e.comment,readonly:!!e.readonly,onInput:t[0]||(t[0]=function(){return e.change&&e.change.apply(e,arguments)})},null,40,Yo)])])}var $o=(0,a.aZ)({name:"RecordComment",setup:function(){var e=zi(),t=(0,a.Fl)((function(){return e.record.current.comment})),n=(0,a.Fl)((function(){return e.appState!=Hi.NORMAL})),i=(0,d.iH)(null),r=function(t){var n=t.target.value;e.updateRecordComment(n)};return(0,a.bv)((function(){i.value.addEventListener("copy",(function(e){e.stopPropagation()})),i.value.addEventListener("paste",(function(e){e.stopPropagation()}))})),{textarea:i,comment:t,readonly:n,change:r}}});const Qo=(0,Rn.Z)($o,[["render",Jo],["__scopeId","data-v-74746424"]]);var Xo=Qo,ea={class:"root"};function ta(e,t,n,i,r,o){var s=(0,a.up)("EngineAnalyticsElement");return(0,a.wg)(),(0,a.iD)("div",null,[(0,a._)("div",ea,[e.blackPlayer?((0,a.wg)(),(0,a.j4)(s,{key:0,"history-mode":e.historyMode,name:e.blackPlayer.name,info:e.blackPlayer,height:e.elementHeight},null,8,["history-mode","name","info","height"])):(0,a.kq)("",!0),e.whitePlayer?((0,a.wg)(),(0,a.j4)(s,{key:1,"history-mode":e.historyMode,name:e.whitePlayer.name,info:e.whitePlayer,height:e.elementHeight},null,8,["history-mode","name","info","height"])):(0,a.kq)("",!0),e.researcher?((0,a.wg)(),(0,a.j4)(s,{key:2,"history-mode":e.historyMode,name:e.researcher.name,info:e.researcher,height:e.elementHeight},null,8,["history-mode","name","info","height"])):(0,a.kq)("",!0)])])}n(6977);var na=function(e){return(0,a.dD)("data-v-3fd4e856"),e=e(),(0,a.Cn)(),e},ia={class:"root"},ra={class:"headers"},oa={class:"header"},aa=na((function(){return(0,a._)("span",{class:"label"},"エンジン名: ",-1)})),sa={class:"value"},ca={class:"header"},ua=na((function(){return(0,a._)("span",{class:"label"},"予想手: ",-1)})),la={class:"value"},ha={class:"header"},da=na((function(){return(0,a._)("span",{class:"label"},"最善手: ",-1)})),pa={class:"value"},va={class:"header"},fa=na((function(){return(0,a._)("span",{class:"label"},"秒間探索ノード(NPS): ",-1)})),ga={class:"value"},ma={class:"header"},_a=na((function(){return(0,a._)("span",{class:"label"},"探索ノード数: ",-1)})),ya={class:"value"},Sa={class:"header"},wa=na((function(){return(0,a._)("span",{class:"label"},"ハッシュ使用率: ",-1)})),Ea={class:"value"},ka=(0,a.uE)('<div class="list-header" data-v-3fd4e856><div class="list-column time" data-v-3fd4e856>経過時間</div><div class="list-column multipv-index" data-v-3fd4e856>順位</div><div class="list-column depth" data-v-3fd4e856>深さ</div><div class="list-column nodes" data-v-3fd4e856>探索局面数</div><div class="list-column score" data-v-3fd4e856>評価値</div></div>',1),Ia={class:"list-column time"},ba={class:"list-column multipv-index"},Ta={class:"list-column depth"},Ra={class:"list-column nodes"},Aa={class:"list-column score"},Na={class:"list-column score-flag"},Pa={class:"list-column text"},Oa=["onClick"],Ca=(0,a.Uk)(" 再現 ");function Ha(e,t,n,i,r,o){var c=(0,a.up)("ButtonIcon"),u=(0,a.up)("PVPreviewDialog");return(0,a.wg)(),(0,a.iD)("div",null,[(0,a._)("div",ia,[(0,a._)("div",ra,[(0,a._)("div",oa,[aa,(0,a._)("span",sa,(0,s.zw)(e.name),1)]),(0,a._)("div",ca,[ua,(0,a._)("span",la,(0,s.zw)(e.info.ponderMove?e.info.ponderMove:"---"),1)]),(0,a._)("div",ha,[da,(0,a._)("span",pa,(0,s.zw)(e.info.currentMoveText||"---"),1)]),(0,a._)("div",va,[fa,(0,a._)("span",ga,(0,s.zw)(e.info.nps||"---"),1)]),(0,a._)("div",ma,[_a,(0,a._)("span",ya,(0,s.zw)(e.info.nodes||"---"),1)]),(0,a._)("div",Sa,[wa,(0,a._)("span",Ea,(0,s.zw)(e.info.hashfull?(100*e.info.hashfull).toFixed(1):"---")+" % ",1)])]),ka,(0,a._)("div",{class:"list",style:(0,s.j5)("height:".concat(e.height-37,"px"))},[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.historyMode?e.info.iterates:e.info.latestIteration,(function(t,n){return(0,a.wg)(),(0,a.iD)("div",{key:n,class:(0,s.C_)(["list-item",{highlight:e.historyMode&&1===t.multiPV}])},[(0,a._)("div",Ia,(0,s.zw)(t.timeMs?(t.timeMs/1e3).toFixed(1)+"s":""),1),(0,a._)("div",ba,(0,s.zw)(t.multiPV||""),1),(0,a._)("div",Ta,(0,s.zw)(t.depth)+(0,s.zw)(t.selectiveDepth&&t.depth?"/":"")+(0,s.zw)(t.selectiveDepth),1),(0,a._)("div",Ra,(0,s.zw)(t.nodes),1),(0,a._)("div",Aa,(0,s.zw)(t.score)+" "+(0,s.zw)(t.scoreMate?t.scoreMate:""),1),(0,a._)("div",Na,(0,s.zw)(t.lowerBound?"++":"")+" "+(0,s.zw)(t.upperBound?"--":"")+" "+(0,s.zw)(t.scoreMate?"詰":""),1),(0,a._)("div",Pa,[t.pv&&0!==t.pv.length&&t.text?((0,a.wg)(),(0,a.iD)("button",{key:0,onClick:function(n){return e.showPreview(t)}},[(0,a.Wm)(c,{class:"icon",icon:e.Icon.PLAY},null,8,["icon"]),Ca],8,Oa)):(0,a.kq)("",!0),(0,a.Uk)(" "+(0,s.zw)(t.text),1)])],2)})),128))],4),e.preview?((0,a.wg)(),(0,a.j4)(u,{key:0,position:e.preview.position,pv:e.preview.pv,infos:e.preview.infos,onClose:e.closePreview},null,8,["position","pv","infos","onClose"])):(0,a.kq)("",!0)])])}var Ma={ref:"dialog"},La={class:"control top"},Da={class:"control-row"},xa={class:"control-row"},Ba={class:"control-row"},Ga={class:"informations"};function Za(e,t,n,i,r,o){var c=(0,a.up)("ButtonIcon"),u=(0,a.up)("BoardView");return(0,a.wg)(),(0,a.iD)("div",null,[(0,a._)("dialog",Ma,[(0,a.Wm)(u,{class:"board","piece-image-type":e.appSetting.pieceImage,"board-image-type":e.appSetting.boardImage,"board-label-type":e.appSetting.boardLabelType,"max-size":e.maxSize,position:e.pos,"last-move":e.lastMove,flip:e.flip},{"right-control":(0,a.w5)((function(){return[(0,a._)("div",La,[(0,a._)("div",Da,[(0,a._)("button",{class:"control-item",onClick:t[0]||(t[0]=function(){return e.doFlip&&e.doFlip.apply(e,arguments)})},[(0,a.Wm)(c,{class:"icon",icon:e.Icon.FLIP},null,8,["icon"])]),(0,a._)("button",{class:"control-item",onClick:t[1]||(t[1]=function(){return e.close&&e.close.apply(e,arguments)})},[(0,a.Wm)(c,{class:"icon",icon:e.Icon.CLOSE},null,8,["icon"])])]),(0,a._)("div",xa,[(0,a._)("button",{class:"control-item",onClick:t[2]||(t[2]=function(){return e.goBegin&&e.goBegin.apply(e,arguments)})},[(0,a.Wm)(c,{class:"icon",icon:e.Icon.FIRST},null,8,["icon"])]),(0,a._)("button",{class:"control-item",onClick:t[3]||(t[3]=function(){return e.goEnd&&e.goEnd.apply(e,arguments)})},[(0,a.Wm)(c,{class:"icon",icon:e.Icon.LAST},null,8,["icon"])])]),(0,a._)("div",Ba,[(0,a._)("button",{class:"control-item",onClick:t[4]||(t[4]=function(){return e.goBack&&e.goBack.apply(e,arguments)})},[(0,a.Wm)(c,{class:"icon",icon:e.Icon.BACK},null,8,["icon"])]),(0,a._)("button",{class:"control-item",onClick:t[5]||(t[5]=function(){return e.goForward&&e.goForward.apply(e,arguments)})},[(0,a.Wm)(c,{class:"icon",icon:e.Icon.NEXT},null,8,["icon"])])])])]})),_:1},8,["piece-image-type","board-image-type","board-label-type","max-size","position","last-move","flip"]),(0,a._)("div",Ga,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.infos,(function(e){return(0,a.wg)(),(0,a.iD)("div",{key:e,class:"information"},(0,s.zw)(e),1)})),128))])],512)])}var Wa=(0,a.aZ)({name:"PVPreviewDialog",components:{BoardView:Nn,ButtonIcon:nr},props:{position:{type:String,required:!0},pv:{type:Object,required:!0},infos:{type:Object,default:[],required:!1}},emits:["close"],setup:function(e,t){var n=zi(),r=(0,d.iH)(null),o=(0,d.qj)(new _n(0,0)),s=(0,d.qj)(new rt),c=(0,d.iH)(n.appSetting.boardFlipping),u=function(){o.width=.8*window.innerWidth,o.height=.8*window.innerHeight-80},l=function(){var t=Fe.newBySFEN(e.position);if(t){s.clear(t);var n,i=(0,ot.Z)(e.pv);try{for(i.s();!(n=i.n()).done;){var r=n.value,o=s.position.createMoveBySFEN(r);if(!o)break;s.append(o,{ignoreValidation:!0})}}catch(a){i.e(a)}finally{i.f()}s.goto(1)}};(0,a.bv)((0,i.Z)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:u(),l(),window.addEventListener("resize",u),br(r.value);case 4:case"end":return e.stop()}}),e)})))),(0,a.Ah)((function(){window.removeEventListener("resize",u)})),(0,a.YP)([function(){return e.position},function(){return e.pv}],(function(){l(),br(r.value)}));var h=function(){t.emit("close")},p=function(){s.goto(0)},v=function(){s.goto(Number.MAX_SAFE_INTEGER)},f=function(){s.goBack()},g=function(){s.goForward()},m=function(){c.value=!c.value},_=(0,d.Fl)((function(){return s.position})),y=(0,d.Fl)((function(){return s.current.move instanceof He?s.current.move:null}));return{dialog:r,appSetting:n.appSetting,pos:_,lastMove:y,maxSize:o,flip:c,close:h,goBegin:p,goEnd:v,goBack:f,goForward:g,doFlip:m,Icon:Ji}}});const Ua=(0,Rn.Z)(Wa,[["render",Za],["__scopeId","data-v-0317ad55"]]);var Ka=Ua,Fa=(0,a.aZ)({name:"EngineAnalyticsElement",components:{ButtonIcon:nr,PVPreviewDialog:Ka},props:{historyMode:{type:Boolean,required:!0},name:{type:String,required:!0},info:{type:_i,required:!0},height:{type:Number,required:!0}},setup:function(){var e=(0,d.iH)(null),t=function(t){var n=[];void 0!==t.depth&&n.push("深さ=".concat(t.depth)),void 0!==t.selectiveDepth&&n.push("選択的深さ=".concat(t.selectiveDepth)),t.score&&(n.push("評価値=".concat(t.score)),t.lowerBound&&n.push("（下界値）"),t.upperBound&&n.push("（上界値）")),t.scoreMate&&n.push("詰み手数=".concat(t.scoreMate)),t.multiPV&&n.push("順位=".concat(t.multiPV)),e.value={position:t.position,pv:t.pv||[],infos:[n.join(" / "),t.text||""]}},n=function(){e.value=null};return{Icon:Ji,preview:e,showPreview:t,closePreview:n}}});const qa=(0,Rn.Z)(Fa,[["render",Ha],["__scopeId","data-v-3fd4e856"]]);var ja=qa,Va=(0,a.aZ)({name:"EngineAnalytics",components:{EngineAnalyticsElement:ja},props:{size:{type:_n,required:!0},historyMode:{type:Boolean,required:!0}},setup:function(e){var t=zi(),n=(0,a.Fl)((function(){return t.usiBlackPlayerMonitor})),i=(0,a.Fl)((function(){return t.usiWhitePlayerMonitor})),r=(0,a.Fl)((function(){return t.usiResearcherMonitor})),o=(0,a.Fl)((function(){var n=(t.usiBlackPlayerMonitor?1:0)+(t.usiWhitePlayerMonitor?1:0)+(t.usiResearcherMonitor?1:0);return 0!==n?e.size.height/n:0}));return{blackPlayer:n,whitePlayer:i,researcher:r,elementHeight:o}}});const za=(0,Rn.Z)(Va,[["render",ta],["__scopeId","data-v-3b22508c"]]);var Ya=za,Ja={class:"root"},$a=["width","height"];function Qa(e,t,n,i,r,o){return(0,a.wg)(),(0,a.iD)("div",null,[(0,a._)("div",Ja,[(0,a._)("canvas",{ref:"canvas",width:e.size.width.toFixed(0),height:e.size.height.toFixed(0)},null,8,$a)])])}var Xa,es=n(6084),ts=n(2728),ns=2e3,is=-ns;function rs(e){switch(e){default:return{main:"black",ticks:"dimgray",grid:"lightgray",head:"red",blackPlayer:"royalblue",whitePlayer:"darkorange",researcher:"darkgreen"};case Kn.DARK:return{main:"white",ticks:"darkgray",grid:"dimgray",head:"red",blackPlayer:"deepskyblue",whitePlayer:"orange",researcher:"mediumseagreen"}}}(function(e){e["RAW"]="raw",e["WIN_RATE"]="winRate"})(Xa||(Xa={}));var os=(0,a.aZ)({name:"EvaluationChart",props:{size:{type:_n,required:!0},type:{type:String,required:!0}},setup:function(e){var t,n=(0,d.iH)(null),i=zi(),r=ns,o=is;e.type===Xa.WIN_RATE&&(r=100,o=0);var s=function(t,n,i,r){var o=[];return i.moves.forEach((function(t){var i=new wi(t.customData),a=i.evaluation&&i.evaluation[n];if(void 0!==a){switch(e.type){case Xa.RAW:a=Math.min(Math.max(a,is),ns);break;case Xa.WIN_RATE:a=Zi(a,r);break}o.push({x:t.number,y:a})}})),{label:fi(n),borderColor:t,data:o,showLine:!0}},c=function(e,t){return{label:"現在の局面",borderColor:t.head,data:[{x:e.current.number,y:r},{x:e.current.number,y:o}],showLine:!0,pointBorderWidth:0,pointRadius:0}},u=function(e,t,n){return[c(e,n),s(n.blackPlayer,vi.BLACK_PLAYER,e,t),s(n.whitePlayer,vi.WHITE_PLAYER,e,t),s(n.researcher,vi.RESEARCHER,e,t)]},l=function(e,t){return{x:{min:0,max:e.length+10,ticks:{color:t.ticks},grid:{color:t.grid}},y:{min:o,max:r,ticks:{color:t.ticks},grid:{color:t.grid}}}},h=function(e,n){var i=rs(n.thema);t.data.datasets=u(e,n,i),t.options.color=i.main,t.options.scales=l(e,i),t.update()},p=function(e,t,n){if(null!==e.x){var r=n.scales.x.max-n.scales.x.min,o=n.scales.x.right-n.scales.x.left,a=(e.x-n.scales.x.left)/o*r+n.scales.x.min,s=Math.round(a);i.changeMoveNumber(s)}};return(0,a.bv)((function(){var e=n.value,i=e.getContext("2d");t=new ts.kL(i,{type:"scatter",data:{datasets:[]},options:{animation:{duration:0},maintainAspectRatio:!1,events:["click"],onClick:p}}),t.draw()})),(0,a.Ah)((function(){t.destroy()})),(0,a.YP)((function(){return[i.record,i.appSetting]}),(function(e){var t=(0,es.Z)(e,2),n=t[0],i=t[1];return h(n,i)}),{deep:!0}),(0,a.YP)((function(){return[e.size]}),(function(e){var n=(0,es.Z)(e,1),i=n[0];t.resize(i.width,i.height)}),{deep:!0}),{canvas:n}}});const as=(0,Rn.Z)(os,[["render",Qa],["__scopeId","data-v-dbdea358"]]);var ss=as,cs=function(e){return(0,a.dD)("data-v-1fb9186d"),e=e(),(0,a.Cn)(),e},us={class:"element"},ls=cs((function(){return(0,a._)("div",{class:"key"},"ファイル",-1)})),hs={class:"value"},ds={class:"key"},ps=["value","onInput"];function vs(e,t,n,i,r,o){return(0,a.wg)(),(0,a.iD)("div",null,[(0,a._)("div",{ref:"root",class:"root",style:(0,s.j5)("height:".concat(e.size.height,"px"))},[(0,a._)("div",us,[ls,(0,a._)("div",hs,(0,s.zw)(e.filePath||"（新規棋譜）"),1)]),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.list,(function(t){return(0,a.wg)(),(0,a.iD)("div",{key:t.key,class:"element"},[(0,a._)("div",ds,(0,s.zw)(t.displayName),1),(0,a._)("input",{class:"value",value:t.value,onInput:function(n){return e.change(n,t.key)}},null,40,ps)])})),128))],4)])}n(1249);var fs=(0,a.aZ)({name:"RecordComment",props:{size:{type:_n,required:!0}},setup:function(){var e=(0,d.iH)(null),t=zi(),n=(0,a.Fl)((function(){return t.recordFilePath})),i=(0,a.Fl)((function(){return Object.values(Ve).map((function(e){var n=t.record.metadata;return{key:e,displayName:Qe(e),value:n.getStandardMetadata(e)||""}}))}));(0,a.bv)((function(){e.value.addEventListener("copy",(function(e){e.stopPropagation()})),e.value.addEventListener("paste",(function(e){e.stopPropagation()}))}));var r=function(e,n){var i=e.target;t.updateStandardRecordMetadata({key:n,value:i.value})};return{root:e,filePath:n,list:i,change:r}}});const gs=(0,Rn.Z)(fs,[["render",vs],["__scopeId","data-v-1fb9186d"]]);var ms=gs,_s=30,ys=240+_s,Ss=(0,a.aZ)({name:"TabPane",components:{RecordComment:Xo,EngineAnalytics:Ya,EvaluationChart:ss,RecordInfo:ms,ButtonIcon:nr},props:{size:{type:_n,required:!0}},setup:function(e){var t=zi(),n=function(e){t.updateAppSetting({tab:e}).catch((function(e){oi.log(jn.WARN,st(e))}))},i=(0,a.Fl)((function(){return t.appSetting.tab})),r=(0,a.Fl)((function(){return e.size.reduce(new _n(0,_s))}));return{activeTab:i,contentSize:r,headerHeight:_s,changeSelect:n,Icon:Ji,Tab:Fn,EvaluationChartType:Xa}}});const ws=(0,Rn.Z)(Ss,[["render",Vo],["__scopeId","data-v-a0779d9e"]]);var Es=ws,ks=(0,a.aZ)({name:"StandardLayout",components:{BoardPane:eo,RecordPane:Do,TabPane:Es},setup:function(){var e=(0,d.qj)(new _n(0,0)),t=(0,d.iH)(new _n(0,0)),n=function(){e.width=window.innerWidth,e.height=window.innerHeight};(0,a.bv)((function(){n(),window.addEventListener("resize",n)})),(0,a.Ah)((function(){window.removeEventListener("resize",n)}));var i=function(e){t.value=e},r=(0,a.Fl)((function(){var t=zi().appSetting.tab!==Fn.INVISIBLE?ys:_s;return new _n(e.width-Ho,e.height-t)})),o=(0,a.Fl)((function(){return{width:"".concat(e.width-t.value.width,"px"),height:"".concat(t.value.height,"px")}})),s=(0,a.Fl)((function(){return new _n(e.width,e.height-t.value.height)}));return{boardPaneMaxSize:r,recordPaneStyle:o,bottomPaneSize:s,onBoardPaneResize:i}}});const Is=(0,Rn.Z)(ks,[["render",h],["__scopeId","data-v-c97084ae"]]);var bs=Is,Ts=function(e){return(0,a.dD)("data-v-c5c0e252"),e=e(),(0,a.Cn)(),e},Rs={ref:"dialog"},As=Ts((function(){return(0,a._)("div",{class:"dialog-title"},"対局",-1)})),Ns={class:"dialog-form-area"},Ps={class:"players"},Os={class:"player"},Cs=Ts((function(){return(0,a._)("div",{class:"top-label"},"先手（下手）",-1)})),Hs={class:"player"},Ms=Ts((function(){return(0,a._)("div",{class:"top-label"},"後手（上手）",-1)})),Ls={class:"players-control"},Ds=(0,a.Uk)(" 先後入れ替え "),xs={class:"dialog-form-areas-h"},Bs={class:"dialog-form-area time-limit"},Gs={class:"dialog-form-item"},Zs=Ts((function(){return(0,a._)("div",{class:"dialog-form-item-label"},"持ち時間",-1)})),Ws={ref:"hours",class:"time-input",type:"number",min:"0",max:"99",step:"1"},Us=Ts((function(){return(0,a._)("div",{class:"dialog-form-item-unit"},"時間",-1)})),Ks={ref:"minutes",class:"time-input",type:"number",min:"0",max:"59",step:"1"},Fs=Ts((function(){return(0,a._)("div",{class:"dialog-form-item-unit"},"分",-1)})),qs={class:"dialog-form-item"},js=Ts((function(){return(0,a._)("div",{class:"dialog-form-item-label"},"秒読み",-1)})),Vs={ref:"byoyomi",class:"time-input single",type:"number",min:"0",max:"60",step:"1"},zs=Ts((function(){return(0,a._)("div",{class:"dialog-form-item-unit"},"秒",-1)})),Ys={class:"dialog-form-item"},Js=Ts((function(){return(0,a._)("div",{class:"dialog-form-item-label"},"増加",-1)})),$s={ref:"increment",class:"time-input single",type:"number",min:"0",max:"99",step:"1"},Qs=Ts((function(){return(0,a._)("div",{class:"dialog-form-item-unit"},"秒",-1)})),Xs={class:"dialog-form-area flags"},ec={class:"dialog-form-item"},tc={ref:"startPosition"},nc=(0,a.uE)('<option value="current" data-v-c5c0e252>現在の局面</option><option value="standard" data-v-c5c0e252>平手</option><option value="handicapLance" data-v-c5c0e252>香落ち</option><option value="handicapRightLance" data-v-c5c0e252>右香落ち</option><option value="handicapBishop" data-v-c5c0e252>角落ち</option><option value="handicapRook" data-v-c5c0e252>飛車落ち</option><option value="handicapRookLance" data-v-c5c0e252>飛車香落ち</option><option value="handicap2Pieces" data-v-c5c0e252>2枚落ち</option><option value="handicap4Pieces" data-v-c5c0e252>4枚落ち</option><option value="handicap6Pieces" data-v-c5c0e252>6枚落ち</option><option value="handicap8Pieces" data-v-c5c0e252>8枚落ち</option>',11),ic=[nc],rc={class:"dialog-form-item"},oc={id:"disable-engine-timeout",ref:"enableEngineTimeout",type:"checkbox"},ac=Ts((function(){return(0,a._)("label",{for:"disable-engine-timeout"},"エンジンの時間切れあり",-1)})),sc={class:"dialog-form-item"},cc={id:"human-is-front",ref:"humanIsFront",type:"checkbox"},uc=Ts((function(){return(0,a._)("label",{for:"human-is-front"},"人を手前に表示する",-1)})),lc={class:"dialog-main-buttons"};function hc(e,t,n,i,r,o){var s=(0,a.up)("PlayerSelector"),c=(0,a.up)("ButtonIcon");return(0,a.wg)(),(0,a.iD)("div",null,[(0,a._)("dialog",Rs,[As,(0,a._)("div",Ns,[(0,a._)("div",Ps,[(0,a._)("div",Os,[Cs,(0,a.Wm)(s,{players:e.players,"player-uri":e.blackPlayerURI,"engine-settings":e.engineSettings.json,"display-ponder-state":!0,"display-thread-state":!0,"display-multi-pv-state":!0,onUpdateEngineSetting:e.onUpdatePlayerSetting,onSelectPlayer:e.onSelectBlackPlayer},null,8,["players","player-uri","engine-settings","onUpdateEngineSetting","onSelectPlayer"])]),(0,a._)("div",Hs,[Ms,e.whitePlayerURI?((0,a.wg)(),(0,a.j4)(s,{key:0,players:e.players,"player-uri":e.whitePlayerURI,"engine-settings":e.engineSettings.json,"display-ponder-state":!0,"display-thread-state":!0,"display-multi-pv-state":!0,onUpdateEngineSetting:e.onUpdatePlayerSetting,onSelectPlayer:e.onSelectWhitePlayer},null,8,["players","player-uri","engine-settings","onUpdateEngineSetting","onSelectPlayer"])):(0,a.kq)("",!0)])]),(0,a._)("div",Ls,[(0,a._)("button",{onClick:t[0]||(t[0]=function(){return e.onSwapColor&&e.onSwapColor.apply(e,arguments)})},[(0,a.Wm)(c,{class:"icon",icon:e.Icon.SWAP_H},null,8,["icon"]),Ds])])]),(0,a._)("div",xs,[(0,a._)("div",Bs,[(0,a._)("div",Gs,[Zs,(0,a._)("input",Ws,null,512),Us,(0,a._)("input",Ks,null,512),Fs]),(0,a._)("div",qs,[js,(0,a._)("input",Vs,null,512),zs]),(0,a._)("div",Ys,[Js,(0,a._)("input",$s,null,512),Qs])]),(0,a._)("div",Xs,[(0,a._)("div",ec,[(0,a._)("select",tc,ic,512)]),(0,a._)("div",rc,[(0,a._)("input",oc,null,512),ac]),(0,a._)("div",sc,[(0,a._)("input",cc,null,512),uc])])]),(0,a._)("div",lc,[(0,a._)("button",{class:"dialog-button",onClick:t[1]||(t[1]=function(t){return e.onStart()})},"対局開始"),(0,a._)("button",{class:"dialog-button",onClick:t[2]||(t[2]=function(t){return e.onCancel()})},"キャンセル")])],512)])}function dc(e){var t=Number(e.value);return e.max&&(t=Math.min(t,Number(e.max))),e.min&&(t=Math.max(t,Number(e.min))),t}var pc=function(e){return(0,a.dD)("data-v-7083fac1"),e=e(),(0,a.Cn)(),e},vc={class:"root"},fc=["value"],gc=["value"],mc={key:0,class:"player-info"},_c=pc((function(){return(0,a._)("span",{class:"player-info-key"},"先読み(Ponder):",-1)})),yc={class:"player-info-value"},Sc={key:1,class:"player-info"},wc=pc((function(){return(0,a._)("span",{class:"player-info-key"},"スレッド数:",-1)})),Ec={class:"player-info-value"},kc={key:2,class:"player-info"},Ic=pc((function(){return(0,a._)("span",{class:"player-info-key"},"マルチPV:",-1)})),bc={class:"player-info-value"},Tc=["disabled"],Rc=(0,a.Uk)(" 設定 ");function Ac(e,t,n,i,r,o){var c=(0,a.up)("ButtonIcon"),u=(0,a.up)("USIEngineOptionDialog");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a._)("div",null,[(0,a._)("div",vc,[(0,a._)("select",{ref:"playerSelect",class:"player-select",size:"1",value:e.playerUri,onChange:t[0]||(t[0]=function(){return e.onPlayerChange&&e.onPlayerChange.apply(e,arguments)})},[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.players,(function(e){return(0,a.wg)(),(0,a.iD)("option",{key:e.uri,value:e.uri},(0,s.zw)(e.name),9,gc)})),128))],40,fc),e.displayPonderState?((0,a.wg)(),(0,a.iD)("div",mc,[_c,(0,a._)("span",yc,(0,s.zw)(e.ponderState||"---"),1)])):(0,a.kq)("",!0),e.displayThreadState?((0,a.wg)(),(0,a.iD)("div",Sc,[wc,(0,a._)("span",Ec,(0,s.zw)(e.threadState||"---"),1)])):(0,a.kq)("",!0),e.displayMultiPvState?((0,a.wg)(),(0,a.iD)("div",kc,[Ic,(0,a._)("span",bc,(0,s.zw)(e.multiPVState||"---"),1)])):(0,a.kq)("",!0),(0,a._)("button",{class:"player-setting",disabled:!e.isPlayerSettingEnabled,onClick:t[1]||(t[1]=function(){return e.openPlayerSetting&&e.openPlayerSetting.apply(e,arguments)})},[(0,a.Wm)(c,{class:"icon",icon:e.Icon.SETTINGS},null,8,["icon"]),Rc],8,Tc)])]),e.engineSettingDialog?((0,a.wg)(),(0,a.j4)(u,{key:0,"latest-engine-setting":e.engineSettingDialog,"ok-button-text":"保存",onOk:e.savePlayerSetting,onCancel:e.closePlayerSetting},null,8,["latest-engine-setting","onOk","onCancel"])):(0,a.kq)("",!0)],64)}var Nc=function(e){return(0,a.dD)("data-v-01e76537"),e=e(),(0,a.Cn)(),e},Pc={ref:"dialog"},Oc=Nc((function(){return(0,a._)("div",{class:"dialog-title"},"エンジン設定",-1)})),Cc={class:"dialog-form-area option-list"},Hc={class:"option"},Mc=Nc((function(){return(0,a._)("div",{class:"option-name"},"エンジン名",-1)})),Lc={class:"option-unchangeable"},Dc={class:"option"},xc=Nc((function(){return(0,a._)("div",{class:"option-name"},"作者",-1)})),Bc={class:"option-unchangeable"},Gc={class:"option"},Zc=Nc((function(){return(0,a._)("div",{class:"option-name"},"場所",-1)})),Wc={class:"option-unchangeable"},Uc={class:"option"},Kc=Nc((function(){return(0,a._)("div",{class:"option-name"},"表示名",-1)})),Fc={ref:"engineNameInput",class:"option-value-text",type:"text",name:"ElectronShogiEngineName"},qc={class:"option-name"},jc=["id","min","max","name"],Vc=["id","name"],zc=["id","name"],Yc=["onClick"],Jc=["id"],$c=Nc((function(){return(0,a._)("option",{value:""},"既定値",-1)})),Qc=Nc((function(){return(0,a._)("option",{value:"true"},"ON",-1)})),Xc=Nc((function(){return(0,a._)("option",{value:"false"},"OFF",-1)})),eu=[$c,Qc,Xc],tu=["id"],nu=Nc((function(){return(0,a._)("option",{value:""},"既定値",-1)})),iu=["value"],ru=["onClick"],ou={class:"dialog-main-buttons"};function au(e,t,n,i,r,o){return(0,a.wg)(),(0,a.iD)("div",null,[(0,a._)("dialog",Pc,[Oc,(0,a._)("div",Cc,[(0,a._)("div",Hc,[Mc,(0,a._)("div",Lc,(0,s.zw)(e.engine.defaultName),1)]),(0,a._)("div",Dc,[xc,(0,a._)("div",Bc,(0,s.zw)(e.engine.author),1)]),(0,a._)("div",Gc,[Zc,(0,a._)("div",Wc,(0,s.zw)(e.engine.path),1)]),(0,a._)("div",Uc,[Kc,(0,a._)("input",Fc,null,512)]),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.options,(function(t){return(0,a.wg)(),(0,a.iD)("div",{key:t.name,class:"option"},[(0,a._)("div",qc,(0,s.zw)(t.name),1),"spin"===t.type?((0,a.wg)(),(0,a.iD)("input",{key:0,id:t.inputId,class:"option-value-number",type:"number",min:t.min,max:t.max,step:"1",name:t.name},null,8,jc)):(0,a.kq)("",!0),"string"===t.type?((0,a.wg)(),(0,a.iD)("input",{key:1,id:t.inputId,class:"option-value-text",type:"text",name:t.name},null,8,Vc)):(0,a.kq)("",!0),"filename"===t.type?((0,a.wg)(),(0,a.iD)("input",{key:2,id:t.inputId,class:"option-value-filename",type:"text",name:t.name},null,8,zc)):(0,a.kq)("",!0),"filename"===t.type?((0,a.wg)(),(0,a.iD)("button",{key:3,class:"dialog-button",onClick:function(n){return e.selectFile(t.inputId)}}," 選択 ",8,Yc)):(0,a.kq)("",!0),"check"===t.type?((0,a.wg)(),(0,a.iD)("select",{key:4,id:t.inputId,class:"option-value-check"},eu,8,Jc)):(0,a.kq)("",!0),"combo"===t.type?((0,a.wg)(),(0,a.iD)("select",{key:5,id:t.inputId,class:"option-value-combo"},[nu,((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(t.vars,(function(e){return(0,a.wg)(),(0,a.iD)("option",{key:e,value:e},(0,s.zw)(e),9,iu)})),128))],8,tu)):(0,a.kq)("",!0),"button"===t.type?((0,a.wg)(),(0,a.iD)("button",{key:6,class:"dialog-button",onClick:function(n){return e.sendOption(t.name)}}," 実行 ",8,ru)):(0,a.kq)("",!0)])})),128))]),(0,a._)("button",{class:"dialog-wide-button",onClick:t[0]||(t[0]=function(t){return e.reset()})}," エンジンの既定値に戻す "),(0,a._)("div",ou,[(0,a._)("button",{class:"dialog-button",onClick:t[1]||(t[1]=function(t){return e.ok()})},(0,s.zw)(e.okButtonText),1),(0,a._)("button",{class:"dialog-button",onClick:t[2]||(t[2]=function(t){return e.cancel()})},"キャンセル")])],512)])}var su=(0,a.aZ)({name:"USIEngineOptionDialog",props:{latestEngineSetting:{type:Object,required:!0},okButtonText:{type:String,required:!1,default:"OK"}},emits:["ok","cancel"],setup:function(e,t){var n=zi(),r=(0,d.iH)(null),o=(0,d.iH)(null),s=e.latestEngineSetting,c=(0,d.iH)(s),u=(0,a.Fl)((function(){return Object.values(c.value.options).sort((function(e,t){var n=e.name.startsWith("USI_"),i=t.name.startsWith("USI_");return n!==i?n?-1:1:e.name<t.name?-1:1})).map((function(e,t){return(0,un.Z)((0,un.Z)({},e),{},{inputId:"usiEngineOptionDialogOption"+t,value:Gn(e)})}))}));n.retainBussyState(),(0,a.bv)((0,i.Z)(regeneratorRuntime.mark((function e(){var i,a,l,h;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return br(r.value),e.prev=1,e.next=4,oi.getUSIEngineInfo(s.path);case 4:c.value=e.sent,Wn(c.value,s),o.value.value=c.value.name,i=(0,ot.Z)(u.value);try{for(i.s();!(a=i.n()).done;)l=a.value,h=Tr(l.inputId),h&&void 0!==l.value&&(h.value=l.value+"")}catch(d){i.e(d)}finally{i.f()}e.next=15;break;case 11:e.prev=11,e.t0=e["catch"](1),n.pushError(e.t0),t.emit("cancel");case 15:return e.prev=15,n.releaseBussyState(),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[1,11,15,18]])}))));var l=function(){var e=(0,i.Z)(regeneratorRuntime.mark((function e(t){var i,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n.retainBussyState(),e.prev=1,e.next=4,oi.showSelectFileDialog();case 4:i=e.sent,r=Tr(t),i&&r&&(r.value=i),e.next=12;break;case 9:e.prev=9,e.t0=e["catch"](1),n.pushError(e.t0);case 12:return e.prev=12,n.releaseBussyState(),e.finish(12);case 15:case"end":return e.stop()}}),e,null,[[1,9,12,15]])})));return function(t){return e.apply(this,arguments)}}(),h=function(){var e=(0,i.Z)(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n.retainBussyState(),e.prev=1,e.next=4,oi.sendUSISetOption(c.value.path,t);case 4:e.next=9;break;case 6:e.prev=6,e.t0=e["catch"](1),n.pushError(e.t0);case 9:return e.prev=9,n.releaseBussyState(),e.finish(9);case 12:case"end":return e.stop()}}),e,null,[[1,6,9,12]])})));return function(t){return e.apply(this,arguments)}}(),p=function(){o.value.value=c.value.defaultName;var e,t=(0,ot.Z)(u.value);try{for(t.s();!(e=t.n()).done;){var n=e.value,i=Tr(n.inputId);i&&(void 0!==c.value.options[n.name].default?i.value=c.value.options[n.name].default+"":i.value="")}}catch(r){t.e(r)}finally{t.f()}},v=function(){c.value.name=o.value.value;var e,n=(0,ot.Z)(u.value);try{for(n.s();!(e=n.n()).done;){var i=e.value,r=Tr(i.inputId);r&&(c.value.options[i.name].value=r.value?"spin"===i.type?dc(r):r.value:void 0)}}catch(a){n.e(a)}finally{n.f()}t.emit("ok",c.value)},f=function(){t.emit("cancel")};return{engine:c,dialog:r,engineNameInput:o,options:u,selectFile:l,sendOption:h,reset:p,ok:v,cancel:f}}});const cu=(0,Rn.Z)(su,[["render",au],["__scopeId","data-v-01e76537"]]);var uu=cu,lu=(0,a.aZ)({name:"PlayerSelector",components:{ButtonIcon:nr,USIEngineOptionDialog:uu},props:{players:{type:Array,required:!0},playerUri:{type:String,required:!0},engineSettings:{type:String,required:!0},displayPonderState:{type:Boolean,default:!1},displayThreadState:{type:Boolean,default:!1},displayMultiPvState:{type:Boolean,default:!1}},emits:["select-player","update-engine-setting"],setup:function(e,t){var n=(0,d.iH)(null),i=(0,d.iH)(null),r=(0,a.Fl)((function(){if(!Cn(e.playerUri))return null;var t=new zn(e.engineSettings),n=t.getEngine(e.playerUri);return"true"===Gn(n.options[Mn])?"ON":"OFF"})),o=(0,a.Fl)((function(){if(!Cn(e.playerUri))return null;var t=new zn(e.engineSettings),n=t.getEngine(e.playerUri),i=Gn(n.options[Dn])||Gn(n.options[xn]);return i})),s=(0,a.Fl)((function(){if(!Cn(e.playerUri))return null;var t=new zn(e.engineSettings),n=t.getEngine(e.playerUri),i=Gn(n.options[Ln])||Gn(n.options[Bn]);return i})),c=(0,a.Fl)((function(){return Cn(e.playerUri)})),u=function(){if(Cn(e.playerUri)){var t=new zn(e.engineSettings),n=t.getEngine(e.playerUri);i.value=n}},l=function(e){i.value=null,t.emit("update-engine-setting",e)},h=function(){i.value=null},p=function(){t.emit("select-player",n.value.value)};return{playerSelect:n,ponderState:r,threadState:o,multiPVState:s,isPlayerSettingEnabled:c,engineSettingDialog:i,onPlayerChange:p,openPlayerSetting:u,savePlayerSetting:l,closePlayerSetting:h,Icon:Ji}}});const hu=(0,Rn.Z)(lu,[["render",Ac],["__scopeId","data-v-7083fac1"]]);var du=hu,pu=(0,a.aZ)({name:"GameDialog",components:{ButtonIcon:nr,PlayerSelector:du},setup:function(){var e=zi(),t=(0,d.iH)(null),n=(0,d.iH)(null),o=(0,d.iH)(null),s=(0,d.iH)(null),c=(0,d.iH)(null),u=(0,d.iH)(null),l=(0,d.iH)(null),h=(0,d.iH)(null),p=(0,d.iH)(Qn()),v=(0,d.iH)(new zn),f=(0,d.iH)(""),g=(0,d.iH)("");e.retainBussyState(),(0,a.bv)((0,i.Z)(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,oi.loadGameSetting();case 3:return p.value=n.sent,n.next=6,oi.loadUSIEngineSetting();case 6:v.value=n.sent,f.value=p.value.black.uri,g.value=p.value.white.uri,br(t.value),n.next=16;break;case 12:n.prev=12,n.t0=n["catch"](0),e.pushError(n.t0),e.closeModalDialog();case 16:return n.prev=16,e.releaseBussyState(),n.finish(16);case 19:case"end":return n.stop()}}),n,null,[[0,12,16,19]])}))));var m=!1;(0,a.ic)((function(){m||(n.value.value=Math.floor(p.value.timeLimit.timeSeconds/3600),o.value.value=Math.floor(p.value.timeLimit.timeSeconds/60)%60,s.value.value=p.value.timeLimit.byoyomi,c.value.value=p.value.timeLimit.increment,u.value.value=void 0!==p.value.startPosition?p.value.startPosition:"current",l.value.checked=p.value.enableEngineTimeout,h.value.checked=p.value.humanIsFront,m=!0)}));var _=function(e){if(Cn(e)){var t=v.value.getEngine(e);return{name:t.name,uri:e,usi:t}}return{name:"人",uri:Pn}},y=function(){var t={black:_(f.value),white:_(g.value),timeLimit:{timeSeconds:60*(60*dc(n.value)+dc(o.value)),byoyomi:dc(s.value),increment:dc(c.value)},startPosition:"current"!==u.value.value?u.value.value:void 0,enableEngineTimeout:l.value.checked,humanIsFront:h.value.checked},i=Xn(t);i?e.pushError(i):e.startGame(t)},S=function(){e.closeModalDialog()},w=function(){var t=(0,i.Z)(regeneratorRuntime.mark((function t(n){var i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return i=new zn(v.value.json),i.updateEngine(n),e.retainBussyState(),t.prev=3,t.next=6,oi.saveUSIEngineSetting(i);case 6:v.value=i,t.next=12;break;case 9:t.prev=9,t.t0=t["catch"](3),e.pushError(t.t0);case 12:return t.prev=12,e.releaseBussyState(),t.finish(12);case 15:case"end":return t.stop()}}),t,null,[[3,9,12,15]])})));return function(e){return t.apply(this,arguments)}}(),E=function(e){f.value=e},k=function(e){g.value=e},I=function(){var e=[g.value,f.value];f.value=e[0],g.value=e[1]},b=(0,a.Fl)((function(){return[{name:"人",uri:Pn}].concat((0,r.Z)(v.value.engineList))}));return{dialog:t,hours:n,minutes:o,byoyomi:s,increment:c,startPosition:u,enableEngineTimeout:l,humanIsFront:h,engineSettings:v,blackPlayerURI:f,whitePlayerURI:g,players:b,onStart:y,onCancel:S,onUpdatePlayerSetting:w,onSelectBlackPlayer:E,onSelectWhitePlayer:k,onSwapColor:I,Icon:Ji}}});const vu=(0,Rn.Z)(pu,[["render",hc],["__scopeId","data-v-c5c0e252"]]);var fu=vu,gu=function(e){return(0,a.dD)("data-v-34690848"),e=e(),(0,a.Cn)(),e},mu={ref:"dialog",class:"root"},_u=gu((function(){return(0,a._)("div",{class:"dialog-title"},"検討",-1)})),yu={class:"dialog-form-area"},Su={class:"dialog-form-item"},wu={class:"dialog-main-buttons"};function Eu(e,t,n,i,r,o){var s=(0,a.up)("PlayerSelector");return(0,a.wg)(),(0,a.iD)("div",null,[(0,a._)("dialog",mu,[_u,(0,a._)("div",yu,[(0,a._)("div",Su,[(0,a.Wm)(s,{players:e.engines,"player-uri":e.engineURI,"engine-settings":e.engineSettings.json,"display-thread-state":!0,"display-multi-pv-state":!0,onUpdateEngineSetting:e.onUpdatePlayerSetting,onSelectPlayer:e.onSelectPlayer},null,8,["players","player-uri","engine-settings","onUpdateEngineSetting","onSelectPlayer"])])]),(0,a._)("div",wu,[(0,a._)("button",{class:"dialog-button",onClick:t[0]||(t[0]=function(t){return e.onStart()})},"検討開始"),(0,a._)("button",{class:"dialog-button",onClick:t[1]||(t[1]=function(t){return e.onCancel()})},"キャンセル")])],512)])}var ku=(0,a.aZ)({name:"ResearchDialog",components:{PlayerSelector:du},setup:function(){var e=zi(),t=(0,d.iH)(null),n=(0,d.iH)(ei()),r=(0,d.iH)(new zn),o=(0,d.iH)("");e.retainBussyState(),(0,a.bv)((0,i.Z)(regeneratorRuntime.mark((function i(){var a;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return br(t.value),i.prev=1,i.next=4,oi.loadResearchSetting();case 4:return n.value=i.sent,i.next=7,oi.loadUSIEngineSetting();case 7:r.value=i.sent,o.value=(null===(a=n.value.usi)||void 0===a?void 0:a.uri)||"",i.next=15;break;case 11:i.prev=11,i.t0=i["catch"](1),e.pushError(i.t0),e.closeModalDialog();case 15:return i.prev=15,e.releaseBussyState(),i.finish(15);case 18:case"end":return i.stop()}}),i,null,[[1,11,15,18]])}))));var s=(0,a.Fl)((function(){return r.value.engineList})),c=function(){if(o.value&&r.value.hasEngine(o.value)){var t=r.value.getEngine(o.value),n={usi:t};e.startResearch(n)}else e.pushError("エンジンを選択してください。")},u=function(){e.closeModalDialog()},l=function(){var t=(0,i.Z)(regeneratorRuntime.mark((function t(n){var i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return i=new zn(r.value.json),i.updateEngine(n),e.retainBussyState(),t.prev=3,t.next=6,oi.saveUSIEngineSetting(i);case 6:r.value=i,t.next=12;break;case 9:t.prev=9,t.t0=t["catch"](3),e.pushError(t.t0);case 12:return t.prev=12,e.releaseBussyState(),t.finish(12);case 15:case"end":return t.stop()}}),t,null,[[3,9,12,15]])})));return function(e){return t.apply(this,arguments)}}(),h=function(e){o.value=e};return{dialog:t,engineSettings:r,engineURI:o,engines:s,onStart:c,onCancel:u,onUpdatePlayerSetting:l,onSelectPlayer:h}}});const Iu=(0,Rn.Z)(ku,[["render",Eu],["__scopeId","data-v-34690848"]]);var bu=Iu,Tu=function(e){return(0,a.dD)("data-v-9ca1beda"),e=e(),(0,a.Cn)(),e},Ru={ref:"dialog"},Au=Tu((function(){return(0,a._)("div",{class:"dialog-title"},"エンジン管理",-1)})),Nu={class:"dialog-form-area engine-list"},Pu={key:0,class:"engine"},Ou=["value"],Cu={class:"engine-name"},Hu=["onClick"],Mu=["onClick"],Lu=["onClick"],Du={class:"dialog-main-buttons"};function xu(e,t,n,i,r,o){var c=(0,a.up)("USIEngineOptionDialog");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a._)("div",null,[(0,a._)("dialog",Ru,[Au,(0,a._)("div",Nu,[0===e.engines.length?((0,a.wg)(),(0,a.iD)("div",Pu," エンジンが登録されていません。 ")):(0,a.kq)("",!0),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.engines,(function(t){return(0,a.wg)(),(0,a.iD)("div",{key:t.uri,class:"engine",value:t.uri},[(0,a._)("div",Cu,(0,s.zw)(t.name),1),(0,a._)("button",{onClick:function(n){return e.openOptions(t.uri)}},"設定",8,Hu),(0,a._)("button",{onClick:function(n){return e.duplicate(t.uri)}},"複製",8,Mu),(0,a._)("button",{onClick:function(n){return e.remove(t.uri)}},"削除",8,Lu)],8,Ou)})),128))]),(0,a._)("button",{class:"dialog-wide-button",onClick:t[0]||(t[0]=function(t){return e.add()})},"追加"),(0,a._)("div",Du,[(0,a._)("button",{class:"dialog-button",onClick:t[1]||(t[1]=function(t){return e.saveAndClose()})}," 保存して閉じる "),(0,a._)("button",{class:"dialog-button",onClick:t[2]||(t[2]=function(t){return e.cancel()})},"キャンセル")])],512)]),e.optionDialog?((0,a.wg)(),(0,a.j4)(c,{key:0,"latest-engine-setting":e.optionDialog,onOk:e.optionOk,onCancel:e.optionCancel},null,8,["latest-engine-setting","onOk","onCancel"])):(0,a.kq)("",!0)],64)}var Bu=(0,a.aZ)({name:"USIEngineManagementDialog",components:{USIEngineOptionDialog:uu},setup:function(){var e=zi(),t=(0,d.iH)(null),n=(0,d.iH)(null),r=(0,d.iH)(new zn);e.retainBussyState(),(0,a.bv)((0,i.Z)(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return br(t.value),n.prev=1,n.next=4,oi.loadUSIEngineSetting();case 4:r.value=n.sent,n.next=11;break;case 7:n.prev=7,n.t0=n["catch"](1),e.pushError(n.t0),e.closeModalDialog();case 11:return n.prev=11,e.releaseBussyState(),n.finish(11);case 14:case"end":return n.stop()}}),n,null,[[1,7,11,14]])}))));var o=function(){var t=(0,i.Z)(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,e.retainBussyState(),t.next=4,oi.showSelectUSIEngineDialog();case 4:if(n=t.sent,n){t.next=7;break}return t.abrupt("return");case 7:return t.t0=r.value,t.next=10,oi.getUSIEngineInfo(n);case 10:t.t1=t.sent,t.t0.addEngine.call(t.t0,t.t1),t.next=17;break;case 14:t.prev=14,t.t2=t["catch"](0),e.pushError(t.t2);case 17:return t.prev=17,e.releaseBussyState(),t.finish(17);case 20:case"end":return t.stop()}}),t,null,[[0,14,17,20]])})));return function(){return t.apply(this,arguments)}}(),s=function(e){r.value.removeEngine(e)},c=function(e){n.value=r.value.getEngine(e)},u=function(e){var t=r.value.getEngine(e),n=Zn(t);r.value.addEngine(n)},l=function(){var t=(0,i.Z)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,e.retainBussyState(),t.next=4,oi.saveUSIEngineSetting(r.value);case 4:e.closeModalDialog(),t.next=10;break;case 7:t.prev=7,t.t0=t["catch"](0),e.pushError(t.t0);case 10:return t.prev=10,e.releaseBussyState(),t.finish(10);case 13:case"end":return t.stop()}}),t,null,[[0,7,10,13]])})));return function(){return t.apply(this,arguments)}}(),h=function(){e.closeModalDialog()},p=function(e){r.value.updateEngine(e),n.value=null},v=function(){n.value=null},f=(0,a.Fl)((function(){return r.value.engineList}));return{optionDialog:n,dialog:t,engines:f,add:o,remove:s,openOptions:c,duplicate:u,saveAndClose:l,cancel:h,optionOk:p,optionCancel:v}}});const Gu=(0,Rn.Z)(Bu,[["render",xu],["__scopeId","data-v-9ca1beda"]]);var Zu=Gu,Wu=function(e){return(0,a.dD)("data-v-4393f78a"),e=e(),(0,a.Cn)(),e},Uu={ref:"dialog"},Ku=Wu((function(){return(0,a._)("div",{class:"dialog-title"},"アプリ設定",-1)})),Fu={class:"dialog-form-area settings"},qu={class:"section"},ju=Wu((function(){return(0,a._)("div",{class:"section-title"},"外観",-1)})),Vu={class:"dialog-form-item"},zu=Wu((function(){return(0,a._)("div",{class:"dialog-form-item-label-wide"},"テーマ",-1)})),Yu=["value"],Ju=["value"],$u={class:"dialog-form-item"},Qu=Wu((function(){return(0,a._)("div",{class:"dialog-form-item-label-wide"},"駒画像",-1)})),Xu=["value"],el=["value"],tl={class:"dialog-form-item"},nl=Wu((function(){return(0,a._)("div",{class:"dialog-form-item-label-wide"},"盤画像",-1)})),il=["value"],rl=["value"],ol={class:"dialog-form-item"},al=Wu((function(){return(0,a._)("div",{class:"dialog-form-item-label-wide"},"段・筋を表示",-1)})),sl=["checked"],cl=Wu((function(){return(0,a._)("hr",{class:"separator"},null,-1)})),ul={class:"section"},ll=Wu((function(){return(0,a._)("div",{class:"section-title"},"音",-1)})),hl={class:"dialog-form-item"},dl=Wu((function(){return(0,a._)("div",{class:"dialog-form-item-label-wide"},"駒音の大きさ",-1)})),pl=["value"],vl=Wu((function(){return(0,a._)("div",{class:"dialog-form-item-unit"},"%",-1)})),fl={class:"dialog-form-item"},gl=Wu((function(){return(0,a._)("div",{class:"dialog-form-item-label-wide"},"時計音の大きさ",-1)})),ml=["value"],_l=Wu((function(){return(0,a._)("div",{class:"dialog-form-item-unit"},"%",-1)})),yl={class:"dialog-form-item"},Sl=Wu((function(){return(0,a._)("div",{class:"dialog-form-item-label-wide"},"時計音の高さ",-1)})),wl=["value"],El=Wu((function(){return(0,a._)("div",{class:"dialog-form-item-unit"},"Hz (220 ~ 880)",-1)})),kl={class:"dialog-form-item"},Il=Wu((function(){return(0,a._)("div",{class:"dialog-form-item-label-wide"},"時計音の対象",-1)})),bl=["value"],Tl=Wu((function(){return(0,a._)("option",{value:"all"},"全ての手番",-1)})),Rl=Wu((function(){return(0,a._)("option",{value:"onlyUser"},"人の手番のみ",-1)})),Al=[Tl,Rl],Nl=Wu((function(){return(0,a._)("hr",{class:"separator"},null,-1)})),Pl={class:"section"},Ol=Wu((function(){return(0,a._)("div",{class:"section-title"},"ファイル",-1)})),Cl={class:"dialog-form-item"},Hl=Wu((function(){return(0,a._)("div",{class:"dialog-form-item-label-wide"},"改行文字",-1)})),Ml=["value"],Ll=Wu((function(){return(0,a._)("option",{value:"crlf"},"CR + LF (Windows)",-1)})),Dl=Wu((function(){return(0,a._)("option",{value:"lf"},"LF (UNIX/Mac)",-1)})),xl=Wu((function(){return(0,a._)("option",{value:"cr"},"CR (90年代Mac)",-1)})),Bl=[Ll,Dl,xl],Gl=Wu((function(){return(0,a._)("hr",{class:"separator"},null,-1)})),Zl={class:"section"},Wl=Wu((function(){return(0,a._)("div",{class:"section-title"},"評価値・期待勝率",-1)})),Ul={class:"dialog-form-item"},Kl=Wu((function(){return(0,a._)("div",{class:"dialog-form-item-label-wide"},"勝率換算係数",-1)})),Fl=["value"],ql=Wu((function(){return(0,a._)("div",{class:"dialog-form-item-unit"},"(推奨: 600 から 1500 まで)",-1)})),jl={class:"dialog-form-item"},Vl=Wu((function(){return(0,a._)("div",{class:"dialog-form-item-label-wide"},"緩手の閾値",-1)})),zl=["value"],Yl=Wu((function(){return(0,a._)("div",{class:"dialog-form-item-unit"},"%",-1)})),Jl={class:"dialog-form-item"},$l=Wu((function(){return(0,a._)("div",{class:"dialog-form-item-label-wide"},"疑問手の閾値",-1)})),Ql=["value"],Xl=Wu((function(){return(0,a._)("div",{class:"dialog-form-item-unit"},"%",-1)})),eh={class:"dialog-form-item"},th=Wu((function(){return(0,a._)("div",{class:"dialog-form-item-label-wide"},"悪手の閾値",-1)})),nh=["value"],ih=Wu((function(){return(0,a._)("div",{class:"dialog-form-item-unit"},"%",-1)})),rh={class:"dialog-form-item"},oh=Wu((function(){return(0,a._)("div",{class:"dialog-form-item-label-wide"},"大悪手の閾値",-1)})),ah=["value"],sh=Wu((function(){return(0,a._)("div",{class:"dialog-form-item-unit"},"%",-1)})),ch=Wu((function(){return(0,a._)("hr",{class:"separator"},null,-1)})),uh={class:"section"},lh=Wu((function(){return(0,a._)("div",{class:"section-title"},"開発者向け",-1)})),hh={class:"dialog-form-item"},dh=Wu((function(){return(0,a._)("div",{class:"dialog-form-item-label-wide"},"アプリログを出力",-1)})),ph=["checked"],vh={key:0,class:"dialog-form-item-unit"},fh={key:1,class:"dialog-form-item-unit"},gh={class:"dialog-form-item"},mh=Wu((function(){return(0,a._)("div",{class:"dialog-form-item-label-wide"},"USI通信ログを出力",-1)})),_h=["checked"],yh={key:0,class:"dialog-form-item-unit"},Sh={key:1,class:"dialog-form-item-unit"},wh={class:"dialog-main-buttons"};function Eh(e,t,n,i,r,o){return(0,a.wg)(),(0,a.iD)("div",null,[(0,a._)("dialog",Uu,[Ku,(0,a._)("div",Fu,[(0,a._)("div",qu,[ju,(0,a._)("div",Vu,[zu,(0,a._)("select",{ref:"thema",value:e.appSetting.thema},[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.themaOptions,(function(e){return(0,a.wg)(),(0,a.iD)("option",{key:e.value,value:e.value},(0,s.zw)(e.name),9,Ju)})),128))],8,Yu)]),(0,a._)("div",$u,[Qu,(0,a._)("select",{ref:"pieceImage",value:e.appSetting.pieceImage},[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.pieceImageTypes,(function(e){return(0,a.wg)(),(0,a.iD)("option",{key:e.value,value:e.value},(0,s.zw)(e.name),9,el)})),128))],8,Xu)]),(0,a._)("div",tl,[nl,(0,a._)("select",{ref:"boardImage",value:e.appSetting.boardImage},[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.boardImageTypes,(function(e){return(0,a.wg)(),(0,a.iD)("option",{key:e.value,value:e.value},(0,s.zw)(e.name),9,rl)})),128))],8,il)]),(0,a._)("div",ol,[al,(0,a._)("input",{ref:"displayBoardLabels",class:"toggle",checked:e.appSetting.boardLabelType!=e.BoardLabelType.NONE,type:"checkbox"},null,8,sl)])]),cl,(0,a._)("div",ul,[ll,(0,a._)("div",hl,[dl,(0,a._)("input",{ref:"pieceVolume",value:e.appSetting.pieceVolume,type:"number",max:"100",min:"0"},null,8,pl),vl]),(0,a._)("div",fl,[gl,(0,a._)("input",{ref:"clockVolume",value:e.appSetting.clockVolume,type:"number",max:"100",min:"0"},null,8,ml),_l]),(0,a._)("div",yl,[Sl,(0,a._)("input",{ref:"clockPitch",value:e.appSetting.clockPitch,type:"number",max:"880",min:"220"},null,8,wl),El]),(0,a._)("div",kl,[Il,(0,a._)("select",{ref:"clockSoundTarget",value:e.appSetting.clockSoundTarget},Al,8,bl)])]),Nl,(0,a._)("div",Pl,[Ol,(0,a._)("div",Cl,[Hl,(0,a._)("select",{ref:"returnCode",value:e.appSetting.returnCode},Bl,8,Ml)])]),Gl,(0,a._)("div",Zl,[Wl,(0,a._)("div",Ul,[Kl,(0,a._)("input",{ref:"coefficientInSigmoid",value:e.appSetting.coefficientInSigmoid,type:"number",max:"10000",min:"1"},null,8,Fl),ql]),(0,a._)("div",jl,[Vl,(0,a._)("input",{ref:"badMoveLevelThreshold1",value:e.appSetting.badMoveLevelThreshold1,type:"number",max:"100",min:"0"},null,8,zl),Yl]),(0,a._)("div",Jl,[$l,(0,a._)("input",{ref:"badMoveLevelThreshold2",value:e.appSetting.badMoveLevelThreshold2,type:"number",max:"100",min:"0"},null,8,Ql),Xl]),(0,a._)("div",eh,[th,(0,a._)("input",{ref:"badMoveLevelThreshold3",value:e.appSetting.badMoveLevelThreshold3,type:"number",max:"100",min:"0"},null,8,nh),ih]),(0,a._)("div",rh,[oh,(0,a._)("input",{ref:"badMoveLevelThreshold4",value:e.appSetting.badMoveLevelThreshold4,type:"number",max:"100",min:"0"},null,8,ah),sh])]),ch,(0,a._)("div",uh,[lh,(0,a._)("div",hh,[dh,(0,a._)("input",{ref:"enableAppLog",class:"toggle",checked:e.appSetting.enableAppLog,type:"checkbox"},null,8,ph),e.isNative?((0,a.wg)(),(0,a.iD)("div",vh," （再起動後に反映） ")):(0,a.kq)("",!0),e.isNative?(0,a.kq)("",!0):((0,a.wg)(),(0,a.iD)("div",fh," （ブラウザ版では機能しません） "))]),(0,a._)("div",gh,[mh,(0,a._)("input",{ref:"enableUSILog",class:"toggle",checked:e.appSetting.enableUSILog,type:"checkbox"},null,8,_h),e.isNative?((0,a.wg)(),(0,a.iD)("div",yh," （再起動後に反映） ")):(0,a.kq)("",!0),e.isNative?(0,a.kq)("",!0):((0,a.wg)(),(0,a.iD)("div",Sh," （ブラウザ版では機能しません） "))])])]),(0,a._)("div",wh,[(0,a._)("button",{class:"dialog-button",onClick:t[0]||(t[0]=function(t){return e.saveAndClose()})}," 保存して閉じる "),(0,a._)("button",{class:"dialog-button",onClick:t[1]||(t[1]=function(t){return e.cancel()})},"キャンセル")])],512)])}var kh={"\r\n":"crlf","\n":"lf","\r":"cr"},Ih={crlf:"\r\n",lf:"\n",cr:"\r"},bh=(0,a.aZ)({name:"AppSettingDialog",setup:function(){var e=zi(),t=(0,d.iH)(null),n=(0,d.iH)(null),r=(0,d.iH)(null),o=(0,d.iH)(null),s=(0,d.iH)(null),c=(0,d.iH)(null),u=(0,d.iH)(null),l=(0,d.iH)(null),h=(0,d.iH)(null),p=(0,d.iH)(null),v=(0,d.iH)(null),f=(0,d.iH)(null),g=(0,d.iH)(null),m=(0,d.iH)(null),_=(0,d.iH)(null),y=(0,d.iH)(null),S=(0,d.iH)(null);(0,a.bv)((function(){br(t.value)}));var w=function(){var t=(0,i.Z)(regeneratorRuntime.mark((function t(){var i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return i={thema:n.value.value,pieceImage:r.value.value,boardImage:o.value.value,boardLabelType:s.value.checked?mn.STANDARD:mn.NONE,pieceVolume:dc(c.value),clockVolume:dc(u.value),clockPitch:dc(l.value),clockSoundTarget:h.value.value,returnCode:Ih[p.value.value],coefficientInSigmoid:dc(v.value),badMoveLevelThreshold1:dc(f.value),badMoveLevelThreshold2:dc(g.value),badMoveLevelThreshold3:dc(m.value),badMoveLevelThreshold4:dc(_.value),enableAppLog:y.value.checked,enableUSILog:S.value.checked},e.retainBussyState(),t.prev=2,t.next=5,e.updateAppSetting(i);case 5:e.closeAppSettingDialog(),t.next=11;break;case 8:t.prev=8,t.t0=t["catch"](2),e.pushError(t.t0);case 11:return t.prev=11,e.releaseBussyState(),t.finish(11);case 14:case"end":return t.stop()}}),t,null,[[2,8,11,14]])})));return function(){return t.apply(this,arguments)}}(),E=function(){e.closeAppSettingDialog()},k=(0,a.Fl)((function(){return(0,un.Z)((0,un.Z)({},e.appSetting),{},{returnCode:kh[e.appSetting.returnCode]})})),I=[{name:"標準（緑）",value:Kn.STANDARD},{name:"桜",value:Kn.CHERRY_BLOSSOM},{name:"ダーク",value:Kn.DARK}],b=[{name:"一文字駒",value:fn.HITOMOJI},{name:"一文字駒（ゴシック体）",value:fn.HITOMOJI_GOTHIC},{name:"一文字駒（ダーク）",value:fn.HITOMOJI_DARK},{name:"一文字駒（ゴシック体・ダーク）",value:fn.HITOMOJI_GOTHIC_DARK}],T=[{name:"木目（明るい）",value:gn.LIGHT},{name:"木目（暖かい）",value:gn.WARM},{name:"塩化ビニル",value:gn.RESIN},{name:"ダーク",value:gn.DARK}];return{BoardLabelType:mn,dialog:t,thema:n,pieceImage:r,boardImage:o,displayBoardLabels:s,pieceVolume:c,clockVolume:u,clockPitch:l,clockSoundTarget:h,returnCode:p,coefficientInSigmoid:v,badMoveLevelThreshold1:f,badMoveLevelThreshold2:g,badMoveLevelThreshold3:m,badMoveLevelThreshold4:_,enableAppLog:y,enableUSILog:S,appSetting:k,themaOptions:I,pieceImageTypes:b,boardImageTypes:T,isNative:ai(),saveAndClose:w,cancel:E}}});const Th=(0,Rn.Z)(bh,[["render",Eh],["__scopeId","data-v-4393f78a"]]);var Rh=Th,Ah=function(e){return(0,a.dD)("data-v-4490b135"),e=e(),(0,a.Cn)(),e},Nh={ref:"dialog"},Ph={ref:"content"},Oh={class:"dialog-form-area"},Ch=Ah((function(){return(0,a._)("div",{class:"message"},"以下の棋譜(または局面)を取り込みます。",-1)})),Hh=Ah((function(){return(0,a._)("div",{class:"message"},"※KIF形式/CSA形式/SFENに対応しています。",-1)})),Mh={key:0,class:"message"},Lh=(0,a.Uk)(" ※テキストエリアに棋譜を貼り付けてください。"),Dh=Ah((function(){return(0,a._)("br",null,null,-1)})),xh=(0,a.Uk)(" ※インストールアプリ版では自動的に貼り付けられます。 "),Bh=[Lh,Dh,xh],Gh={ref:"textarea"},Zh={class:"dialog-main-buttons"};function Wh(e,t,n,i,r,o){return(0,a.wg)(),(0,a.iD)("div",null,[(0,a._)("dialog",Nh,[(0,a._)("div",Ph,[(0,a._)("div",Oh,[Ch,Hh,e.isNative?(0,a.kq)("",!0):((0,a.wg)(),(0,a.iD)("div",Mh,Bh)),(0,a._)("textarea",Gh,null,512)])],512),(0,a._)("div",Zh,[(0,a._)("button",{class:"dialog-button",onClick:t[0]||(t[0]=function(){return e.onOk&&e.onOk.apply(e,arguments)})},"取り込む"),(0,a._)("button",{class:"dialog-button",onClick:t[1]||(t[1]=function(){return e.onCancel&&e.onCancel.apply(e,arguments)})},"キャンセル")])],512)])}var Uh=(0,a.aZ)({name:"PasteDialog",setup:function(){var e=zi(),t=(0,d.iH)(null),n=(0,d.iH)(null);e.retainBussyState(),(0,a.bv)((0,i.Z)(regeneratorRuntime.mark((function i(){return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:if(i.prev=0,br(t.value),!ai()){i.next=6;break}return i.next=5,navigator.clipboard.readText();case 5:n.value.value=i.sent;case 6:return i.prev=6,e.releaseBussyState(),i.finish(6);case 9:case"end":return i.stop()}}),i,null,[[0,,6,9]])}))));var r=function(){var t=n.value.value;e.closeModalDialog(),t&&e.pasteRecord(t)},o=function(){e.closeModalDialog()};return{dialog:t,textarea:n,onOk:r,onCancel:o,isNative:ai()}}});const Kh=(0,Rn.Z)(Uh,[["render",Wh],["__scopeId","data-v-4490b135"]]);var Fh=Kh,qh=function(e){return(0,a.dD)("data-v-71bd87cb"),e=e(),(0,a.Cn)(),e},jh={ref:"dialog",class:"bussy"},Vh={class:"content"},zh=qh((function(){return(0,a._)("div",{class:"message"},"処理中です。お待ち下さい。",-1)}));function Yh(e,t,n,i,r,o){var s=(0,a.up)("ButtonIcon");return(0,a.wg)(),(0,a.iD)("div",null,[(0,a._)("dialog",jh,[(0,a._)("div",Vh,[(0,a.Wm)(s,{class:"icon",icon:e.Icon.BUSSY},null,8,["icon"]),zh])],512)])}var Jh=(0,a.aZ)({name:"BussyMessage",components:{ButtonIcon:nr},setup:function(){var e=(0,d.iH)(null);return(0,a.bv)((function(){br(e.value)})),{dialog:e,Icon:Ji}}});const $h=(0,Rn.Z)(Jh,[["render",Yh],["__scopeId","data-v-71bd87cb"]]);var Qh=$h,Xh={ref:"dialog",class:"confirm"},ed={class:"content"},td={class:"message"},nd={class:"dialog-main-buttons"};function id(e,t,n,i,r,o){var c=(0,a.up)("ButtonIcon");return(0,a.wg)(),(0,a.iD)("div",null,[(0,a._)("dialog",Xh,[(0,a._)("div",ed,[(0,a.Wm)(c,{class:"icon",icon:e.Icon.QUESTION},null,8,["icon"]),(0,a._)("div",td,(0,s.zw)(e.message),1)]),(0,a._)("div",nd,[(0,a._)("button",{class:"dialog-button",onClick:t[0]||(t[0]=function(t){return e.onOk()})},"OK"),(0,a._)("button",{class:"dialog-button",onClick:t[1]||(t[1]=function(t){return e.onClose()})},"キャンセル")])],512)])}var rd=(0,a.aZ)({name:"InfoMessage",components:{ButtonIcon:nr},setup:function(){var e=zi(),t=(0,d.iH)(null),n=(0,a.Fl)((function(){return e.confirmation}));(0,a.bv)((function(){br(t.value)}));var i=function(){e.confirmationOk()},r=function(){e.confirmationCancel()};return{dialog:t,message:n,onOk:i,onClose:r,Icon:Ji}}});const od=(0,Rn.Z)(rd,[["render",id],["__scopeId","data-v-7ae26b4e"]]);var ad=od,sd={ref:"dialog",class:"info"},cd={class:"content"},ud={class:"message"},ld={class:"dialog-main-buttons"};function hd(e,t,n,i,r,o){var c=(0,a.up)("ButtonIcon");return(0,a.wg)(),(0,a.iD)("div",null,[(0,a._)("dialog",sd,[(0,a._)("div",cd,[(0,a.Wm)(c,{class:"icon",icon:e.Icon.INFO},null,8,["icon"]),(0,a._)("div",ud,(0,s.zw)(e.message),1)]),(0,a._)("div",ld,[(0,a._)("button",{onClick:t[0]||(t[0]=function(t){return e.onClose()})},"閉じる")])],512)])}var dd=(0,a.aZ)({name:"InfoMessage",components:{ButtonIcon:nr},setup:function(){var e=zi(),t=(0,d.iH)(null);(0,a.bv)((function(){br(t.value)}));var n=(0,a.Fl)((function(){return e.message})),i=function(){e.dequeueMessage()};return{dialog:t,message:n,onClose:i,Icon:Ji}}});const pd=(0,Rn.Z)(dd,[["render",hd],["__scopeId","data-v-2d54feb7"]]);var vd=pd,fd={ref:"dialog",class:"error"},gd={class:"content"},md={class:"items"},_d={class:"notice"},yd={class:"index"},Sd={class:"message"},wd={class:"dialog-main-buttons"};function Ed(e,t,n,i,r,o){var c=(0,a.up)("ButtonIcon");return(0,a.wg)(),(0,a.iD)("div",null,[(0,a._)("dialog",fd,[(0,a._)("div",gd,[(0,a.Wm)(c,{class:"icon",icon:e.Icon.ERROR},null,8,["icon"]),(0,a._)("div",md,[(0,a._)("div",_d,(0,s.zw)(e.errors.length)+" 件のエラーが発生しました。 ",1),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.errors,(function(e){return(0,a.wg)(),(0,a.iD)("div",{key:e.index,class:"item"},[(0,a._)("p",yd,(0,s.zw)(e.index+1)+" 件目",1),(0,a._)("p",Sd,(0,s.zw)(e.message),1)])})),128))])]),(0,a._)("div",wd,[(0,a._)("button",{onClick:t[0]||(t[0]=function(t){return e.onClose()})},"閉じる")])],512)])}var kd=(0,a.aZ)({name:"ErrorMessage",components:{ButtonIcon:nr},setup:function(){var e=zi(),t=(0,d.iH)(null);(0,a.bv)((function(){br(t.value)}));var n=(0,a.Fl)((function(){return e.errors.map((function(e,t){return{message:e.message,index:t}}))})),i=function(){e.clearErrors()};return{dialog:t,errors:n,onClose:i,Icon:Ji}}});const Id=(0,Rn.Z)(kd,[["render",Ed],["__scopeId","data-v-1a5cd743"]]);var bd=Id;function Td(){var e=document.activeElement;return e instanceof HTMLTextAreaElement||e instanceof HTMLInputElement||e instanceof HTMLSelectElement}function Rd(e,t){if(!Td())switch(e){case"ArrowUp":return t.onArrowUp;case"ArrowDown":return t.onArrowDown;case"ArrowLeft":return t.onArrowLeft;case"ArrowRight":return t.onArrowRight}}function Ad(e){document.addEventListener("keydown",(function(t){var n=Rd(t.key,e);n&&(t.preventDefault(),n())}))}var Nd=function(e){return(0,a.dD)("data-v-155615cc"),e=e(),(0,a.Cn)(),e},Pd={ref:"dialog",class:"root"},Od=Nd((function(){return(0,a._)("div",{class:"dialog-title"},"棋譜解析",-1)})),Cd={class:"dialog-form-area"},Hd=Nd((function(){return(0,a._)("div",null,"エンジン",-1)})),Md={class:"dialog-form-item"},Ld={class:"dialog-form-area"},Dd=Nd((function(){return(0,a._)("div",null,"開始条件",-1)})),xd={class:"dialog-form-item"},Bd=["checked"],Gd=["disabled","value"],Zd=Nd((function(){return(0,a._)("div",{class:"dialog-form-item-unit"},"手目から",-1)})),Wd={class:"dialog-form-area"},Ud=Nd((function(){return(0,a._)("div",null,"終了条件",-1)})),Kd={class:"dialog-form-item"},Fd=["checked"],qd=["disabled","value"],jd=Nd((function(){return(0,a._)("div",{class:"dialog-form-item-unit"},"手目まで",-1)})),Vd={class:"dialog-form-area"},zd=Nd((function(){return(0,a._)("div",null,"局面ごとの終了条件",-1)})),Yd={class:"dialog-form-item"},Jd=["value"],$d=Nd((function(){return(0,a._)("div",{class:"dialog-form-item-unit"},"秒まで",-1)})),Qd={class:"dialog-form-area"},Xd=Nd((function(){return(0,a._)("div",null,"出力設定",-1)})),ep={class:"dialog-form-item"},tp=Nd((function(){return(0,a._)("div",{class:"dialog-item-label"},"指し手コメント:",-1)})),np=["value"],ip=Nd((function(){return(0,a._)("option",{value:"none"},"出力しない",-1)})),rp=Nd((function(){return(0,a._)("option",{value:"insert"},"前方に加筆する",-1)})),op=Nd((function(){return(0,a._)("option",{value:"append"},"末尾に加筆する",-1)})),ap=Nd((function(){return(0,a._)("option",{value:"overwrite"},"上書きする",-1)})),sp=[ip,rp,op,ap],cp={class:"dialog-main-buttons"};function up(e,t,n,i,r,o){var s=(0,a.up)("PlayerSelector");return(0,a.wg)(),(0,a.iD)("div",null,[(0,a._)("dialog",Pd,[Od,(0,a._)("div",Cd,[Hd,(0,a._)("div",Md,[(0,a.Wm)(s,{players:e.engines,"player-uri":e.engineURI,"engine-settings":e.engineSettings.json,"display-thread-state":!0,"display-multi-pv-state":!0,onUpdateEngineSetting:e.onUpdatePlayerSetting,onSelectPlayer:e.onSelectPlayer},null,8,["players","player-uri","engine-settings","onUpdateEngineSetting","onSelectPlayer"])])]),(0,a._)("div",Ld,[Dd,(0,a._)("div",xd,[(0,a._)("input",{ref:"enableStartNumber",class:"toggle",type:"checkbox",checked:e.defaultValues.enableStartNumber,onChange:t[0]||(t[0]=function(){return e.updateToggle&&e.updateToggle.apply(e,arguments)})},null,40,Bd),(0,a._)("input",{ref:"startNumber",class:"small",type:"number",min:"1",step:"1",disabled:!e.defaultValues.enableStartNumber,value:e.defaultValues.startNumber},null,8,Gd),Zd])]),(0,a._)("div",Wd,[Ud,(0,a._)("div",Kd,[(0,a._)("input",{ref:"enableEndNumber",class:"toggle",type:"checkbox",checked:e.defaultValues.enableEndNumber,onChange:t[1]||(t[1]=function(){return e.updateToggle&&e.updateToggle.apply(e,arguments)})},null,40,Fd),(0,a._)("input",{ref:"endNumber",class:"small",type:"number",min:"1",step:"1",disabled:!e.defaultValues.enableEndNumber,value:e.defaultValues.endNumber},null,8,qd),jd])]),(0,a._)("div",Vd,[zd,(0,a._)("div",Yd,[(0,a._)("input",{ref:"maxSecondsPerMove",class:"small",type:"number",min:"0",step:"1",value:e.defaultValues.maxSecondsPerMove},null,8,Jd),$d])]),(0,a._)("div",Qd,[Xd,(0,a._)("div",ep,[tp,(0,a._)("select",{ref:"commentBehavior",size:"1",value:e.defaultValues.commentBehavior},sp,8,np)])]),(0,a._)("div",cp,[(0,a._)("button",{class:"dialog-button",onClick:t[2]||(t[2]=function(t){return e.onStart()})},"解析実行"),(0,a._)("button",{class:"dialog-button",onClick:t[3]||(t[3]=function(t){return e.onCancel()})},"キャンセル")])],512)])}var lp=(0,a.aZ)({name:"ResearchDialog",components:{PlayerSelector:du},setup:function(){var e=zi(),t=(0,d.iH)(null),n=(0,d.iH)(null),r=(0,d.iH)(null),o=(0,d.iH)(null),s=(0,d.iH)(null),c=(0,d.iH)(null),u=(0,d.iH)(null),l=(0,d.iH)(Yn()),h=(0,d.iH)(new zn),p=(0,d.iH)("");e.retainBussyState(),(0,a.bv)((0,i.Z)(regeneratorRuntime.mark((function n(){var i;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return br(t.value),n.prev=1,n.next=4,oi.loadAnalysisSetting();case 4:return l.value=n.sent,n.next=7,oi.loadUSIEngineSetting();case 7:h.value=n.sent,p.value=(null===(i=l.value.usi)||void 0===i?void 0:i.uri)||"",n.next=15;break;case 11:n.prev=11,n.t0=n["catch"](1),e.pushError(n.t0),e.closeModalDialog();case 15:return n.prev=15,e.releaseBussyState(),n.finish(15);case 18:case"end":return n.stop()}}),n,null,[[1,11,15,18]])}))));var v=function(){r.value.disabled=!n.value.checked,s.value.disabled=!o.value.checked},f=function(){if(p.value&&h.value.hasEngine(p.value)){var t=h.value.getEngine(p.value),i={usi:t,startCriteria:{enableNumber:n.value.checked,number:dc(r.value)},endCriteria:{enableNumber:o.value.checked,number:dc(s.value)},perMoveCriteria:{maxSeconds:dc(c.value)},commentBehavior:u.value.value};e.startAnalysis(i)}else e.pushError("エンジンを選択してください。")},g=function(){e.closeModalDialog()},m=function(){var t=(0,i.Z)(regeneratorRuntime.mark((function t(n){var i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return i=new zn(h.value.json),i.updateEngine(n),e.retainBussyState(),t.prev=3,t.next=6,oi.saveUSIEngineSetting(i);case 6:h.value=i,t.next=12;break;case 9:t.prev=9,t.t0=t["catch"](3),e.pushError(t.t0);case 12:return t.prev=12,e.releaseBussyState(),t.finish(12);case 15:case"end":return t.stop()}}),t,null,[[3,9,12,15]])})));return function(e){return t.apply(this,arguments)}}(),_=function(e){p.value=e},y=(0,a.Fl)((function(){return h.value.engineList})),S=(0,a.Fl)((function(){return{enableStartNumber:l.value.startCriteria.enableNumber,startNumber:l.value.startCriteria.number,enableEndNumber:l.value.endCriteria.enableNumber,endNumber:l.value.endCriteria.number,maxSecondsPerMove:l.value.perMoveCriteria.maxSeconds,commentBehavior:l.value.commentBehavior}}));return{dialog:t,engineSettings:h,engineURI:p,enableStartNumber:n,startNumber:r,enableEndNumber:o,endNumber:s,maxSecondsPerMove:c,commentBehavior:u,engines:y,defaultValues:S,updateToggle:v,onStart:f,onCancel:g,onUpdatePlayerSetting:m,onSelectPlayer:_}}});const hp=(0,Rn.Z)(lp,[["render",up],["__scopeId","data-v-155615cc"]]);var dp=hp,pp=(0,a.aZ)({name:"App",components:{StandardLayout:bs,GameDialog:fu,ResearchDialog:bu,USIEngineManagementDialog:Zu,AppSettingDialog:Rh,PasteDialog:Fh,BussyMessage:Qh,ConfirmDialog:ad,InfoMessage:vd,ErrorMessage:bd,AnalysisDialog:dp},setup:function(){var e=zi(),t=(0,a.Fl)((function(){return e.appSetting.thema})),n=(0,a.Fl)((function(){return{game:e.appState===Hi.GAME_DIALOG,research:e.appState===Hi.RESEARCH_DIALOG,analysis:e.appState===Hi.ANALYSIS_DIALOG,usiEngineSetting:e.appState===Hi.USI_ENGINE_SETTING_DIALOG,appSetting:e.isAppSettingDialogVisible,paste:e.appState===Hi.PASTE_DIALOG,bussy:e.isBussy,confirm:void 0!==e.confirmation}})),i=(0,a.Fl)((function(){return e.hasMessage})),r=(0,a.Fl)((function(){return e.hasError}));return(0,a.bv)((function(){var t=document.getElementsByTagName("body")[0];t.addEventListener("copy",(function(t){e.copyRecordKIF(),t.preventDefault()})),t.addEventListener("paste",(function(t){e.showPasteDialog(),t.preventDefault()})),t.addEventListener("dragover",(function(e){e.preventDefault()})),t.addEventListener("drop",(function(t){if(t.dataTransfer&&t.dataTransfer.files[0]){var n=t.dataTransfer.files[0].path;e.openRecord(n)}t.preventDefault()})),Ad({onArrowUp:function(){var t=e.record.current.number;e.changeMoveNumber(t-1)},onArrowDown:function(){var t=e.record.current.number;e.changeMoveNumber(t+1)},onArrowLeft:function(){e.changeMoveNumber(0)},onArrowRight:function(){e.changeMoveNumber(Number.MAX_SAFE_INTEGER)}})})),{thema:t,dialogVisibilities:n,hasMessage:i,hasErrors:r}}});const vp=(0,Rn.Z)(pp,[["render",c],["__scopeId","data-v-6e2058ba"]]);var fp,gp=vp;function mp(){var e=zi();ii.onSendError((function(t){e.pushError(t)})),ii.onMenuEvent((function(t){if(!e.isBussy)switch(t){case fp.NEW_RECORD:e.newRecord();break;case fp.OPEN_RECORD:e.openRecord();break;case fp.SAVE_RECORD:e.saveRecord({overwrite:!0});break;case fp.SAVE_RECORD_AS:e.saveRecord();break;case fp.COPY_RECORD:e.copyRecordKIF();break;case fp.COPY_RECORD_CSA:e.copyRecordCSA();break;case fp.COPY_RECORD_USI_BEFORE:e.copyRecordUSIBefore();break;case fp.COPY_RECORD_USI_ALL:e.copyRecordUSIAll();break;case fp.COPY_BOARD_SFEN:e.copyBoardSFEN();break;case fp.PASTE_RECORD:e.showPasteDialog();break;case fp.INSERT_INTERRUPT:e.insertSpecialMove(Xe.INTERRUPT);break;case fp.INSERT_RESIGN:e.insertSpecialMove(Xe.RESIGN);break;case fp.INSERT_DRAW:e.insertSpecialMove(Xe.DRAW);break;case fp.INSERT_REPETITION_DRAW:e.insertSpecialMove(Xe.REPETITION_DRAW);break;case fp.INSERT_MATE:e.insertSpecialMove(Xe.MATE);break;case fp.INSERT_TIMEOUT:e.insertSpecialMove(Xe.TIMEOUT);break;case fp.INSERT_FOUL_WIN:e.insertSpecialMove(Xe.FOUL_WIN);break;case fp.INSERT_FOUL_LOSE:e.insertSpecialMove(Xe.FOUL_LOSE);break;case fp.INSERT_ENTERING_OF_KING:e.insertSpecialMove(Xe.ENTERING_OF_KING);break;case fp.INSERT_WIN_BY_DEFAULT:e.insertSpecialMove(Xe.WIN_BY_DEFAULT);break;case fp.INSERT_LOSS_BY_DEFAULT:e.insertSpecialMove(Xe.LOSS_BY_DEFAULT);break;case fp.REMOVE_RECORD_AFTER:e.removeRecordAfter();break;case fp.START_POSITION_EDITING:e.startPositionEditing();break;case fp.END_POSITION_EDITING:e.endPositionEditing();break;case fp.CHANGE_TURN:e.changeTurn();break;case fp.INIT_POSITION_STANDARD:e.initializePosition(Le.STANDARD);break;case fp.INIT_POSITION_HANDICAP_LANCE:e.initializePosition(Le.HANDICAP_LANCE);break;case fp.INIT_POSITION_HANDICAP_RIGHT_LANCE:e.initializePosition(Le.HANDICAP_RIGHT_LANCE);break;case fp.INIT_POSITION_HANDICAP_BISHOP:e.initializePosition(Le.HANDICAP_BISHOP);break;case fp.INIT_POSITION_HANDICAP_ROOK:e.initializePosition(Le.HANDICAP_ROOK);break;case fp.INIT_POSITION_HANDICAP_ROOK_LANCE:e.initializePosition(Le.HANDICAP_ROOK_LANCE);break;case fp.INIT_POSITION_HANDICAP_2PIECES:e.initializePosition(Le.HANDICAP_2PIECES);break;case fp.INIT_POSITION_HANDICAP_4PIECES:e.initializePosition(Le.HANDICAP_4PIECES);break;case fp.INIT_POSITION_HANDICAP_6PIECES:e.initializePosition(Le.HANDICAP_6PIECES);break;case fp.INIT_POSITION_HANDICAP_8PIECES:e.initializePosition(Le.HANDICAP_8PIECES);break;case fp.INIT_POSITION_TSUME_SHOGI:e.initializePosition(Le.TSUME_SHOGI);break;case fp.INIT_POSITION_TSUME_SHOGI_2KINGS:e.initializePosition(Le.TSUME_SHOGI_2KINGS);break;case fp.START_GAME:e.showGameDialog();break;case fp.STOP_GAME:e.stopGame();break;case fp.RESIGN:Ii.resign();break;case fp.START_RESEARCH:e.showResearchDialog();break;case fp.STOP_RESEARCH:e.stopResearch();break;case fp.START_ANALYSIS:e.showAnalysisDialog();break;case fp.STOP_ANALYSIS:e.stopAnalysis();break;case fp.FLIP_BOARD:e.flipBoard();break;case fp.APP_SETTING_DIALOG:e.showAppSettingDialog();break;case fp.USI_ENGINE_SETTING_DIALOG:e.showUsiEngineManagementDialog();break}})),ii.onUSIBestMove((function(e,t,n,i){Ri(e,t,n,i)})),ii.onUSIInfo((function(t,n,i,r,o){e.updateUSIInfo(t,n,i,r,JSON.parse(o))})),ii.onUSIPonderInfo((function(t,n,i,r,o){e.updateUSIPonderInfo(t,n,i,r,JSON.parse(o))})),(0,a.YP)((function(){return[e.appState,e.isBussy]}),(function(e){var t=(0,es.Z)(e,2),n=t[0],i=t[1];ii.updateMenuState(n,i)})),ii.updateMenuState(e.appState,e.isBussy)}(function(e){e["NEW_RECORD"]="newRecord",e["OPEN_RECORD"]="openRecord",e["SAVE_RECORD"]="saveRecord",e["SAVE_RECORD_AS"]="saveRecordAs",e["COPY_RECORD"]="copyRecord",e["COPY_RECORD_CSA"]="copyRecordCsa",e["COPY_RECORD_USI_BEFORE"]="copyRecordUsiBefore",e["COPY_RECORD_USI_ALL"]="copyRecordUsiAll",e["COPY_BOARD_SFEN"]="copyRecordSfen",e["PASTE_RECORD"]="pasteRecord",e["INSERT_INTERRUPT"]="insertInterrupt",e["INSERT_RESIGN"]="insertResign",e["INSERT_DRAW"]="insertDraw",e["INSERT_REPETITION_DRAW"]="insertRepetitionDraw",e["INSERT_MATE"]="insertMate",e["INSERT_TIMEOUT"]="insertTimeout",e["INSERT_FOUL_WIN"]="insertFoulWin",e["INSERT_FOUL_LOSE"]="insertFoulLose",e["INSERT_ENTERING_OF_KING"]="insertEnteringOfKing",e["INSERT_WIN_BY_DEFAULT"]="insertWinByDefault",e["INSERT_LOSS_BY_DEFAULT"]="insertLossByDefault",e["REMOVE_RECORD_AFTER"]="remvoeRecordAfter",e["START_POSITION_EDITING"]="startPositionEditing",e["END_POSITION_EDITING"]="endPositionEditing",e["CHANGE_TURN"]="changeTurn",e["INIT_POSITION_STANDARD"]="initPositionStandard",e["INIT_POSITION_HANDICAP_LANCE"]="initPositionHandicapLance",e["INIT_POSITION_HANDICAP_RIGHT_LANCE"]="initPositionHandicapRightLance",e["INIT_POSITION_HANDICAP_BISHOP"]="initPositionHandicapBishop",e["INIT_POSITION_HANDICAP_ROOK"]="initPositionHandicapRook",e["INIT_POSITION_HANDICAP_ROOK_LANCE"]="initPositionHandicapRookLance",e["INIT_POSITION_HANDICAP_2PIECES"]="initPositionHandicap2Pieces",e["INIT_POSITION_HANDICAP_4PIECES"]="initPositionHandicap4Pieces",e["INIT_POSITION_HANDICAP_6PIECES"]="initPositionHandicap6Pieces",e["INIT_POSITION_HANDICAP_8PIECES"]="initPositionHandicap8Pieces",e["INIT_POSITION_TSUME_SHOGI"]="initPositionTsumeShogi",e["INIT_POSITION_TSUME_SHOGI_2KINGS"]="initPositionTsumeShogi2Kings",e["START_RESEARCH"]="startResearch",e["STOP_RESEARCH"]="stopResearch",e["START_ANALYSIS"]="startAnalysis",e["STOP_ANALYSIS"]="stopAnalysis",e["START_GAME"]="startGame",e["STOP_GAME"]="stopGame",e["RESIGN"]="resign",e["FLIP_BOARD"]="flipBoard",e["APP_SETTING_DIALOG"]="appSetting",e["USI_ENGINE_SETTING_DIALOG"]="usiEngineSetting"})(fp||(fp={})),oi.log(jn.INFO,"start renderer process"),ts.kL.register.apply(ts.kL,(0,r.Z)(ts.zX)),mp();var _p=zi();Promise.allSettled([oi.loadAppSetting().then((function(e){_p.updateAppSetting(e)})).catch((function(e){_p.pushError(new Error("アプリ設定の読み込み中にエラーが発生しました :"+e))})),(0,i.Z)(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,oi.getRecordPathFromProcArg();case 2:t=e.sent,t&&_p.openRecord(t);case 4:case"end":return e.stop()}}),e)})))()]).finally((function(){oi.log(jn.INFO,"mount app"),(0,o.ri)(gp).mount("#app")}))},5832:function(){}},t={};function n(i){var r=t[i];if(void 0!==r)return r.exports;var o=t[i]={exports:{}};return e[i](o,o.exports,n),o.exports}n.m=e,function(){var e=[];n.O=function(t,i,r,o){if(!i){var a=1/0;for(l=0;l<e.length;l++){i=e[l][0],r=e[l][1],o=e[l][2];for(var s=!0,c=0;c<i.length;c++)(!1&o||a>=o)&&Object.keys(n.O).every((function(e){return n.O[e](i[c])}))?i.splice(c--,1):(s=!1,o<a&&(a=o));if(s){e.splice(l--,1);var u=r();void 0!==u&&(t=u)}}return t}o=o||0;for(var l=e.length;l>0&&e[l-1][2]>o;l--)e[l]=e[l-1];e[l]=[i,r,o]}}(),function(){n.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(t,{a:t}),t}}(),function(){n.d=function(e,t){for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})}}(),function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={826:0};n.O.j=function(t){return 0===e[t]};var t=function(t,i){var r,o,a=i[0],s=i[1],c=i[2],u=0;if(a.some((function(t){return 0!==e[t]}))){for(r in s)n.o(s,r)&&(n.m[r]=s[r]);if(c)var l=c(n)}for(t&&t(i);u<a.length;u++)o=a[u],n.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return n.O(l)},i=self["webpackChunkelectron_shogi"]=self["webpackChunkelectron_shogi"]||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))}();var i=n.O(void 0,[998],(function(){return n(739)}));i=n.O(i)})();
//# sourceMappingURL=index-legacy.7836455f.js.map